<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  

  
  <title>一帖看透iOS14 小组件 | 我的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="自iOS8之后，苹果支持了扩展（Extension）的开发，开发者可以通过系统提供给我们的扩展接入点 (Extension point) 来为系统特定的服务提供某些附加的功能。但iOS14后，苹果更新了扩展组件，引入了新的UI组件：WidgetKit 而舍弃了iOS14以下版本的Today Extension组件  Widget介绍这里有一份官方的小组件使用指南 简单来说：小组件相当于一个动态程">
<meta property="og:type" content="article">
<meta property="og:title" content="一帖看透iOS14 小组件">
<meta property="og:url" content="https://zcx4u.github.io/2021/02/23/%E4%B8%80%E5%B8%96%E7%9C%8B%E9%80%8FiOS14%20%E5%B0%8F%E7%BB%84%E4%BB%B6/index.html">
<meta property="og:site_name" content="我的博客">
<meta property="og:description" content="自iOS8之后，苹果支持了扩展（Extension）的开发，开发者可以通过系统提供给我们的扩展接入点 (Extension point) 来为系统特定的服务提供某些附加的功能。但iOS14后，苹果更新了扩展组件，引入了新的UI组件：WidgetKit 而舍弃了iOS14以下版本的Today Extension组件  Widget介绍这里有一份官方的小组件使用指南 简单来说：小组件相当于一个动态程">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.zcx.info/008eGmZEly1gnu0x3a5faj305g05p0tr.jpg">
<meta property="og:image" content="https://cdn.zcx.info/008eGmZEly1gnu0y70jk5j30ae0bgjuv.jpg">
<meta property="og:image" content="https://cdn.zcx.info/008eGmZEly1gnu1b833goj30g90gdadn.jpg">
<meta property="og:image" content="https://cdn.zcx.info/008eGmZEly1gnu1b7z83jj30kb0eodh5.jpg">
<meta property="og:image" content="https://cdn.zcx.info/008eGmZEly1gnu1b7vu85j30ke0eoq3v.jpg">
<meta property="og:image" content="https://gitee.com/zcx_bruin/gitee-images/blob/master/Hexo/iOS14Widget/008eGmZEgy1gnu587og7mj30e902s3yi.jpg">
<meta property="og:image" content="https://cdn.zcx.info/008eGmZEly1gnu1ge3kbuj30eb03hglp.jpg">
<meta property="og:image" content="https://cdn.zcx.info/008eGmZEly1gnu2oixw72j304o051mx9.jpg">
<meta property="og:image" content="https://cdn.zcx.info/008eGmZEly1gnwiq5qmqfj30n80rugn1.jpg">
<meta property="og:image" content="https://cdn.zcx.info/008eGmZEly1gnwfwkcrujj30il04f3yq.jpg">
<meta property="og:image" content="https://cdn.zcx.info/008eGmZEly1gnwfux3fiej31310ibn10.jpg">
<meta property="og:image" content="https://cdn.zcx.info/008eGmZEly1gnwfqmmkj4j305r06waag.jpg">
<meta property="og:image" content="https://cdn.zcx.info/008eGmZEly1gnwg0oh85cj30iw06ljsr.jpg">
<meta property="og:image" content="https://cdn.zcx.info/008eGmZEly1gnwgzuiadlj30rh09g751.jpg">
<meta property="og:image" content="https://cdn.zcx.info/008eGmZEly1gnwha6k9wsj30970g3dgy.jpg">
<meta property="article:published_time" content="2021-02-22T16:00:00.000Z">
<meta property="article:modified_time" content="2025-03-13T10:01:43.057Z">
<meta property="article:author" content="bruin">
<meta property="article:tag" content="小组件">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.zcx.info/008eGmZEly1gnu0x3a5faj305g05p0tr.jpg">
  
    <link rel="alternate" href="/atom.xml" title="我的博客" type="application/atom+xml">
  
  
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-192.png" sizes="192x192">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-192.png" sizes="192x192">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/images/banner.webp" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="  ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>我的博客 </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
      <a id="nav-rss-link" class="nav-icon mobile-hide" href="/atom.xml" title="RSS 订阅">
        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M198-120q-25.846 0-44.23-18.384-18.384-18.385-18.384-44.23 0-25.846 18.384-44.23 18.384-18.385 44.23-18.385 25.846 0 44.23 18.385 18.384 18.384 18.384 44.23 0 25.845-18.384 44.23Q223.846-120 198-120Zm538.385 0q-18.846 0-32.923-13.769-14.076-13.769-15.922-33.23-8.692-100.616-51.077-188.654-42.385-88.039-109.885-155.539-67.5-67.501-155.539-109.885Q283-663.462 182.385-672.154q-19.461-1.846-33.23-16.23-13.769-14.385-13.769-33.846t14.076-32.922q14.077-13.461 32.923-12.23 120.076 8.692 226.038 58.768 105.961 50.077 185.73 129.846 79.769 79.769 129.846 185.731 50.077 105.961 58.769 226.038 1.231 18.846-12.538 32.922Q756.461-120 736.385-120Zm-252 0q-18.231 0-32.423-13.461t-18.653-33.538Q418.155-264.23 348.886-333.5q-69.27-69.27-166.501-84.423-20.077-4.462-33.538-18.961-13.461-14.5-13.461-33.346 0-19.076 13.884-33.23 13.884-14.153 33.115-10.922 136.769 15.384 234.384 112.999 97.615 97.615 112.999 234.384 3.231 19.23-10.538 33.115Q505.461-120 484.385-120Z"/></svg>
      </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
    
      <a class="nav-dropdown-link" href="/atom.xml" title="RSS 订阅">RSS</a>
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/images/bruin.png></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">bruin </div>
      <div class="dot"></div>
      <div class="subtitle">个人技术博客 </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/zcx4u" title="GitHub"><i class="fa-brands fa-github"></i></a>
        
          <a class="link-btn" href="mailto:your-email@example.com" title="Email"><i class="fa-solid fa-envelope"></i></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">分类</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/%E6%8A%80%E6%9C%AF/">
                技术
                <div class="category-count">4</div>
            </a>
        
            <a class="category-link" href="/categories/iOS/">
                iOS
                <div class="category-count">19</div>
            </a>
        
            <a class="category-link" href="/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/">
                软件工程
                <div class="category-count">1</div>
            </a>
        
            <a class="category-link" href="/categories/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/">
                工程实践
                <div class="category-count">1</div>
            </a>
        </div>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">标签</h3>
      <ul class="widget-tag-list" itemprop="keywords"><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/AIGC/" rel="tag">AIGC</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/BUG%E8%AE%B0%E5%BD%95%E5%92%8C%E7%BB%8F%E9%AA%8C%E6%94%B6%E9%9B%86/" rel="tag">BUG记录和经验收集</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ChatGPT/" rel="tag">ChatGPT</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Xcode/" rel="tag">Xcode</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ios/" rel="tag">iOS</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E4%B8%80%E9%94%AE%E5%94%A4%E8%B5%B7/" rel="tag">一键唤起</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E6%9F%A5/" rel="tag">代码审查</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7/" rel="tag">可观测性</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E5%A4%9A%E8%AF%BB%E6%96%87%E6%A1%A3/" rel="tag">多读文档</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84/" rel="tag">学习路径</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E5%B0%8F%E7%BB%84%E4%BB%B6/" rel="tag">小组件</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" rel="tag">开发工具</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/" rel="tag">开发流程</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E6%8A%80%E6%9C%AF%E8%B0%83%E7%A0%94/" rel="tag">技术调研</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E6%95%88%E7%8E%87/" rel="tag">效率</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/" rel="tag">日志系统</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/best-practices/" rel="tag">最佳实践</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E6%9C%89%E7%94%A8%E7%9A%84/" rel="tag">有用的</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E7%9F%A5%E8%AF%86%E7%82%B9/" rel="tag">知识点</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/mobile-dev/" rel="tag">移动开发</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E7%BB%8F%E9%AA%8C%E8%AE%B0%E5%BD%95/" rel="tag">经验记录</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E8%81%8C%E4%B8%9A%E5%8F%91%E5%B1%95/" rel="tag">职业发展</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E8%B0%83%E8%AF%95/" rel="tag">调试</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/" rel="tag">错误处理</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag">面试</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">归档</h3>
      
      
        <a class="archive-link" href="/archives/2025/03 ">
          三月 2025 
          <div class="archive-count">4 </div>
        </a>
      
        <a class="archive-link" href="/archives/2024/01 ">
          一月 2024 
          <div class="archive-count">4 </div>
        </a>
      
        <a class="archive-link" href="/archives/2022/11 ">
          十一月 2022 
          <div class="archive-count">1 </div>
        </a>
      
        <a class="archive-link" href="/archives/2022/07 ">
          七月 2022 
          <div class="archive-count">1 </div>
        </a>
      
        <a class="archive-link" href="/archives/2022/02 ">
          二月 2022 
          <div class="archive-count">1 </div>
        </a>
      
        <a class="archive-link" href="/archives/2021/12 ">
          十二月 2021 
          <div class="archive-count">2 </div>
        </a>
      
        <a class="archive-link" href="/archives/2021/09 ">
          九月 2021 
          <div class="archive-count">2 </div>
        </a>
      
        <a class="archive-link" href="/archives/2021/08 ">
          八月 2021 
          <div class="archive-count">3 </div>
        </a>
      
        <a class="archive-link" href="/archives/2021/04 ">
          四月 2021 
          <div class="archive-count">2 </div>
        </a>
      
        <a class="archive-link" href="/archives/2021/02 ">
          二月 2021 
          <div class="archive-count">1 </div>
        </a>
      
        <a class="archive-link" href="/archives/2021/01 ">
          一月 2021 
          <div class="archive-count">1 </div>
        </a>
      
        <a class="archive-link" href="/archives/2020/09 ">
          九月 2020 
          <div class="archive-count">3 </div>
        </a>
      
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">最新文章</h3>
      <ul>
        
          <a class="recent-link" href="/2025/03/14/CodeReview%E6%8C%87%E5%8D%97/" title="代码审查实战指南" >
            <div class="recent-link-text">
              代码审查实战指南
            </div>
          </a>
        
          <a class="recent-link" href="/2025/03/14/%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%97%A5%E5%BF%97%E8%A7%84%E8%8C%83%E6%8C%87%E5%8D%97/" title="客户端日志规范指南" >
            <div class="recent-link-text">
              客户端日志规范指南
            </div>
          </a>
        
          <a class="recent-link" href="/2025/03/12/iOSCrash%E7%B1%BB%E5%9E%8B/" title="iOS Crash类型总结" >
            <div class="recent-link-text">
              iOS Crash类型总结
            </div>
          </a>
        
          <a class="recent-link" href="/2025/03/12/iOS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E6%8C%87%E5%8D%97/" title="iOS文件系统编程指南" >
            <div class="recent-link-text">
              iOS文件系统编程指南
            </div>
          </a>
        
          <a class="recent-link" href="/2024/01/15/ChatGPT%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7%E6%89%8B%E5%86%8C/" title="ChatGPT使用技巧手册" >
            <div class="recent-link-text">
              ChatGPT使用技巧手册
            </div>
          </a>
        
          <a class="recent-link" href="/2024/01/01/%E6%8A%80%E6%9C%AF%E8%B7%AF%E7%BA%BF%E5%9B%BE/" title="iOS 开发者技术路线图（2025 年）" >
            <div class="recent-link-text">
              iOS 开发者技术路线图（2025 年）
            </div>
          </a>
        
          <a class="recent-link" href="/2024/01/01/%E7%AE%97%E6%B3%95/" title="常见算法考题列表（2025 年整理）" >
            <div class="recent-link-text">
              常见算法考题列表（2025 年整理）
            </div>
          </a>
        
          <a class="recent-link" href="/2024/01/01/%E9%AB%98%E9%A2%91%E9%97%AE%E9%A2%98/" title="iOS 面试高频问题总结（2025 最新版）" >
            <div class="recent-link-text">
              iOS 面试高频问题总结（2025 最新版）
            </div>
          </a>
        
          <a class="recent-link" href="/2022/11/05/iOS%E7%AD%BE%E5%90%8D%E6%9C%BA%E5%88%B6/" title="iOS签名机制" >
            <div class="recent-link-text">
              iOS签名机制
            </div>
          </a>
        
          <a class="recent-link" href="/2022/07/06/SwiftUI/" title="SwiftUI 从入门到放弃" >
            <div class="recent-link-text">
              SwiftUI 从入门到放弃
            </div>
          </a>
        
          <a class="recent-link" href="/2022/02/28/XCUITest%E6%8E%A2%E7%B4%A2/" title="XCUITest iOS自动化UI测试框架" >
            <div class="recent-link-text">
              XCUITest iOS自动化UI测试框架
            </div>
          </a>
        
          <a class="recent-link" href="/2021/12/06/iOS%20Web%E5%94%A4%E8%B5%B7APP%E6%96%B9%E6%A1%88%E5%8F%82%E8%80%83/" title="iOS 一键唤起APP方案参考" >
            <div class="recent-link-text">
              iOS 一键唤起APP方案参考
            </div>
          </a>
        
          <a class="recent-link" href="/2021/12/06/%E4%BF%A1%E6%81%AF%E6%B5%81GIF%E8%BD%AE%E6%92%AD%E6%A1%86%E6%9E%B6/" title="iOS 如何做一个九宫格GIF播放器" >
            <div class="recent-link-text">
              iOS 如何做一个九宫格GIF播放器
            </div>
          </a>
        
          <a class="recent-link" href="/2021/09/18/iOS%E7%BC%96%E8%AF%91%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%AE%9E%E8%B7%B5-%E7%BB%84%E4%BB%B6%E7%AF%87/" title="iOS编译优化方案探索与实践-组件篇" >
            <div class="recent-link-text">
              iOS编译优化方案探索与实践-组件篇
            </div>
          </a>
        
          <a class="recent-link" href="/2021/09/09/module-importing%20failed-invalid%20pathname/" title="module importing failed invalid pathname 问题解决" >
            <div class="recent-link-text">
              module importing failed invalid pathname 问题解决
            </div>
          </a>
        
          <a class="recent-link" href="/2021/08/31/iOS-OCR%E5%AE%9E%E8%B7%B5/" title="iOS-OCR实践" >
            <div class="recent-link-text">
              iOS-OCR实践
            </div>
          </a>
        
          <a class="recent-link" href="/2021/08/25/AVPlayer%E7%9B%B8%E5%85%B3BUG%E8%AE%B0%E5%BD%95/" title="AVPlayer相关BUG记录" >
            <div class="recent-link-text">
              AVPlayer相关BUG记录
            </div>
          </a>
        
          <a class="recent-link" href="/2021/08/25/Xcode%E4%BB%A3%E7%A0%81%E5%9D%97%E4%BA%91%E5%90%8C%E6%AD%A5+%E6%9C%AC%E5%9C%B0%E5%AE%89%E8%A3%85%E8%84%9A%E6%9C%AC/" title="Xcode代码块云同步+本地安装脚本" >
            <div class="recent-link-text">
              Xcode代码块云同步+本地安装脚本
            </div>
          </a>
        
          <a class="recent-link" href="/2021/04/22/iOS%E5%AD%97%E7%AC%A6%E5%92%8C%E5%AD%97%E7%B4%A0%E7%B0%87/" title="iOS字符串安全截取及任意位置插入" >
            <div class="recent-link-text">
              iOS字符串安全截取及任意位置插入
            </div>
          </a>
        
          <a class="recent-link" href="/2021/04/20/NSCache/" title="NSCache" >
            <div class="recent-link-text">
              NSCache
            </div>
          </a>
        
          <a class="recent-link" href="/2021/02/23/%E4%B8%80%E5%B8%96%E7%9C%8B%E9%80%8FiOS14%20%E5%B0%8F%E7%BB%84%E4%BB%B6/" title="一帖看透iOS14 小组件" >
            <div class="recent-link-text">
              一帖看透iOS14 小组件
            </div>
          </a>
        
          <a class="recent-link" href="/2021/01/18/APP%E4%BB%A3%E7%90%86/" title="APP内部代理" >
            <div class="recent-link-text">
              APP内部代理
            </div>
          </a>
        
          <a class="recent-link" href="/2020/09/25/runloop/" title="runloop 学习笔记" >
            <div class="recent-link-text">
              runloop 学习笔记
            </div>
          </a>
        
          <a class="recent-link" href="/2020/09/23/block/" title="__block 关键字探究" >
            <div class="recent-link-text">
              __block 关键字探究
            </div>
          </a>
        
          <a class="recent-link" href="/2020/09/22/GCD/" title="GCD相关知识学习笔记" >
            <div class="recent-link-text">
              GCD相关知识学习笔记
            </div>
          </a>
        
      </ul>
    </div>
  </div>

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       


<article id="post-一帖看透iOS14 小组件" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        一帖看透iOS14 小组件
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2021-02-22T16:00:00.000Z" itemprop="datePublished">2021-02-23</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/categories/iOS/">iOS</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            10k 词 
          </div>
        </div>
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B0%8F%E7%BB%84%E4%BB%B6/" rel="tag">小组件</a></li></ul>

      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <blockquote>
<p>自iOS8之后，苹果支持了扩展（Extension）的开发，开发者可以通过系统提供给我们的扩展接入点 (Extension point) 来为系统特定的服务提供某些附加的功能。<br>但iOS14后，苹果更新了扩展组件，引入了新的UI组件：<code>WidgetKit</code> 而舍弃了iOS14以下版本的Today Extension组件</p>
</blockquote>
<h3 id="Widget介绍"><a href="#Widget介绍" class="headerlink" title="Widget介绍"></a>Widget介绍</h3><p><a target="_blank" rel="noopener" href="https://support.apple.com/zh-cn/HT207122">这里有一份官方的小组件使用指南</a></p>
<p>简单来说：小组件相当于一个动态程序入口，在有限的空间内展示你想看到的重要的信息</p>
<img src="https://cdn.zcx.info/008eGmZEly1gnu0x3a5faj305g05p0tr.jpg" alt="电池小组件" style="zoom:50%;" />

<p>苹果自带的日历使用起来非常不适，下载第三方日历又不想被捆绑的无用功能打扰。有了小组件之后这个问题就很好的解决了，比如上面的日历小组件，清晰的展示了今天的日期和农历以及周几，打开手机锁屏就能看见。</p>
<p>此外系统自带的电量小组件，方便的展示了需要下滑去状态栏才能看到的耳机电量：</p>
<img src="https://cdn.zcx.info/008eGmZEly1gnu0y70jk5j30ae0bgjuv.jpg" alt="电池小组件" style="zoom:50%;" />

<p>之前发布的时候觉得这都是安卓系统玩剩下的东西，没什么卵用，不过现在是真香！</p>
<hr>
<h3 id="Widget设计指南"><a href="#Widget设计指南" class="headerlink" title="Widget设计指南"></a>Widget设计指南</h3><p><a target="_blank" rel="noopener" href="https://developer.apple.com/design/human-interface-guidelines/ios/system-capabilities/widgets/">这里有一份官方的设计指南</a></p>
<p>简而言之，设计一个简单漂亮吸引人并且快速显示内容的小组件。</p>
<hr>
<h3 id="Widget-HelloWorld"><a href="#Widget-HelloWorld" class="headerlink" title="Widget: HelloWorld"></a>Widget: HelloWorld</h3><p><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/widgetkit/creating-a-widget-extension">这里有一份官方的开发文档可以参考</a></p>
<p>一个小组件需要经过</p>
<p><code>FIle</code> &gt; <code>New</code> &gt;<code>Target</code> &gt;<code>Wiget Extension</code>  来创建</p>
<img src="https://cdn.zcx.info/008eGmZEly1gnu1b833goj30g90gdadn.jpg" style="zoom:100%;" />

<p>找到我们需要的 <code>Widget Extension</code></p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnu1b7z83jj30kb0eodh5.jpg"></p>
<p>命名小组件</p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnu1b7vu85j30ke0eoq3v.jpg"></p>
<p>图中圈着的选项控制了我们的小组件能否配置属性，例如天气相关的小组件就可能需要你手动配置地址来获取你想要知道的城市的天气数据。</p>
<p>这样就创建好了一个小组件。小组件的文件结构如下：</p>
<p><img src="https://gitee.com/zcx_bruin/gitee-images/blob/master/Hexo/iOS14Widget/008eGmZEgy1gnu587og7mj30e902s3yi.jpg" alt="不带配置项的小组件结构"></p>
<p>这里我们选则了不带配置项的小组件</p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnu1ge3kbuj30eb03hglp.jpg" alt="带配置项的结构"></p>
<p>带配置项的小组件的结构 主要区别在于 <code>TestWidget.intentdefinition</code>文件上，这个文件内部可以添加配置选项。</p>
<p>TestWidget代码如下</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> WidgetKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Provider</span>: <span class="title class_ inherited__">TimelineProvider</span> &#123;</span><br><span class="line">   	<span class="comment">/// 默认显示（无自定数据情况下显示）</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">placeholder</span>(<span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">SimpleEntry</span> &#123;</span><br><span class="line">        <span class="type">SimpleEntry</span>(date: <span class="type">Date</span>())</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">///getSnapshot方法是提供一个预览数据，可以让用户看到该组件的一个大致情况，是长什么样、显示什么数据的，可以写成固定数据，国外的			文章里叫它“fake information”</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">getSnapshot</span>(<span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>, <span class="params">completion</span>: <span class="keyword">@escaping</span> (<span class="type">SimpleEntry</span>) -&gt; ()) &#123;</span><br><span class="line">        <span class="keyword">let</span> entry <span class="operator">=</span> <span class="type">SimpleEntry</span>(date: <span class="type">Date</span>())</span><br><span class="line">        completion(entry)</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">		<span class="comment">///包含要显示的所有条目：预期显示的时间（条目的日期）以及时间轴“过期”的时间</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">getTimeline</span>(<span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>, <span class="params">completion</span>: <span class="keyword">@escaping</span> (<span class="type">Timeline</span>&lt;<span class="type">Entry</span>&gt;) -&gt; ()) &#123;</span><br><span class="line">        <span class="keyword">var</span> entries: [<span class="type">SimpleEntry</span>] <span class="operator">=</span> []</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Generate a timeline consisting of five entries an hour apart, starting from the current date.</span></span><br><span class="line">        <span class="keyword">let</span> currentDate <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">        <span class="keyword">for</span> hourOffset <span class="keyword">in</span> <span class="number">0</span> <span class="operator">..&lt;</span> <span class="number">5</span> &#123;</span><br><span class="line">            <span class="comment">//需要在这里从网络加载数据回来 同步进行初始化</span></span><br><span class="line">            <span class="keyword">let</span> entryDate <span class="operator">=</span> <span class="type">Calendar</span>.current.date(byAdding: .hour, value: hourOffset, to: currentDate)<span class="operator">!</span></span><br><span class="line">            <span class="keyword">let</span> entry <span class="operator">=</span> <span class="type">SimpleEntry</span>(date: entryDate)</span><br><span class="line">            entries.append(entry)</span><br><span class="line">        &#125;</span><br><span class="line">				<span class="comment">// atEnd 指在最后一个显示时间点的小组件完毕后重新刷新TimeLine</span></span><br><span class="line">        <span class="keyword">let</span> timeline <span class="operator">=</span> <span class="type">Timeline</span>(entries: entries, policy: .atEnd)</span><br><span class="line">        completion(timeline)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SimpleEntry</span>: <span class="title class_ inherited__">TimelineEntry</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> date: <span class="type">Date</span></span><br><span class="line">  	<span class="comment">// 下面可以自己添加自定义的model</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TestWidgetEntryView</span> : <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> entry: <span class="type">Provider</span>.<span class="type">Entry</span></span><br><span class="line">		<span class="comment">// swiftUI的View 可以返回一系列View 具体请参看SwiftUI文档</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(entry.date, style: .time)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 小组件主入口</span></span><br><span class="line"><span class="keyword">@main</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TestWidget</span>: <span class="title class_ inherited__">Widget</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> kind: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;TestWidget&quot;</span></span><br><span class="line">		<span class="comment">// StaticConfiguration 不带配置项的小组件初始化方式</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">WidgetConfiguration</span> &#123;</span><br><span class="line">        <span class="type">StaticConfiguration</span>(kind: kind, provider: <span class="type">Provider</span>()) &#123; entry <span class="keyword">in</span></span><br><span class="line">            <span class="type">TestWidgetEntryView</span>(entry: entry)</span><br><span class="line">        &#125;</span><br><span class="line">        .configurationDisplayName(<span class="string">&quot;My Widget&quot;</span>)</span><br><span class="line">        .description(<span class="string">&quot;This is an example widget.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 实时预览view</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TestWidget_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">TestWidgetEntryView</span>(entry: <span class="type">SimpleEntry</span>(date: <span class="type">Date</span>()))</span><br><span class="line">            .previewContext(<span class="type">WidgetPreviewContext</span>(family: .systemSmall))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>于是我们获得了第一个小组件：</p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnu2oixw72j304o051mx9.jpg"></p>
<p>看起来很简单吧！</p>
<hr>
<h3 id="Widget结构解析"><a href="#Widget结构解析" class="headerlink" title="Widget结构解析"></a>Widget结构解析</h3><h4 id="至关重要-TimeLine"><a href="#至关重要-TimeLine" class="headerlink" title="至关重要 TimeLine"></a>至关重要 TimeLine</h4><p><code>getTimeLine</code> 方法获取小组件整个显示周期。</p>
<p>为了管理系统负载，<code>WidgetKit</code>使用预算来分配一天中的窗口小部件重新负载。</p>
<blockquote>
<p>Widgets use SwiftUI views to display their content. WidgetKit renders the views on your behalf in a separate process. As a result, your widget extension is not continually active, even if the widget is onscreen. Despite your widget not always being active, there are several ways you can keep its content up to date.</p>
</blockquote>
<p>抛开 <code>SwiftUI</code>不谈，单说 <code>your widget extension is not continually active</code> ，这段文字清晰的说明了小组件所面临的问题：不能实时刷新。即使你的小组件在你目光注视中，小组件也不能保持最新状态。</p>
<p>重新加载窗口小部件会消耗系统资源，并会由于额外的联网和处理而导致电池消耗。为了减少对性能的影响并保持全天的电池寿命，请求的更新频率和更新次数将会限制为必要。</p>
<p>那么小组件如何刷新？</p>
<blockquote>
<p>Many widgets have predictable points in time where it makes sense to update their content. For example, a widget that displays weather information might update the temperature hourly throughout the day. A stock market widget could update its content frequently during open market hours, but not at all over the weekend. By planning these times in advance, WidgetKit automatically refreshes your widget when the appropriate time arrives.</p>
</blockquote>
<p>许多APP需要定时刷新数据，这些刷新时间是可预测的，比如日历APP每天刷新当日的日期信息，股市APP则会在工作日频繁刷新交易信息，但是在休息日不频繁刷新。</p>
<p>当我们能够为小组件提供一个可预测的时间点和刷新策略，系统便会按照既定的顺序刷新。</p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnwiq5qmqfj30n80rugn1.jpg"></p>
<p>如图所示，我们在 <code>.Now</code>和每隔1小时共三小时设置四个显示时间点，系统在get到我们给定的 <code>TimeLine</code>之后会在当前、一小时后、两小时后、三小时后总计四个时间点进行小组件UI渲染,由于我们第一次给定的重新刷新策略为 <code>.atEnd</code>所以会在三个小时时间点渲染完毕之后重新获取 <code>TimeLine</code>。</p>
<p>第二个 <code>TimeLine(Provide timeline)</code>中设置的重新刷新策略为 <code>.never</code>所以在这个时间点的小组件渲染完毕之后就不再刷新了。</p>
<h4 id="添加预览-Snapshot"><a href="#添加预览-Snapshot" class="headerlink" title="添加预览 Snapshot"></a>添加预览 Snapshot</h4><p><code>getSnapshot</code>方法比较简单，这个方法获取我们在打开小组件预览界面时所看到的三个小组件的 <code>Entry</code>。</p>
<p>这里如果不需要展示实时数据的时候可以放入固定的预览数据以获得最好的体验(不需要请求网络直接渲染数据)。</p>
<h4 id="界面美化-Placeholder"><a href="#界面美化-Placeholder" class="headerlink" title="界面美化 Placeholder"></a>界面美化 Placeholder</h4><p><code>placeholder</code>方法目的在于获取一个没有数据或者没有网络情况下的默认View,一般是进行美化小组件的时候在这个view上做文章，</p>
<h4 id="数据支撑-TimelineEntry"><a href="#数据支撑-TimelineEntry" class="headerlink" title="数据支撑 TimelineEntry"></a>数据支撑 TimelineEntry</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SimpleEntry</span>: <span class="title class_ inherited__">TimelineEntry</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> date: <span class="type">Date</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>TimelineEntry</code>协议必须包含一个 <code>date</code>属性，用于计算需要渲染页面的时间点</p>
<p>自定义的模型可以实现这个协议用于承载内容数据。</p>
<h4 id="内容基石-WidgetEntryView"><a href="#内容基石-WidgetEntryView" class="headerlink" title="内容基石 WidgetEntryView"></a>内容基石 WidgetEntryView</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">TestWidgetEntryView</span> : <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> entry: <span class="type">Provider</span>.<span class="type">Entry</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(entry.date, style: .time)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>小组件的 <code>View</code>就是一个普通的包含 <code>Provider.Entry</code>的 <code>View(swiftUI)</code>，一般创建timeline的时候会提供 <code>Provider.Entry</code>给 <code>View</code>进行渲染。</p>
<p><code>body</code>属性下包含一系列 <code>VIew</code>控件用于渲染页面，更多 <code>SwiftUI</code>相关的知识看<a target="_blank" rel="noopener" href="https://developer.apple.com/tutorials/swiftui/creating-and-combining-views">SwiftUI文档</a>。</p>
<p>以上就是小组件的结构拆分和解析，只要明白组成结构和运行机制就能根据自己的需求去定制开发了。</p>
<hr>
<h3 id="Widget进阶"><a href="#Widget进阶" class="headerlink" title="Widget进阶"></a>Widget进阶</h3><h4 id="功能和限制"><a href="#功能和限制" class="headerlink" title="功能和限制"></a>功能和限制</h4><p><code>iOS14 Widget</code>的功能对比着以前的 <code>TodayExtension</code>要少了很多，官方对小组件添加了很多限制。</p>
<ul>
<li>小组件扩展整体需要使用 <code>SwiftUI</code>结构，<code>WidgetEntryView</code>需要提供 <code>SwiftUIView</code>。</li>
<li>页面滚动、动画和视频是被禁止的，<code>SwiftUI</code> 中 <code> List</code> 控件是无法使用的，扩展的 <code>UIKit</code>中 <code>UIVisualEffectView</code>是被禁用的(毛玻璃效果)，更多被禁用的 <code>View</code>还需要在开发中发现。</li>
<li>只支持点击事件交互。</li>
<li>无法主动更新数据 刷新数据使用 <code>Timeline</code>方式手动设置。</li>
<li>每次重置刷新轮次的间隔不能低于5分钟，低于5分钟无效 ，我们在填充 <code>entries</code>时应该为其填充5分钟内需要显示的数据。不建议显示实时时间，和手机系统显示的时间可能会出现偏差。</li>
</ul>
<h4 id="小组件样式区分-supportedFamilies"><a href="#小组件样式区分-supportedFamilies" class="headerlink" title="小组件样式区分  supportedFamilies"></a>小组件样式区分  supportedFamilies</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@main</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TestWidget</span>: <span class="title class_ inherited__">Widget</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> kind: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;TestWidget&quot;</span></span><br><span class="line">		<span class="comment">// StaticConfiguration 不带配置项的小组件初始化方式</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">WidgetConfiguration</span> &#123;</span><br><span class="line">        <span class="type">StaticConfiguration</span>(kind: kind, provider: <span class="type">Provider</span>()) &#123; entry <span class="keyword">in</span></span><br><span class="line">            <span class="type">TestWidgetEntryView</span>(entry: entry)</span><br><span class="line">        &#125;</span><br><span class="line">        .configurationDisplayName(<span class="string">&quot;My Widget&quot;</span>)</span><br><span class="line">        .description(<span class="string">&quot;This is an example widget.&quot;</span>)</span><br><span class="line">        .supportedFamilies([.systemSmall])<span class="comment">// 注意这里增加了一个方法来限制小组件支持的类型 这里只支持2x2小方块</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从主入口可以看到我们定义了一个 <code>TestWidget的</code>小组件，这个小组件默认支持三种样式。</p>
<p>我们常常只需要某一个小组件只支持一种样式，比如最小的方块形状的组件设计的时候由于尺寸及形状往往不考虑其他显示格式。</p>
<p>这时我们可以在 <code>StaticConfiguration</code>后跟上配置支持的样式方法 <code>supportedFamilies()</code>，小组件按照体积大小分为   <code>systemSmall</code>, <code> systemMedium</code>，<code>systemLarge</code>三种。</p>
<h4 id="多小组件容器-WidgetBundle"><a href="#多小组件容器-WidgetBundle" class="headerlink" title="多小组件容器  WidgetBundle"></a>多小组件容器  WidgetBundle</h4><p>在设计完成并确定要展示的小组件之后，我们会遇到一个问题，如何在入口方法处展示多个不同类型的小组件。</p>
<p>比如我们确定了三个小组件，<code>2x2</code>、<code>2x4</code>、<code>4x4</code>三种尺寸各一个，展示的内容也不相同。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@main</span> <span class="comment">// 移除原来的标记 放在这里 main只能存在一个</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">KrWidget</span>: <span class="title class_ inherited__">WidgetBundle</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">Widget</span> &#123;</span><br><span class="line">        <span class="type">KrSmallWidget</span>()</span><br><span class="line">        <span class="type">KrMediumWidget</span>()</span><br><span class="line">        <span class="type">KrLargeWidget</span>()</span><br><span class="line">      	<span class="type">TestWidget</span>()<span class="comment">// 声明好的小组件可以在WidgetBundle下直接初始化</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时我们可以将入口方法标记改成 <code>WidgetBundle</code>来适应多个小组件，<code>KrSmallWidget</code>、<code>KrMediumWidget</code>、<code>KrLargeWidget</code>为我们自定义的小组件，其结构和 <code>TestWidget</code>一致。</p>
<h4 id="所见即所得-PreviewProvider"><a href="#所见即所得-PreviewProvider" class="headerlink" title="所见即所得   PreviewProvider"></a>所见即所得   PreviewProvider</h4><p>如果对 <code>swiftUI</code>比较熟悉的胖友对这个会比较熟悉。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">TestWidget_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">TestWidgetEntryView</span>(entry: <span class="type">SimpleEntry</span>(date: <span class="type">Date</span>()))</span><br><span class="line">            .previewContext(<span class="type">WidgetPreviewContext</span>(family: .systemSmall))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个 <code>PreviewProvider</code>可以呼出实时预览的页面，方便我们码UI。</p>
<p>可以点编辑器右边的resume按钮进行预览</p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnwfwkcrujj30il04f3yq.jpg"></p>
<p>经过build可以看到预览的结果，在你代码改动的时候会实时变化，十分方便。</p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnwfux3fiej31310ibn10.jpg"></p>
<p>不小心把页面关掉的话可以在右上角五条横线按钮中找到 <code>Canvas</code>选项勾选即可 <code>(Xcode12)</code></p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnwfqmmkj4j305r06waag.jpg"></p>
<h4 id="APP内刷新小组件-WidgetCenter"><a href="#APP内刷新小组件-WidgetCenter" class="headerlink" title="APP内刷新小组件   WidgetCenter"></a>APP内刷新小组件   WidgetCenter</h4><p>如果你需要在主工程里干预小组件的刷新，你可以使用 <code>WidgetCenter（单例）</code>类来进行操作。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Reloads the timelines for all widgets of a particular kind.</span></span><br><span class="line"> <span class="comment">/// - Parameter kind: A string that identifies the widget and matches the</span></span><br><span class="line"> <span class="comment">///   value you used when you created the widget&#x27;s configuration.</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">reloadTimelines</span>(<span class="params">ofKind</span> <span class="params">kind</span>: <span class="type">String</span>)</span><br><span class="line"></span><br><span class="line"> <span class="comment">/// Reloads the timelines for all configured widgets belonging to the</span></span><br><span class="line"> <span class="comment">/// containing app.</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">reloadAllTimelines</span>()</span><br></pre></td></tr></table></figure>

<p>一般使用这两个方法，来实现主APP内刷新小组件。</p>
<h4 id="为小组件启用定位"><a href="#为小组件启用定位" class="headerlink" title="为小组件启用定位"></a>为小组件启用定位</h4><p>一些天气类型的小组件经常会获取当前的定位，小组件中如果要请求定位信息，需要在小组件目录下的 <code>info.plist</code>文件中添加 <code>NSWidgetWantsLocation</code>字段来请求权限</p>
<p>更多定位权限相关的信息请参考<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/widgetkit/accessing-location-information-in-widgets">给你的小组件添加定位信息</a></p>
<h4 id="和主APP数据共享"><a href="#和主APP数据共享" class="headerlink" title="和主APP数据共享"></a>和主APP数据共享</h4><p>由于widget跟APP间相互独立，如果想用相同的数据则需要两者间数据共享，创建**<code>App Group</code>**<br>主APP中  <code>Target</code> -&gt; <code>Signing &amp; Capability</code> -&gt; <code>+Capability</code> -&gt; <code>添加 App Group</code></p>
<p>不过如果开发者账号开启 <code>Automatically manage signing</code>的话苹果会自动给你创建相关联的APPID。</p>
<p>两者间的数据共享主要通过**<code>UserDefaults</code><strong>和</strong> <code>FileManager</code>**两种形式。</p>
<h4 id="点击交互和跳转方式"><a href="#点击交互和跳转方式" class="headerlink" title="点击交互和跳转方式"></a>点击交互和跳转方式</h4><p>点击Widget窗口唤起APP进行交互指定跳转支持两种方式：</p>
<ul>
<li><code>.widgetURL</code>：点击区域是Widget的所有区域，适合元素、逻辑简单的小部件，一个小组件只能响应一个 <code>widgetURL</code>，其中**<code>systemSmall</code>**类型的小组件只能使用此方式进行跳转</li>
<li><code>Link</code>：通过Link修饰，允许让界面上不同元素产生点击响应，一个小组件可以包含多个 <code>Link</code></li>
</ul>
<p>以上两种小组件链接点击后，可以在主 <code>APP</code>中的 <code>APPDelegate</code>类中进行响应</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">application</span>(<span class="keyword">_</span> <span class="params">app</span>: <span class="type">UIApplication</span>, <span class="params">open</span> <span class="params">url</span>: <span class="type">URL</span>, <span class="params">options</span>: [<span class="type">UIApplication</span>.<span class="params">OpenURLOptionsKey</span> : <span class="keyword">Any</span>] <span class="operator">=</span> [:]) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">  		 <span class="comment">// 一般为小组件链接定义特殊的host进行区分</span></span><br><span class="line">       <span class="keyword">if</span> url.host <span class="operator">==</span> <span class="type">WidgetExtensionHost</span> &#123;</span><br><span class="line">         <span class="comment">//处理小组件点击事件源</span></span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果 <code>APP</code>内做了切屏适配，实现了 <code>SceneDelegate</code>则需要在 <code>SceneDelegate</code>里面实现跳转处理</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">scene</span>(<span class="keyword">_</span> <span class="params">scene</span>: <span class="type">UIScene</span>, <span class="params">openURLContexts</span> <span class="params">URLContexts</span>: <span class="type">Set</span>&lt;<span class="type">UIOpenURLContext</span>&gt;) &#123;</span><br><span class="line">    <span class="keyword">for</span> context <span class="keyword">in</span> <span class="type">URLContexts</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(context.url)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="调试小组件"><a href="#调试小组件" class="headerlink" title="调试小组件"></a>调试小组件</h4><p>开发的过程中总是充满了不确定性，一些东西需要断点进行调试。那么针对小组件如何调试？其实很简单，安装APP之后把 <code>Scheme</code>修改为我们的 <code>WidgetExtension</code>，选择测试机，然后运行，在手机上添加小组件后即可看到代码进入断点。</p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnwg0oh85cj30iw06ljsr.jpg"></p>
<h4 id="机型适配"><a href="#机型适配" class="headerlink" title="机型适配"></a>机型适配</h4><p><img src="https://cdn.zcx.info/008eGmZEly1gnwgzuiadlj30rh09g751.jpg"></p>
<p>不同的设备尺寸所拥有的小组件的尺寸也是不同的，目前（iPhone12时代）小组件有以上几种尺寸。</p>
<p>在设计界面的时候和布局时需要考虑不同大小的区域的布局区别。</p>
<p>官方建议保证大的组件看起来比较好，其他尺寸的小组件根据大尺寸的进行微调。（毕竟屏幕一天比一天大）</p>
<h4 id="暗黑模式"><a href="#暗黑模式" class="headerlink" title="暗黑模式"></a>暗黑模式</h4><p>开发过程中有遇到使用双模式的图片素材时，手机切换暗黑模式后页面的图标配图没有及时更新。总觉的目前小组件还有许多问题，不是很完善。</p>
<p>解决方案为使用单模式的图，使用两套图进行根据环境切换。</p>
<p>swiftUI中使用ColorScheme判断暗黑模式</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Environment</span>(\.colorScheme) <span class="keyword">var</span> colorScheme: <span class="type">ColorScheme</span></span><br><span class="line"><span class="comment">//根据不同模式填充不同颜色</span></span><br><span class="line"><span class="type">Rectangle</span>().fill(<span class="type">Color</span>(colorScheme <span class="operator">==</span> .dark <span class="operator">?</span> <span class="type">UIColor</span>(hex: <span class="number">0x262626</span>) <span class="operator">??</span> <span class="type">UIColor</span>.black : .white))</span><br></pre></td></tr></table></figure>

<h4 id="网络请求"><a href="#网络请求" class="headerlink" title="网络请求"></a>网络请求</h4><p>如果主项目是使用swift进行开发的，可以将对应的网络请求库分享到小组件的target进行使用。在对应的类文件的Target Membership选项勾选小组件target即可。</p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnwha6k9wsj30970g3dgy.jpg"></p>
<p>但是一般主项目中的网络框架往往会夹杂很多定制化的插件或其他需求，这么分享会使项目工程代码依赖十分混乱。</p>
<p>小组件中要使用的接口服务不会很多，所以我建议这里使用简单的网络请求即可。</p>
<p>当然由于widget类似于todayExtension，这里可以和todayExtension的网络请求策略保持一致。</p>
<h4 id="网络图片"><a href="#网络图片" class="headerlink" title="网络图片"></a>网络图片</h4><p>SwiftUI中的Image没有提供直接加载URL方式的图片显示。在 <code>getTimeline</code>中进行数据请求中 <code>completion(timeline)</code>执行完之后，不再支持图片的异步回调，用异步加载的方式就无法加载网络图片，所以必须在数据请求回来的处理中采用<strong>同步方式</strong>，将图片的data获取，转换成UIImage，再赋值给Image展示</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">KrBaseWidgetEntity</span>: <span class="title class_ inherited__">Mappable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> itemId: <span class="type">Int</span>?</span><br><span class="line">    <span class="keyword">var</span> itemType: <span class="type">Int</span>?</span><br><span class="line">    <span class="keyword">var</span> widgetTitle: <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">var</span> widgetImageURL: <span class="type">URL</span>?</span><br><span class="line">    <span class="keyword">var</span> widgetImage: <span class="type">UIImage</span>?</span><br><span class="line">    <span class="keyword">var</span> route: <span class="type">String</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init?</span>(<span class="params">map</span>: <span class="type">Map</span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">mapping</span>(<span class="params">map</span>: <span class="type">Map</span>) &#123;</span><br><span class="line">        itemId <span class="operator">&lt;-</span> map[<span class="string">&quot;itemId&quot;</span>]</span><br><span class="line">        itemType <span class="operator">&lt;-</span> map[<span class="string">&quot;itemType&quot;</span>]</span><br><span class="line">        widgetTitle <span class="operator">&lt;-</span> map[<span class="string">&quot;widgetTitle&quot;</span>]</span><br><span class="line">        widgetImageURL <span class="operator">&lt;-</span> (map[<span class="string">&quot;widgetImage&quot;</span>], <span class="type">CustomURLTransform</span>())</span><br><span class="line">        route <span class="operator">&lt;-</span> map[<span class="string">&quot;route&quot;</span>]</span><br><span class="line">      	<span class="comment">//获取到图片地址后直接同步获取图片数据转换为UIImage然后在View里面转换为Image显示</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> url <span class="operator">=</span>  widgetImageURL,<span class="keyword">let</span> img <span class="operator">=</span> <span class="keyword">try?</span> <span class="type">Data</span>(contentsOf: url) &#123;</span><br><span class="line">            widgetImage <span class="operator">=</span> <span class="type">UIImage</span>(data: img)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">id</span>: <span class="type">Int</span>, <span class="params">img</span>: <span class="type">UIImage</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.itemId <span class="operator">=</span> id</span><br><span class="line">        <span class="keyword">self</span>.itemType <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">self</span>.widgetTitle <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">self</span>.widgetImage <span class="operator">=</span> img</span><br><span class="line">        <span class="keyword">self</span>.route <span class="operator">=</span> defultRoute</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="埋点传值"><a href="#埋点传值" class="headerlink" title="埋点传值"></a>埋点传值</h4><p>小组件中埋点不宜设计过于复杂，因为小组件能够一直在操作系统界面上留存，但是主APP却不一定，需要传递埋点的时候只能在点击事件传递的URL中附带埋点值然后在APP内接收和处理的时候再提取固定的埋点字段。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//目前有一个自定义的埋点传值 类似&quot;media_event_value=click_mor_and_eve_widget&quot;</span></span><br><span class="line"><span class="keyword">let</span> routeStr <span class="operator">=</span> route <span class="operator">??</span> defultRoute</span><br><span class="line">  <span class="keyword">var</span> pathURL <span class="operator">=</span>  <span class="type">URL</span>(string: <span class="string">&quot;TestWidget://<span class="subst">\(widgetHost)</span>?<span class="subst">\(routeStr)</span>&quot;</span>)<span class="operator">!</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">let</span> trackStr <span class="operator">=</span> track &#123;</span><br><span class="line">      pathURL <span class="operator">=</span>  <span class="type">URL</span>(string: <span class="string">&quot;TestWidget://<span class="subst">\(widgetHost)</span>?<span class="subst">\(routeStr)</span>&amp;<span class="subst">\(trackStr)</span>&quot;</span>)<span class="operator">!</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Widget踩坑"><a href="#Widget踩坑" class="headerlink" title="Widget踩坑"></a>Widget踩坑</h3><h4 id="强制使用SwiftUI"><a href="#强制使用SwiftUI" class="headerlink" title="强制使用SwiftUI"></a>强制使用SwiftUI</h4><p>这次的小组件更新强制使用SwiftUI可以看到苹果的目标和态度。对这个UI库不熟的话开发起来还是有点困难，不过正好也可以通过Widget对swiftUI进行一次实战训练。</p>
<h4 id="偶现第一次添加小组件到桌面UI渲染失败-系统不调用getTimeLine"><a href="#偶现第一次添加小组件到桌面UI渲染失败-系统不调用getTimeLine" class="headerlink" title="偶现第一次添加小组件到桌面UI渲染失败(系统不调用getTimeLine)"></a>偶现第一次添加小组件到桌面UI渲染失败(系统不调用getTimeLine)</h4><p>测试过程中发现的一个问题</p>
<p>APP第一次安装，第一次添加小组件的的时候，如果不等待小组件预览渲染完成就直接点 <code>添加到桌面</code>会触发初始化失败问题</p>
<p>断点调试发现这个时候操作系统不调用（有时候会等很久才调貌似是线程被阻塞了）<code>getTimeLine</code>方法，导致页面加载不成功，由于timeline获取失败，其后续的刷新时间点也没法确定，则最后全部都不能刷新。</p>
<h4 id="刷新不及时"><a href="#刷新不及时" class="headerlink" title="刷新不及时"></a>刷新不及时</h4><p>自己使用的一些其他家的小组件，例如上文提到的日历，偶尔能看到小组件上还保持着昨天的日期，这让我感觉体验很差。</p>
<p>这个新兴事物还有待优化呀。</p>

        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2021/04/20/NSCache/"
      title="NSCache"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        NSCache
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/2021/01/18/APP%E4%BB%A3%E7%90%86/"
      title="APP内部代理"
     >

    <p class="title-text">
      
        APP内部代理
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>





    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2025 bruin<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
