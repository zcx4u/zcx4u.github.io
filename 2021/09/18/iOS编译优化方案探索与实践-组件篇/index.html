<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-center-atom.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="技术调研," />





  <link rel="alternate" href="/atom.xml" title="Bruin'sBlog" type="application/atom+xml" />






<meta name="description" content="iOS编译优化方案探索与实践-组件篇序言目前主流的项目构建方案中几乎都使用cocoapods进行组件库管理，不论是第三方开源库还是自研的私有库，都会生成.podspec文件使用cocoapods工具进行维护。 为了便于进行调试，第三方开源库或私有代码库 我们都以源码的方式进行引入。 每次在本机进行全量编译或者ci机器进行打包的时候都会先编译pod仓库中的源代码，然后链接到主项目中。 这个流程没有问">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS编译优化方案探索与实践-组件篇">
<meta property="og:url" content="http://yoursite.com/2021/09/18/iOS%E7%BC%96%E8%AF%91%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%AE%9E%E8%B7%B5-%E7%BB%84%E4%BB%B6%E7%AF%87/index.html">
<meta property="og:site_name" content="Bruin&#39;sBlog">
<meta property="og:description" content="iOS编译优化方案探索与实践-组件篇序言目前主流的项目构建方案中几乎都使用cocoapods进行组件库管理，不论是第三方开源库还是自研的私有库，都会生成.podspec文件使用cocoapods工具进行维护。 为了便于进行调试，第三方开源库或私有代码库 我们都以源码的方式进行引入。 每次在本机进行全量编译或者ci机器进行打包的时候都会先编译pod仓库中的源代码，然后链接到主项目中。 这个流程没有问">
<meta property="og:locale">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gukuhvxnh2j613i0u0gr602.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gukvojcuwpj60u015rjxk02.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gukvrtyptvj61h30u0td202.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gukw1ce7iej60kq0fmq3x02.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gukw4a4ri8j61tc0lijvv02.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gukw3brvajj60x0038gly02.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gukw38z5bdj60nu05eq3w02.jpg">
<meta property="article:published_time" content="2021-09-17T16:00:00.000Z">
<meta property="article:modified_time" content="2022-07-12T06:44:55.016Z">
<meta property="article:author" content="zcx">
<meta property="article:tag" content="技术调研">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gukuhvxnh2j613i0u0gr602.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2021/09/18/iOS编译优化方案探索与实践-组件篇/"/>





  <title>iOS编译优化方案探索与实践-组件篇 | Bruin'sBlog</title>
  








<meta name="generator" content="Hexo 6.2.0"></head>
  
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Bruin'sBlog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/09/18/iOS%E7%BC%96%E8%AF%91%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%AE%9E%E8%B7%B5-%E7%BB%84%E4%BB%B6%E7%AF%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bruin'sBlog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">iOS编译优化方案探索与实践-组件篇</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-09-18T00:00:00+08:00">
                2021-09-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2021/09/18/iOS%E7%BC%96%E8%AF%91%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%AE%9E%E8%B7%B5-%E7%BB%84%E4%BB%B6%E7%AF%87/" class="leancloud_visitors" data-flag-title="iOS编译优化方案探索与实践-组件篇">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="iOS编译优化方案探索与实践-组件篇"><a href="#iOS编译优化方案探索与实践-组件篇" class="headerlink" title="iOS编译优化方案探索与实践-组件篇"></a>iOS编译优化方案探索与实践-组件篇</h1><h3 id="序言"><a href="#序言" class="headerlink" title="序言"></a>序言</h3><p>目前主流的项目构建方案中几乎都使用cocoapods进行组件库管理，不论是第三方开源库还是自研的私有库，都会生成.podspec文件使用cocoapods工具进行维护。</p>
<p>为了便于进行调试，第三方开源库或私有代码库 我们都以源码的方式进行引入。</p>
<p>每次在本机进行全量编译或者ci机器进行打包的时候都会先编译pod仓库中的源代码，然后链接到主项目中。</p>
<p>这个流程没有问题，但是随着项目的的大量迭代和长时间维护，引入的仓库会越来越多。以我们的项目为例，项目迭代了3年左右，引入的第三方仓库达到了30+个。在我的mac上进行一次全量编译时间达到了500s，性能稍差的设备编译消耗的时间更长。</p>
<p>针对组件库的编译时长的优化方案很简单，把cocoapods仓库中引入的需要编译的源码改成不需要编译的二进制库即可。</p>
<p>当然一刀切的引入方式切换是不可取的，根据自身的实际情况，对一些基本不会进入调试的代码和一些稳定版本的常用的仓库进行二进制化较为合适。</p>
<span id="more"></span>

<p>针对以上想法有了一些cocoapods插件可以使用。</p>
<h3 id="Cocoapods-Binary"><a href="#Cocoapods-Binary" class="headerlink" title="Cocoapods-Binary"></a>Cocoapods-Binary</h3><p>cocoapods 1.6.x版本的时候常用的一个仓库，大家可能都用过，其思路是在cocoapods进行install操作时通过将 dependencies 预编译成 binary 后缓存至本地，然后将原有的 Source Code link 到 binary 以几乎零成本的方式实现编译效率的提高。</p>
<p>也就是说在pod install的过程中先进行预编译，预编译之后每次pod install都将编译完的二进制link到项目，这样就完成了源码到二进制的转化。</p>
<p>规模较小的团队非常适合这种方案，没有什么额外的成本，成员协作之间也不会产生冲突，通过简单的 :binary &#x3D;&gt; true指令即可设置仓库的二进制和源码的切换。</p>
<blockquote>
<p>但是目前这个库不再维护了，同时在swift方面也存在着一些问题<br>由于 CocoaPods 在 1.7.x 以上版本，修改了 framework 生成逻辑，不会把 bundle copy 至 framework，因此我们需要将 Pod 环境固定到 1.6.2<br>pod 要支持 binary，header ref 需要变更为 #import &lt;&gt;或者 @import 以符合 moduler 标准<br>统一 CI 和开发的 compiler 环境，如果项目支持 Swift，不同 compiler 编译产物有 Swift 版本兼容问题<br>最终的 binary size 会比使用源码的时候大一点，不建议最终上传 Store<br>建议 Git ignore Pods 文件夹，否则在 source code 与 binary 切换过程会有大量的 file change，增加 git 负担<br>—引用自<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904025624674311">浅析 Cocoapods-Binary 实现</a></p>
</blockquote>
<h3 id="cocoapods-imy-bin"><a href="#cocoapods-imy-bin" class="headerlink" title="cocoapods-imy-bin"></a>cocoapods-imy-bin</h3><p>cocoapods-imy-bin 插件是美柚团队开源的cocoapods二进制管理方案。</p>
<p>其核心思想是先制作二进制文件，然后上传到文件服务器进行保存，在pod install 阶段动态判断三方库是否在本地私有源有二进制记录，如果有就会将此库的源替换成二进制源然后下载二进制文件，进而link到项目中完成源码和二进制的切换。</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6903407900006449160#heading-3">iOS编译速度如何稳定提高10倍以上之一</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6903408514778497031#heading-1">iOS编译速度如何稳定提高10倍以上之二</a></p>
<p>所谓实践出真知，咱就试一试看看效果。</p>
<h3 id="cocoapods-imy-bin实践"><a href="#cocoapods-imy-bin实践" class="headerlink" title="cocoapods-imy-bin实践"></a>cocoapods-imy-bin实践</h3><p><a target="_blank" rel="noopener" href="https://github.com/MeetYouDevs/cocoapods-imy-bin/blob/master/%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.md">cocoapods-imy-bin使用教程</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/su350380433/cocoapods-imy-bin-demo">cocoapods-imy-bin-demo工程</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/su350380433/binary-server">binary-server 静态资源服务器</a></p>
<p>按照使用教程开始操作：</p>
<h4 id="1、首先创建二进制仓库私有源"><a href="#1、首先创建二进制仓库私有源" class="headerlink" title="1、首先创建二进制仓库私有源"></a>1、首先创建二进制仓库私有源</h4><p>可以选择私有的github&#x2F;gitlab仓库，这个仓库负责二进制源cocoapods repo的维护。</p>
<p>添加到本地repo</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod repo add example_spec_bin_dev git<span class="variable">@github</span>.<span class="symbol">com:</span>su350380433/example_spec_bin_dev.git</span><br></pre></td></tr></table></figure>

<p>坑点：cocoapods-imy-bin配置私有源时只支持ssh，因此要修改以前的https的源，对ssh操作不熟练的需要google出现的问题及解决方案。</p>
<blockquote>
<p><a href="mailto:&#103;&#x69;&#x74;&#64;&#120;&#x78;&#120;&#x2e;&#99;&#x6f;&#x6d;">&#103;&#x69;&#x74;&#64;&#120;&#x78;&#120;&#x2e;&#99;&#x6f;&#x6d;</a> ssh一直报错，之前的公钥有密码,通过ssh连接私有库的时候一直报错让输入密码，但是输入之后还是不行,报错无授权,重新生成rsa秘钥对之后尝试还是不行，报同样的错误。最后发现是git地址没有给对，从cocoapods file中拷贝出来的时候带了一个source字符串，所以ssh授权一直失败（地址都错了授权肯定失败啊）</p>
</blockquote>
<p>创建repo不能仅仅拉一个git仓库就行了，还得找一个已有的仓库进行.podspec文件push ，否则添加此源之后 执行pod repo update 会一直失败。</p>
<blockquote>
<p>新增空的pod repo 之后 pod repo update 一直失败,尝试push一次已有的.podspec文件再更新repo才成功</p>
</blockquote>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pod push 命令</span></span><br><span class="line">pod repo push demo_binary_source APPLog.podspec --allow-warnings</span><br></pre></td></tr></table></figure>


<h4 id="2、搭建静态资源服务器"><a href="#2、搭建静态资源服务器" class="headerlink" title="2、搭建静态资源服务器"></a>2、搭建静态资源服务器</h4><p>本质是一个可以接收和下载文件的服务器，使用Node承载服务，使用MongoDB存储数据。 可自行选择ECS或者其他文件服务器，做测试的话可以在本地搭建。</p>
<p>先搭建数据库(Mac)</p>
<p>文档上MongoDB是在官网下载安装的，但是实测有很多文件夹权限问题，改用homebrew安装。<br>brew install mongodb 命令失效，且官网不再开源，这里改用homebrew的社区版。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew tap mongodb/brew <span class="comment">#先执行这个</span></span><br><span class="line">brew install mongodb-community<span class="variable">@4</span>.<span class="number">2</span> <span class="comment">#等一小会执行这个 安装4.2版本的 </span></span><br></pre></td></tr></table></figure>
<p>安装完毕后需要设置环境变量才能使用，根据终端使用的zsh还是bash各自在配置文件设置</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export <span class="variable constant_">PATH</span>=<span class="variable">$PATH</span><span class="symbol">:/usr/local/Cellar/mongodb-community</span><span class="variable">@4</span>.<span class="number">2</span>/<span class="number">4.2</span>.<span class="number">9</span>/bin</span><br></pre></td></tr></table></figure>
<p>安装完毕后测试结果，然后使用Mac系统服务的方式打开数据库，这样不用依托终端窗口，即使终端窗口关闭了数据库也不会关闭。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mongod -version <span class="comment">#测试是否安装成功</span></span><br><span class="line"><span class="comment">#除了安装包文件，安装还创建了以下文件和目录：</span></span><br><span class="line"><span class="comment">#配置文件（/usr/local/etc/mongod.conf）</span></span><br><span class="line"><span class="comment">#日志目录（/usr/local/var/log/mongodb）</span></span><br><span class="line"><span class="comment">#数据目录（/usr/local/var/mongodb）</span></span><br><span class="line"><span class="comment">#将MongoDB作为系统服务启动 不再依托终端窗口</span></span><br><span class="line">brew services start mongodb-community<span class="variable">@4</span>.<span class="number">2</span> /<span class="regexp">/启动</span></span><br><span class="line"><span class="regexp">brew services stop mongodb-community@4.2 /</span><span class="regexp">/停止</span></span><br><span class="line"><span class="regexp">brew services restart mongodb-community@4.2 /</span><span class="regexp">/重启</span></span><br></pre></td></tr></table></figure>
<p>也可以执行mongo shell命令查看数据库启动状态</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gukuhvxnh2j613i0u0gr602.jpg" alt="mongodb启动shell"></p>
<p>到这里 你的数据库就搭好了也启动起来了。</p>
<p>然后搭建静态资源服务器</p>
<p>先下载服务源码：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone git<span class="variable">@github</span>.<span class="symbol">com:</span>su350380433/binary-server.git</span><br><span class="line">cd /binary-server <span class="comment">#进入到你下载binary-server的根目录去</span></span><br><span class="line">npm install <span class="comment">#安装依赖包</span></span><br><span class="line">npm start <span class="comment"># 启动node</span></span><br></pre></td></tr></table></figure>
<p>这是文件服务器App.js源码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Koa</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">&#x27;./server/routes&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">&#x27;koa-logger&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> koaBody = <span class="built_in">require</span>(<span class="string">&#x27;koa-body&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Koa</span></span><br><span class="line"></span><br><span class="line">mongoose.<span class="title function_">connect</span>(<span class="string">&#x27;mongodb://localhost/binary_database&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">koaBody</span>(&#123; <span class="attr">multipart</span>: <span class="literal">true</span> &#125;))</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">logger</span>())</span><br><span class="line">app.<span class="title function_">use</span>(router.<span class="title function_">routes</span>())</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>

<p>由此可见，文件服务器创建了binary_database数据库，并且占用了8080端口。</p>
<p>执行了npm start之后可能会出现两个问题</p>
<p>8080端口已经被占用：出现这个问题有可能是你之前安装过其他服务也占用这个端口，可以切换静态资源文件的使用端口修改app.listen(8080)即可，或者和我一样直接把不用的其他服务关掉。</p>
<p>数据库连接失败：出现这个问题可以看一下具体的报错内容，根据不同的内容处理。如果出现</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">getaddrinfo <span class="variable constant_">ENOTFOUND</span> localhost     at GetAddrInfoReqWrap.onlookup</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>这样的报错的话很可能是你的设备没有做localhost的127.0.0.1的映射。db使用的链接是ip地址，但是静态资源服务中的代码里连接数据库使用的是localhost，且端口是db的默认端口，如果你数据库改过端口号，那这里一定要修改数据库连接地址。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; binary-server<span class="variable">@0</span>.<span class="number">1.0</span> start /Users/zcx/binary-server</span><br><span class="line">&gt; node app.js</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>如果一切顺利，这里node服务器就启动起来了，监听8080(或你设置的)端口，提供http服务。</p>
<h4 id="3-安装和初始化cocoapods-imy-bin插件"><a href="#3-安装和初始化cocoapods-imy-bin插件" class="headerlink" title="3 安装和初始化cocoapods-imy-bin插件"></a>3 安装和初始化cocoapods-imy-bin插件</h4><p>安装这一步比较简单 直接执行gem命令安装插件即可</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gem install cocoapods-imy-bin</span><br></pre></td></tr></table></figure>
<p>初始化插件配置：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">xx:</span>Demo slj<span class="variable">$ </span>pod bin init <span class="comment">#执行这个命令 根据提示信息进行下一步的操作</span></span><br><span class="line"></span><br><span class="line">======  dev 环境 ========</span><br><span class="line"></span><br><span class="line">开始设置二进制化初始信息.</span><br><span class="line">所有的信息都会保存在 /Users/slj/.cocoapods/bin_dev.yml 文件中.</span><br><span class="line"><span class="string">%w[bin_dev.yml bin_debug_iphoneos.yml bin_release_iphoneos.yml]</span> </span><br><span class="line">你可以在对应目录下手动添加编辑该文件. 文件包含的配置信息样式如下：</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"><span class="symbol">configuration_env:</span> dev</span><br><span class="line"><span class="comment"># 上面这个是环境切换选项 先不改 目前先配一套环境</span></span><br><span class="line"><span class="symbol">code_repo_url:</span> git<span class="variable">@github</span>.<span class="symbol">com:</span>su350380433/example_spec_source.git</span><br><span class="line"><span class="comment"># 上面这个是正在使用的私有源地址</span></span><br><span class="line"><span class="symbol">binary_repo_url:</span> git<span class="variable">@github</span>.<span class="symbol">com:</span>su350380433/example_spec_bin_dev.git</span><br><span class="line"><span class="comment"># 上面这个是新增的二进制私有源地址</span></span><br><span class="line"><span class="symbol">binary_download_url:</span> <span class="symbol">http:</span>/<span class="regexp">/localhost:8080/frameworks</span><span class="regexp">/%s/</span>%s/zip</span><br><span class="line"><span class="comment"># 上面这个是新创建的服务器地址 默认使用的本地 %s是动态替换三方库的名称的 这里不要改</span></span><br><span class="line"><span class="symbol">download_file_type:</span> zip</span><br><span class="line"><span class="comment"># 上面这个是二进制传输用的压缩格式 一般都zip也不用改</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 以上的配置都可以在配置文件里进行更改</span></span><br><span class="line">open /Users/zcx/.cocoapods/bin_dev.yml  <span class="comment">#文件保存 插件的配置信息</span></span><br></pre></td></tr></table></figure>
<p>到这里准备工作就算是就绪了，可以开始制作二进制文件了。</p>
<h4 id="4-制作二进制文件"><a href="#4-制作二进制文件" class="headerlink" title="4 制作二进制文件"></a>4 制作二进制文件</h4><p>想要制作一系列的三方库二进制组件，必须得有个文件存储三方库的列表吧，所以这里还得准备一个.podspec文件来维护你想要制作的库。</p>
<p>在项目根目录新增一个<code>demo_binary_source.podspec</code>文件,内容如下（一个基本的依赖文件）</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MARK: converted automatically by spec.py. <span class="doctag">@hgy</span></span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Pod::Spec</span>.new <span class="keyword">do</span> |<span class="params">s</span>|</span><br><span class="line">	s.name = <span class="string">&#x27;demo_binary_source&#x27;</span></span><br><span class="line">	s.version = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">	s.description = <span class="string">&#x27;demo_binary_source&#x27;</span></span><br><span class="line">	s.license = <span class="string">&#x27;MIT&#x27;</span></span><br><span class="line">	s.summary = <span class="string">&#x27;demo_binary_source&#x27;</span></span><br><span class="line">	s.homepage = <span class="string">&#x27;https://gitlab-media.corp.demo.com/iOS/krmedium_binary_source&#x27;</span></span><br><span class="line">	s.authors = &#123; <span class="string">&#x27;zcx&#x27;</span> =&gt; <span class="string">&#x27;zhouchuanxiang@demo.com&#x27;</span> &#125;</span><br><span class="line">	s.source = &#123; <span class="symbol">:git</span> =&gt; <span class="string">&#x27;git@gitlab-media.corp.demo.com:iOS/krmedium_binary_source.git&#x27;</span>, <span class="symbol">:branch</span> =&gt; <span class="string">&#x27;master&#x27;</span> &#125;</span><br><span class="line">        s.requires_arc = <span class="literal">true</span></span><br><span class="line">        s.ios.deployment_target = <span class="string">&#x27;11.0&#x27;</span></span><br><span class="line">        s.source_files = <span class="string">&#x27;Source/**/*.&#123;h,m,c,swift&#125;&#x27;</span></span><br><span class="line">        s.public_header_files = <span class="string">&#x27;Source/**/*.&#123;h,swift&#125;&#x27;</span></span><br><span class="line">        <span class="comment">#objc依赖</span></span><br><span class="line">        s.dependency <span class="string">&#x27;Masonry&#x27;</span>, <span class="string">&#x27;1.1.0&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;MJRefresh&#x27;</span>, <span class="string">&#x27;3.3.1&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;SDWebImage&#x27;</span>, <span class="string">&#x27;5.3.1&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;YYCategories&#x27;</span>, <span class="string">&#x27;1.0.4&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;MJExtension&#x27;</span>, <span class="string">&#x27;3.2.2&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;MBProgressHUD&#x27;</span>, <span class="string">&#x27;1.1.0&#x27;</span></span><br><span class="line">        <span class="comment">#demo项目依赖</span></span><br><span class="line">        s.dependency <span class="string">&#x27;KeychainAccess&#x27;</span>, <span class="string">&#x27;4.1.0&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;Moya/RxSwift&#x27;</span>, <span class="string">&#x27;13.0.1&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;ObjectMapper&#x27;</span>, <span class="string">&#x27;3.4.2&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;IQKeyboardManagerSwift&#x27;</span>, <span class="string">&#x27;6.5.1&#x27;</span> <span class="comment">#键盘管理</span></span><br><span class="line">        s.dependency <span class="string">&#x27;RTRootNavigationController&#x27;</span>, <span class="string">&#x27;0.5.19&#x27;</span> <span class="comment">#UI</span></span><br><span class="line">        s.dependency <span class="string">&#x27;Kingfisher&#x27;</span>, <span class="string">&#x27;5.15.4&#x27;</span> <span class="comment">#图片处理</span></span><br><span class="line">        s.dependency <span class="string">&#x27;Zip&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;SnapKit&#x27;</span>, <span class="string">&#x27;5.0.1&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;Stencil&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;iCarousel&#x27;</span>, <span class="string">&#x27;1.8.3&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;YYText&#x27;</span>, <span class="string">&#x27;1.0.5&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;lottie-ios&#x27;</span>, <span class="string">&#x27;3.1.9&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;YYCache&#x27;</span>, <span class="string">&#x27;1.0.4&#x27;</span></span><br><span class="line">        <span class="comment">#debug调试工具</span></span><br><span class="line">        s.dependency <span class="string">&#x27;NetSwitch&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;LookinServer&#x27;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>文件中所有的<code>dependency</code>依赖都会被尝试制作二进制文件。制作二进制文件之前需要保证所有的<code>repo</code>都是正常的，每个三方库的源都指向原始源（源代码源），我们制作的时候会先获取源码进行编译。<br>把这个文件放在和<code>Podfile</code>同一个目录下，进入此目录，然后执行</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod bin auto --all-make <span class="comment"># 开始制作二进制</span></span><br></pre></td></tr></table></figure>
<p>这个过程可能会根据你依赖的库报各种错误，比如我遇到的</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Installing...</span><br><span class="line">Installing Realm (<span class="number">3.19</span>.<span class="number">0</span>)</span><br><span class="line">Installing RealmSwift (<span class="number">3.19</span>.<span class="number">0</span>)</span><br><span class="line">Installing demo_binary_source (<span class="number">1</span>)</span><br><span class="line">[!] /bin/bash -c</span><br><span class="line">set -e</span><br><span class="line">sh build.sh cocoapods-setup</span><br><span class="line"></span><br><span class="line"><span class="symbol">sh:</span> build.<span class="symbol">sh:</span> No such file <span class="keyword">or</span> directory</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行pod bin auto --all-make 报错 不知道啥原因</span></span><br><span class="line"><span class="comment">#经排查 使用插件后 swiftRealm库附带的下载依赖脚本无法执行</span></span><br><span class="line"></span><br><span class="line">Running prepare command</span><br><span class="line"><span class="variable">$ </span>/bin/bash -c  set -e sh build.sh cocoapods-setup</span><br><span class="line">Downloading <span class="symbol">dependency:</span> <span class="number">10.3</span>.<span class="number">2</span> from <span class="symbol">https:</span>/<span class="regexp">/static.realm.io/downloads</span><span class="regexp">/core/realm</span>-monorepo-xcframework-v10.<span class="number">3.2</span>.tar.xz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解决方案</span></span><br><span class="line">单独的库无法处理，这里因为<span class="string">&#x27;Realm&#x27;</span>编译源码也很慢，所以改成<span class="string">&#x27;xcframework&#x27;</span>方式进行引入了。</span><br><span class="line">解决问题的过程中可能遇见<span class="string">&#x27;pod repo&#x27;</span>混乱的问题，</span><br><span class="line">之前尝试的 <span class="string">&#x27;--all-make&#x27;</span>命令 生成了一部分二进制和<span class="string">&#x27;repo&#x27;</span>信息引起混乱</span><br><span class="line">那就全部删掉，删掉<span class="string">&#x27;repo&#x27;</span>源，删掉已经上传的二进制文件从头再来一遍 </span><br></pre></td></tr></table></figure>
<p>解决完问题后再尝试进行二进制文件制作。如果顺利的话会看到制作结果。</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gukvojcuwpj60u015rjxk02.jpg"></p>
<p>同时可以检验一下新创建的 私有源中是否记录的二进制文件的地址信息。</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gukvrtyptvj61h30u0td202.jpg"></p>
<p>二进制文件制作好了，就差link到项目中了。</p>
<p>既然我们更新了私有源，这里最好把<code>cocoapods repo </code>更新一下再安装。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">pod repo update --verbose <span class="comment">#更新源</span></span><br><span class="line">pod install --verbose <span class="comment">#你懂得</span></span><br><span class="line"><span class="comment">#然后你会看到执行的结果，部分三方库被替换成了打包好的静态库</span></span><br><span class="line">======  dev 环境 ========</span><br><span class="line"><span class="variable constant_">CDN</span>: trunk Relative <span class="symbol">path:</span> CocoaPods-version.yml exists! Returning local because checking is only performed <span class="keyword">in</span> repo update</span><br><span class="line">cocoapods-imy-bin 插件</span><br><span class="line">- 开始处理 Alamofire <span class="number">4.9</span>.<span class="number">1</span> 组件.</span><br><span class="line">specification =Alamofire (<span class="number">4.9</span>.<span class="number">1</span>)</span><br><span class="line">#&lt;Pod::Resolver::ResolverSpecification:0x00007fc8369c9630&gt;</span><br><span class="line">cocoapods-imy-bin 插件</span><br><span class="line">- 开始处理 AliPlayerSDK_iOS <span class="number">5.4</span>.<span class="number">0</span> 组件.</span><br><span class="line">cocoapods-imy-bin 插件</span><br><span class="line">- 开始处理 AliPlayerSDK_iOS/AliPlayerSDK <span class="number">5.4</span>.<span class="number">0</span> 组件.</span><br><span class="line">cocoapods-imy-bin 插件</span><br><span class="line">- 开始处理 AlipaySDK-iOS <span class="number">15.7</span>.<span class="number">9</span> 组件.</span><br><span class="line">cocoapods-imy-bin 插件</span><br><span class="line">- 开始处理 Bugly <span class="number">2.5</span>.<span class="number">90</span> 组件.</span><br><span class="line">........</span><br><span class="line">#&lt;Pod::Resolver::ResolverSpecification:0x00007fc8370b0f48&gt;</span><br><span class="line">【AliPlayerSDK_iOS |<span class="params"> 5.4.0】组件无对应二进制版本 , 将采用源码依赖.</span></span><br><span class="line"><span class="params">【AliPlayerSDK_iOS/AliPlayerSDK </span>| <span class="number">5.4</span>.<span class="number">0</span>】组件无对应二进制版本 , 将采用源码依赖.</span><br><span class="line">【AlipaySDK-iOS |<span class="params"> 15.7.9】组件无对应二进制版本 , 将采用源码依赖.</span></span><br><span class="line"><span class="params">【Bugly </span>| <span class="number">2.5</span>.<span class="number">90</span>】组件无对应二进制版本 , 将采用源码依赖.</span><br><span class="line">【CocoaAsyncSocket |<span class="params"> 7.6.5】组件无对应二进制版本 , 将采用源码依赖.</span></span><br><span class="line"><span class="params">【GTSDK </span>| <span class="number">2.5</span>.<span class="number">5.0</span>】组件无对应二进制版本 , 将采用源码依赖.</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>最后查看<code>xcode</code>中的<code>pod</code>文件夹，从源码切换成了<code>framework</code><br><img src="https://tva1.sinaimg.cn/large/008i3skNly1gukw1ce7iej60kq0fmq3x02.jpg"><br>如果没有出现<code>framework</code>的话可以尝试再更新一次<code>pod repo </code>和<code>执行 pod install</code></p>
<p><code>clean</code> 一下进行全量编译可以看到变化，优化前编译需要500s</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gukw4a4ri8j61tc0lijvv02.jpg"></p>
<p>优化后<code>tasks</code>减少到2500左右</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gukw3brvajj60x0038gly02.jpg"></p>
<p>编译时间减少到300s</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gukw38z5bdj60nu05eq3w02.jpg"></p>
<h4 id="可能存在的问题"><a href="#可能存在的问题" class="headerlink" title="可能存在的问题"></a>可能存在的问题</h4><p>暂时没有测试ci打包机上的命令修改和真正realse发包过程。如果要上生产环境的话需要进行大面积的覆盖测试。切记谨慎行事。</p>
<h3 id="拓展与思考"><a href="#拓展与思考" class="headerlink" title="拓展与思考"></a>拓展与思考</h3><p>组件库的编译时间减少较为可观，这也许是大家推行项目组件化的原因。随着业务的发展，项目会越来越大，业务拓展后也可能会划分更多的部门。</p>
<p>每个部门做自己的业务，不关注其他部门的代码。所以如果指定一定的代码规范，制作比如网络请求组件、路由组件等公用组件的基础上，每个业务部门输出自身的业务组件，使用<code>cocoapods</code>进行二进制化管理。代码整体的编译上就可以节省不少时间，提升编译效率，团队间合作也会降低一些成本。</p>
<p>未来我们的项目也可以考虑分割各个组件，总体做一个壳工程，采用组件化的方案进行代码维护。但是组件化任重而道远，还得得根据自身的实际情况来选择技术方案。组件化和其他设计模式一样，都是为了解决实际问题，不要为了设计而设计。</p>
<p>当然一些前瞻性的思考还是不能缺少的，未雨绸缪总好过于亡羊补牢！</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/%E6%8A%80%E6%9C%AF%E8%B0%83%E7%A0%94/" rel="tag"># 技术调研</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/09/09/module-importing%20failed-invalid%20pathname/" rel="next" title="module importing failed invalid pathname 问题解决">
                <i class="fa fa-chevron-left"></i> module importing failed invalid pathname 问题解决
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/12/06/iOS%20Web%E5%94%A4%E8%B5%B7APP%E6%96%B9%E6%A1%88%E5%8F%82%E8%80%83/" rel="prev" title="iOS 一键唤起APP方案参考">
                iOS 一键唤起APP方案参考 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
<span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_fav">收藏夹</a>
<a class="jiathis_button_copy">复制网址</a>
<a class="jiathis_button_email">邮件</a>
<a class="jiathis_button_weixin">微信</a>
<a class="jiathis_button_qzone">QQ空间</a>
<a class="jiathis_button_tqq">腾讯微博</a>
<a class="jiathis_button_douban">豆瓣</a>
<a class="jiathis_button_share">一键分享</a>

<a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
var jiathis_config={
  data_track_clickback:true,
  summary:"",
  shortUrl:false,
  hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script>
<!-- JiaThis Button END -->
      
    </div>
  </div>


          </div>
          


          

  
    <div id="gitalk-container"></div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpeg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/zcx4u" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://plus.google.com/zcx940518" target="_blank" title="Google">
                      
                        <i class="fa fa-fw fa-google"></i>Google</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:zcx_bruin@foxmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://weibo.com/6995445360/profile?topnav=1&wvr=6" target="_blank" title="微博">
                      
                        <i class="fa fa-fw fa-weibo"></i>微博</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://macshuo.com/" title="MacTalk" target="_blank">MacTalk</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#iOS%E7%BC%96%E8%AF%91%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%AE%9E%E8%B7%B5-%E7%BB%84%E4%BB%B6%E7%AF%87"><span class="nav-number">1.</span> <span class="nav-text">iOS编译优化方案探索与实践-组件篇</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%8F%E8%A8%80"><span class="nav-number">1.0.1.</span> <span class="nav-text">序言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cocoapods-Binary"><span class="nav-number">1.0.2.</span> <span class="nav-text">Cocoapods-Binary</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cocoapods-imy-bin"><span class="nav-number">1.0.3.</span> <span class="nav-text">cocoapods-imy-bin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cocoapods-imy-bin%E5%AE%9E%E8%B7%B5"><span class="nav-number">1.0.4.</span> <span class="nav-text">cocoapods-imy-bin实践</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81%E9%A6%96%E5%85%88%E5%88%9B%E5%BB%BA%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%BB%93%E5%BA%93%E7%A7%81%E6%9C%89%E6%BA%90"><span class="nav-number">1.0.4.1.</span> <span class="nav-text">1、首先创建二进制仓库私有源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">1.0.4.2.</span> <span class="nav-text">2、搭建静态资源服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%AE%89%E8%A3%85%E5%92%8C%E5%88%9D%E5%A7%8B%E5%8C%96cocoapods-imy-bin%E6%8F%92%E4%BB%B6"><span class="nav-number">1.0.4.3.</span> <span class="nav-text">3 安装和初始化cocoapods-imy-bin插件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E5%88%B6%E4%BD%9C%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6"><span class="nav-number">1.0.4.4.</span> <span class="nav-text">4 制作二进制文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%AF%E8%83%BD%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">1.0.4.5.</span> <span class="nav-text">可能存在的问题</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%93%E5%B1%95%E4%B8%8E%E6%80%9D%E8%80%83"><span class="nav-number">1.0.5.</span> <span class="nav-text">拓展与思考</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zcx</span>

  
</div>


  <div class="powered-by">Action speak louder than words.</div>



  <span class="post-meta-divider"></span>





        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
   <script type="text/javascript">
        var gitalk = new Gitalk({
          clientID: '1ce46427a2d389bf0f0a',
          clientSecret: 'e5c94c309da55fd7f82dfb09768a7685ce1021a1',
          repo: 'zcx4u.github.io',
          owner: 'zcx4u',
          admin: ['zcx4u'],
          id: location.pathname,
          distractionFreeMode: 'true'
        })
        gitalk.render('gitalk-container')           
       </script>

  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("MUoigkFJVBIC84KJ66GDdRzg-gzGzoHsz", "7BcnpnTmmpl7LlKmrROjroPk");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
