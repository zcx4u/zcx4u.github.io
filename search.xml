<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>APPå†…éƒ¨ä»£ç†</title>
    <url>/2021/01/18/APP%E4%BB%A3%E7%90%86/</url>
    <content><![CDATA[<h3 id="APPå†…éƒ¨ä»£ç†"><a href="#APPå†…éƒ¨ä»£ç†" class="headerlink" title="APPå†…éƒ¨ä»£ç†"></a>APPå†…éƒ¨ä»£ç†</h3><hr>
<h5 id="wifiçš„ä»£ç†é…ç½®ä¸ä¼šè‡ªåŠ¨ä¿å­˜ï¼Ÿ"><a href="#wifiçš„ä»£ç†é…ç½®ä¸ä¼šè‡ªåŠ¨ä¿å­˜ï¼Ÿ" class="headerlink" title="wifiçš„ä»£ç†é…ç½®ä¸ä¼šè‡ªåŠ¨ä¿å­˜ï¼Ÿ"></a>wifiçš„ä»£ç†é…ç½®ä¸ä¼šè‡ªåŠ¨ä¿å­˜ï¼Ÿ</h5><p>ä½¿ç”¨iPhoneçš„å¤§æ¦‚éƒ½é‡è§è¿‡è¿™ç§äº‹æƒ…ï¼š</p>
<p>æ¯æ¬¡éœ€è¦ç»™APPæŠ“åŒ…çš„æ—¶å€™éƒ½éœ€è¦åˆ°è®¾ç½®-WIFI-ä¸‹æ‰‹åŠ¨é…ç½®ä»£ç†ï¼Œç„¶è€Œå½“æˆ‘ä»¬è¿ç€ä»£ç†çš„æ—¶å€™æ— æ³•è®¿é—®App Storeæˆ–å…¶ä»–ç¦æ­¢ä»£ç†çš„æœåŠ¡ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¼šæŠŠWIFIçš„ä»£ç†ç»™å…³é—­ã€‚</p>
<p>å¼„å®Œæ‚ä¸ƒæ‚å…«çš„ä¸œè¥¿ä¹‹åå›åˆ°æŠ“åŒ…è°ƒè¯•ï¼Œæ‰“å¼€WIFIè®¾ç½®é¡µï¼Œæ‰‹åŠ¨é…ç½®ä»£ç†â€¦</p>
<p>ï¼Ÿï¼Ÿï¼Ÿ</p>
<p>æˆ‘åˆšæ‰å¡«çš„æœ¬æœºIPå’Œç«¯å£å‘¢ï¼Ÿæˆ‘è¿˜å¾—å†è¾“ä¸€æ¬¡ï¼ŸWTFï¼</p>
<hr>
<h5 id="è§£å†³æ–¹æ¡ˆä¸€"><a href="#è§£å†³æ–¹æ¡ˆä¸€" class="headerlink" title="è§£å†³æ–¹æ¡ˆä¸€"></a>è§£å†³æ–¹æ¡ˆä¸€</h5><p>å¼„ä¸¤ä¸ªwifiä¿¡å·ï¼Œä¸€ä¸ªæŒ‚ç¬”è®°æœ¬çš„ä»£ç†ä¸å…³ï¼Œå¦ä¸€ä¸ªæ­£å¸¸è”ç½‘ï¼Œéœ€è¦åˆ‡æ¢ä»£ç†çš„æ—¶å€™åˆ‡æ¢wifiã€‚</p>
<p> è¯´å®è¯æ“ä½œèµ·æ¥æŒºéº»çƒ¦çš„ï¼Œå¹¶ä¸”å…¬å¸åªæœ‰ä¸€ä¸ªå…¬ç”¨çš„wifiä¿¡å·ï¼Œæƒ³å¼„ä¸€ä¸ªæ–°çš„ä¿¡å·è¿˜éœ€è¦è¿ç»´å°ä¼™ä¼´æ¥æï¼Œéš¾é¡¶ã€‚</p>
<hr>
<h5 id="è§£å†³æ–¹æ¡ˆäºŒ"><a href="#è§£å†³æ–¹æ¡ˆäºŒ" class="headerlink" title="è§£å†³æ–¹æ¡ˆäºŒ"></a>è§£å†³æ–¹æ¡ˆäºŒ</h5><p>å®‰è£…VPNè½¯ä»¶ï¼Œé…ç½®æœ¬åœ°ä»£ç†è§„åˆ™ï¼Œéœ€è¦æŠ“åŒ…çš„æ—¶å€™æ‰“å¼€ç½‘ç»œä»£ç†ã€‚</p>
<p>å°ç«ç®­ä¹‹ç±»å¥½ç”¨çš„è½¯ä»¶éœ€è¦ç¾åŒºè´¦å·å®‰è£…ï¼Œæ¯ä¸ªæµ‹è¯•æœºéƒ½å¯èƒ½ä¼šæœ‰è¿™ä¸ªéœ€æ±‚ï¼Œä¸å¯èƒ½æ¯ä¸ªæµ‹è¯•æœºéƒ½è¿™ä¹ˆæ“ä½œä¸€éã€‚</p>
<hr>
<h5 id="è§£å†³æ–¹æ¡ˆä¸‰"><a href="#è§£å†³æ–¹æ¡ˆä¸‰" class="headerlink" title="è§£å†³æ–¹æ¡ˆä¸‰"></a>è§£å†³æ–¹æ¡ˆä¸‰</h5><p>APPå†…éƒ¨é€šè¿‡ä»£ç è®¾ç½®ä»£ç†ï¼Œåªåœ¨APPå†…éƒ¨ç”Ÿæ•ˆï¼Œå¼€å‘ç¯å¢ƒä½¿ç”¨ï¼Œå¯æŒä¹…åŒ–é…ç½®æ–‡ä»¶ã€‚</p>
<p>å»gooleäº†ä¸€åœˆï¼Œå‘ç°<code>URLSessionConfiguration</code> ä¸­æœ‰ä¸ªå­—å…¸ä¸“é—¨ä¿å­˜ä»£ç†ä¿¡æ¯<code>connectionProxyDictionary</code> </p>
<p>å®˜æ–¹è¿™ä¹ˆè¯´çš„ï¼š</p>
<blockquote>
<p>This property controls which proxy tasks within sessions based on this configuration use when connecting to remote hosts.<br>The default value is NULL, which means that tasks use the default system settings.</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´é»˜è®¤NULLçš„æ—¶å€™æ˜¯èµ°ç³»ç»Ÿçš„ä»£ç†è®¾ç½®ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå®šä¹‰çš„è¯å°±èµ°æˆ‘ä»¬APPå†…éƒ¨è‡ªå®šä¹‰çš„ä»£ç†è®¾ç½®å’¯ã€‚</p>
<p>åŒç†å¦‚æœæˆ‘ä»¬å¼ºåˆ¶å°†è¿™ä¸ªå€¼ç½®ç©ºå°±èƒ½å¤Ÿé¿å…æˆ‘ä»¬çš„è¯·æ±‚èµ°éš§é“ä¹Ÿèƒ½é˜²æ­¢åˆ«äººæŠ“åŒ…è¾£ï¼</p>
<hr>
<h5 id="åŠ¨åŠ¨å°æ‰‹è¯•è¯•æ•ˆæœ"><a href="#åŠ¨åŠ¨å°æ‰‹è¯•è¯•æ•ˆæœ" class="headerlink" title="åŠ¨åŠ¨å°æ‰‹è¯•è¯•æ•ˆæœ"></a>åŠ¨åŠ¨å°æ‰‹è¯•è¯•æ•ˆæœ</h5><p>æˆ‘ä»¬å·¥ç¨‹ä¸­ä½¿ç”¨äº†<code>Moya</code>æ¥åšç½‘ç»œå°è£…ï¼Œ<code>Moya</code>å†…éƒ¨ä½¿ç”¨<code>Alamofire</code>æ¥è¯·æ±‚ç½‘ç»œï¼Œä¸è®ºæ˜¯<code>Moya</code> è¿˜æ˜¯<code>Alamofire</code>éƒ½ä¸å½±å“å®é™…çš„ä»£ç æ•ˆæœã€‚å› ä¸ºä»–ä»¬éƒ½ä½¿ç”¨äº†<code>URLSessionConfiguration</code>çš„å•ä¾‹ï¼Œåªéœ€è¦åœ¨æ„å»ºç½‘ç»œè¯·æ±‚çš„æ—¶å€™æ·»åŠ ä¸Šå¯¹åº”çš„ä»£ç†ä¿¡æ¯å³å¯ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> alamofireConfiguration: <span class="type">URLSessionConfiguration</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> configuration <span class="operator">=</span> <span class="type">URLSessionConfiguration</span>.default</span><br><span class="line">        <span class="keyword">#if</span> <span class="type">DEBUG</span></span><br><span class="line">        configuration.timeoutIntervalForRequest <span class="operator">=</span> <span class="number">30</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> proxyHost: <span class="type">String</span> <span class="operator">=</span> <span class="type">UserDefaultManager</span>.object(forKey: <span class="type">UserDefaultsKeys</span>.<span class="type">Test</span>.proxyHost),</span><br><span class="line">           <span class="keyword">let</span> proxyPort: <span class="type">Int64</span> <span class="operator">=</span> <span class="type">UserDefaultManager</span>.object(forKey: <span class="type">UserDefaultsKeys</span>.<span class="type">Test</span>.proxyPort) &#123;</span><br><span class="line">            <span class="keyword">var</span> proxyConfiguration <span class="operator">=</span> [<span class="type">AnyHashable</span>:<span class="keyword">Any</span>]()</span><br><span class="line">            <span class="comment">//HTTP</span></span><br><span class="line">            proxyConfiguration.updateValue(<span class="number">1</span> <span class="keyword">as</span> <span class="type">AnyObject</span>, forKey: <span class="string">&quot;HTTPEnable&quot;</span>)</span><br><span class="line">            proxyConfiguration.updateValue(proxyHost <span class="keyword">as</span> <span class="type">AnyObject</span>, forKey: <span class="string">&quot;HTTPProxy&quot;</span>)</span><br><span class="line">            proxyConfiguration.updateValue(proxyPort <span class="keyword">as</span> <span class="type">AnyObject</span>, forKey: <span class="string">&quot;HTTPPort&quot;</span>)</span><br><span class="line">            <span class="comment">//HTTPS</span></span><br><span class="line">            proxyConfiguration.updateValue(<span class="number">1</span> <span class="keyword">as</span> <span class="type">AnyObject</span>, forKey: <span class="string">&quot;HTTPSEnable&quot;</span>)</span><br><span class="line">            proxyConfiguration.updateValue(proxyHost <span class="keyword">as</span> <span class="type">AnyObject</span>, forKey: <span class="string">&quot;HTTPSProxy&quot;</span>)</span><br><span class="line">            proxyConfiguration.updateValue(proxyPort <span class="keyword">as</span> <span class="type">AnyObject</span>, forKey: <span class="string">&quot;HTTPSPort&quot;</span>)</span><br><span class="line">            configuration.connectionProxyDictionary <span class="operator">=</span> proxyConfiguration</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">#else</span></span><br><span class="line">        configuration.timeoutIntervalForRequest <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">        <span class="keyword">#endif</span></span><br><span class="line">        <span class="keyword">return</span> configuration</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åå†åšä¸ªä¿å­˜è®¾ç½®åŠŸèƒ½ä¹‹ç±»çš„ä¸œä¸œå°±å¤§åŠŸå‘Šæˆäº†ï¼</p>
<p>ä½¿ç”¨èµ·æ¥ååˆ†èˆ’æœï¼Œå†ä¹Ÿä¸ç”¨è€å»WIFIè®¾ç½®é¡µå»å¡«è‡ªå·±ç”µè„‘çš„IPå’Œç«¯å£äº†ï¼Œåœ¨APPå†…éƒ¨è®¾ç½®ç„¶åæŒä¹…åŒ–ä¸€ä¸‹å°±å¯ä»¥æŠ“åŒ…åˆ†æè€Œä¸”ä¸æ‹…å¿ƒå½±å“å…¶ä»–APPäº†ã€‚</p>
<p>å½“ç„¶è¦è®°å¾—æ§åˆ¶å¥½å¼€å‘ç¯å¢ƒï¼Œä¸è¦å½±å“çº¿ä¸Šä¸šåŠ¡å“¦ï¼</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æœ‰ç”¨çš„</tag>
      </tags>
  </entry>
  <entry>
    <title>AVPlayerç›¸å…³BUGè®°å½•</title>
    <url>/2021/08/25/AVPlayer%E7%9B%B8%E5%85%B3BUG%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<p>Bugï¼šéŸ³é¢‘åˆ—è¡¨é¡ºåºæ’­æ”¾è¿‡ç¨‹ä¸­å¶å°”å‡ºç°è®¾ç½®çš„1.5å€é€Ÿé‡ç½®ä¸º1</p>
<p>åŸå› ï¼šéŸ³é¢‘æµå¡é¡¿æš‚åœå¹¶ç¼“å†²åˆ°äº†è¶³å¤Ÿå¯ä»¥ç»§ç»­æ’­æ”¾çš„bufferé•¿åº¦åå“åº”<code>playbackLikelyToKeepUp</code> äº‹ä»¶ä¸­ æ‰‹åŠ¨è°ƒç”¨äº† <code>player.play()</code> æ–¹æ³•æ’­æ”¾éŸ³é¢‘</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> keyPath <span class="operator">==</span> <span class="string">&quot;currentItem.playbackLikelyToKeepUp&quot;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">let</span> item <span class="operator">=</span> currentItem, item.isPlaybackLikelyToKeepUp, playStatus <span class="operator">==</span> .loading, isPlayerActive &#123;</span><br><span class="line">    playStatus <span class="operator">=</span> .playing</span><br><span class="line">    player.play()</span><br><span class="line">    <span class="comment">// æ’­æ”¾ä¹‹åéœ€å¢åŠ è®¾ç½®rateçš„æ­¥éª¤</span></span><br><span class="line">    rate <span class="operator">=</span> <span class="type">CGFloat</span>(<span class="type">UserDefaultManager</span>.manager.getAudioRateValue()) </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æ–‡æ¡£å¯ä»¥çœ‹åˆ°<code>play</code>æ–¹æ³•ç­‰åŒäº <code>player.rate = 1</code>ï¼Œæ•…è€Œå¯¼è‡´éŸ³é¢‘çš„é€Ÿç‡å˜æˆäº†1</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*!</span></span><br><span class="line"><span class="comment"> @method		play</span></span><br><span class="line"><span class="comment"> @abstract		Signals the desire to begin playback at the current item&#x27;s natural rate.</span></span><br><span class="line"><span class="comment"> @discussion	Equivalent to setting the value of rate to 1.0.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="operator">-</span> (void)play;</span><br></pre></td></tr></table></figure>

<p>æ€»ç»“ï¼šapiçš„ä½¿ç”¨è¿˜æ˜¯éœ€è¦å¤šçœ‹æ–‡æ¡£ä¸è¦ä»…ä»…çœ‹åå­—å°±æƒ³å½“ç„¶(play &#x3D; ä»¥å½“å‰é€Ÿç‡è¿›è¡Œç»§ç»­æ’­æ”¾)ï¼Œç®€å•çš„apiåç§°å¹¶ä¸ä»£è¡¨ç€ç®€å•çš„åŠŸèƒ½ï¼</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>BUGè®°å½•å’Œç»éªŒæ”¶é›†</tag>
      </tags>
  </entry>
  <entry>
    <title>CTMediator æ¶æ„æ–¹æ¡ˆæ·±åº¦è§£æ</title>
    <url>/2025/03/14/CTMediator%20%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93%E4%B8%8E%E6%80%9D%E8%80%83/</url>
    <content><![CDATA[<h1 id="ä¸€ã€æ¶æ„èƒŒæ™¯æ·±åº¦å‰–æ"><a href="#ä¸€ã€æ¶æ„èƒŒæ™¯æ·±åº¦å‰–æ" class="headerlink" title="ä¸€ã€æ¶æ„èƒŒæ™¯æ·±åº¦å‰–æ"></a>ä¸€ã€æ¶æ„èƒŒæ™¯æ·±åº¦å‰–æ</h1><h2 id="1-1-é—®é¢˜åœºæ™¯å†ç°"><a href="#1-1-é—®é¢˜åœºæ™¯å†ç°" class="headerlink" title="1.1 é—®é¢˜åœºæ™¯å†ç°"></a>1.1 é—®é¢˜åœºæ™¯å†ç°</h2><p><strong>å…¸å‹ç—›ç‚¹è¡¨ç°</strong>ï¼š</p>
<ul>
<li>ç¼–è¯‘æ—¶é—´éšæ¨¡å—å¢åŠ å‘ˆæŒ‡æ•°å¢é•¿ï¼ˆN æ¨¡å—ç¼–è¯‘è€—æ—¶çº¦ [T &#x3D; k*N^2]ï¼‰</li>
<li>å¤šå›¢é˜Ÿåä½œæ—¶å‡ºç°ã€Œä¿®æ”¹å†²çªé£æš´ã€</li>
<li>åŸºç¡€æ¨¡å—è¿­ä»£å¯¼è‡´å…¨é‡å›å½’æµ‹è¯•</li>
</ul>
<h2 id="1-2-è®¾è®¡å†³ç­–çŸ©é˜µ"><a href="#1-2-è®¾è®¡å†³ç­–çŸ©é˜µ" class="headerlink" title="1.2 è®¾è®¡å†³ç­–çŸ©é˜µ"></a>1.2 è®¾è®¡å†³ç­–çŸ©é˜µ</h2><table>
<thead>
<tr>
<th>æ–¹æ¡ˆç±»å‹</th>
<th>ç¼–è¯‘æ—¶è€¦åˆ</th>
<th>è¿è¡Œæ—¶å¼€é”€</th>
<th>å¯ç»´æŠ¤æ€§</th>
<th>å­¦ä¹ æ›²çº¿</th>
</tr>
</thead>
<tbody><tr>
<td>ç›´æ¥å¼•ç”¨</td>
<td>é«˜</td>
<td>ä½</td>
<td>å·®</td>
<td>ä½</td>
</tr>
<tr>
<td>åè®®æŠ½è±¡</td>
<td>ä¸­</td>
<td>ä¸­</td>
<td>ä¼˜</td>
<td>é«˜</td>
</tr>
<tr>
<td>CTMediator</td>
<td>ä½</td>
<td>ä¸­</td>
<td>è‰¯</td>
<td>ä¸­</td>
</tr>
<tr>
<td>URL Router</td>
<td>ä½</td>
<td>é«˜</td>
<td>è‰¯</td>
<td>ä½</td>
</tr>
</tbody></table>
<h1 id="äºŒã€æŠ€æœ¯å®ç°è¯¦è§£"><a href="#äºŒã€æŠ€æœ¯å®ç°è¯¦è§£" class="headerlink" title="äºŒã€æŠ€æœ¯å®ç°è¯¦è§£"></a>äºŒã€æŠ€æœ¯å®ç°è¯¦è§£</h1><h2 id="2-1-æ ¸å¿ƒç±»ç»“æ„"><a href="#2-1-æ ¸å¿ƒç±»ç»“æ„" class="headerlink" title="2.1 æ ¸å¿ƒç±»ç»“æ„"></a>2.1 æ ¸å¿ƒç±»ç»“æ„</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@startuml</span><br><span class="line">class CTMediator &#123;</span><br><span class="line">  - cachedTargets: NSMutableDictionary</span><br><span class="line">  + sharedInstance(): CTMediator</span><br><span class="line">  + performTarget(): id</span><br><span class="line">  + safePerformAction(): id</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Target_XXX &#123;</span><br><span class="line">  + Action_YYY(): id</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CTMediator --&gt; Target_XXX : åŠ¨æ€è°ƒç”¨</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure>

<h2 id="2-2-å®Œæ•´è°ƒç”¨é“¾è·¯"><a href="#2-2-å®Œæ•´è°ƒç”¨é“¾è·¯" class="headerlink" title="2.2 å®Œæ•´è°ƒç”¨é“¾è·¯"></a>2.2 å®Œæ•´è°ƒç”¨é“¾è·¯</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// è°ƒç”¨ç«¯ç¤ºä¾‹ï¼ˆå«å®‰å…¨æ ¡éªŒï¼‰</span><br><span class="line">NSDictionary *params = @&#123;</span><br><span class="line">  @&quot;pageID&quot;: @(1024),</span><br><span class="line">  @&quot;authToken&quot;: @&quot;3a8d7f0e&quot;,</span><br><span class="line">  @&quot;callback&quot;: ^(BOOL success) &#123;</span><br><span class="line">      NSLog(@&quot;æ“ä½œçŠ¶æ€: %@&quot;, success ? @&quot;æˆåŠŸ&quot; : @&quot;å¤±è´¥&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">UIViewController *vc = [[CTMediator sharedInstance]</span><br><span class="line">    performTarget:@&quot;UserCenter&quot;  // ç›®æ ‡æ¨¡å—æ ‡è¯†</span><br><span class="line">     action:@&quot;ProfilePage&quot;       // åŠŸèƒ½å•å…ƒæ ‡è¯†</span><br><span class="line">     params:[params copy]       // é˜²å¾¡æ€§æ‹·è´</span><br><span class="line">     shouldCacheTarget:YES];    // é«˜é¢‘è®¿é—®ç¼“å­˜</span><br><span class="line"></span><br><span class="line">// å¼‚å¸¸å¤„ç†æµç¨‹</span><br><span class="line">if (![vc conformsToProtocol:@protocol(SafeViewProtocol)]) &#123;</span><br><span class="line">    [self trackException:@&#123;</span><br><span class="line">        @&quot;code&quot;: @(403),</span><br><span class="line">        @&quot;reason&quot;: @&quot;è§†å›¾æ§åˆ¶å™¨åè®®ä¸åŒ¹é…&quot;</span><br><span class="line">    &#125;];</span><br><span class="line">    vc = [FallbackViewController new];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"><a href="#2-3-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="2.3 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"></a>2.3 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</h2><p><strong>ç¼“å­˜æœºåˆ¶å®ç°</strong>ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CTMediatorCache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> targetCache <span class="operator">=</span> [<span class="type">String</span>: <span class="type">NSObject</span>]()</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">cache</span>(<span class="params">target</span>: <span class="type">NSObject</span>, <span class="params">forKey</span> <span class="params">key</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">guard</span> targetCache.count <span class="operator">&lt;</span> <span class="number">20</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125; <span class="comment">// é˜²æº¢å‡º</span></span><br><span class="line">        targetCache[key] <span class="operator">=</span> target</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">purgeExpired</span>() &#123;</span><br><span class="line">        targetCache.keys</span><br><span class="line">            .filter &#123; lastAccessTime(for: <span class="variable">$0</span>) <span class="operator">&lt;</span> .now<span class="operator">-</span><span class="number">3600</span> &#125;</span><br><span class="line">            .forEach &#123; targetCache.removeValue(forKey: <span class="variable">$0</span>) &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ä¸‰ã€æ¶æ„æ¼”è¿›è·¯çº¿"><a href="#ä¸‰ã€æ¶æ„æ¼”è¿›è·¯çº¿" class="headerlink" title="ä¸‰ã€æ¶æ„æ¼”è¿›è·¯çº¿"></a>ä¸‰ã€æ¶æ„æ¼”è¿›è·¯çº¿</h1><h2 id="3-1-å½“å‰åº”ç”¨åœºæ™¯"><a href="#3-1-å½“å‰åº”ç”¨åœºæ™¯" class="headerlink" title="3.1 å½“å‰åº”ç”¨åœºæ™¯"></a>3.1 å½“å‰åº”ç”¨åœºæ™¯</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">graph TD</span><br><span class="line">  subgraph åŸºç¡€å±‚</span><br><span class="line">      CommonUtils --&gt;|åå‘è°ƒç”¨| CTMediator</span><br><span class="line">  end</span><br><span class="line">  </span><br><span class="line">  subgraph ä¸šåŠ¡å±‚</span><br><span class="line">      FeatureA --&gt;|è·¨æ¨¡å—è°ƒç”¨| CTMediator</span><br><span class="line">      CTMediator --&gt;|åŠ¨æ€è·¯ç”±| I18NModule</span><br><span class="line">  end</span><br><span class="line">  </span><br><span class="line">  subgraph æ•°æ®å±‚</span><br><span class="line">      Analytics --&gt;|äº‹ä»¶ä¸ŠæŠ¥| CTMediator</span><br><span class="line">  end</span><br></pre></td></tr></table></figure>

<h2 id="3-2-æ”¹é€ è·¯çº¿å›¾"><a href="#3-2-æ”¹é€ è·¯çº¿å›¾" class="headerlink" title="3.2 æ”¹é€ è·¯çº¿å›¾"></a>3.2 æ”¹é€ è·¯çº¿å›¾</h2><table>
<thead>
<tr>
<th>é˜¶æ®µ</th>
<th>æ—¶é—´èŒƒå›´</th>
<th>é‡ç‚¹ä»»åŠ¡</th>
<th>å…³é”®æŒ‡æ ‡</th>
</tr>
</thead>
<tbody><tr>
<td>è¿‡æ¸¡æœŸ</td>
<td>2025 Q1-Q2</td>
<td>å»ºç«‹è°ƒç”¨å¤‡æ¡ˆåˆ¶åº¦</td>
<td>è°ƒç”¨æ–‡æ¡£è¦†ç›–ç‡ â‰¥90%</td>
</tr>
<tr>
<td>è¿ç§»æœŸ</td>
<td>2025 Q3-Q4</td>
<td>æ ¸å¿ƒæ¨¡å—æ¥å£æ”¹é€ </td>
<td>ç›´æ¥å¼•ç”¨å æ¯” â‰¤30%</td>
</tr>
<tr>
<td>ç¨³å®šæœŸ</td>
<td>2026 Q1</td>
<td>å…¨é‡é™æ€æ ¡éªŒå®æ–½</td>
<td>ç¼–è¯‘æ—¶æ£€æŸ¥è¦†ç›–ç‡ 100%</td>
</tr>
</tbody></table>
<h1 id="å››ã€æœ€ä½³å®è·µæŒ‡å—"><a href="#å››ã€æœ€ä½³å®è·µæŒ‡å—" class="headerlink" title="å››ã€æœ€ä½³å®è·µæŒ‡å—"></a>å››ã€æœ€ä½³å®è·µæŒ‡å—</h1><h2 id="4-1-å®‰å…¨è°ƒç”¨æ¨¡æ¿"><a href="#4-1-å®‰å…¨è°ƒç”¨æ¨¡æ¿" class="headerlink" title="4.1 å®‰å…¨è°ƒç”¨æ¨¡æ¿"></a>4.1 å®‰å…¨è°ƒç”¨æ¨¡æ¿</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// SafeInvoker.h</span><br><span class="line">#define SAFE_CALL(target, action, paramsType) \</span><br><span class="line">__attribute__((overloadable)) \</span><br><span class="line">static inline id safeInvoke(NSString *target, NSString *action, paramsType params) &#123; \</span><br><span class="line">    if (![CTMediator validateTarget:target]) &#123; \</span><br><span class="line">        [NSException raise:@&quot;éæ³•è°ƒç”¨&quot; format:@&quot;æœªç»æ³¨å†Œçš„ Target: %@&quot;, target]; \</span><br><span class="line">    &#125; \</span><br><span class="line">    /* ... å‚æ•°æ ¡éªŒé€»è¾‘ ... */ \</span><br><span class="line">    return [[CTMediator sharedInstance] performTarget:target action:action params:params]; \</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-2-ç›‘æ§æŒ‡æ ‡é…ç½®"><a href="#4-2-ç›‘æ§æŒ‡æ ‡é…ç½®" class="headerlink" title="4.2 ç›‘æ§æŒ‡æ ‡é…ç½®"></a>4.2 ç›‘æ§æŒ‡æ ‡é…ç½®</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;metrics&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;è°ƒç”¨æˆåŠŸç‡&quot;</span><span class="punctuation">:</span> <span class="string">&quot;98.7%&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;å¹³å‡å“åº”æ—¶é—´&quot;</span><span class="punctuation">:</span> <span class="string">&quot;12ms&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ç¼“å­˜å‘½ä¸­ç‡&quot;</span><span class="punctuation">:</span> <span class="string">&quot;82.3%&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;å¼‚å¸¸ç±»å‹åˆ†å¸ƒ&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;TargetNotFound&quot;</span><span class="punctuation">:</span> <span class="number">45</span>%<span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;ActionMissing&quot;</span><span class="punctuation">:</span> <span class="number">30</span>%<span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;ParamError&quot;</span><span class="punctuation">:</span> <span class="number">25</span>%</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="äº”ã€å¸¸è§é—®é¢˜è¯Šæ–­"><a href="#äº”ã€å¸¸è§é—®é¢˜è¯Šæ–­" class="headerlink" title="äº”ã€å¸¸è§é—®é¢˜è¯Šæ–­"></a>äº”ã€å¸¸è§é—®é¢˜è¯Šæ–­</h1><table>
<thead>
<tr>
<th>æ•…éšœç°è±¡</th>
<th>æ’æŸ¥æ­¥éª¤</th>
<th>ä¿®å¤æ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody><tr>
<td>è°ƒç”¨è¿”å› nil</td>
<td>1. æ£€æŸ¥ Target ç±»å‰ç¼€<code>&lt;br&gt;</code>2. éªŒè¯ Action å‚æ•°ç±»å‹</td>
<td>æ·»åŠ  Class å‰ç¼€çº¦å®š</td>
</tr>
<tr>
<td>å‚æ•°ä¼ é€’ä¸¢å¤±</td>
<td>1. æ£€æŸ¥å­—å…¸ key å¤§å°å†™<code>&lt;br&gt;</code>2. éªŒè¯ NSJSONSerialization å…¼å®¹æ€§</td>
<td>ä½¿ç”¨ç±»å‹å®‰å…¨çš„å‚æ•°åŒ…è£…å™¨</td>
</tr>
<tr>
<td>å†…å­˜æŒç»­å¢é•¿</td>
<td>1. æ£€æŸ¥ Target ç¼“å­˜ç­–ç•¥<code>&lt;br&gt;</code>2. åˆ†æ ARC å¼•ç”¨å…³ç³»</td>
<td>å®ç°ç¼“å­˜è‡ªåŠ¨å›æ”¶æœºåˆ¶</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>æ¶æ„å¸ˆå»ºè®®</strong>ï¼šåœ¨ Swift ä¸»å¯¼çš„æ–°é¡¹ç›®ä¸­ï¼Œå»ºè®®é‡‡ç”¨ <code>Protocol-Oriented Dependency Injection</code> æ¨¡å¼é€æ­¥æ›¿ä»£ CTMediatorï¼ŒåŒæ—¶ä¿ç•™å…¶ä½œä¸ºåº”æ€¥é€šä¿¡æœºåˆ¶ã€‚</p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>ä»£ç å®¡æŸ¥å®æˆ˜æŒ‡å—</title>
    <url>/2025/03/14/CodeReview%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h1 id="ä»£ç å®¡æŸ¥å®æˆ˜æŒ‡å—"><a href="#ä»£ç å®¡æŸ¥å®æˆ˜æŒ‡å—" class="headerlink" title="ä»£ç å®¡æŸ¥å®æˆ˜æŒ‡å—"></a>ä»£ç å®¡æŸ¥å®æˆ˜æŒ‡å—</h1><h2 id="ä¸€ã€ä»£ç é£æ ¼æ ‡å‡†åŒ–"><a href="#ä¸€ã€ä»£ç é£æ ¼æ ‡å‡†åŒ–" class="headerlink" title="ä¸€ã€ä»£ç é£æ ¼æ ‡å‡†åŒ–"></a>ä¸€ã€ä»£ç é£æ ¼æ ‡å‡†åŒ–</h2><h3 id="1-1-å‘½åè§„èŒƒ"><a href="#1-1-å‘½åè§„èŒƒ" class="headerlink" title="1.1 å‘½åè§„èŒƒ"></a>1.1 å‘½åè§„èŒƒ</h3><ul>
<li>é‡‡ç”¨åŒˆç‰™åˆ©å‘½åæ³•ï¼ˆå¦‚ <code>strUserName</code>ï¼‰æˆ–ç°ä»£è¯­ä¹‰å‘½åï¼ˆå¦‚ <code>userNameTextField</code>ï¼‰</li>
<li>ç¦æ­¢ä½¿ç”¨ <code>tmp</code>&#x2F;<code>data</code>ç­‰æ— æ„ä¹‰å‘½å</li>
<li>ç±»åé‡‡ç”¨å¤§é©¼å³°ï¼Œæ–¹æ³•åä½¿ç”¨å°é©¼å³°</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¥½çš„ç¤ºä¾‹</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UserService</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)updateUserProfile:(<span class="built_in">NSString</span> *)userId;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-æ ¼å¼ä¸€è‡´æ€§"><a href="#1-2-æ ¼å¼ä¸€è‡´æ€§" class="headerlink" title="1.2 æ ¼å¼ä¸€è‡´æ€§"></a>1.2 æ ¼å¼ä¸€è‡´æ€§</h3><ul>
<li>ç»Ÿä¸€ç¼©è¿›ç­–ç•¥ï¼ˆ4ç©ºæ ¼åˆ¶æˆ–2ç©ºæ ¼åˆ¶ï¼‰</li>
<li>æ–¹æ³•å‚æ•°å¯¹é½æ ‡å‡†ï¼š</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="type">void</span>)complexCalculationWithParam1:(<span class="built_in">NSInteger</span>)param1</span><br><span class="line">                             param2:(<span class="built_in">CGFloat</span>)param2</span><br><span class="line">                             param3:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="type">id</span>&gt; *)param3</span><br><span class="line">                         completion:(<span class="type">void</span>(^)(ResultType *result))completion;</span><br></pre></td></tr></table></figure>

<h2 id="äºŒã€å†—ä½™ä»£ç æ²»ç†"><a href="#äºŒã€å†—ä½™ä»£ç æ²»ç†" class="headerlink" title="äºŒã€å†—ä½™ä»£ç æ²»ç†"></a>äºŒã€å†—ä½™ä»£ç æ²»ç†</h2><h3 id="2-1-ä»£ç é‡å¤æ£€æµ‹"><a href="#2-1-ä»£ç é‡å¤æ£€æµ‹" class="headerlink" title="2.1 ä»£ç é‡å¤æ£€æµ‹"></a>2.1 ä»£ç é‡å¤æ£€æµ‹</h3><p>ä½¿ç”¨OCLintå·¥å…·æ£€æµ‹é‡å¤ä»£ç å—ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">disable-rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">LongLine</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">LongMethod</span></span><br><span class="line"><span class="attr">enable-rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">DuplicatedCode:</span></span><br><span class="line">      <span class="attr">threshold:</span> <span class="number">50</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-æ— æ•ˆä»£ç å¤„ç†æµç¨‹"><a href="#2-2-æ— æ•ˆä»£ç å¤„ç†æµç¨‹" class="headerlink" title="2.2 æ— æ•ˆä»£ç å¤„ç†æµç¨‹"></a>2.2 æ— æ•ˆä»£ç å¤„ç†æµç¨‹</h3><h2 id="ä¸‰ã€ä¸šåŠ¡é€»è¾‘éªŒè¯"><a href="#ä¸‰ã€ä¸šåŠ¡é€»è¾‘éªŒè¯" class="headerlink" title="ä¸‰ã€ä¸šåŠ¡é€»è¾‘éªŒè¯"></a>ä¸‰ã€ä¸šåŠ¡é€»è¾‘éªŒè¯</h2><h3 id="3-1-æ ¸å¿ƒæ£€æŸ¥ç‚¹çŸ©é˜µ"><a href="#3-1-æ ¸å¿ƒæ£€æŸ¥ç‚¹çŸ©é˜µ" class="headerlink" title="3.1 æ ¸å¿ƒæ£€æŸ¥ç‚¹çŸ©é˜µ"></a>3.1 æ ¸å¿ƒæ£€æŸ¥ç‚¹çŸ©é˜µ</h3><table>
<thead>
<tr>
<th>æ£€æŸ¥ç»´åº¦</th>
<th>æ­£å‘æ¡ˆä¾‹éªŒè¯</th>
<th>å¼‚å¸¸åœºæ™¯è¦†ç›–</th>
<th>æ€§èƒ½è¾¹ç•Œæµ‹è¯•</th>
</tr>
</thead>
<tbody><tr>
<td>æ”¯ä»˜æµç¨‹</td>
<td>âœ“</td>
<td>âœ“</td>
<td>ï¼100TPS</td>
</tr>
<tr>
<td>åº“å­˜æ‰£å‡</td>
<td>âœ“</td>
<td>è¶…å–é˜²æŠ¤</td>
<td>åˆ†å¸ƒå¼é”</td>
</tr>
</tbody></table>
<h3 id="3-2-é˜²å¾¡æ€§ç¼–ç¨‹æ¨¡å¼"><a href="#3-2-é˜²å¾¡æ€§ç¼–ç¨‹æ¨¡å¼" class="headerlink" title="3.2 é˜²å¾¡æ€§ç¼–ç¨‹æ¨¡å¼"></a>3.2 é˜²å¾¡æ€§ç¼–ç¨‹æ¨¡å¼</h3><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨NSParameterAssertè¿›è¡Œå‚æ•°æ£€æŸ¥</span></span><br><span class="line"><span class="built_in">NSParameterAssert</span>(orderId.length &gt; <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (orderId.length == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *errorMsg = <span class="string">@&quot;è®¢å•IDä¸èƒ½ä¸ºç©º&quot;</span>;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>, errorMsg);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å››ã€è§„èŒƒæ‰§è¡Œæœºåˆ¶"><a href="#å››ã€è§„èŒƒæ‰§è¡Œæœºåˆ¶" class="headerlink" title="å››ã€è§„èŒƒæ‰§è¡Œæœºåˆ¶"></a>å››ã€è§„èŒƒæ‰§è¡Œæœºåˆ¶</h2><h3 id="4-1-è‡ªåŠ¨åŒ–æ£€æŸ¥æ¸…å•"><a href="#4-1-è‡ªåŠ¨åŒ–æ£€æŸ¥æ¸…å•" class="headerlink" title="4.1 è‡ªåŠ¨åŒ–æ£€æŸ¥æ¸…å•"></a>4.1 è‡ªåŠ¨åŒ–æ£€æŸ¥æ¸…å•</h3><ol>
<li>SonarQubeè´¨é‡é—¨ç¦ï¼ˆè¦†ç›–ç‡ï¼80%ï¼‰</li>
<li>OCLintæ ¼å¼æ ¡éªŒ</li>
<li>OWASPä¾èµ–æ‰«æ</li>
<li>ç¼–è¯‘å™¨è­¦å‘Šé›¶å®¹å¿</li>
</ol>
<h3 id="4-2-å®¡æŸ¥è®°å½•æ¨¡æ¿"><a href="#4-2-å®¡æŸ¥è®°å½•æ¨¡æ¿" class="headerlink" title="4.2 å®¡æŸ¥è®°å½•æ¨¡æ¿"></a>4.2 å®¡æŸ¥è®°å½•æ¨¡æ¿</h3><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="strong">**å®¡æŸ¥é¡¹**</span>ï¼šç”¨æˆ·æœåŠ¡æ¨¡å—  </span><br><span class="line"><span class="strong">**é—®é¢˜ç±»å‹**</span>ï¼š  </span><br><span class="line"><span class="bullet">-</span> [ ] ä»£ç é£æ ¼  </span><br><span class="line"><span class="bullet">-</span> [x] ä¸šåŠ¡é€»è¾‘  </span><br><span class="line"><span class="strong">**æ”¹è¿›å»ºè®®**</span>ï¼š  </span><br><span class="line">å»ºè®®ä½¿ç”¨NSDateæ›¿ä»£CFAbsoluteTime  </span><br><span class="line"><span class="strong">**ä¸¥é‡ç¨‹åº¦**</span>ï¼šâ­ï¸â­ï¸</span><br></pre></td></tr></table></figure>

<h2 id="äº”ã€å…¸å‹é—®é¢˜è§£ç­”"><a href="#äº”ã€å…¸å‹é—®é¢˜è§£ç­”" class="headerlink" title="äº”ã€å…¸å‹é—®é¢˜è§£ç­”"></a>äº”ã€å…¸å‹é—®é¢˜è§£ç­”</h2><h3 id="Q1ï¼šå¦‚ä½•å¤„ç†ç´§æ€¥éœ€æ±‚ä¸ä»£ç è§„èŒƒçš„å†²çªï¼Ÿ"><a href="#Q1ï¼šå¦‚ä½•å¤„ç†ç´§æ€¥éœ€æ±‚ä¸ä»£ç è§„èŒƒçš„å†²çªï¼Ÿ" class="headerlink" title="Q1ï¼šå¦‚ä½•å¤„ç†ç´§æ€¥éœ€æ±‚ä¸ä»£ç è§„èŒƒçš„å†²çªï¼Ÿ"></a>Q1ï¼šå¦‚ä½•å¤„ç†ç´§æ€¥éœ€æ±‚ä¸ä»£ç è§„èŒƒçš„å†²çªï¼Ÿ</h3><p>å»ºç«‹ <code>ç´§æ€¥é€šé“ç™½åå•</code>æœºåˆ¶ï¼Œéœ€æ»¡è¶³ï¼š</p>
<ol>
<li>æäº¤é£é™©è¯„ä¼°æŠ¥å‘Š</li>
<li>æ·»åŠ TODOæ³¨é‡Šæ ‡è®°</li>
<li>72å°æ—¶å†…è¡¥å…¨å®¡æŸ¥</li>
</ol>
<h3 id="Q2ï¼šè·¨å›¢é˜Ÿä»£ç å®¡æŸ¥å¦‚ä½•åä½œï¼Ÿ"><a href="#Q2ï¼šè·¨å›¢é˜Ÿä»£ç å®¡æŸ¥å¦‚ä½•åä½œï¼Ÿ" class="headerlink" title="Q2ï¼šè·¨å›¢é˜Ÿä»£ç å®¡æŸ¥å¦‚ä½•åä½œï¼Ÿ"></a>Q2ï¼šè·¨å›¢é˜Ÿä»£ç å®¡æŸ¥å¦‚ä½•åä½œï¼Ÿ</h3><p>æ¨èä½¿ç”¨<a href="https://www.gerritcodereview.com/">Gerrit</a>çš„è¯„å®¡å·¥ä½œæµï¼š</p>
<ol>
<li>åˆ›å»ºè·¨åŸŸè¯„å®¡ç»„</li>
<li>è®¾ç½®æƒé‡è¯„åˆ†æœºåˆ¶</li>
<li>å®æ–½è¿½è¸ªçœ‹æ¿</li>
</ol>
<hr>
<p><strong>å»¶ä¼¸é˜…è¯»</strong>ï¼š</p>
<ul>
<li><a href="https://google.github.io/eng-practices/review/">Googleä»£ç å®¡æŸ¥æ ‡å‡†</a></li>
<li><a href="https://docs.microsoft.com/codereview-checklist">å¾®è½¯ä»£ç è¯„å®¡checklist</a></li>
</ul>
]]></content>
      <categories>
        <category>è½¯ä»¶å·¥ç¨‹</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡æŸ¥</tag>
        <tag>æœ€ä½³å®è·µ</tag>
        <tag>å¼€å‘æµç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Xcodeä»£ç å—äº‘åŒæ­¥+æœ¬åœ°å®‰è£…è„šæœ¬</title>
    <url>/2021/08/25/Xcode%E4%BB%A3%E7%A0%81%E5%9D%97%E4%BA%91%E5%90%8C%E6%AD%A5+%E6%9C%AC%E5%9C%B0%E5%AE%89%E8%A3%85%E8%84%9A%E6%9C%AC/</url>
    <content><![CDATA[<p>ä»Šå¤©æ•´ç†äº†æœ€è¿‘åŠå¹´å†…ä½¿ç”¨é¢‘ç‡é«˜çš„ä¸€äº›ä»£ç ï¼Œåšäº†ä¸€äº›ä»£ç å— <code>codesnippet</code>ä½¿ç”¨ï¼Œå¹¶åœ¨githubä¸Šåˆ›å»ºäº†ä¸€ä¸ªç§æœ‰ä»“åº“ç”¨æ¥äº‘ç«¯ç»´æŠ¤å’ŒåŒæ­¥ï¼Œå†™äº†ä¸€ä¸ªè„šæœ¬è¿›è¡Œä»£ç å—ä¸‹è½½å’Œåˆå¹¶ã€‚</p>
<p>åˆ›å»ºæ–¹å¼ï¼š</p>
<ol>
<li><p>é€‰ä¸­è¦åˆ›å»ºçš„ä»£ç å—ï¼Œå³é”®é€‰æ‹©Create Code Snippte</p>
<p><img src="https://cdn.zcx.info/008i3skNly1gtt9tybj9gj611y0q8djc02.jpg"></p>
</li>
<li><p>å³ä¸Šè§’ <code>+</code>æ¡†å¿«é€ŸæŸ¥çœ‹ç³»ç»Ÿå’Œè‡ªå®šä¹‰ä»£ç å—</p>
<p><img src="https://cdn.zcx.info/008i3skNly1gtt9ty5ejxj61gj0u043502.jpg"></p>
</li>
<li><p>å¡«å†™ä»£ç å—æè¿°ï¼Œä»¥åŠå¿«æ·æ–¹å¼ï¼Œä¿®æ”¹ä»£ç å—</p>
</li>
</ol>
<p><img src="https://cdn.zcx.info/008i3skNly1gtt9txvjapj61c50u00wu02.jpg"></p>
<p>xcodeä¸­ç”¨æˆ·è‡ªå®šä¹‰çš„ ä»£ç å—ä¿å­˜åœ¨~&#x2F;Library&#x2F;Developer&#x2F;Xcode&#x2F;UserData&#x2F;CodeSnippetsè·¯å¾„ä¸‹ï¼Œæ¯ä¸ªä»£ç å—éƒ½æ˜¯ä¸€ä¸ª.codesnippetæ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">~<span class="regexp">/Library/</span><span class="title class_">Developer</span>/<span class="title class_">Xcode</span>/<span class="title class_">UserData</span>/<span class="title class_">CodeSnippets</span><span class="variable">$:</span> ls -l</span><br><span class="line">total <span class="number">72</span></span><br><span class="line">-rw-r--r--  <span class="number">1</span> zcx  staff  <span class="number">1008</span> <span class="title class_">Aug</span> <span class="number">25</span> <span class="number">19</span><span class="symbol">:</span><span class="number">36</span> 1BF011CF-<span class="number">9292</span>-4B72-9D44-<span class="variable constant_">F7C3BC89AFE0</span>.codesnippet</span><br><span class="line">-rw-r--r--  <span class="number">1</span> zcx  staff  <span class="number">1036</span> <span class="title class_">Aug</span> <span class="number">25</span> <span class="number">16</span><span class="symbol">:</span><span class="number">03</span> 28DDA843-<span class="variable constant_">AD69</span>-4A09-87C4-3D1DB320EDB5.codesnippet</span><br><span class="line">-rw-r--r--  <span class="number">1</span> zcx  staff   <span class="number">864</span> <span class="title class_">Aug</span> <span class="number">25</span> <span class="number">16</span><span class="symbol">:</span><span class="number">37</span> 8BEF45E5-0B98-4CC5-9CB8-86203CA29A69.codesnippet</span><br><span class="line">-rw-r--r--  <span class="number">1</span> zcx  staff  <span class="number">1699</span> <span class="title class_">Aug</span> <span class="number">25</span> <span class="number">19</span><span class="symbol">:</span><span class="number">37</span> <span class="variable constant_">B42EC618</span>-1BF8-<span class="number">4E30</span>-<span class="variable constant_">AC73</span>-12E1282FEAFC.codesnippet</span><br><span class="line">-rw-r--r--  <span class="number">1</span> zcx  staff   <span class="number">994</span> <span class="title class_">Aug</span> <span class="number">25</span> <span class="number">17</span><span class="symbol">:</span><span class="number">48</span> <span class="variable constant_">BA1B105B</span>-<span class="variable constant_">F02A</span>-<span class="number">4925</span>-<span class="variable constant_">A7FD</span>-<span class="variable constant_">B7E6081438E2</span>.codesnippet</span><br><span class="line">-rw-r--r--  <span class="number">1</span> zcx  staff  <span class="number">1099</span> <span class="title class_">Aug</span> <span class="number">25</span> <span class="number">15</span><span class="symbol">:</span><span class="number">30</span> <span class="variable constant_">BB31C5F1</span>-<span class="variable constant_">D74A</span>-4CD4-968D-<span class="variable constant_">F707DADF07C1</span>.codesnippet</span><br><span class="line">-rw-r--r--  <span class="number">1</span> zcx  staff  <span class="number">1144</span> <span class="title class_">Aug</span> <span class="number">25</span> <span class="number">17</span><span class="symbol">:</span><span class="number">48</span> <span class="variable constant_">DDA53283</span>-7F1F-49EC-9D76-87D876EA67FC.codesnippet</span><br><span class="line">-rw-r--r--  <span class="number">1</span> zcx  staff  <span class="number">1557</span> <span class="title class_">Aug</span> <span class="number">25</span> <span class="number">17</span><span class="symbol">:</span><span class="number">48</span> <span class="variable constant_">E12D24FC</span>-<span class="number">2098</span>-413F-<span class="variable constant_">B12E</span>-<span class="variable constant_">CBB79181EBDA</span>.codesnippet</span><br><span class="line">-rw-r--r--  <span class="number">1</span> zcx  staff  <span class="number">1085</span> <span class="title class_">Aug</span> <span class="number">25</span> <span class="number">17</span><span class="symbol">:</span><span class="number">48</span> <span class="variable constant_">E7CFEE5D</span>-<span class="variable constant_">D2F0</span>-42D7-<span class="variable constant_">AD6E</span>-258BC0A67D75.codesnippet</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥å¯¹ä¸ªäººçš„ä»£ç å—çš„ç»´æŠ¤æ–¹å¼ä¹Ÿæ˜¾è€Œæ˜“è§å˜æˆäº†å¯¹æ­¤æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶çš„ç»´æŠ¤ã€‚</p>
<hr>
<p><a href="https://github.com/zcx4u/XCode_CodeSnippet">åˆ›å»ºç§æœ‰åº“ç”¨æ¥ä¿å­˜åˆ›å»ºçš„ä»£ç å—</a></p>
<p>æ¯æ¬¡ä¸‹è½½è¿‡æ–‡ä»¶ä¹‹åå†æ‰‹åŠ¨æ‰¹é‡å‘æœ¬åœ°å¤åˆ¶ç²˜è´´æŒºéº»çƒ¦ï¼ˆä¸»è¦æ˜¯æ‡’â€¦ï¼‰æ‰€ä»¥é€šè¿‡è„šæœ¬å‘½ä»¤è¿›è¡Œåˆå¹¶å†å¥½ä¸è¿‡äº†ï¼</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># GitHub: https://github.com/zcx4u/XCode_CodeSnippet</span></span><br><span class="line"><span class="comment"># å°†ä»£ç å—åˆ°æœ¬åœ°å¹¶å®‰è£…åˆ°xcode</span></span><br><span class="line"></span><br><span class="line"><span class="variable constant_">SRC_HOME</span>=<span class="string">`pwd`</span></span><br><span class="line">echo <span class="string">&quot;å¤‡ä»½æ—§ä»£ç å—~/Library/Developer/Xcode/UserData/CodeSnippets_Backup.zip&quot;</span></span><br><span class="line">cd ~<span class="regexp">/Library/</span><span class="title class_">Developer</span>/<span class="title class_">Xcode</span>/<span class="title class_">UserData</span></span><br><span class="line">zip -r <span class="title class_">CodeSnippets</span>_Backup.zip <span class="title class_">CodeSnippets</span></span><br><span class="line">echo <span class="string">&quot;åˆå¹¶ä»£ç å—&quot;</span></span><br><span class="line">ditto -V <span class="variable">$&#123;</span><span class="variable constant_">SRC_HOME</span>&#125;/<span class="title class_">CodeSnippets</span> ~<span class="regexp">/Library/</span><span class="title class_">Developer</span>/<span class="title class_">Xcode</span>/<span class="title class_">UserData</span>/<span class="title class_">CodeSnippets</span></span><br><span class="line">echo <span class="string">&quot;done&quot;</span></span><br></pre></td></tr></table></figure>

<p> è®°å¾—å…ˆå¤‡ä»½æ—§çš„æ–‡ä»¶å¤¹ä»¥é˜²ä¸æµ‹ğŸ˜„</p>
<p>ä»¥å‰ä¹Ÿé›¶é›¶ç¢ç¢çš„å¢åŠ è¿‡ä»£ç å—ï¼Œä½†æ˜¯æ¢å·¥ä½œæ¢ç”µè„‘åå°±æ¸…ç©ºäº†ï¼Œå®¢æˆ·ç«¯ä¸šåŠ¡å˜åŒ–è¾ƒå¤§é‡å¤æ€§çš„ç¼–ç è¿˜æ˜¯æ¯”è¾ƒå¤šã€‚</p>
<p>ç§¯ç´¯ä¸€äº›ä½¿ç”¨çš„é¡ºæ‰‹çš„å·¥å…·å’Œæ–¹æ³•èƒ½æœ‰æ•ˆæå‡æ•ˆç‡ï¼Œé«˜æ•ˆå®Œæˆcodingæ—©ç‚¹homingå¯ä»¥gamingè¿˜èƒ½shoppingï¼Œå²‚ä¸ç¾å“‰ï¼</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æ•ˆç‡</tag>
      </tags>
  </entry>
  <entry>
    <title>ChatGPTä½¿ç”¨æŠ€å·§æ‰‹å†Œ</title>
    <url>/2024/01/15/ChatGPT%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7%E6%89%8B%E5%86%8C/</url>
    <content><![CDATA[<h1 id="ChatGPTä½¿ç”¨æŠ€å·§æ‰‹å†Œ"><a href="#ChatGPTä½¿ç”¨æŠ€å·§æ‰‹å†Œ" class="headerlink" title="ChatGPTä½¿ç”¨æŠ€å·§æ‰‹å†Œ"></a>ChatGPTä½¿ç”¨æŠ€å·§æ‰‹å†Œ</h1><hr>
<h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ul>
<li><a href="#%E6%A0%B8%E5%BF%83%E6%8A%80%E5%B7%A7">æ ¸å¿ƒæŠ€å·§</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96%E4%B8%8E%E9%87%8D%E6%9E%84">ä»£ç ä¼˜åŒ–ä¸é‡æ„</a></li>
<li><a href="#%E5%A4%9A%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86">å¤šè¯­è¨€å¤„ç†</a></li>
<li><a href="#%E5%BC%80%E5%8F%91%E8%BE%85%E5%8A%A9">å¼€å‘è¾…åŠ©</a></li>
<li><a href="#%E8%B7%A8%E5%B9%B3%E5%8F%B0%E9%80%82%E9%85%8D">è·¨å¹³å°é€‚é…</a></li>
<li><a href="#%E6%89%A9%E5%B1%95%E5%BA%94%E7%94%A8">æ‰©å±•åº”ç”¨</a></li>
</ul>
<hr>
<h2 id="æ ¸å¿ƒæŠ€å·§"><a href="#æ ¸å¿ƒæŠ€å·§" class="headerlink" title="æ ¸å¿ƒæŠ€å·§"></a>æ ¸å¿ƒæŠ€å·§</h2><h3 id="Promptç”Ÿæˆæ–¹æ³•è®º"><a href="#Promptç”Ÿæˆæ–¹æ³•è®º" class="headerlink" title="Promptç”Ÿæˆæ–¹æ³•è®º"></a>Promptç”Ÿæˆæ–¹æ³•è®º</h3><ol>
<li><p><strong>å¤šPromptç”Ÿæˆ</strong></p>
<ul>
<li>é€šè¿‡ç”Ÿæˆå¤šä¸ªpromptè¿­ä»£ä¼˜åŒ–è¾“å‡ºè´¨é‡</li>
<li>ç¤ºä¾‹æµç¨‹ï¼š<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆåˆå§‹Prompt â†’ è¯„ä¼°ç»“æœ â†’ ç”Ÿæˆæ”¹è¿›Prompt â†’ æœ€ç»ˆä¼˜åŒ–</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>è§’è‰²æ‰®æ¼”</strong></p>
<ul>
<li>ä½œä¸ºè¶…çº§è¯­è¨€è§£é‡Šå™¨ï¼ˆå¤„ç†å¤æ‚è¯­ä¹‰ï¼‰</li>
<li>ä½œä¸ºæç¤ºè¯è®­ç»ƒå™¨ï¼ˆç”Ÿæˆé¢†åŸŸä¸“ç”¨Promptï¼‰</li>
</ul>
</li>
<li><p><strong>æ ¼å¼è§„èŒƒ</strong></p>
<ul>
<li>å¼ºåˆ¶JSON&#x2F;YAMLç»“æ„åŒ–è¾“å‡º</li>
<li>è¡¨æ ¼åŒ–æ•°æ®å‘ˆç°</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ä»£ç ä¼˜åŒ–ä¸é‡æ„"><a href="#ä»£ç ä¼˜åŒ–ä¸é‡æ„" class="headerlink" title="ä»£ç ä¼˜åŒ–ä¸é‡æ„"></a>ä»£ç ä¼˜åŒ–ä¸é‡æ„</h2><h3 id="10å¤§å³æ—¶ä»£ç é‡æ„æŠ€å·§"><a href="#10å¤§å³æ—¶ä»£ç é‡æ„æŠ€å·§" class="headerlink" title="10å¤§å³æ—¶ä»£ç é‡æ„æŠ€å·§"></a>10å¤§å³æ—¶ä»£ç é‡æ„æŠ€å·§</h3><table>
<thead>
<tr>
<th>ä¼˜åŒ–æ–¹å‘</th>
<th>å…¸å‹æ“ä½œ</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td>æ€§èƒ½ä¼˜åŒ–</td>
<td>ç®—æ³•å¤æ‚åº¦åˆ†æ</td>
<td>å¾ªç¯ç»“æ„</td>
</tr>
<tr>
<td>å…¼å®¹æ€§</td>
<td>å¤šè¯­è¨€è¯­æ³•é€‚é…</td>
<td>è·¨å¹³å°é¡¹ç›®</td>
</tr>
<tr>
<td>å¯ç»´æŠ¤æ€§</td>
<td>æ¨¡å—åŒ–æ‹†åˆ†</td>
<td>å¤§å‹å·¥ç¨‹</td>
</tr>
</tbody></table>
<p><strong>é‡æ„æ­¥éª¤ç¤ºä¾‹ï¼š</strong></p>
<ol>
<li>ä½¿ç”¨æœ€æ–°åº“ç‰ˆæœ¬æ›¿æ¢è¿‡æ—¶ä»£ç </li>
<li>å°†ArrayListæ”¹ä¸ºConcurrentHashMapï¼ˆæ•°æ®ç»“æ„ä¼˜åŒ–ï¼‰</li>
<li>æ·»åŠ try-with-resourcesé”™è¯¯å¤„ç†</li>
</ol>
<hr>
<h2 id="å¤šè¯­è¨€å¤„ç†"><a href="#å¤šè¯­è¨€å¤„ç†" class="headerlink" title="å¤šè¯­è¨€å¤„ç†"></a>å¤šè¯­è¨€å¤„ç†</h2><h3 id="å¤šè¯­ç§ç¿»è¯‘å·¥ä½œæµ"><a href="#å¤šè¯­ç§ç¿»è¯‘å·¥ä½œæµ" class="headerlink" title="å¤šè¯­ç§ç¿»è¯‘å·¥ä½œæµ"></a>å¤šè¯­ç§ç¿»è¯‘å·¥ä½œæµ</h3><p><strong>å…³é”®æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨ <code>LANG_CODE</code>ä½œä¸ºå­—å…¸key</li>
<li>ä¿ç•™åŸå§‹æ–‡æœ¬å ä½ç¬¦ï¼ˆå¦‚ <code>&#123;0&#125;</code>ï¼‰</li>
<li>ä¼˜å…ˆå¤„ç†æ•°å­—&#x2F;æ—¥æœŸæ ¼å¼</li>
</ul>
<hr>
<h2 id="å¼€å‘è¾…åŠ©"><a href="#å¼€å‘è¾…åŠ©" class="headerlink" title="å¼€å‘è¾…åŠ©"></a>å¼€å‘è¾…åŠ©</h2><h3 id="æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰"><a href="#æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰" class="headerlink" title="æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰"></a>æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰</h3><ol>
<li><p><strong>UTç”Ÿæˆ</strong></p>
<ul>
<li>è¾“å…¥ï¼šæ–¹æ³•ç­¾å + è¾¹ç•Œæ¡ä»¶</li>
<li>è¾“å‡ºï¼šJUnit&#x2F;TestNGæµ‹è¯•å¥—ä»¶</li>
<li>è¦†ç›–ç‡åˆ†æå»ºè®®</li>
</ul>
</li>
<li><p><strong>Mockæ•°æ®ç”Ÿæˆ</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;##number(1,100)&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;##name.fullName&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="è·¨å¹³å°é€‚é…"><a href="#è·¨å¹³å°é€‚é…" class="headerlink" title="è·¨å¹³å°é€‚é…"></a>è·¨å¹³å°é€‚é…</h2><h3 id="iOSå¸ƒå±€è½¬æ¢"><a href="#iOSå¸ƒå±€è½¬æ¢" class="headerlink" title="iOSå¸ƒå±€è½¬æ¢"></a>iOSå¸ƒå±€è½¬æ¢</h3><p><strong>Objective-Cæ¡†æ¶è¿ç§»æµç¨‹ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// åŸå§‹Frameå¸ƒå±€</span><br><span class="line">CGRectMake(10, 20, 30, 40);</span><br><span class="line"></span><br><span class="line">// Masonryè½¬æ¢å</span><br><span class="line">make.top.equalTo(20);</span><br><span class="line">make.left.equalTo(10);</span><br><span class="line">make.width.equalTo(30);</span><br><span class="line">make.height.equalTo(40);</span><br></pre></td></tr></table></figure>

<p><strong>ä¼˜åŒ–å»ºè®®ï¼š</strong></p>
<ul>
<li>å°†å¸ƒå±€é€»è¾‘æ‹†åˆ†ä¸º <code>setupConstraints</code>æ–¹æ³•</li>
<li>ä½¿ç”¨ <code>MAS_SHORTHAND</code>ç®€åŒ–è¯­æ³•</li>
</ul>
<hr>
<h2 id="æ‰©å±•åº”ç”¨"><a href="#æ‰©å±•åº”ç”¨" class="headerlink" title="æ‰©å±•åº”ç”¨"></a>æ‰©å±•åº”ç”¨</h2><h3 id="Figma-ChatGPTåä½œ"><a href="#Figma-ChatGPTåä½œ" class="headerlink" title="Figma+ChatGPTåä½œ"></a>Figma+ChatGPTåä½œ</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@startuml</span><br><span class="line">frame Figmaè®¾è®¡ç¨¿ &#123;</span><br><span class="line">  component å›¾å±‚ç»“æ„</span><br><span class="line">  component æ ·å¼å‚æ•°</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">frame ChatGPT &#123;</span><br><span class="line">  component è®¾è®¡è§„èŒƒè§£æ</span><br><span class="line">  component ä»£ç ç”Ÿæˆ</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Figmaè®¾è®¡ç¨¿ --&gt; ChatGPT : å¯¼å‡ºè®¾è®¡è§„èŒƒ</span><br><span class="line">ChatGPT --&gt; å‰ç«¯å·¥ç¨‹ : ç”Ÿæˆç»„ä»¶ä»£ç </span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h2><h3 id="å®ç”¨èµ„æº"><a href="#å®ç”¨èµ„æº" class="headerlink" title="å®ç”¨èµ„æº"></a>å®ç”¨èµ„æº</h3><ul>
<li><a href="https://www.aishort.top/?tags=code">Promptç²¾é€‰åº“</a></li>
<li>Rechartsæ•°æ®å¯è§†åŒ–åº“</li>
<li>Lucide Reactå›¾æ ‡é›†</li>
</ul>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>AIGC</tag>
        <tag>ChatGPT</tag>
        <tag>å¼€å‘å·¥å…·</tag>
      </tags>
  </entry>
  <entry>
    <title>NSCache</title>
    <url>/2021/04/20/NSCache/</url>
    <content><![CDATA[<h2 id="NSCache"><a href="#NSCache" class="headerlink" title="NSCache"></a>NSCache</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><blockquote>
<p>A mutable collection you use to temporarily store transient key-value pairs that are subject to eviction when resources are low.</p>
</blockquote>
<p>ä¸€ç§ç”¨äºä¸´æ—¶å­˜å‚¨ä¸´æ—¶é”®å€¼å¯¹çš„å¯å˜é›†åˆï¼Œåœ¨èµ„æºä¸è¶³æ—¶å®¹æ˜“è¢«å›æ”¶ã€‚</p>
<blockquote>
<p>Cache objects differ from other mutable collections in a few ways:<br>The NSCache class incorporates various auto-eviction policies, which ensure that a cache doesnâ€™t use too much of the systemâ€™s memory. If memory is needed by other applications, these policies remove some items from the cache, minimizing its memory footprint.<br>You can add, remove, and query items in the cache from different threads without having to lock the cache yourself.<br>Unlike an NSMutableDictionary object, a cache does not copy the key objects that are put into it.<br>You typically use NSCache objects to temporarily store objects with transient data that are expensive to create. Reusing these objects can provide performance benefits, because their values do not have to be recalculated. However, the objects are not critical to the application and can be discarded if memory is tight. If discarded, their values will have to be recomputed again when needed.<br>Objects that have subcomponents that can be discarded when not being used can adopt the NSDiscardableContent protocol to improve cache eviction behavior. By default, NSDiscardableContent objects in a cache are automatically removed if their content is discarded, although this automatic removal policy can be changed. If an NSDiscardableContent object is put into the cache, the cache calls discardContentIfPossible() on it upon its removal.</p>
</blockquote>
<p>ç¼“å­˜å¯¹è±¡ä¸å…¶ä»–å¯å˜é›†åˆåœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æœ‰æ‰€ä¸åŒ:</p>
<p><strong>è‡ªåŠ¨å›æ”¶</strong>ï¼š NSCacheç±»åŒ…å«å„ç§è‡ªåŠ¨å›æ”¶ç­–ç•¥ï¼Œè¿™äº›ç­–ç•¥ç¡®ä¿ç¼“å­˜ä¸ä¼šä½¿ç”¨å¤ªå¤šçš„ç³»ç»Ÿå†…å­˜ã€‚å¦‚æœå…¶ä»–åº”ç”¨ç¨‹åºéœ€è¦å†…å­˜ï¼Œè¿™äº›ç­–ç•¥ä¼šä»ç¼“å­˜ä¸­åˆ é™¤ä¸€äº›é¡¹ï¼Œä»è€Œæœ€å°åŒ–å…¶å†…å­˜å ç”¨ã€‚</p>
<p><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šå¯ä»¥ä»ä¸åŒçš„çº¿ç¨‹åœ¨ç¼“å­˜ä¸­æ·»åŠ ã€åˆ é™¤å’ŒæŸ¥è¯¢é¡¹ï¼Œè€Œä¸å¿…è‡ªå·±é”å®šç¼“å­˜ã€‚</p>
<p><strong>Keyæ— éœ€å®ç°NSCopying</strong>ï¼šä¸NSMutableDictionaryå¯¹è±¡ä¸åŒï¼Œç¼“å­˜ä¸ä¼šå¤åˆ¶æ”¾å…¥å…¶ä¸­çš„keyå¯¹è±¡ï¼Œé™ä½å†…å­˜å ç”¨ã€‚</p>
<p><strong>ä¸èƒ½é•¿ä¹…å‚¨å­˜æ•°æ®</strong>ï¼š æ‚¨é€šå¸¸ä½¿ç”¨NSCacheå¯¹è±¡æ¥ä¸´æ—¶å­˜å‚¨å¸¦æœ‰ä¸´æ—¶æ•°æ®çš„å¯¹è±¡ï¼Œè¿™äº›æ•°æ®çš„åˆ›å»ºæˆæœ¬å¾ˆé«˜ã€‚é‡ç”¨è¿™äº›å¯¹è±¡å¯ä»¥æä¾›æ€§èƒ½ä¼˜åŠ¿ï¼Œå› ä¸ºå®ƒä»¬çš„å€¼ä¸å¿…é‡æ–°è®¡ç®—ã€‚ä½†æ˜¯ï¼Œè¿™äº›å¯¹è±¡å¯¹åº”ç”¨ç¨‹åºå¹¶ä¸é‡è¦ï¼Œå¦‚æœå†…å­˜ç´§å¼ ï¼Œå¯ä»¥ä¸¢å¼ƒè¿™äº›å¯¹è±¡ã€‚å¦‚æœä¸¢å¼ƒï¼Œå®ƒä»¬çš„å€¼å°†ä¸å¾—ä¸åœ¨éœ€è¦æ—¶é‡æ–°è®¡ç®—ã€‚</p>
<p><strong>NSDiscardableContent åœ¨NSCacheä¸­ä¸ä¼šå¼ºå¼•ç”¨</strong>ï¼šå…·æœ‰å­ç»„ä»¶çš„å¯¹è±¡åœ¨ä¸ä½¿ç”¨æ—¶å¯ä»¥è¢«ä¸¢å¼ƒï¼Œå¯ä»¥é‡‡ç”¨NSDiscardableContent åè®®æ¥æ”¹è¿›ç¼“å­˜å›æ”¶è¡Œä¸ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœç¼“å­˜ä¸­çš„NSDiscardableContent å¯¹è±¡çš„å†…å®¹è¢«ä¸¢å¼ƒï¼Œé‚£ä¹ˆå®ƒä»¬å°†è¢«è‡ªåŠ¨åˆ é™¤ï¼Œå°½ç®¡è¿™ä¸ªè‡ªåŠ¨åˆ é™¤ç­–ç•¥å¯ä»¥æ›´æ”¹ã€‚å¦‚æœä¸€ä¸ªNSDiscardableContent å¯¹è±¡è¢«æ”¾å…¥ç¼“å­˜ï¼Œç¼“å­˜åœ¨å®ƒè¢«åˆ é™¤æ—¶è°ƒç”¨discardContentIfPossible()ã€‚</p>
<p>ï¼ˆä¸€èˆ¬ä¸ç”¨å¯ä¸¢å¼ƒå¯¹è±¡åŒ…è£¹ï¼Œç›´æ¥ä½¿ç”¨æ–¹æ³•ä¿å­˜åŸå§‹objå°±è¡Œï¼‰</p>
<h3 id="Values-Methods"><a href="#Values-Methods" class="headerlink" title="Values &amp; Methods"></a>Values &amp; Methods</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#import &lt;Foundation/NSObject.h&gt;</span><br><span class="line"></span><br><span class="line">@class NSString;</span><br><span class="line">@protocol NSCacheDelegate;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0))</span><br><span class="line">@interface NSCache &lt;KeyType, ObjectType&gt; : NSObject &#123;</span><br><span class="line">@private</span><br><span class="line">    id _delegate;</span><br><span class="line">    void *_private[5];</span><br><span class="line">    void *_reserved;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@property (copy) NSString *name; // ç”¨æ¥ç®¡ç†åŒºåˆ†cacheå¯¹è±¡çš„åå­—</span><br><span class="line"></span><br><span class="line">@property (nullable, assign) id&lt;NSCacheDelegate&gt; delegate;</span><br><span class="line"></span><br><span class="line">- (nullable ObjectType)objectForKey:(KeyType)key; // å–æ•°æ®</span><br><span class="line">- (void)setObject:(ObjectType)obj forKey:(KeyType)key; // 0 cost ç¼“å­˜æ•°æ®</span><br><span class="line">- (void)setObject:(ObjectType)obj forKey:(KeyType)key cost:(NSUInteger)g; // ç¼“å­˜æ•°æ® costå€¼è®¾ç½®çš„æ¶ˆè€—å†…å­˜å¤§å°</span><br><span class="line">- (void)removeObjectForKey:(KeyType)key;// ç§»é™¤æ•°æ®</span><br><span class="line"></span><br><span class="line">- (void)removeAllObjects;// ç§»é™¤æ‰€æœ‰æ•°æ®</span><br><span class="line"></span><br><span class="line">@property NSUInteger totalCostLimit;	// limits are imprecise/not strict é™åˆ¶ç¼“å­˜æ•°é‡</span><br><span class="line">@property NSUInteger countLimit;	// limits are imprecise/not strict é™åˆ¶ç¼“å­˜ä¿å­˜æ•°å¤§å°ï¼ˆcostï¼‰</span><br><span class="line">@property BOOL evictsObjectsWithDiscardedContent; // æ˜¯å¦è‡ªåŠ¨å›æ”¶</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@protocol NSCacheDelegate &lt;NSObject&gt;</span><br><span class="line">@optional</span><br><span class="line">- (void)cache:(NSCache *)cache willEvictObject:(id)obj; // å›æ”¶å†…å­˜çš„æ—¶å€™è°ƒç”¨ä»£ç†çš„æ–¹æ³•</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>GCDç›¸å…³çŸ¥è¯†å­¦ä¹ ç¬”è®°</title>
    <url>/2020/09/22/GCD/</url>
    <content><![CDATA[<p>è‡´æœªæ¥çš„æˆ‘ï¼šä½ æ˜¯ä¸æ˜¯æœ‰ç‚¹å¿˜è®°äº†GCDçš„ä¸€äº›çŸ¥è¯†ï¼Ÿæ°å·§è¿™å‡ å¤©æˆ‘æœ‰çœ‹è¿™äº›ï¼Œè®©æˆ‘ç»™ä½ è®²è®²å§ï¼Ÿ<br>GCDæ˜¯åŸºäºCè¯­è¨€çš„APIï¼Œå¼€å‘è€…åªéœ€è¦å°†ä»»åŠ¡æ”¾åœ¨blockå†…ï¼Œå¹¶æŒ‡å®šå¥½è¿½åŠ çš„é˜Ÿåˆ—ï¼Œå°±å¯ä»¥å®Œæˆå¤šçº¿ç¨‹å¼€å‘.</p>
<h2 id="çŸ¥è¯†ç‚¹é€Ÿè§ˆ"><a href="#çŸ¥è¯†ç‚¹é€Ÿè§ˆ" class="headerlink" title="çŸ¥è¯†ç‚¹é€Ÿè§ˆ"></a>çŸ¥è¯†ç‚¹é€Ÿè§ˆ</h2><p>1.é˜Ÿåˆ—ï¼š ä¸²è¡Œé˜Ÿåˆ—ã€å¹¶å‘é˜Ÿåˆ—</p>
<p>2.ä»»åŠ¡ï¼š åŒæ­¥ä»»åŠ¡ã€å¼‚æ­¥ä»»åŠ¡</p>
<p>3.é˜Ÿåˆ—å’Œä»»åŠ¡çš„äº¤å‰ç»„åˆä½¿ç”¨</p>
<p>4.æ­»é”çš„äº§ç”Ÿå’Œé¢„é˜²</p>
<h3 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h3><p>Dispatch Queueæ˜¯æ‰§è¡Œå¤„ç†çš„ç­‰å¾…é˜Ÿåˆ—ï¼ŒæŒ‰ç…§ä»»åŠ¡ï¼ˆblockï¼‰è¿½åŠ åˆ°é˜Ÿåˆ—é‡Œçš„é¡ºåºï¼Œå…ˆè¿›å…ˆå‡ºæ‰§è¡Œå¤„ç†ã€‚</p>
<p>è€Œç­‰å¾…é˜Ÿåˆ—æœ‰ä¸¤ç§</p>
<p>Serial Dispatch Queueï¼šä¸²è¡Œé˜Ÿåˆ—ï¼Œç­‰å¾…å½“å‰æ‰§è¡Œä»»åŠ¡å¤„ç†ç»“æŸçš„é˜Ÿåˆ—ã€‚</p>
<p>Concurrent Dispatch Queue:å¹¶å‘é˜Ÿåˆ—ï¼Œä¸ç­‰å¾…å½“å‰æ‰§è¡Œä»»åŠ¡å¤„ç†ç»“æŸçš„é˜Ÿåˆ—</p>
<p>é‚£ä¹ˆå¦‚ä½•åˆ›å»ºä¸€ä¸ªæ–°é˜Ÿåˆ—å‘¢</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//åˆ›å»ºäº†ä¸²è¡Œé˜Ÿåˆ—</span><br><span class="line">dispatch_queue_t serailQueue = dispatch_queue_create(&quot;Test_SERIAL_GCD_Queue&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">//åˆ›å»ºäº†å¹¶è¡Œé˜Ÿåˆ—</span><br><span class="line">dispatch_queue_t concurrentQueue = dispatch_queue_create(&quot;Test_CONCURRENT_GCD_Queue&quot;, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¦å¤–ç³»ç»Ÿè‡ªå¸¦çš„ä¸¤ä¸ªé˜Ÿåˆ—<br>ä¸»é˜Ÿåˆ—ï¼šmainqueen, APPå¯åŠ¨éšä¹‹å¯åŠ¨çš„ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—<br>å…¨å±€é˜Ÿåˆ—ï¼šgolobalQueue, Appleä¸ºå¼€å‘è€…é¢„è®¾çš„ä¸€ä¸ªå…¨å±€å¹¶å‘é˜Ÿåˆ—ï¼Œä»»åŠ¡è¾ƒä¸ºç®€å•æ²¡æœ‰æ–°å»ºé˜Ÿåˆ—çš„éœ€æ±‚çš„æ—¶å€™ å¯ä»¥ç›´æ¥åœ¨å…¨å±€é˜Ÿåˆ—æ‰§è¡Œä»»åŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//è·å–åˆ°äº†ä¸»é˜Ÿåˆ—</span><br><span class="line">dispatch_queue_t mainQueue = dispatch_get_main_queue();</span><br><span class="line">//è·å–åˆ°äº†å…¨å±€é˜Ÿåˆ— ï¼ˆé»˜è®¤ä¼˜å…ˆçº§ï¼Œç¬¬äºŒä¸ªå‚æ•°æš‚æ—¶æ²¡ç”¨ï¼‰</span><br><span class="line">dispatch_queue_t golobalQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</span><br></pre></td></tr></table></figure>
<h3 id="ä»»åŠ¡"><a href="#ä»»åŠ¡" class="headerlink" title="ä»»åŠ¡"></a>ä»»åŠ¡</h3><p>GCDçš„ä»»åŠ¡æ˜¯ä»¥å°è£…å¥½çš„blockçš„å½¢å¼æ¥æ‰§è¡Œçš„<br>ä»»åŠ¡åˆ†ä¸º åŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡</p>
<p>åŒæ­¥ä»»åŠ¡ï¼šä¸€ç§è¿½åŠ åˆ°é˜Ÿåˆ—ä¸­æŒ‰ç…§è¿½åŠ é¡ºåºæ‰§è¡Œçš„ä»»åŠ¡ï¼Œå½“å‰ä»»åŠ¡æœªæ‰§è¡Œå®Œæ¯•æ—¶ä¼šç­‰å¾…å…¶æ‰§è¡Œå®Œæ¯•å†å¼€å§‹è‡ªå·±çš„ä»»åŠ¡, ä½¿ç”¨ dispatch_sync æ¥è¿½åŠ ä»»åŠ¡<br>ä¾‹å¦‚ ç»™å…¨å±€é˜Ÿåˆ—è¿½åŠ ä¸€ä¸ªåŒæ­¥ä»»åŠ¡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dispatch_sync(golobalQueue, ^&#123;</span><br><span class="line">    [self logCurrentThreadNameWith:@&quot;æˆ‘æ˜¯golobalQueueçš„åŒæ­¥ä»»åŠ¡ä¸€&quot;];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å¼‚æ­¥ä»»åŠ¡ï¼šè¿½åŠ åˆ°é˜Ÿåˆ—ä¸­ä¸å†ç­‰å¾…å½“å‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•è€Œç›´æ¥å¼€å§‹æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä¸€èˆ¬ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œä½†æ˜¯çº¿ç¨‹ä¸ä¼šæ— é™åˆ¶çš„åˆ›å»º, ä½¿ç”¨ dispatch_async æ¥è¿½åŠ ä»»åŠ¡<br>ä¾‹å¦‚ ç»™å…¨å±€é˜Ÿåˆ—è¿½åŠ ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ä¸»é˜Ÿåˆ—å¼‚æ­¥ä¼šç­‰å¾…ä¸»é˜Ÿåˆ—çš„ä»»åŠ¡æ‰§è¡Œå®Œäº†å†æ‰§è¡Œ</span><br><span class="line">dispatch_async(golobalQueue, ^&#123;</span><br><span class="line">    [self logCurrentThreadNameWith:@&quot;æˆ‘æ˜¯golobalQueueçš„å¼‚æ­¥ä»»åŠ¡ä¸€&quot;];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="é˜Ÿåˆ—å’Œä»»åŠ¡çš„ç»„åˆ"><a href="#é˜Ÿåˆ—å’Œä»»åŠ¡çš„ç»„åˆ" class="headerlink" title="é˜Ÿåˆ—å’Œä»»åŠ¡çš„ç»„åˆ"></a>é˜Ÿåˆ—å’Œä»»åŠ¡çš„ç»„åˆ</h3><p>ä¸²è¡Œé˜Ÿåˆ—+åŒæ­¥ä»»åŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//ç»™ä¸²è¡Œé˜Ÿåˆ—å¢åŠ ä¸¤ä¸ªåŒæ­¥ä»»åŠ¡</span><br><span class="line">dispatch_sync(serailQueue, ^&#123;</span><br><span class="line">    [self logCurrentThreadNameWith:@&quot;æˆ‘æ˜¯ä¸²è¡Œé˜Ÿåˆ—serailQueueçš„åŒæ­¥ä»»åŠ¡ä¸€&quot;];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">dispatch_sync(serailQueue, ^&#123;</span><br><span class="line">    [self logCurrentThreadNameWith:@&quot;æˆ‘æ˜¯ä¸²è¡Œé˜Ÿåˆ—serailQueueçš„åŒæ­¥ä»»åŠ¡äºŒ&quot;];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ä¸²è¡Œé˜Ÿåˆ—çš„åŒæ­¥ä»»åŠ¡ä¼šæŒ‰ç…§æ·»åŠ çš„æ¬¡åºåœ¨å½“å‰çº¿ç¨‹ä¾æ¬¡æ‰§è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2020-09-22 00:30:08.334655+0800 MyDemo[75669:3948525] æˆ‘æ˜¯ä¸²è¡Œé˜Ÿåˆ—serailQueueçš„åŒæ­¥ä»»åŠ¡ä¸€å½“å‰çº¿ç¨‹: &lt;NSThread: 0x6000023ec780&gt;&#123;number = 1, name = main&#125;</span><br><span class="line">2020-09-22 00:30:08.335000+0800 MyDemo[75669:3948525] æˆ‘æ˜¯ä¸²è¡Œé˜Ÿåˆ—serailQueueçš„åŒæ­¥ä»»åŠ¡äºŒå½“å‰çº¿ç¨‹: &lt;NSThread: 0x6000023ec780&gt;&#123;number = 1, name = main&#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºæ˜¯åœ¨ä¸»çº¿ç¨‹ç»™ä¸²è¡Œé˜Ÿåˆ—è¿½åŠ çš„åŒæ­¥ä»»åŠ¡ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªä»»åŠ¡åœ¨ä¸»çº¿ç¨‹é‡Œä¾æ¬¡æ‰§è¡Œ</p>
<p>ä¸²è¡Œé˜Ÿåˆ—+å¹¶è¡Œä»»åŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//ç»™ä¸²è¡Œé˜Ÿåˆ—å¢åŠ ä¸¤ä¸ªå¼‚æ­¥ä»»åŠ¡</span><br><span class="line">dispatch_async(serailQueue, ^&#123;</span><br><span class="line">    [self logCurrentThreadNameWith:@&quot;æˆ‘æ˜¯ä¸²è¡Œé˜Ÿåˆ—serailQueueçš„å¼‚æ­¥ä»»åŠ¡ä¸€&quot;];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">dispatch_async(serailQueue, ^&#123;</span><br><span class="line">    [self logCurrentThreadNameWith:@&quot;æˆ‘æ˜¯ä¸²è¡Œé˜Ÿåˆ—serailQueueçš„å¼‚æ­¥ä»»åŠ¡äºŒ&quot;];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ä¸²è¡Œé˜Ÿåˆ—çš„å¼‚æ­¥ä»»åŠ¡ä¼šæ–°å¼€ä¸€æ¡çº¿ç¨‹ç„¶åæŒ‰ç…§æ·»åŠ çš„æ¬¡åºæ‰§è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2020-09-22 00:30:08.335765+0800 MyDemo[75669:3949753] æˆ‘æ˜¯ä¸²è¡Œé˜Ÿåˆ—serailQueueçš„å¼‚æ­¥ä»»åŠ¡ä¸€å½“å‰çº¿ç¨‹: &lt;NSThread: 0x6000023d7980&gt;&#123;number = 11, name = (null)&#125;</span><br><span class="line">2020-09-22 00:30:08.336010+0800 MyDemo[75669:3949753] æˆ‘æ˜¯ä¸²è¡Œé˜Ÿåˆ—serailQueueçš„å¼‚æ­¥ä»»åŠ¡äºŒå½“å‰çº¿ç¨‹: &lt;NSThread: 0x6000023d7980&gt;&#123;number = 11, name = (null)&#125;</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶åœ¨ä¸»çº¿ç¨‹è¿½åŠ çš„ä»»åŠ¡ï¼Œä½†æ˜¯å¼‚æ­¥ä»»åŠ¡ä¼šå¼€å¯ä¸€æ¡æ–°çº¿ç¨‹æ‰§è¡Œï¼Œå†çœ‹ä¸¤æ¬¡æ‰“å°çš„çº¿ç¨‹åœ°å€ç›¸åŒï¼Œå¯å¾—çŸ¥ä¸²è¡Œé˜Ÿåˆ—çš„å¼‚æ­¥ä»»åŠ¡åªä¼šå¼€å¯ä¸€æ¡æ–°çº¿ç¨‹æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡</p>
<p>å¹¶å‘é˜Ÿåˆ—+åŒæ­¥ä»»åŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//ç»™å¹¶è¡Œé˜Ÿåˆ—å¢åŠ ä¸¤ä¸ªåŒæ­¥ä»»åŠ¡</span><br><span class="line">dispatch_sync(concurrentQueue, ^&#123;</span><br><span class="line">    [self logCurrentThreadNameWith:@&quot;æˆ‘æ˜¯å¹¶è¡Œé˜Ÿåˆ—concurrentQueueçš„åŒæ­¥ä»»åŠ¡ä¸€&quot;];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">dispatch_sync(concurrentQueue, ^&#123;</span><br><span class="line">    [self logCurrentThreadNameWith:@&quot;æˆ‘æ˜¯å¹¶è¡Œé˜Ÿåˆ—concurrentQueueçš„åŒæ­¥ä»»åŠ¡äºŒ&quot;];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>å¹¶å‘é˜Ÿåˆ—çš„åŒæ­¥ä»»åŠ¡ä¾æ—§ä¼šåœ¨å½“å‰çº¿ç¨‹æŒ‰ç…§æ·»åŠ æ¬¡åºæ‰§è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2020-09-22 00:30:08.335258+0800 MyDemo[75669:3948525] æˆ‘æ˜¯å¹¶è¡Œé˜Ÿåˆ—concurrentQueueçš„åŒæ­¥ä»»åŠ¡ä¸€å½“å‰çº¿ç¨‹: &lt;NSThread: 0x6000023ec780&gt;&#123;number = 1, name = main&#125;</span><br><span class="line">2020-09-22 00:30:08.335446+0800 MyDemo[75669:3948525] æˆ‘æ˜¯å¹¶è¡Œé˜Ÿåˆ—concurrentQueueçš„åŒæ­¥ä»»åŠ¡äºŒå½“å‰çº¿ç¨‹: &lt;NSThread: 0x6000023ec780&gt;&#123;number = 1, name = main&#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºæ˜¯åœ¨ä¸»çº¿ç¨‹ç»™å¹¶å‘é˜Ÿåˆ—è¿½åŠ çš„åŒæ­¥ä»»åŠ¡ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªä»»åŠ¡åœ¨ä¸»çº¿ç¨‹é‡Œä¾æ¬¡æ‰§è¡Œ</p>
<p>å¹¶å‘é˜Ÿåˆ—+å¼‚æ­¥ä»»åŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//ç»™å¹¶è¡Œé˜Ÿåˆ—å¢åŠ ä¸¤ä¸ªå¼‚æ­¥ä»»åŠ¡</span><br><span class="line">dispatch_async(concurrentQueue, ^&#123;</span><br><span class="line">    [self logCurrentThreadNameWith:@&quot;æˆ‘æ˜¯å¹¶è¡Œé˜Ÿåˆ—concurrentQueueçš„å¼‚æ­¥ä»»åŠ¡ä¸€&quot;];</span><br><span class="line">    [self logThreadRunSomeTimeWith:3 TaskName:@&quot;å¼‚æ­¥ä»»åŠ¡ä¸€&quot;];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">dispatch_async(concurrentQueue, ^&#123;</span><br><span class="line">    [self logCurrentThreadNameWith:@&quot;æˆ‘æ˜¯å¹¶è¡Œé˜Ÿåˆ—concurrentQueueçš„å¼‚æ­¥ä»»åŠ¡äºŒ&quot;];</span><br><span class="line">    [self logThreadRunSomeTimeWith:2 TaskName:@&quot;å¼‚æ­¥ä»»åŠ¡äºŒ&quot;];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2020-09-22 00:37:23.038545+0800 MyDemo[75770:3956315] æˆ‘æ˜¯å¹¶è¡Œé˜Ÿåˆ—concurrentQueueçš„å¼‚æ­¥ä»»åŠ¡ä¸€å½“å‰çº¿ç¨‹: &lt;NSThread: 0x600002a900c0&gt;&#123;number = 4, name = (null)&#125;</span><br><span class="line">2020-09-22 00:37:23.038552+0800 MyDemo[75770:3956312] æˆ‘æ˜¯å¹¶è¡Œé˜Ÿåˆ—concurrentQueueçš„å¼‚æ­¥ä»»åŠ¡äºŒå½“å‰çº¿ç¨‹: &lt;NSThread: 0x600002addf40&gt;&#123;number = 5, name = (null)&#125;</span><br></pre></td></tr></table></figure>

<p>å¹¶å‘é˜Ÿåˆ—çš„å¼‚æ­¥ä»»åŠ¡ä¼šç«‹å³å¼€å¯æ–°çº¿ç¨‹æ‰§è¡Œï¼Œå¯ä»¥çœ‹åˆ°ä¸¤ä¸ªä»»åŠ¡æ‰€åœ¨çš„çº¿ç¨‹æ˜¯ä¸ä¸€è‡´çš„</p>
<h3 id="æ­»é”çš„äº§ç”Ÿå’Œé¢„é˜²"><a href="#æ­»é”çš„äº§ç”Ÿå’Œé¢„é˜²" class="headerlink" title="æ­»é”çš„äº§ç”Ÿå’Œé¢„é˜²"></a>æ­»é”çš„äº§ç”Ÿå’Œé¢„é˜²</h3><p>æ­»é”å°±æ˜¯é˜Ÿåˆ—å¼•èµ·çš„å¾ªç¯ç­‰å¾…</p>
<p>ä¸€ä¸ªæœ€å¸¸è§çš„ä¾‹å­ï¼šä¸»é˜Ÿåˆ—è¿½åŠ åŒæ­¥ä»»åŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    dispatch_sync(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">       </span><br><span class="line">        NSLog(@&quot;deallock&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">    // Do any additional setup after loading the view, typically from a nib.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸»çº¿ç¨‹ä¸­è¿ç”¨ä¸»é˜Ÿåˆ—åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯æŠŠä»»åŠ¡æ”¾åˆ°äº†ä¸»çº¿ç¨‹çš„é˜Ÿåˆ—ä¸­ã€‚<br>åŒæ­¥å¯¹äºä»»åŠ¡æ˜¯ç«‹åˆ»æ‰§è¡Œçš„ï¼Œé‚£ä¹ˆå½“æŠŠä»»åŠ¡æ”¾è¿›ä¸»é˜Ÿåˆ—æ—¶ï¼Œå®ƒå°±ä¼šç«‹é©¬æ‰§è¡Œ,åªæœ‰æ‰§è¡Œå®Œè¿™ä¸ªä»»åŠ¡ï¼ŒviewDidLoadæ‰ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚<br>è€ŒviewDidLoadå’Œä»»åŠ¡éƒ½æ˜¯åœ¨ä¸»é˜Ÿåˆ—ä¸Šçš„ï¼Œç”±äºé˜Ÿåˆ—çš„å…ˆè¿›å…ˆå‡ºåŸåˆ™ï¼Œä»»åŠ¡åˆéœ€ç­‰å¾…viewDidLoadæ‰§è¡Œå®Œæ¯•åæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼ŒviewDidLoadå’Œè¿™ä¸ªä»»åŠ¡å°±å½¢æˆäº†ç›¸äº’å¾ªç¯ç­‰å¾…ï¼Œå°±é€ æˆäº†æ­»é”ã€‚<br>æƒ³é¿å…è¿™ç§æ­»é”ï¼Œå¯ä»¥å°†åŒæ­¥æ”¹æˆå¼‚æ­¥dispatch_async,æˆ–è€…å°†dispatch_get_main_queueæ¢æˆå…¶ä»–ä¸²è¡Œæˆ–å¹¶è¡Œé˜Ÿåˆ—ï¼Œéƒ½å¯ä»¥è§£å†³ã€‚</p>
<p>å¤æ‚ä¸€ç‚¹çš„ä¾‹å­: ä¸²è¡Œé˜Ÿåˆ—å¼‚æ­¥ä»»åŠ¡ä¸­åµŒå¥—äº†åŒä¸€ä¸ªé˜Ÿåˆ—çš„åŒæ­¥ä»»åŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dispatch_queue_t serialQueue = dispatch_queue_create(&quot;Test_SERIAL_GCD_Queue&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line"></span><br><span class="line">dispatch_async(serialQueue, ^&#123;</span><br><span class="line">    </span><br><span class="line">    dispatch_sync(serialQueue, ^&#123;</span><br><span class="line">        </span><br><span class="line">        NSLog(@&quot;deadlock&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å¤–é¢çš„å‡½æ•°æ— è®ºæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥éƒ½ä¼šé€ æˆæ­»é”ã€‚<br>è¿™æ˜¯å› ä¸ºé‡Œé¢çš„ä»»åŠ¡å’Œå¤–é¢çš„ä»»åŠ¡éƒ½åœ¨åŒä¸€ä¸ªserialQueueé˜Ÿåˆ—å†…ï¼Œåˆæ˜¯åŒæ­¥ï¼Œè¿™å°±å’Œä¸Šè¾¹ä¸»é˜Ÿåˆ—åŒæ­¥çš„ä¾‹å­ä¸€æ ·é€ æˆäº†æ­»é”<br>è§£å†³æ–¹æ³•ä¹Ÿå’Œä¸Šè¾¹ä¸€æ ·ï¼Œå°†é‡Œé¢çš„åŒæ­¥æ”¹æˆå¼‚æ­¥dispatch_async,æˆ–è€…å°†serialQueueæ¢æˆå…¶ä»–ä¸²è¡Œæˆ–å¹¶è¡Œé˜Ÿåˆ—ï¼Œéƒ½å¯ä»¥è§£å†³</p>
<p>è€Œä¸¤ä¸ªä¸åŒçš„ä¸²è¡Œé˜Ÿåˆ—åµŒå¥—åˆ™ä¸ä¼šäº§ç”Ÿæ­»é”ï¼Œä¸”ä¸¤ä¸ªé˜Ÿåˆ—è¿½åŠ çš„ä»»åŠ¡åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dispatch_queue_t serialQueueA= dispatch_queue_create(&quot;TestA_SERIAL_GCD_Queue&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">dispatch_queue_t serialQueueB = dispatch_queue_create(&quot;TestB_SERIAL_GCD_Queue&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line"></span><br><span class="line">dispatch_async(serialQueueA, ^&#123;</span><br><span class="line">       </span><br><span class="line">    dispatch_sync(serialQueueB, ^&#123;</span><br><span class="line">        </span><br><span class="line">        NSLog(@&quot;deadlock&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="æ …æ ä»»åŠ¡å’Œå»¶æ—¶ä»»åŠ¡"><a href="#æ …æ ä»»åŠ¡å’Œå»¶æ—¶ä»»åŠ¡" class="headerlink" title="æ …æ ä»»åŠ¡å’Œå»¶æ—¶ä»»åŠ¡"></a>æ …æ ä»»åŠ¡å’Œå»¶æ—¶ä»»åŠ¡</h3><p>æ …æ ä»»åŠ¡ï¼šç­‰å¾…æ …æ ä¹‹å‰çš„å¼‚æ­¥ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•äº†ä¹‹åå†æ‰§è¡Œæ­¤ä»»åŠ¡<br>ä¸¾ä¸ªæ —å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//ç»™å¹¶è¡Œé˜Ÿåˆ—å¢åŠ ä¸¤ä¸ªå¼‚æ­¥ä»»åŠ¡</span><br><span class="line">dispatch_async(concurrentQueue, ^&#123;</span><br><span class="line">    [self logCurrentThreadNameWith:@&quot;æˆ‘æ˜¯å¹¶è¡Œé˜Ÿåˆ—concurrentQueueçš„å¼‚æ­¥ä»»åŠ¡ä¸€&quot;];</span><br><span class="line">    [self logThreadRunSomeTimeWith:3 TaskName:@&quot;å¼‚æ­¥ä»»åŠ¡ä¸€&quot;];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">dispatch_async(concurrentQueue, ^&#123;</span><br><span class="line">    [self logCurrentThreadNameWith:@&quot;æˆ‘æ˜¯å¹¶è¡Œé˜Ÿåˆ—concurrentQueueçš„å¼‚æ­¥ä»»åŠ¡äºŒ&quot;];</span><br><span class="line">    [self logThreadRunSomeTimeWith:2 TaskName:@&quot;å¼‚æ­¥ä»»åŠ¡äºŒ&quot;];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//ç»™å¹¶è¡Œé˜Ÿåˆ—å¢åŠ æ …æ ä»»åŠ¡ æ …æ ä»»åŠ¡ä¼šç­‰å¾…ä¹‹å‰æ‰€æœ‰çš„å¼‚æ­¥ä»»åŠ¡å®Œæˆåæ‰æ‰§è¡Œ</span><br><span class="line">dispatch_barrier_async(concurrentQueue, ^&#123;</span><br><span class="line">    [self logCurrentThreadNameWith:@&quot;æˆ‘æ˜¯å¹¶è¡Œé˜Ÿåˆ—concurrentQueueçš„æ …æ ä»»åŠ¡&quot;];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">dispatch_async(concurrentQueue, ^&#123;</span><br><span class="line">    [self logCurrentThreadNameWith:@&quot;æˆ‘æ˜¯å¹¶è¡Œé˜Ÿåˆ—concurrentQueueçš„å¼‚æ­¥ä»»åŠ¡ä¸‰&quot;];</span><br><span class="line">    dispatch_async(mainQueue, ^&#123;</span><br><span class="line">        [self logCurrentThreadNameWith:@&quot;concurrentQueueå¼‚æ­¥ä»»åŠ¡å›åˆ°ä¸»é˜Ÿåˆ—è¿½åŠ ä»»åŠ¡&quot;];</span><br><span class="line">        [self logThreadRunSomeTimeWith:2 TaskName:@&quot;å›åˆ°ä¸»é˜Ÿåˆ—çš„å¼‚æ­¥ä»»åŠ¡&quot;];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">dispatch_async(concurrentQueue, ^&#123;</span><br><span class="line">    [self logCurrentThreadNameWith:@&quot;æˆ‘æ˜¯å¹¶è¡Œé˜Ÿåˆ—concurrentQueueçš„å¼‚æ­¥ä»»åŠ¡å››&quot;];</span><br><span class="line">    [self logThreadRunSomeTimeWith:4 TaskName:@&quot;å¼‚æ­¥ä»»åŠ¡å››&quot;];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2020-09-22 00:37:23.038545+0800 MyDemo[75770:3956315] æˆ‘æ˜¯å¹¶è¡Œé˜Ÿåˆ—concurrentQueueçš„å¼‚æ­¥ä»»åŠ¡ä¸€å½“å‰çº¿ç¨‹: &lt;NSThread: 0x600002a900c0&gt;&#123;number = 4, name = (null)&#125;</span><br><span class="line">2020-09-22 00:37:23.038552+0800 MyDemo[75770:3956312] æˆ‘æ˜¯å¹¶è¡Œé˜Ÿåˆ—concurrentQueueçš„å¼‚æ­¥ä»»åŠ¡äºŒå½“å‰çº¿ç¨‹: &lt;NSThread: 0x600002addf40&gt;&#123;number = 5, name = (null)&#125;</span><br><span class="line">2020-09-22 00:37:26.045128+0800 MyDemo[75770:3956315] æˆ‘æ˜¯å¹¶è¡Œé˜Ÿåˆ—concurrentQueueçš„æ …æ ä»»åŠ¡å½“å‰çº¿ç¨‹: &lt;NSThread: 0x600002a900c0&gt;&#123;number = 4, name = (null)&#125;</span><br><span class="line">2020-09-22 00:37:26.045309+0800 MyDemo[75770:3956315] æˆ‘æ˜¯å¹¶è¡Œé˜Ÿåˆ—concurrentQueueçš„å¼‚æ­¥ä»»åŠ¡ä¸‰å½“å‰çº¿ç¨‹: &lt;NSThread: 0x600002a900c0&gt;&#123;number = 4, name = (null)&#125;</span><br><span class="line">2020-09-22 00:37:26.045323+0800 MyDemo[75770:3956312] æˆ‘æ˜¯å¹¶è¡Œé˜Ÿåˆ—concurrentQueueçš„å¼‚æ­¥ä»»åŠ¡å››å½“å‰çº¿ç¨‹: &lt;NSThread: 0x600002addf40&gt;&#123;number = 5, name = (null)&#125;</span><br></pre></td></tr></table></figure>
<p>å»¶æ—¶ä»»åŠ¡ï¼šä½¿ç”¨GCDçš„å»¶æ—¶ä»»åŠ¡æ¯”è¾ƒç®€å•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), mainQueue, ^&#123;</span><br><span class="line">    [self logCurrentThreadNameWith:@&quot;2ç§’åå¼‚æ­¥è¿½åŠ çš„ä»»åŠ¡æ‰§è¡Œ&quot;];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åŒæ­¥ä»»åŠ¡ä¸å…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ› å¼‚æ­¥ä»»åŠ¡æ€»æ˜¯ä¼šå¼€å¯æ–°çº¿ç¨‹<br>ä¸²è¡Œé˜Ÿåˆ—ä¸­æ— è®ºæ˜¯å¦å¼€å¯äº†æ–°çº¿ç¨‹ éƒ½ä¼šæŒ‰ç…§æŒ‡å®šçš„é¡ºåºæ‰§è¡Œ</p>
<p>å¦‚æœæ‰§è¡ŒåŒæ­¥ä»»åŠ¡åˆ™é˜»å¡ä»»åŠ¡çš„çº¿ç¨‹ æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡åˆ™ä¸ä¼šé˜»å¡ä»»åŠ¡æ‰€åœ¨çš„çº¿ç¨‹<br>ä¸²è¡Œé˜Ÿåˆ—ä¸­çš„å¼‚æ­¥ä»»åŠ¡å³ä½¿å¼€å¯äº†æ–°çº¿ç¨‹ä¹Ÿä¼šå› ä¸ºé˜Ÿåˆ—çš„ä¸²è¡Œé™åˆ¶è€Œä¸€ä¸ªä¸€ä¸ªæŒ‰é¡ºåºæ‰§è¡Œï¼Œæ‰€ä»¥åªéœ€è¦å¼€å¯ä¸€æ¡æ–°çº¿ç¨‹å°±èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚<br>å¹¶å‘é˜Ÿåˆ—ä¸­çš„åŒæ­¥ä»»åŠ¡åœ¨å½“å‰çº¿ç¨‹å»æ‰§è¡Œ</p>
<p>ä¸ºäº†æ–¹ä¾¿ç¨‹åºå‘˜çš„ä½¿ç”¨,è‹¹æœæä¾›äº†å…¨å±€é˜Ÿåˆ—:dispatch_get_global_queue(0, 0)<br>å…¨å±€é˜Ÿåˆ—æ˜¯ä¸€ä¸ªå¹¶å‘é˜Ÿåˆ—(concurrent)<br>åœ¨ä½¿ç”¨å¤šçº¿ç¨‹å¼€å‘æ—¶,å¦‚æœå¯¹é˜Ÿåˆ—æ²¡æœ‰ç‰¹æ®Šéœ€æ±‚,åœ¨æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡æ—¶,å¯ä»¥ç›´æ¥ä½¿ç”¨å…¨å±€é˜Ÿåˆ—</p>
<p>é˜Ÿåˆ—ç›¸å½“äºä¸€ä¸ªçº¿ç¨‹çš„è°ƒåº¦å™¨ ä¸²è¡Œé˜Ÿåˆ—æ€»æ˜¯åœ¨å½“å‰çº¿ç¨‹å»è¿›è¡Œä»»åŠ¡è°ƒåº¦ å¹¶å‘é˜Ÿåˆ—ä¼šå¯¹å¼‚æ­¥ä»»åŠ¡å¼€å¯æ–°çº¿ç¨‹</p>
<h2 id="æ„Ÿæ‚Ÿ"><a href="#æ„Ÿæ‚Ÿ" class="headerlink" title="æ„Ÿæ‚Ÿ"></a>æ„Ÿæ‚Ÿ</h2><p>é€šè¿‡æˆ‘ä»Šå¤©å¯¹GCDçš„å­¦ä¹ ï¼Œæˆ‘è§‰å¾—ä¹‹å‰æ€»æ˜¯æœ‰è®¸å¤šè‡ªå·±ç»™è‡ªå·±è®¾ç½®çš„å­¦ä¹ éšœç¢ï¼Œä¸€ä¸ªå¤§æ¦‚åªéœ€è¦ä¸¤ä¸ªå°æ—¶å°±èƒ½ææ˜ç™½çš„çŸ¥è¯†ä¸ºä»€ä¹ˆä¸é™ä¸‹å¿ƒæ¥å»çœ‹çœ‹å‘¢ï¼Ÿ<br>ä¸ä¼šçš„æŠ€æœ¯å¹¶ä¸æ˜¯éš¾ä»¥è·¨è¶Šçš„å¤§å±±ï¼Œåªè¦ç”¨å¿ƒé’»ç ”ï¼Œå°±ä¸€å®šä¼šæœ‰æ‰€æ”¶è·ã€‚<br>å¥½äº†ï¼Œçœ‹åˆ°è¿™é‡Œäº†ï¼Œæœªæ¥çš„æˆ‘æœ‰ä»€ä¹ˆè¦ç»™æˆ‘è¡¥å……çš„å—ï¼Ÿ</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>XCUITest iOSè‡ªåŠ¨åŒ–UIæµ‹è¯•æ¡†æ¶</title>
    <url>/2022/02/28/XCUITest%E6%8E%A2%E7%B4%A2/</url>
    <content><![CDATA[<h1 id="XCUITest-iOSè‡ªåŠ¨åŒ–UIæµ‹è¯•æ¡†æ¶"><a href="#XCUITest-iOSè‡ªåŠ¨åŒ–UIæµ‹è¯•æ¡†æ¶" class="headerlink" title="XCUITest iOSè‡ªåŠ¨åŒ–UIæµ‹è¯•æ¡†æ¶"></a><em>XCUITest</em> iOSè‡ªåŠ¨åŒ–UIæµ‹è¯•æ¡†æ¶</h1><h2 id="XCUITestç®€ä»‹"><a href="#XCUITestç®€ä»‹" class="headerlink" title="XCUITestç®€ä»‹"></a>XCUITestç®€ä»‹</h2><p>XCUITestæ˜¯Appleæä¾›çš„å†…åµŒåˆ°xcodeä¸­çš„ä¸€å¥—UIè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ã€‚</p>
<blockquote>
<p>UIæµ‹è¯•ä¾èµ–äºä¸¤é¡¹æ ¸å¿ƒæŠ€æœ¯:XCTestæ¡†æ¶å’ŒAccessibilityã€‚</p>
<p>XCTestæä¾›äº†UIæµ‹è¯•åŠŸèƒ½çš„æ¡†æ¶ï¼Œä¸Xcodeé›†æˆåœ¨ä¸€èµ·ã€‚åˆ›å»ºå’Œä½¿ç”¨UIæµ‹è¯•æ‰©å±•äº†æ‚¨å¯¹ä½¿ç”¨XCTestå’Œåˆ›å»ºå•å…ƒæµ‹è¯•çš„äº†è§£ã€‚æ‚¨åˆ›å»ºäº†ä¸€ä¸ªUIæµ‹è¯•ç›®æ ‡ï¼Œå¹¶å°†åˆ›å»ºUIæµ‹è¯•ç±»å’ŒUIæµ‹è¯•æ–¹æ³•ä½œä¸ºé¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚æ‚¨å¯ä»¥ä½¿ç”¨XCTestæ–­è¨€æ¥éªŒè¯é¢„æœŸç»“æœæ˜¯å¦ä¸ºçœŸã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡Xcode Serverå’Œxcodebuildå®ç°æŒç»­é›†æˆã€‚XCTestä¸Objective-Cå’ŒSwiftå®Œå…¨å…¼å®¹ã€‚</p>
<p>Accessibilityæ˜¯ä¸€é¡¹æ ¸å¿ƒæŠ€æœ¯ï¼Œå®ƒå…è®¸æ®‹ç–¾ç”¨æˆ·è·å¾—ä¸å…¶ä»–ç”¨æˆ·ç›¸åŒçš„iOSå’ŒmacOSä¸°å¯Œä½“éªŒã€‚å®ƒåŒ…å«äº†ä¸€ç»„ä¸°å¯Œçš„UIè¯­ä¹‰æ•°æ®ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨å®ƒæ¥æŒ‡å¯¼ä»–ä»¬ä½¿ç”¨ä½ çš„åº”ç”¨ã€‚å¯è®¿é—®æ€§é›†æˆäº†UIKitå’ŒAppKitï¼Œå¹¶æœ‰apiå…è®¸ä½ è°ƒæ•´è¡Œä¸ºå’Œå¯¹å¤–å…¬å¼€çš„ä½¿ç”¨ã€‚UIæµ‹è¯•ä½¿ç”¨è¿™äº›æ•°æ®æ¥æ‰§è¡Œå…¶åŠŸèƒ½ã€‚</p>
<p>åœ¨æºä»£ç ä¸­åˆ›å»ºUIæµ‹è¯•ç±»ä¼¼äºåˆ›å»ºå•å…ƒæµ‹è¯•ã€‚ä½ ä¸ºä½ çš„åº”ç”¨åˆ›å»ºä¸€ä¸ªUIæµ‹è¯•ç›®æ ‡;ç„¶åXcodeä¸ºä½ åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„UIæµ‹è¯•ç»„å’Œå®ç°æ–‡ä»¶ï¼Œåœ¨å®ç°æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªç¤ºä¾‹æµ‹è¯•æ–¹æ³•æ¨¡æ¿ã€‚åœ¨åˆ›å»ºUIæµ‹è¯•ç›®æ ‡æ—¶ï¼Œå¯ä»¥æŒ‡å®šæµ‹è¯•è¦å¤„ç†çš„åº”ç”¨ç¨‹åºã€‚</p>
</blockquote>
<p><a href="https://developer.apple.com/library/archive/documentation/DeveloperTools/Conceptual/testing_with_xcode/chapters/09-ui_testing.html#//apple_ref/doc/uid/TP40014132-CH13-DontLinkElementID_8">User Interface Testing</a></p>
<p><a href="https://onevcat.com/2015/09/ui-testing/">WWDC15 Sessionç¬”è®° - Xcode 7 UI æµ‹è¯•åˆçª¥</a></p>
<h2 id="æ·»åŠ target"><a href="#æ·»åŠ target" class="headerlink" title="æ·»åŠ target"></a>æ·»åŠ target</h2><p>ä»¥å‰åœ¨æ–°å»ºé¡¹ç›®çš„æ—¶å€™å¯ä»¥çœ‹åˆ°è‡ªå¸¦å•å…ƒæµ‹è¯•å’ŒUIæµ‹è¯•ã€‚æ–°ç‰ˆæœ¬çš„XCodeæ–°å»ºé¡¹ç›®çš„æ—¶å€™å¯ä»¥çœ‹åˆ°Incloud Testsçš„é€‰é¡¹ï¼Œå‹¾ä¸­è¿™ä¸ªé€‰é¡¹å°±å¯ä»¥åˆ›å»ºå‡ºæ¥å¸¦å•å…ƒæµ‹è¯•å’ŒUIæµ‹è¯•çš„targetã€‚</p>
<p><img src="https://cdn.zcx.info/e6c9d24ely1gzt95s1si1j20kq0eodge.jpg"></p>
<p><img src="https://cdn.zcx.info/e6c9d24ely1gzt95u7e5qj20ea0ajjrx.jpg" alt="è‡ªåŠ¨åˆ›å»ºäº†testæœ‰å…³çš„Target"></p>
<p>å½“ç„¶å¦‚æœæ˜¯ä»¥å‰å°±åˆ›å»ºçš„é¡¹ç›®ä¹Ÿå¯ä»¥å•ç‹¬æ·»åŠ UI Testçš„Targetã€‚</p>
<h2 id="ç¼–å†™æµ‹è¯•ä»£ç "><a href="#ç¼–å†™æµ‹è¯•ä»£ç " class="headerlink" title="ç¼–å†™æµ‹è¯•ä»£ç "></a>ç¼–å†™æµ‹è¯•ä»£ç </h2><blockquote>
<p>UI æµ‹è¯•åœ¨åŸºæœ¬æ–¹é¢ä¸åŒäºå•å…ƒæµ‹è¯•ã€‚å•å…ƒæµ‹è¯•ä½¿æ‚¨èƒ½å¤Ÿåœ¨åº”ç”¨ç¨‹åºçš„èŒƒå›´å†…å·¥ä½œï¼Œå¹¶å…è®¸æ‚¨åœ¨å®Œå…¨è®¿é—®åº”ç”¨ç¨‹åºå˜é‡å’ŒçŠ¶æ€çš„æƒ…å†µä¸‹ç»ƒä¹ å‡½æ•°å’Œæ–¹æ³•ã€‚UI æµ‹è¯•ä»¥ä¸ç”¨æˆ·åœ¨ä¸è®¿é—®åº”ç”¨ç¨‹åºçš„å†…éƒ¨æ–¹æ³•ã€å‡½æ•°å’Œå˜é‡çš„æƒ…å†µä¸‹æ‰§è¡Œç›¸åŒçš„æ–¹å¼æ¥æµ‹è¯•åº”ç”¨ç¨‹åºçš„ UIã€‚è¿™ä½¿æ‚¨çš„æµ‹è¯•èƒ½å¤Ÿä»¥ä¸ç”¨æˆ·ç›¸åŒçš„æ–¹å¼æŸ¥çœ‹åº”ç”¨ç¨‹åºï¼Œä»è€Œæš´éœ²ç”¨æˆ·é‡åˆ°çš„ UI é—®é¢˜ã€‚</p>
<p>æ‚¨çš„æµ‹è¯•ä»£ç ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹è¿è¡Œï¼Œç»¼åˆåº”ç”¨ç¨‹åºä¸­çš„ UI å“åº”çš„äº‹ä»¶ã€‚</p>
</blockquote>
<p>ç¼–å†™æµ‹è¯•ä»£ç ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œç”±äºUITestä¸èƒ½ä¾µå…¥ä»£ç é€»è¾‘ï¼Œä»…ä»…ä½¿ç”¨è¯†åˆ«ç•Œé¢ä¸Šçš„æ§ä»¶åå‘é€äº‹ä»¶æ¥é©±åŠ¨APPï¼Œæ‰€ä»¥æµ‹è¯•ä»£ç çš„ç¼–å†™é€»è¾‘è¶‹å‘äºæŸ¥è¯¢å±å¹•ä¸Šæ˜¾ç¤ºçš„æ§ä»¶ï¼Œæ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„æ§ä»¶ï¼Œå‘é€æ§ä»¶æ”¯æŒçš„äº‹ä»¶ï¼Œç­‰å¾…äº‹ä»¶å“åº”åä½¿ç”¨æ–­è¨€æˆ–è€…æœŸæœ›æ–­è¨€æ¥åˆ¤æ–­æ˜¯å¦è¾¾åˆ°äº†é¢„æœŸçš„æµ‹è¯•ç»“æœã€‚</p>
<p>ä»¥36æ°ªç›´æ’­é—´å†…é¢„çº¦ç›´æ’­çš„è¿‡ç¨‹ä¸ºä¾‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">testSubscribeLiveInLiveHome</span>() &#123;</span><br><span class="line">  	<span class="comment">//è·å–APPå®ä¾‹</span></span><br><span class="line">    <span class="keyword">let</span> app <span class="operator">=</span> <span class="type">XCUIApplication</span>()</span><br><span class="line"> 		<span class="comment">//å¯åŠ¨APP</span></span><br><span class="line">    app.launch()</span><br><span class="line">  	<span class="comment">//è¿™é‡Œå»¶è¿Ÿäº†1sæ¥ç­‰å¾…APPå¯åŠ¨é¡¹é…ç½®åŠ è½½</span></span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">  	<span class="comment">//æŸ¥è¯¢æ‰€æœ‰tabbarï¼Œç­›é€‰åŒ…å«ç›´æ’­æ–‡å­—çš„åº•å¯¼ï¼Œç‚¹å‡»</span></span><br><span class="line">    app.tabBars[<span class="string">&quot;æ ‡ç­¾é¡µæ &quot;</span>].buttons[<span class="string">&quot;ç›´æ’­&quot;</span>].tap()</span><br><span class="line">  	<span class="comment">//æŸ¥è¯¢APPä¸Šæ˜¾ç¤ºçš„scrollViewsä¸Šçš„æ§ä»¶</span></span><br><span class="line">    <span class="keyword">let</span> elementsQuery <span class="operator">=</span> app.scrollViews.otherElements </span><br><span class="line">  	<span class="comment">//ç‚¹å‡»åŒ…å«ç›´æ’­æ–‡å­—çš„æŒ‰é’® </span></span><br><span class="line">    elementsQuery.staticTexts[<span class="string">&quot;ç›´æ’­&quot;</span>].tap()</span><br><span class="line"> 	 	<span class="comment">//æŸ¥è¯¢å¹¶ç‚¹å‡»APPä¸Šæ˜¾ç¤ºcollectionViewsä¸­åŒ…å«å³å°†å¼€æ’­æ–‡å­—çš„æŒ‰é’®</span></span><br><span class="line">    elementsQuery.collectionViews.staticTexts[<span class="string">&quot;å³å°†å¼€æ’­&quot;</span>].tap()</span><br><span class="line"> 	 	<span class="comment">//å»¶è¿Ÿ1sç­‰å¾…APPåŠ è½½å³å°†å¼€æ’­åˆ—è¡¨</span></span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">  	<span class="comment">//æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ…å«é¢„çº¦æ–‡å­—çš„cellï¼Œè¿™é‡Œå¦‚æœå·²ç»é¢„çº¦åˆ™ä¸æ˜¾ç¤ºé¢„çº¦æ–‡å­—</span></span><br><span class="line">    app.collectionViews.cells.otherElements.containing(.staticText, identifier:<span class="string">&quot;é¢„çº¦&quot;</span>).element(boundBy: <span class="number">0</span>).tap()</span><br><span class="line">  	<span class="comment">//å»¶è¿Ÿ1sç­‰å¾…APPåŠ è½½ç›´æ’­é—´</span></span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line"> 	 <span class="comment">//æŸ¥è¯¢å¹¶ç‚¹å‡»åŒ…å«é¢„çº¦ç›´æ’­æ–‡å­—çš„æŒ‰é’®</span></span><br><span class="line">    elementsQuery.staticTexts[<span class="string">&quot;é¢„çº¦ç›´æ’­&quot;</span>].tap()</span><br><span class="line"> 	 <span class="comment">//åˆ›å»ºæœŸæœ›æ–­è¨€åˆ¤æ–­å·²é¢„çº¦æ–‡æ¡ˆæ˜¯å¦å­˜åœ¨ï¼Œé¢„çº¦æˆåŠŸä¼šä¿®æ”¹æŒ‰é’®æ–‡æ¡ˆ</span></span><br><span class="line">    <span class="keyword">let</span> result <span class="operator">=</span> app.staticTexts[<span class="string">&quot;å·²é¢„çº¦&quot;</span>]</span><br><span class="line">    expectation(for: <span class="type">NSPredicate</span>(format: <span class="string">&quot;exists &gt;= 1&quot;</span>), evaluatedWith: result, handler: <span class="literal">nil</span>)</span><br><span class="line">    waitForExpectations(timeout: <span class="number">3</span>, handler: <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å†™å¥½äº†ä¸€ä¸ªç›´æ’­é—´é¢„çº¦çš„æµ‹è¯•æµç¨‹ã€‚</p>
<p>å¯ä»¥çœ‹å‡ºæµ‹è¯•ä»£ç çš„ç¼–å†™è¿˜æ˜¯å¾ˆç¹ççš„ï¼Œå†™åŠŸèƒ½çš„åŒæ—¶å‡ ä¹æ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´å†ç¼–å†™ä¸€å¥—å¯¹åº”çš„æµ‹è¯•ä»£ç ã€‚è€Œä¸”åŠŸèƒ½è¿˜ä¼šéšç€é¡¹ç›®çš„è¿­ä»£ä¸æ–­å˜åŒ–ï¼ŒåŒæ—¶ç»´æŠ¤åŠŸèƒ½ä»£ç å’Œæµ‹è¯•ä»£ç çš„æˆæœ¬æ˜¯å·¨å¤§çš„ã€‚</p>
<p>ä½†æ˜¯ä¸€äº›å˜åŒ–æ¦‚ç‡ä½çš„æ ¸å¿ƒè·¯å¾„è¿˜æ˜¯å»ºè®®ä½¿ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•æ¥è§£æ”¾åŒæ‰‹é™ä½é‡å¤å·¥ä½œé‡ã€‚</p>
<h2 id="å½•åˆ¶æµ‹è¯•ä»£ç "><a href="#å½•åˆ¶æµ‹è¯•ä»£ç " class="headerlink" title="å½•åˆ¶æµ‹è¯•ä»£ç "></a>å½•åˆ¶æµ‹è¯•ä»£ç </h2><p>æœ‰æ—¶å€™ä¸çŸ¥é“æ€ä¹ˆæŸ¥è¯¢å…·ä½“æŸä¸ªæ§ä»¶çš„æ—¶å€™å¯ä»¥å€Ÿç”¨XCodeä¸Šçš„å½•åˆ¶åŠŸèƒ½ã€‚</p>
<p>æŠŠå…‰æ ‡ç§»å…¥æµ‹è¯•ä»£ç æ–¹æ³•å¤§æ‹¬å·å†…éƒ¨ç©ºç™½å¤„å¯ä»¥çœ‹åˆ°å·¦ä¸‹è§’æœ‰ä¸ªçº¢è‰²åœ†ç‚¹äº®äº†èµ·æ¥ï¼Œç‚¹å‡»çº¢è‰²åœ†ç‚¹åŠå¼€å¯å½•åˆ¶åŠŸèƒ½ã€‚</p>
<p>å½•åˆ¶åŠŸèƒ½å¯ä»¥è®°å½•ä½ æ‰‹åŠ¨ç‚¹å‡»çš„è·¯å¾„å’Œæµç¨‹ï¼Œè‡ªåŠ¨è®¡ç®—å‡ºæ“ä½œè·¯å¾„çš„ä»£ç ã€‚ä½†æ˜¯è®¡ç®—ç»“æœå¯èƒ½ä¸æ˜¯ä¸€ä¸ªé€šç”¨çš„è·¯å¾„ï¼Œæ‰€ä»¥è¿˜éœ€è¦å¼€å‘è€…è‡ªè¡Œè°ƒæ•´ã€‚</p>
<h2 id="æ‰§è¡Œæµ‹è¯•è„šæœ¬"><a href="#æ‰§è¡Œæµ‹è¯•è„šæœ¬" class="headerlink" title="æ‰§è¡Œæµ‹è¯•è„šæœ¬"></a>æ‰§è¡Œæµ‹è¯•è„šæœ¬</h2><p>æ‰§è¡Œä¸Šé¢çš„æµ‹è¯•æ–¹æ³•ï¼Œxcodeä¼šè‡ªåŠ¨ç¼–è¯‘ã€è¿è¡Œä½ çš„APPï¼Œå¹¶ä¼šè¾“å‡ºå…·ä½“çš„æµ‹è¯•ç»“æœã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">Test</span> <span class="type">Case</span> &#x27;<span class="operator">-</span>[<span class="type">ClientUITests</span>.<span class="type">ClientUITestsLaunchTests</span> testSubscribeLiveInLiveHome]&#x27; started.</span><br><span class="line">    t <span class="operator">=</span>     <span class="number">0</span>.00s <span class="type">Setting</span> appearance mode to <span class="type">Light</span></span><br><span class="line">    t <span class="operator">=</span>     <span class="number">2</span>.08s     <span class="type">Wait</span> <span class="keyword">for</span> com.apple.springboard to idle</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">62</span>.18s <span class="type">Start</span> <span class="type">Test</span> at <span class="number">2022</span><span class="operator">-</span><span class="number">02</span><span class="operator">-</span><span class="number">25</span> <span class="number">15</span>:<span class="number">18</span>:<span class="number">37.506</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">62</span>.27s <span class="type">Set</span> <span class="type">Up</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">62</span>.28s <span class="type">Open</span> com.zcx.iosclient</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">62</span>.35s     <span class="type">Launch</span> com.zcx.iosclient</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">66</span>.50s         <span class="type">Setting</span> up automation session</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">67</span>.71s         <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">70</span>.00s <span class="type">Tap</span> <span class="string">&quot;ç›´æ’­&quot;</span> <span class="type">Button</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">70</span>.00s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">71</span>.77s     <span class="type">Find</span> the <span class="string">&quot;ç›´æ’­&quot;</span> <span class="type">Button</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">72</span>.10s     <span class="type">Check</span> <span class="keyword">for</span> interrupting elements affecting <span class="string">&quot;ç›´æ’­&quot;</span> <span class="type">Button</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">72</span>.14s     <span class="type">Synthesize</span> event</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">72</span>.30s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">72</span>.42s <span class="type">Tap</span> <span class="string">&quot;ç›´æ’­&quot;</span> <span class="type">StaticText</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">72</span>.42s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">72</span>.49s     <span class="type">Find</span> the <span class="string">&quot;ç›´æ’­&quot;</span> <span class="type">StaticText</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">72</span>.52s     <span class="type">Check</span> <span class="keyword">for</span> interrupting elements affecting <span class="string">&quot;ç›´æ’­&quot;</span> <span class="type">StaticText</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">72</span>.53s     <span class="type">Synthesize</span> event</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">72</span>.67s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">72</span>.75s <span class="type">Tap</span> <span class="string">&quot;å³å°†å¼€æ’­&quot;</span> <span class="type">StaticText</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">72</span>.75s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">72</span>.81s     <span class="type">Find</span> the <span class="string">&quot;å³å°†å¼€æ’­&quot;</span> <span class="type">StaticText</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">73</span>.85s         <span class="type">Find</span> the <span class="string">&quot;å³å°†å¼€æ’­&quot;</span> <span class="type">StaticText</span> (retry <span class="number">1</span>)</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">73</span>.91s     <span class="type">Check</span> <span class="keyword">for</span> interrupting elements affecting <span class="string">&quot;å³å°†å¼€æ’­&quot;</span> <span class="type">StaticText</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">73</span>.93s     <span class="type">Synthesize</span> event</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">74</span>.07s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">75</span>.66s <span class="type">Tap</span> <span class="type">Other</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">75</span>.66s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">75</span>.74s     <span class="type">Find</span> the <span class="type">Other</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">75</span>.81s     <span class="type">Check</span> <span class="keyword">for</span> interrupting elements affecting <span class="type">Other</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">75</span>.83s     <span class="type">Synthesize</span> event</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">75</span>.98s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">77</span>.58s <span class="type">Tap</span> <span class="string">&quot;é¢„çº¦ç›´æ’­&quot;</span> <span class="type">StaticText</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">77</span>.58s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">77</span>.68s     <span class="type">Find</span> the <span class="string">&quot;é¢„çº¦ç›´æ’­&quot;</span> <span class="type">StaticText</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">77</span>.78s     <span class="type">Check</span> <span class="keyword">for</span> interrupting elements affecting <span class="string">&quot;é¢„çº¦ç›´æ’­&quot;</span> <span class="type">StaticText</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">77</span>.81s     <span class="type">Synthesize</span> event</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">77</span>.97s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">79</span>.10s <span class="type">Checking</span> `<span class="type">Expect</span> predicate `exists <span class="operator">&gt;=</span> <span class="number">1</span>` <span class="keyword">for</span> object <span class="string">&quot;å·²é¢„çº¦&quot;</span> <span class="type">StaticText</span>`</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">79</span>.10s     <span class="type">Checking</span> existence of `<span class="string">&quot;å·²é¢„çº¦&quot;</span> <span class="type">StaticText</span>`</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">79</span>.17s <span class="type">Tear</span> <span class="type">Down</span></span><br><span class="line"><span class="type">Test</span> <span class="type">Case</span> &#x27;<span class="operator">-</span>[<span class="type">ClientUITests</span>.<span class="type">ClientUITestsLaunchTests</span> testSubscribeLiveInLiveHome]&#x27; passed (<span class="number">79.370</span> seconds).</span><br><span class="line"><span class="type">Test</span> <span class="type">Case</span> &#x27;<span class="operator">-</span>[<span class="type">ClientUITests</span>.<span class="type">ClientUITestsLaunchTests</span> testSubscribeLiveInLiveHome]&#x27; started.</span><br><span class="line">    t <span class="operator">=</span>     <span class="number">0</span>.00s <span class="type">Setting</span> appearance mode to <span class="type">Dark</span></span><br><span class="line">    t <span class="operator">=</span>     <span class="number">2</span>.10s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>     <span class="number">2</span>.19s <span class="type">Start</span> <span class="type">Test</span> at <span class="number">2022</span><span class="operator">-</span><span class="number">02</span><span class="operator">-</span><span class="number">25</span> <span class="number">15</span>:<span class="number">18</span>:<span class="number">56.883</span></span><br><span class="line">    t <span class="operator">=</span>     <span class="number">2</span>.26s <span class="type">Set</span> <span class="type">Up</span></span><br><span class="line">    t <span class="operator">=</span>     <span class="number">2</span>.26s <span class="type">Open</span> com.zcx.iosclient</span><br><span class="line">    t <span class="operator">=</span>     <span class="number">2</span>.33s     <span class="type">Launch</span> com.zcx.iosclient</span><br><span class="line">    t <span class="operator">=</span>     <span class="number">2</span>.33s         <span class="type">Terminate</span> com.zcx.iosclient:<span class="number">21694</span></span><br><span class="line">    t <span class="operator">=</span>     <span class="number">4</span>.44s         <span class="type">Setting</span> up automation session</span><br><span class="line">    t <span class="operator">=</span>     <span class="number">5</span>.53s         <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>     <span class="number">7</span>.76s <span class="type">Tap</span> <span class="string">&quot;ç›´æ’­&quot;</span> <span class="type">Button</span></span><br><span class="line">    t <span class="operator">=</span>     <span class="number">7</span>.76s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>     <span class="number">9</span>.30s     <span class="type">Find</span> the <span class="string">&quot;ç›´æ’­&quot;</span> <span class="type">Button</span></span><br><span class="line">    t <span class="operator">=</span>     <span class="number">9</span>.53s     <span class="type">Check</span> <span class="keyword">for</span> interrupting elements affecting <span class="string">&quot;ç›´æ’­&quot;</span> <span class="type">Button</span></span><br><span class="line">    t <span class="operator">=</span>     <span class="number">9</span>.57s     <span class="type">Synthesize</span> event</span><br><span class="line">    t <span class="operator">=</span>     <span class="number">9</span>.72s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>     <span class="number">9</span>.86s <span class="type">Tap</span> <span class="string">&quot;ç›´æ’­&quot;</span> <span class="type">StaticText</span></span><br><span class="line">    t <span class="operator">=</span>     <span class="number">9</span>.86s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>     <span class="number">9</span>.94s     <span class="type">Find</span> the <span class="string">&quot;ç›´æ’­&quot;</span> <span class="type">StaticText</span></span><br><span class="line">    t <span class="operator">=</span>     <span class="number">9</span>.96s     <span class="type">Check</span> <span class="keyword">for</span> interrupting elements affecting <span class="string">&quot;ç›´æ’­&quot;</span> <span class="type">StaticText</span></span><br><span class="line">    t <span class="operator">=</span>     <span class="number">9</span>.97s     <span class="type">Synthesize</span> event</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">10</span>.12s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">10</span>.21s <span class="type">Tap</span> <span class="string">&quot;å³å°†å¼€æ’­&quot;</span> <span class="type">StaticText</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">10</span>.21s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">10</span>.27s     <span class="type">Find</span> the <span class="string">&quot;å³å°†å¼€æ’­&quot;</span> <span class="type">StaticText</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">11</span>.29s         <span class="type">Find</span> the <span class="string">&quot;å³å°†å¼€æ’­&quot;</span> <span class="type">StaticText</span> (retry <span class="number">1</span>)</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">11</span>.39s     <span class="type">Check</span> <span class="keyword">for</span> interrupting elements affecting <span class="string">&quot;å³å°†å¼€æ’­&quot;</span> <span class="type">StaticText</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">11</span>.42s     <span class="type">Synthesize</span> event</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">11</span>.57s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">13</span>.18s <span class="type">Tap</span> <span class="type">Other</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">13</span>.18s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">13</span>.26s     <span class="type">Find</span> the <span class="type">Other</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">13</span>.33s     <span class="type">Check</span> <span class="keyword">for</span> interrupting elements affecting <span class="type">Other</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">13</span>.35s     <span class="type">Synthesize</span> event</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">13</span>.51s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">15</span>.09s <span class="type">Tap</span> <span class="string">&quot;é¢„çº¦ç›´æ’­&quot;</span> <span class="type">StaticText</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">15</span>.09s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">15</span>.29s     <span class="type">Find</span> the <span class="string">&quot;é¢„çº¦ç›´æ’­&quot;</span> <span class="type">StaticText</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">15</span>.39s     <span class="type">Check</span> <span class="keyword">for</span> interrupting elements affecting <span class="string">&quot;é¢„çº¦ç›´æ’­&quot;</span> <span class="type">StaticText</span></span><br><span class="line">    t <span class="operator">=</span>    <span class="number">15</span>.41s     <span class="type">Synthesize</span> event</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">15</span>.58s     <span class="type">Wait</span> <span class="keyword">for</span> com.zcx.iosclient to idle</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">16</span>.67s <span class="type">Checking</span> `<span class="type">Expect</span> predicate `exists <span class="operator">&gt;=</span> <span class="number">1</span>` <span class="keyword">for</span> object <span class="string">&quot;å·²é¢„çº¦&quot;</span> <span class="type">StaticText</span>`</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">16</span>.67s     <span class="type">Checking</span> existence of `<span class="string">&quot;å·²é¢„çº¦&quot;</span> <span class="type">StaticText</span>`</span><br><span class="line">    t <span class="operator">=</span>    <span class="number">16</span>.74s <span class="type">Tear</span> <span class="type">Down</span></span><br><span class="line"><span class="type">Test</span> <span class="type">Case</span> &#x27;<span class="operator">-</span>[<span class="type">ClientUITests</span>.<span class="type">ClientUITestsLaunchTests</span> testSubscribeLiveInLiveHome]&#x27; passed (<span class="number">16.947</span> seconds).</span><br><span class="line"></span><br><span class="line"><span class="type">Test</span> <span class="type">Suite</span> &#x27;<span class="type">ClientUITestsLaunchTests</span>&#x27; passed at <span class="number">2022</span><span class="operator">-</span><span class="number">02</span><span class="operator">-</span><span class="number">25</span> <span class="number">15</span>:<span class="number">19</span>:<span class="number">11.642</span>.</span><br><span class="line"><span class="type">Executed</span> <span class="number">2</span> tests, with <span class="number">0</span> failures (<span class="number">0</span> unexpected) <span class="keyword">in</span> <span class="number">96.317</span> (<span class="number">96.319</span>) seconds</span><br><span class="line"></span><br><span class="line"><span class="type">Test</span> <span class="type">Suite</span> &#x27;<span class="type">ClientUITests</span>.xctest&#x27; passed at <span class="number">2022</span><span class="operator">-</span><span class="number">02</span><span class="operator">-</span><span class="number">25</span> <span class="number">15</span>:<span class="number">19</span>:<span class="number">11.644</span>.</span><br><span class="line"><span class="type">Executed</span> <span class="number">2</span> tests, with <span class="number">0</span> failures (<span class="number">0</span> unexpected) <span class="keyword">in</span> <span class="number">96.317</span> (<span class="number">96.321</span>) seconds</span><br><span class="line"></span><br><span class="line"><span class="type">Test</span> <span class="type">Suite</span> &#x27;<span class="type">Selected</span> tests&#x27; passed at <span class="number">2022</span><span class="operator">-</span><span class="number">02</span><span class="operator">-</span><span class="number">25</span> <span class="number">15</span>:<span class="number">19</span>:<span class="number">11.647</span>.</span><br><span class="line"><span class="type">Executed</span> <span class="number">2</span> tests, with <span class="number">0</span> failures (<span class="number">0</span> unexpected) <span class="keyword">in</span> <span class="number">96.317</span> (<span class="number">96.324</span>) seconds</span><br><span class="line">     </span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯è°ƒç ”</tag>
      </tags>
  </entry>
  <entry>
    <title>SwiftUI ä»å…¥é—¨åˆ°æ”¾å¼ƒ</title>
    <url>/2022/07/06/SwiftUI/</url>
    <content><![CDATA[<p><img src="https://cdn.zcx.info/e6c9d24ely1h4461xrrg2j211906rjrv.jpg" alt="SWiftUITitleImage"></p>
<h2 id="ä»€ä¹ˆæ˜¯SwiftUI"><a href="#ä»€ä¹ˆæ˜¯SwiftUI" class="headerlink" title="ä»€ä¹ˆæ˜¯SwiftUI"></a>ä»€ä¹ˆæ˜¯SwiftUI</h2><p>SwiftUI äº 2019 å¹´åº¦ WWDC å…¨çƒå¼€å‘è€…å¤§ä¼šä¸Šå‘å¸ƒï¼Œå®ƒæ˜¯åŸºäº Swift å»ºç«‹çš„å£°æ˜å¼UIæ¡†æ¶ã€‚</p>
<p>è¯¥æ¡†æ¶å¯ä»¥ç”¨äº watchOSã€tvOSã€macOSã€iOS ç­‰å¹³å°çš„åº”ç”¨å¼€å‘ï¼Œç­‰äºè¯´ç»Ÿä¸€äº†è‹¹æœç”Ÿæ€åœˆçš„å¼€å‘å·¥å…·ã€‚</p>
<blockquote>
<p>SwiftUI provides views, controls, and layout structures for declaring your appâ€™s user interface. The framework provides event handlers for delivering taps, gestures, and other types of input to your app, and tools to manage the flow of data from your appâ€™s models down to the views and controls that users will see and interact with.</p>
</blockquote>
<h2 id="SwiftUI-Hello-World"><a href="#SwiftUI-Hello-World" class="headerlink" title="SwiftUI Hello World"></a>SwiftUI Hello World</h2><p><a href="https://developer.apple.com/tutorials/swiftui/creating-and-combining-views">åˆ›å»ºæ–°é¡¹ç›®å¹¶é¢„è§ˆç”»å¸ƒ</a></p>
<p>å’Œå¹³æ—¶åˆ›å»ºæ–°é¡¹ç›®æµç¨‹åŸºæœ¬ä¸€è‡´ã€‚åªéœ€è¦é€‰æ‹©Swift UI Interfaceå³å¯ã€‚</p>
<p><img src="https://cdn.zcx.info/e6c9d24ely1h36ny2yym8j213002fmx4.jpg" alt="2"></p>
<p>å·¥ç¨‹åˆå§‹åŒ–åˆ›å»ºå®Œæ¯•åå¯ä»¥çœ‹åˆ°æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://cdn.zcx.info/e6c9d24ely1h36o3x0gvgj207h04lglm.jpg" alt="3"></p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ <span class="title class_">SwiftUIClient</span></span><br><span class="line">â”‚Â Â  â”œâ”€â”€ <span class="title class_">Assets</span>.xcassets /<span class="regexp">/ ç´ ææ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="regexp">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ AccentColor.colorset</span></span><br><span class="line"><span class="regexp">â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ Contents.json</span></span><br><span class="line"><span class="regexp">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ AppIcon.appiconset</span></span><br><span class="line"><span class="regexp">â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ Contents.json</span></span><br><span class="line"><span class="regexp">â”‚Â Â  â”‚Â Â  â””â”€â”€ Contents.json</span></span><br><span class="line"><span class="regexp">â”‚Â Â  â”œâ”€â”€ ContentView.swift /</span><span class="regexp">/ é»˜è®¤view</span></span><br><span class="line"><span class="regexp">â”‚Â Â  â”œâ”€â”€ Preview Content</span></span><br><span class="line"><span class="regexp">â”‚Â Â  â”‚Â Â  â””â”€â”€ Preview Assets.xcassets</span></span><br><span class="line"><span class="regexp">â”‚Â Â  â”‚Â Â      â””â”€â”€ Contents.json</span></span><br><span class="line"><span class="regexp">â”‚Â Â  â””â”€â”€ SwiftUIClientApp.swift /</span><span class="regexp">/ APPå…¥å£æ–‡ä»¶</span></span><br><span class="line"><span class="regexp">â””â”€â”€ SwiftUIClient.xcodeproj </span></span><br><span class="line"><span class="regexp">    â”œâ”€â”€ project.pbxproj</span></span><br><span class="line"><span class="regexp">    â””â”€â”€ xcuserdata</span></span><br><span class="line"><span class="regexp">        â””â”€â”€ pxcm-0101-01-0246.xcuserdatad</span></span><br><span class="line"><span class="regexp">            â””â”€â”€ xcschemes</span></span><br><span class="line"><span class="regexp">                â””â”€â”€ xcschememanagement.plist</span></span><br></pre></td></tr></table></figure>

<h2 id="main"><a href="#main" class="headerlink" title="@main"></a>@main</h2><p>æ‰¾åˆ°APPå…¥å£æ–‡ä»¶<code>SwiftUIClientApp.swift</code>ä¸­çš„<code>@main</code>æ ‡è®°<br>æ ¹æ®ç»éªŒAPPä¼šä»@mainå…¥å£å¯åŠ¨å¼€å§‹æ‰§è¡Œ</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">@main</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SwiftUIClientApp</span>: <span class="title class_ inherited__">App</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">Scene</span> &#123;</span><br><span class="line">        <span class="type">WindowGroup</span> &#123;</span><br><span class="line">            <span class="type">ContentView</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¼šé‡åˆ°ä¸‰ä¸ªæ–°çš„ç»“æ„: App, Scene, WindowGroup</p>
<h3 id="App-Protocol"><a href="#App-Protocol" class="headerlink" title="App Protocol"></a>App Protocol</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">14.0</span>, <span class="keyword">macOS</span> <span class="number">11.0</span>, <span class="keyword">tvOS</span> <span class="number">14.0</span>, <span class="keyword">watchOS</span> <span class="number">7.0</span>, <span class="operator">*</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">protocol</span> <span class="title class_">App</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡å£°æ˜ç¬¦åˆ<code>App</code>åè®®çš„ç»“æ„æ¥åˆ›å»ºåº”ç”¨ç¨‹åºã€‚å®ç°æ‰€éœ€çš„<a href="https://developer.apple.com/documentation/swiftui/app/body-swift.property"><code>body</code></a>è®¡ç®—å±æ€§æ¥å®šä¹‰åº”ç”¨ç¨‹åºçš„å†…å®¹ã€‚</p>
<p>åœ¨ç»“æ„å£°æ˜ä¹‹å‰åŠ ä¸Š<a href="https://docs.swift.org/swift-book/ReferenceManual/Attributes.html#ID626">@main</a>å±æ€§ï¼Œè¡¨æ˜æ‚¨çš„è‡ªå®šä¹‰<code>App</code>åè®®ç¬¦åˆè€…æä¾›äº†åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚<a href="https://developer.apple.com/documentation/swiftui/app/main()"><code>main()</code></a>è¯¥åè®®æä¾›äº†ç³»ç»Ÿè°ƒç”¨ä»¥å¯åŠ¨æ‚¨çš„åº”ç”¨ç¨‹åºçš„æ–¹æ³•çš„é»˜è®¤å®ç°ã€‚åœ¨æ‰€æœ‰åº”ç”¨ç¨‹åºæ–‡ä»¶ä¸­åªå¯ä»¥æœ‰ä¸€ä¸ªå…¥å£ç‚¹ã€‚</p>
<p>å¯ä»¥ç®€å•ç†è§£ä¸ºAPPçš„å¤–å£³&#x2F;å®¹å™¨</p>
<h3 id="Scene-Protocol"><a href="#Scene-Protocol" class="headerlink" title="Scene Protocol"></a>Scene Protocol</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">14.0</span>, <span class="keyword">macOS</span> <span class="number">11.0</span>, <span class="keyword">tvOS</span> <span class="number">14.0</span>, <span class="keyword">watchOS</span> <span class="number">7.0</span>, <span class="operator">*</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">protocol</span> <span class="title class_">Scene</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‚¨å¯ä»¥<a href="https://developer.apple.com/documentation/swiftui/app"><code>App</code></a>é€šè¿‡ç»„åˆä¸€ä¸ªæˆ–å¤šä¸ªç¬¦åˆ<code>Scene</code>åº”ç”¨ç¨‹åºä¸­åè®®çš„å®ä¾‹æ¥åˆ›å»º<a href="https://developer.apple.com/documentation/swiftui/app/body-swift.property"><code>body</code></a>. æ‚¨å¯ä»¥ä½¿ç”¨ SwiftUI æä¾›çš„å†…ç½®åœºæ™¯ï¼Œä¾‹å¦‚ï¼Œä»¥åŠæ‚¨ä»å…¶ä»–åœºæ™¯ä¸­ç»„åˆçš„è‡ªå®šä¹‰åœºæ™¯ã€‚è¦åˆ›å»ºè‡ªå®šä¹‰åœºæ™¯ï¼Œè¯·å£°æ˜ç¬¦åˆåè®®çš„ç±»å‹ã€‚å®ç°æ‰€éœ€çš„è®¡ç®—å±æ€§å¹¶ä¸ºæ‚¨çš„è‡ªå®šä¹‰åœºæ™¯æä¾›å†…å®¹ï¼š<a href="https://developer.apple.com/documentation/swiftui/windowgroup"><code>WindowGroup</code></a><code>Scene</code><a href="https://developer.apple.com/documentation/swiftui/scene/body-swift.property"><code>body</code></a></p>
<p>åœºæ™¯æ˜¯è§†å›¾ï¼ˆViewï¼‰å±‚æ¬¡ç»“æ„çš„å®¹å™¨ã€‚é€šè¿‡åœ¨Appå®ä¾‹çš„bodyä¸­ç»„åˆä¸€ä¸ªæˆ–å¤šä¸ªç¬¦åˆSceneåè®®çš„å®ä¾‹æ¥å‘ˆç°å…·ä½“ç¨‹åºã€‚</p>
<ul>
<li>ç”Ÿå‘½å‘¨æœŸç”±ç³»ç»Ÿç®¡ç†</li>
<li>ç³»ç»Ÿä¼šæ ¹æ®è¿è¡Œå¹³å°çš„ä¸åŒè€Œè°ƒæ•´åœºæ™¯çš„å±•ç¤ºè¡Œä¸ºï¼ˆæ¯”å¦‚ç›¸åŒçš„ä»£ç åœ¨iOSå’ŒmacOSä¸‹çš„å‘ˆç°ä¸åŒï¼Œæˆ–è€…æŸäº›åœºæ™¯ä»…èƒ½è¿è¡Œäºç‰¹å®šçš„å¹³å°ï¼‰</li>
<li>SwiftUI2.0æä¾›äº†å‡ ä¸ªé¢„ç½®çš„åœºæ™¯ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥è‡ªå·±ç¼–å†™ç¬¦åˆSceneåè®®çš„åœºæ™¯ã€‚ä¸Šè¿°ä»£ç ä¸­ä¾¿æ˜¯ä½¿ç”¨çš„ä¸€ä¸ªé¢„ç½®åœºæ™¯WindowGroup</li>
</ul>
<p>å¯ä»¥ç®€å•ç†è§£ä¸ºå¤šçª—å£æ¨¡å¼ä¸‹çš„æŸä¸€ä¸ªçª—å£(iPad&#x2F;Mac)</p>
<h3 id="WindowGroup-Struct"><a href="#WindowGroup-Struct" class="headerlink" title="WindowGroup Struct"></a>WindowGroup Struct</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">14.0</span>, <span class="keyword">macOS</span> <span class="number">11.0</span>, <span class="keyword">tvOS</span> <span class="number">14.0</span>, <span class="keyword">watchOS</span> <span class="number">7.0</span>, <span class="operator">*</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> <span class="title class_">WindowGroup</span>&lt;<span class="type">Content</span>&gt; : <span class="type">Scene</span> <span class="keyword">where</span> <span class="type">Content</span> : <span class="type">View</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€å¸¸ç”¨çš„Sceneï¼Œå¯ä»¥å‘ˆç°ä¸€ç»„ç»“æ„ç›¸åŒçš„çª—å£ã€‚ä½¿ç”¨è¯¥åœºæ™¯ï¼Œæˆ‘ä»¬æ— éœ€åœ¨ä»£ç ä¸Šåšä¿®æ”¹ï¼Œåªéœ€è¦åœ¨é¡¹ç›®ä¸­è®¾å®šæ˜¯å¦æ”¯æŒå¤šçª—å£ï¼Œç³»ç»Ÿå°†ä¼šæŒ‰ç…§è¿è¡Œå¹³å°çš„ç‰¹æ€§è‡ªåŠ¨ç®¡ç†ã€‚</p>
<p>å¦‚æœåœ¨ä¸€ä¸ªWindowGroupé‡ŒåŠ å…¥å¤šä¸ªView,å‘ˆç°çŠ¶æ€æœ‰ç‚¹ç±»ä¼¼VStackã€‚ä»ä¸Šåˆ°ä¸‹ä¾æ’åˆ—</p>
<p>åœ¨ä¸€ä¸ªSceneä¸­åŠ å…¥å¤šä¸ªWindowGroupï¼Œåªæœ‰æœ€å‰é¢çš„å¯ä»¥è¢«æ˜¾ç¤ºã€‚</p>
<h2 id="View-Protocol-å’Œå¸¸ç”¨æ§ä»¶"><a href="#View-Protocol-å’Œå¸¸ç”¨æ§ä»¶" class="headerlink" title="View Protocol å’Œå¸¸ç”¨æ§ä»¶"></a>View Protocol å’Œå¸¸ç”¨æ§ä»¶</h2><p>SwiftUIä½¿ç”¨è¿‡ç¨‹ä¸­å¯ä»¥æ˜æ˜¾æ„Ÿè§‰åˆ°æ•´ä¸ªAPPéƒ½æ˜¯ä½¿ç”¨ä¸€ç³»åˆ—Viewäº’ç›¸åµŒå¥—&#x2F;å †å è€Œæˆçš„ã€‚</p>
<p>View åè®®æ˜¯æ•´ä¸ªUIç•Œé¢çš„åŸºç¡€,æä¾›é…ç½®ç•Œé¢çš„å„ä¸ªéƒ¨åˆ†ã€‚</p>
<blockquote>
<p>A type that represents part of your appâ€™s user interface and provides modifiers that you use to configure views.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">TestView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ–‡æœ¬"><a href="#æ–‡æœ¬" class="headerlink" title="æ–‡æœ¬"></a>æ–‡æœ¬</h3><h4 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;æˆ‘æ˜¯ä¸€ä¸ªè®¾ç½®äº†è“åº•ç™½å­—è¡Œé—´è·5å†…è¾¹è·5è¾¹æ¡†3çš„Textæ§ä»¶&quot;</span>)</span><br><span class="line">.lineLimit(<span class="number">2</span>)<span class="comment">// æœ€å¤§2è¡Œ</span></span><br><span class="line">.font(.largeTitle) <span class="comment">// å­—ä½“</span></span><br><span class="line">.foregroundColor(.white)<span class="comment">// å­—ä½“é¢œè‰²</span></span><br><span class="line">.background(.blue) <span class="comment">// èƒŒæ™¯é¢œè‰²</span></span><br><span class="line">.lineSpacing(<span class="number">5</span>) <span class="comment">// è¡Œé—´è·</span></span><br><span class="line">.padding(.all, <span class="number">5</span>) <span class="comment">// æ–‡å­—å’Œç©ºé—´é—´çš„å†…è¾¹è·</span></span><br><span class="line">.border(.blue, width: <span class="number">3</span>)<span class="comment">// è¾¹æ¡†</span></span><br><span class="line">.rotationEffect(<span class="type">Angle</span>(degrees: <span class="number">50</span>)) <span class="comment">// æ—‹è½¬</span></span><br></pre></td></tr></table></figure>

<p>ç®€å•ä¸”å¼ºå¤§çš„æ–‡æœ¬æ§ä»¶,ç±»ä¼¼äºUILabel.å¯ä»¥æ”¯æŒå¾ˆçŸ­çš„ä»£ç è®¾ç½®æ‰€éœ€å±æ€§</p>
<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3i0g7vwrdj214w0mjacl.jpg"></image></pre>
</details>

<h4 id="TextField"><a href="#TextField" class="headerlink" title="TextField"></a>TextField</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">TextField</span>(<span class="string">&quot;è¾“å…¥æ¡†&quot;</span>, text: <span class="variable">$value</span>)</span><br><span class="line">.textFieldStyle(.roundedBorder)</span><br><span class="line">.keyboardType(.alphabet)</span><br></pre></td></tr></table></figure>

<p>ç›¸å½“äºUIKitä¸­çš„UITextFieldçš„å•è¡Œæ–‡æœ¬è¾“å…¥æ¡†.æ”¯æŒbangingä¸€ä¸ª@stateä¿®é¥°çš„stringå˜é‡ã€‚</p>
<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3i5s1lrouj214r0mejuw.jpg"></image></pre>
</details>

<h4 id="SecureField"><a href="#SecureField" class="headerlink" title="SecureField"></a>SecureField</h4><p>å¯†ç è¾“å…¥æ¡†,ç”¨æ³•å’Œæ™®é€šçš„è¾“å…¥æ¡†ä¸€è‡´</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">SecureField</span>(<span class="string">&quot;å¯†ç è¾“å…¥&quot;</span>, text: <span class="variable">$value</span>)</span><br><span class="line">.textFieldStyle(.roundedBorder)</span><br><span class="line">.keyboardType(.alphabet)</span><br><span class="line">.accentColor(.red)</span><br></pre></td></tr></table></figure>

<h4 id="TextEditor"><a href="#TextEditor" class="headerlink" title="TextEditor"></a>TextEditor</h4><p>ç±»ä¼¼UITextView,å¤šè¡Œè¾“å…¥æ–‡æœ¬</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">TextEditor</span>(text: <span class="variable">$value</span>)</span><br><span class="line">.keyboardType(.default)</span><br><span class="line">.multilineTextAlignment(.leading)</span><br><span class="line">.accentColor(.red)</span><br><span class="line">.foregroundColor(.black)</span><br><span class="line">.background(.gray.opacity(<span class="number">0.3</span>))</span><br><span class="line">.lineSpacing(<span class="number">5</span>)</span><br><span class="line">.frame(maxHeight: <span class="number">500</span>)</span><br><span class="line">.textInputAutocapitalization(.words)</span><br><span class="line">.disableAutocorrection(<span class="literal">true</span> )</span><br><span class="line">.onChange(of: value) &#123; newValue <span class="keyword">in</span></span><br><span class="line">    textCount <span class="operator">=</span> newValue.count <span class="comment">// è¾“å…¥æ–‡æœ¬å˜åŒ–ç›‘å¬å™¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3i8b01bi2j214q0mg437.jpg"></image></pre>
</details>

<h3 id="æŒ‰é’®"><a href="#æŒ‰é’®" class="headerlink" title="æŒ‰é’®"></a>æŒ‰é’®</h3><h4 id="Button"><a href="#Button" class="headerlink" title="Button"></a>Button</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸å¸¦è¾¹æ¡†styleçš„button</span></span><br><span class="line"><span class="type">Button</span>(<span class="string">&quot;ä¸åº”ç”¨è¾¹æ¡†çš„æŒ‰é’®æ ·å¼&quot;</span>)&#123;&#125;.buttonStyle(<span class="type">BorderlessButtonStyle</span>()).padding()</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥é€šè¿‡è‡ªå®šä¹‰PrimitiveButtonStyleç±»æ¥å®ç°ä¸€äº›è‡ªå®šä¹‰çš„button</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PriButton</span>: <span class="title class_ inherited__">PrimitiveButtonStyle</span> &#123;</span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">Body</span> <span class="operator">=</span> <span class="type">Button</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeBody</span>(<span class="params">configuration</span>: <span class="type">Configuration</span>) -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        configuration.trigger()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">        <span class="type">Button</span>(configuration)</span><br><span class="line">            .background(<span class="type">Color</span>.orange)</span><br><span class="line">            .clipShape(<span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">25.0</span>, style: .continuous))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨labelå‚æ•°è®¾ç½®è‡ªå®šä¹‰view</span></span><br><span class="line"><span class="type">Button</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;click&quot;</span>) <span class="comment">// äº‹ä»¶block</span></span><br><span class="line">&#125; label: &#123;</span><br><span class="line">   <span class="comment">//è¿™é‡Œå¯ä»¥æ”¾è‡ªå®šä¹‰view</span></span><br><span class="line">    <span class="type">Image</span>(systemName: <span class="string">&quot;star&quot;</span>).offset(x: <span class="operator">-</span><span class="number">10</span>, y: <span class="number">0</span>)</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;å¸¦å›¾æ ‡çš„æŒ‰é’®&quot;</span>)</span><br><span class="line">&#125;.padding()</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3i0k7u9qvj213d0mj42p.jpg"></image></pre>
</details>

<h4 id="Menu-PullDownButton"><a href="#Menu-PullDownButton" class="headerlink" title="Menu(PullDownButton)"></a>Menu(<em>PullDownButton</em>)</h4><p>ç‚¹å‡»å¼¹å‡ºé€‰æ‹©èœå•,å¯ä»¥åŠ åœ¨toolbarä¸Šæˆ–è€…å…¶ä»–åœ°æ–¹,æœ¬ä½“æ˜¯ä¸€ä¸ªButton,ä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰View.</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">Menu</span>(<span class="string">&quot;menu&quot;</span>) &#123;</span><br><span class="line">    <span class="type">Button</span>(<span class="string">&quot;Duplicate&quot;</span>, action: duplicate)</span><br><span class="line">    <span class="type">Button</span>(<span class="string">&quot;Rename&quot;</span>, action: rename)</span><br><span class="line">    <span class="type">Button</span>(<span class="string">&quot;Deleteâ€¦&quot;</span>, action: delete)</span><br><span class="line">    <span class="type">Menu</span>(<span class="string">&quot;Copy&quot;</span>) &#123;</span><br><span class="line">        <span class="type">Button</span>(<span class="string">&quot;Copy&quot;</span>, action: <span class="keyword">copy</span>)</span><br><span class="line">        <span class="type">Button</span>(<span class="string">&quot;Copy Formatted&quot;</span>, action: copyFormatted)</span><br><span class="line">        <span class="type">Button</span>(<span class="string">&quot;Copy Library Path&quot;</span>, action: copyPath)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;.menuStyle(.borderlessButton)</span><br><span class="line"></span><br><span class="line"><span class="type">Menu</span> &#123;</span><br><span class="line">    <span class="type">Button</span>(<span class="string">&quot;Open in Preview&quot;</span>, action: openInPreview)</span><br><span class="line">    <span class="type">Button</span>(<span class="string">&quot;Save as PDF&quot;</span>, action: saveAsPDF)</span><br><span class="line">&#125; label: &#123;</span><br><span class="line">    <span class="type">Image</span>(systemName: <span class="string">&quot;document&quot;</span>)</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;PDF&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3i91gt97aj214s0mgn15.jpg"></image></pre>
</details>

<h4 id="EditButton"><a href="#EditButton" class="headerlink" title="EditButton"></a>EditButton</h4><p>æ”¯æŒæ”¹å˜æ•´ä¸ªç¯å¢ƒå˜é‡ä¸­çš„editModeå­—æ®µ,å¼€å¯ç¼–è¾‘çŠ¶æ€åä¸€äº›ç³»ç»Ÿæ§ä»¶ä¼šè‡ªåŠ¨è§¦å‘çŠ¶æ€å˜åŒ–ã€‚ä¾‹å¦‚æ”¯æŒåˆ é™¤æˆ–è€…æ’åºçš„Listä¸­çš„ForEachåˆ—è¡¨åœ¨å¼€å¯editmodeåä¼šæ˜¾ç¤ºå‡ºListçš„ç¼–è¾‘åŠŸèƒ½ã€‚</p>
<p>å½“ç„¶,ä½ ä¹Ÿå¯ä»¥åˆ›å»ºä¸€äº›æ”¯æŒç¼–è¾‘æ¨¡å¼çš„View,åŒæ—¶ä¹Ÿå¯ä»¥ç›‘å¬ç¯å¢ƒä¸­çš„editModeã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Environment</span>(\.editMode) <span class="keyword">var</span> editMode</span><br></pre></td></tr></table></figure>

<p>ç»å¸¸ä¼šå’ŒtoolbaråŠŸèƒ½å…±ç”¨,åœ¨å¯¼èˆªæ¡å³ä¸Šè§’æ”¯æŒç¼–è¾‘æ¨¡å¼ã€‚</p>
<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3j3vq77r8j214l0md793.jpg"></image></pre>
</details>

<h3 id="åˆ—è¡¨"><a href="#åˆ—è¡¨" class="headerlink" title="åˆ—è¡¨"></a>åˆ—è¡¨</h3><h4 id="List-Section-ForEach"><a href="#List-Section-ForEach" class="headerlink" title="List, Section, ForEach"></a>List, Section, ForEach</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">List</span>&#123;</span><br><span class="line">  <span class="type">Section</span>(<span class="string">&quot;æ°´æœåˆ—è¡¨&quot;</span>) &#123;</span><br><span class="line">      <span class="type">ForEach</span>(fruits, id: \.<span class="keyword">self</span>) &#123; fruit <span class="keyword">in</span></span><br><span class="line">          <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(fruit)</span>&quot;</span>)</span><br><span class="line">      &#125;.onMove &#123; indexSet, index <span class="keyword">in</span></span><br><span class="line">          fruits.move(fromOffsets: indexSet, toOffset: index)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> <span class="operator">!</span>balls.isEmpty &#123;</span><br><span class="line">      <span class="type">Section</span>(<span class="string">&quot;çƒç±»åˆ—è¡¨&quot;</span>) &#123;</span><br><span class="line">          <span class="type">ForEach</span>(balls, id: \.<span class="keyword">self</span>) &#123; ball <span class="keyword">in</span></span><br><span class="line">              <span class="type">Text</span>(<span class="string">&quot;<span class="subst">\(ball)</span>&quot;</span>)</span><br><span class="line">          &#125;.onDelete &#123; indexSet <span class="keyword">in</span></span><br><span class="line">              balls.remove(atOffsets: indexSet)</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Listç±»ä¼¼UIKitä¸­çš„UITableView,å¸¸ä¸ForEachè¯­å¥ä¸€èµ·ä½¿ç”¨ã€‚ä¸åƒUIKitä¸­ç¹ççš„ä»£ç†å’Œæ•°æ®æºæ¨¡å¼,Listæ˜¯å­—é¢å«ä¹‰çš„Viewåˆ—è¡¨,æ‰‹åŠ¨å°†æ¯ä¸ªVIewæ’åˆ—èµ·æ¥å³å¯ã€‚</p>
<p>å½“ç„¶Listä¹Ÿå¯ä»¥ç›´æ¥è£…å¡«æ•°æ®æºè¿›è¡Œåˆ—è¡¨å±•ç¤º</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">List</span>(<span class="number">0</span><span class="operator">..&lt;</span><span class="number">100</span>)&#123; i <span class="keyword">in</span></span><br><span class="line">  <span class="type">Text</span>(<span class="string">&quot;id:<span class="subst">\(id)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Sectionåˆ™å¯ç†è§£ä¸ºUITableViewä¸­çš„SectionHeaderå’ŒFooteråœ¨SwiftUIä¸­çš„å®ç°.Listå’ŒSectionè”åˆä½¿ç”¨å¯ä»¥å®ç°å¸¸ç”¨çš„å¤šSectionçš„tableviewã€‚</p>
<p>ForEachè¯­å¥éœ€æ±‚ä¼ å…¥çš„æ•°æ®æ‹¥æœ‰å”¯ä¸€æ ‡è¯†,é’ˆå¯¹æ•°ç»„å¯ä»¥ç›´æ¥ä½¿ç”¨</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">ForEach</span>(array.indices, id: \.<span class="keyword">self</span>)&#123; index <span class="keyword">in</span></span><br><span class="line"> <span class="comment">//some view</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3j3sni4zjj214s0mhtbz.jpg"></image></pre>
</details>

<h4 id="Group"><a href="#Group" class="headerlink" title="Group"></a>Group</h4><p>Groupç”¨äºé›†åˆå¤šä¸ªè§†å›¾ï¼Œå¯¹ Group è®¾ç½®çš„å±æ€§ï¼Œå°†ä½œç”¨äºæ¯ä¸ªå­è§†å›¾ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">Group</span> &#123;</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">.foregroundColor(.blue)</span><br><span class="line">.font(.caption)</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3rnl7bryaj213o0metbb.jpg"></image></pre>
</details>

<h4 id="From"><a href="#From" class="headerlink" title="From"></a>From</h4><p>Formæ˜¯SwiftUIçš„åŸºç¡€æ§ä»¶ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ˜¾ç¤ºäº§å“é…ç½®ã€é€‰é¡¹ã€ç”¨æˆ·è¾“å…¥æ—¶ï¼Œä½¿ç”¨Formå¯ä»¥å¿«é€Ÿæ­å»ºå‡ºå„ç±»è¡¨å•ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"> <span class="type">Form</span> &#123;</span><br><span class="line">    <span class="type">Section</span> &#123;</span><br><span class="line">        <span class="type">HStack</span>&#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: <span class="string">&quot;star.fill&quot;</span>)</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;è¾“å…¥çš„å†…å®¹:<span class="subst">\(value)</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">TextField</span>(<span class="string">&quot;è¾“å…¥æ¡†çš„placeholder&quot;</span>, text: <span class="variable">$value</span>)</span><br><span class="line">            .textFieldStyle(.roundedBorder)</span><br><span class="line">            .keyboardType(.alphabet)</span><br><span class="line">            .accentColor(.red)</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;ä¸€ä¸ªç®€å•çš„Formå†™æ³•,å¦‚æœæˆ‘ä»¬éœ€è¦æ˜¾ç¤ºäº§å“é…ç½®ã€é€‰é¡¹ã€ç”¨æˆ·è¾“å…¥æ—¶ï¼Œä½¿ç”¨Formå¯ä»¥å¿«é€Ÿæ­å»ºå‡ºå„ç±»è¡¨å•,ä¼šè‡ªåŠ¨å¢åŠ å†…è¾¹è·&quot;</span>)</span><br><span class="line">            .font(.caption)</span><br><span class="line">            .foregroundColor(.gray)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Section</span>(<span class="string">&quot;å¦ä¸€ç»„å†…å®¹&quot;</span>) &#123;</span><br><span class="line">        <span class="type">HStack</span>&#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: <span class="string">&quot;star&quot;</span>)</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;ä¸€ä¸ªå³å¯¹é½çš„æ–‡æ¡ˆ&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3jl3sied0j214q0mb0w3.jpg"></image></pre>
</details>

<h4 id="ScrollView"><a href="#ScrollView" class="headerlink" title="ScrollView"></a>ScrollView</h4><p>åœ¨æœ‰é™ç©ºé—´æ”¾è¾ƒå¤šå†…å®¹çš„å®¹å™¨View</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">ScrollView</span>(.vertical, showsIndicators: <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="type">ForEach</span>(list, id:\.<span class="keyword">self</span>) &#123; item <span class="keyword">in</span></span><br><span class="line">        <span class="type">Text</span>(item).padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3jbr3uhfej214s0mfjy1.jpg"></image></pre>
</details>

<h3 id="å¸ƒå±€"><a href="#å¸ƒå±€" class="headerlink" title="å¸ƒå±€"></a>å¸ƒå±€</h3><h4 id="VStack-HStack"><a href="#VStack-HStack" class="headerlink" title="VStack,HStack"></a>VStack,HStack</h4><p>VStackç±»ä¼¼UIStackView,å±äºå¸ƒå±€ä¿®é¥°ç¬¦,å…¶ä¸­åŒ…è£¹çš„viewä¼šæŒ‰ç…§ä¸€å®šçš„è§„åˆ™è¿›è¡Œå‚ç›´æ–¹å‘çš„è‡ªåŠ¨å¸ƒå±€ã€‚</p>
<p>åŒç†HStackä¼šåœ¨æ°´å¹³æ–¹å‘è‡ªåŠ¨å¸ƒå±€,äºŒè€…å¯å åŠ åµŒå¥—ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">VStack</span>(alignment: .leading, spacing: <span class="number">10</span>) &#123;</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;å‚ç›´æ–¹å‘å·¦å¯¹é½&quot;</span>).border(.blue, width: <span class="number">1</span>)</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;è®¾ç½®çš„ä¸¤ä¸ªlabel&quot;</span>).border(.blue, width: <span class="number">1</span>)</span><br><span class="line">    <span class="type">HStack</span>(alignment: .center, spacing: <span class="number">5</span>) &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;åµŒå¥—ä¸€ä¸ªæ°´å¹³æ–¹å‘çš„HStack&quot;</span>).border(.blue, width: <span class="number">1</span>)</span><br><span class="line">        <span class="type">Spacer</span>()</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;çš„ä¸¤ä¸ªlabel&quot;</span>).border(.blue, width: <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3uoh36i9gj213v0n1418.jpg"></image></pre>
</details>

<h4 id="ZStack"><a href="#ZStack" class="headerlink" title="ZStack"></a>ZStack</h4><p>ZStackçš„å¸ƒå±€æ–¹å¼ç±»ä¼¼äºUIKitä¸­çš„Viewçˆ¶å­å±‚çº§,ä½†æ˜¯SwiftUIä¸­è¾ƒå°‘æåŠçˆ¶å­å±‚çº§å…³ç³»,SwiftUIä¸­è®¤ä¸ºæ¯ä¸ªViewéƒ½æ˜¯ç‹¬ç«‹çš„View,ä»…ä»…æ˜¯å¸ƒå±€æ–¹å¼çš„ä¸åŒã€‚</p>
<p>ä¾‹å¦‚åœ¨UIKitä¸­åœ¨ä¸€ä¸ªViewå†…éƒ¨å¢åŠ å‡ ä¸ªå°Viewä¼šç”¨åˆ°addSubviewæ–¹æ³•æ¥æ·»åŠ å­View,ä½†æ˜¯åœ¨SwiftUIä¸­ä¼šä½¿ç”¨ZStackå¸ƒå±€æ–¹å¼æ¥è¿›è¡ŒViewå †å ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">ZStack</span>(alignment: .center) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font></summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3uorpdw9qj213s0mtn0l.jpg"></image></pre>
</details>

<h3 id="å¯¼èˆª"><a href="#å¯¼èˆª" class="headerlink" title="å¯¼èˆª"></a>å¯¼èˆª</h3><h4 id="TabView"><a href="#TabView" class="headerlink" title="TabView"></a>TabView</h4><p>ç±»ä¼¼UIKitä¸­çš„UITabbaræ‰¿æ‹…tabåˆ‡æ¢çš„åŠŸèƒ½</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">TabType</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> featureList</span><br><span class="line">    <span class="keyword">case</span> other</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">TabView</span> &#123;</span><br><span class="line">  <span class="comment">//FeatureListHomeViewæ˜¯è¿™ä¸ªtabbarçš„rootå±‚çº§çš„view</span></span><br><span class="line">  <span class="type">FeatureListHomeView</span>().tabItem(&#123;</span><br><span class="line">      <span class="type">Label</span>(<span class="string">&quot;åˆ—è¡¨&quot;</span>, systemImage: <span class="string">&quot;list.bullet&quot;</span>)<span class="comment">// tabItemæ¥è¿›è¡Œå±•ç¤ºå†…å®¹</span></span><br><span class="line">  &#125;).tag(<span class="type">TabType</span>.featureList) <span class="comment">// .tagæ¥æ ‡å¿—æ˜ å°„</span></span><br><span class="line"></span><br><span class="line">  <span class="type">CustomViews</span>().tabItem(&#123;</span><br><span class="line">      <span class="type">Label</span>(<span class="string">&quot;è‡ªå®šä¹‰&quot;</span>, systemImage: <span class="string">&quot;star&quot;</span>)</span><br><span class="line">  &#125;).tag(<span class="type">TabType</span>.other)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3jkd4vkktj214o0men09.jpg"></image></pre>
</details>

<h4 id="NavigationView-NavigationLink"><a href="#NavigationView-NavigationLink" class="headerlink" title="NavigationView, NavigationLink"></a>NavigationView, NavigationLink</h4><p>ç±»ä¼¼UINavigationViewController,è´Ÿè´£å¯¼èˆªæ ˆçš„ç®¡ç†ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">NavigationView</span> &#123;</span><br><span class="line"><span class="type">List</span> &#123;</span><br><span class="line">    <span class="type">ForEach</span>(feature.demoFeatures.featureSections, id: \.<span class="keyword">self</span>) &#123; sec <span class="keyword">in</span></span><br><span class="line">        <span class="type">Section</span>(sec.featureSectionName) &#123;</span><br><span class="line">            <span class="type">ForEach</span>(sec.featureList, id: \.<span class="keyword">self</span>) &#123; item <span class="keyword">in</span></span><br><span class="line">                <span class="type">NavigationLink</span> &#123;</span><br><span class="line">                    getDestinationViews(featureItem: item)</span><br><span class="line">                &#125; label: &#123;</span><br><span class="line">                    <span class="type">DemoRowView</span>(title: item.featureName, subTitle: item.featureDesc)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;.onDelete &#123; offset <span class="keyword">in</span></span><br><span class="line">                deleteRow(offset: offset, from: sec)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;.listStyle(.in<span class="keyword">set</span>)</span><br><span class="line">.navigationTitle(<span class="string">&quot;æ§ä»¶åˆ—è¡¨&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>ä¸€èˆ¬é…åˆNavigationLinkæ¥è¿›è¡Œç‚¹å‡»è·³è½¬.ç±»ä¼¼çš„,å¯¼èˆªæ ˆè·³è½¬åç»­çš„é¡µé¢å…±ç”¨åŒä¸€ä¸ªå¯¼èˆªæ ˆã€‚å¯ä»¥é€šè¿‡navigationTitleæ–¹æ³•è®¾ç½®å¯¼èˆªæ ˆçš„æ ‡é¢˜,é€šè¿‡navigationBarTitleDisplayModeæ–¹æ³•è®¾ç½®å¯¼èˆªæ ‡é¢˜çš„å±•ç¤ºå½¢å¼ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">.navigationTitle(<span class="string">&quot;NavigationView&quot;</span>)</span><br><span class="line">.navigationBarTitleDisplayMode(.inline)<span class="comment">// åªåœ¨é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸæ˜¾ç¤º</span></span><br><span class="line">.navigationBarTitleDisplayMode(.large)<span class="comment">// ä¼šåœ¨å½“å‰é¡µé¢é¡¶éƒ¨æ˜¾ç¤ºä¸€ä¸ªè¾ƒå¤§çš„æ ‡é¢˜</span></span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3n25qldn7j214q0mg0va.jpg"></image></pre>
</details>

<h4 id="Modal"><a href="#Modal" class="headerlink" title="Modal"></a>Modal</h4><p>æ¨¡æ€å¼¹å‡ºæ˜¯ç»å¸¸ä½¿ç”¨çš„ä¸€ç§å¼¹å‡ºä¿¡æ¯é¡µé¢çš„æ¨¡å¼ã€‚</p>
<p>SwiftUIç»™VIewå¢åŠ çš„.sheetçš„æ‰©å±•,ç»™å®šä¸€ä¸ªç»‘å®šçš„å€¼,å½“è¿™ä¸ªå€¼å‘ç”Ÿå˜åŒ–çš„æ—¶å€™(true),è§¦å‘æ¨¡æ€æ¡†çš„äº‹ä»¶ã€‚</p>
<p>UIKitä¸­çš„Present VIewControllerä¸åŒçš„style,æœ‰åŠå¼¹çª—å’Œå…¨å±present</p>
<p>åŒç†,SwiftUIç»™VIewå¢åŠ äº†.fullScreenCoverçš„æ‰©å±•,ç»™å®šä¸€ä¸ªç»‘å®šçš„å€¼,å½“è¿™ä¸ªå€¼å‘ç”Ÿå˜åŒ–çš„æ—¶å€™(true),è§¦å‘å…¨å±æ¨¡æ€æ¡†çš„äº‹ä»¶ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">Form</span>&#123;</span><br><span class="line">  <span class="type">Button</span>(<span class="string">&quot;Modal New View&quot;</span>) &#123;</span><br><span class="line">      isPresented.toggle()</span><br><span class="line">  &#125;.sheet(isPresented: <span class="variable">$isPresented</span>, onDismiss: &#123;</span><br><span class="line">      <span class="comment">// dismiss</span></span><br><span class="line">  &#125;) &#123;</span><br><span class="line">      <span class="type">ImageDemo</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">Button</span>(<span class="string">&quot;FullScreenCover New View&quot;</span>) &#123;</span><br><span class="line">      fullScreenCover.toggle()</span><br><span class="line">  &#125;.fullScreenCover(isPresented: <span class="variable">$fullScreenCover</span>) &#123;</span><br><span class="line">      <span class="type">TextEditorDemo</span>(value: <span class="string">&quot;FullScreenCover&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3pdafcupzj213e0mgwgx.jpg"></image></pre>
</details>

<h4 id="Popover"><a href="#Popover" class="headerlink" title="Popover"></a>Popover</h4><p>Popoveråœ¨ä¸åŒçš„è®¾å¤‡ä¸Šå±•ç¤ºä¼šå‡ºç°å·®å¼‚,åœ¨iOSä¸Šæ˜¯æ¨¡æ€å¼¹å‡ºä¸€ä¸ªæ–°é¡µé¢,åœ¨iPadæˆ–Macä¸Šå¼¹å‡ºä¸€ä¸ªæ°”æ³¡æ¡†ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">Button</span>(<span class="string">&quot;Popover New View&quot;</span>) &#123;</span><br><span class="line">    popover.toggle()</span><br><span class="line">&#125;.popover(isPresented: <span class="variable">$popover</span>) &#123;</span><br><span class="line">   <span class="type">Text</span>(<span class="string">&quot;åœ¨iphoneä¸Šæ˜¾ç¤ºä¸ºæ¨¡æ€æ¡†å¼¹å‡ºé¡µé¢,åœ¨ipadä¸Šæ˜¾ç¤ºä¸ºç‚¹å‡»æ°”æ³¡å¼¹çª—&quot;</span>)</span><br><span class="line">        .padding()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3ro8fw598j21380fatah.jpg"></image></pre>
</details>

<h3 id="Pickers"><a href="#Pickers" class="headerlink" title="Pickers"></a>Pickers</h3><h4 id="Picker"><a href="#Picker" class="headerlink" title="Picker"></a>Picker</h4><p>å¯ä»¥è‡ªå®šä¹‰æ•°æ®çš„é€‰æ‹©å™¨</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">Picker</span>(selection: <span class="variable">$selectIndex</span>) &#123;</span><br><span class="line">  <span class="type">ForEach</span>(fruits, id: \.<span class="keyword">self</span>) &#123; fruit <span class="keyword">in</span></span><br><span class="line">      <span class="type">Text</span>(fruit)</span><br><span class="line">  &#125;</span><br><span class="line">&#125; label: &#123;</span><br><span class="line">  <span class="type">Text</span>(<span class="string">&quot;Picker&quot;</span>)</span><br><span class="line">&#125;.pickerStyle(.wheel) <span class="comment">// ä½¿ç”¨æ­¤æ–¹æ³•åˆ‡æ¢é€‰æ‹©é£æ ¼</span></span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3n2vebx0zj214s0mijv7.jpg"></image></pre>
</details>

<h4 id="DatePicker"><a href="#DatePicker" class="headerlink" title="DatePicker"></a>DatePicker</h4><p>ç³»ç»Ÿå†…ç½®çš„æ—¶é—´é€‰æ‹©å™¨</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">DatePicker</span>(<span class="string">&quot;é€‰æ‹©æ—¥æœŸ&quot;</span>, selection: <span class="variable">$selectDate</span>, displayedComponents: .date)</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3nr7v7zu9j214p0mdjvb.jpg"></image></pre>
</details>

<h4 id="Toggle"><a href="#Toggle" class="headerlink" title="Toggle"></a>Toggle</h4><p>ç±»ä¼¼äºUISwitch,ç”¨äºå¼€å…³é€‰æ‹©</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">Toggle</span>(<span class="string">&quot;å¼€å…³&quot;</span>, isOn: <span class="variable">$open</span>)</span><br><span class="line">.onChange(of: <span class="keyword">open</span>) &#123; newValue <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;åˆ‡æ¢äº†å¼€å…³çŠ¶æ€&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3o0cr0v3mj214q0mdmz8.jpg"></image></pre>
</details>

<h4 id="Slider"><a href="#Slider" class="headerlink" title="Slider"></a>Slider</h4><p>Sliderç›¸å½“äºUIKitä¸­çš„UISliderï¼Œé€šè¿‡ç§»åŠ¨æ»‘æ†å®ç°æŒ‡å®šåŒºåŸŸå’Œé—´éš”çš„æ•°å€¼çš„é€‰æ‹©ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">Slider</span>(value: <span class="variable">$opacity</span>, in: <span class="number">0.1</span> <span class="operator">...</span> <span class="number">1.0</span>, step: <span class="number">0.05</span>).accentColor(.red)</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3p7s7u4plj214v0mf0vu.jpg"></image></pre>
</details>

<h4 id="Stepper"><a href="#Stepper" class="headerlink" title="Stepper"></a>Stepper</h4><p>æ­¥è¿›é€‰æ‹©å™¨</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">Stepper</span>(<span class="string">&quot;æœ‰é™çš„é€‰æ‹©æ•°é‡&quot;</span>, value: <span class="variable">$value</span>, in: <span class="operator">-</span><span class="number">1</span> <span class="operator">...</span> <span class="number">5</span>, step: <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3p82b0ae5j214r0mhace.jpg"></image></pre>
</details>

<h3 id="Alerts"><a href="#Alerts" class="headerlink" title="Alerts"></a>Alerts</h3><h4 id="Alert"><a href="#Alert" class="headerlink" title="Alert"></a>Alert</h4><p>AlertViewå°†è¢«åºŸå¼ƒ,è¢«.alertæ–¹æ³•æ›¿ä»£</p>
<p>swiftUIç»™VIewå¢åŠ äº†.alertçš„æ‰©å±•,ç»™å®šä¸€ä¸ªç»‘å®šçš„å€¼,å½“è¿™ä¸ªå€¼å‘ç”Ÿå˜åŒ–çš„æ—¶å€™(true),è§¦å‘Alertçš„äº‹ä»¶ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">.alert(<span class="string">&quot;Alert Title&quot;</span>, isPresented: <span class="variable">$isPresented1</span>, actions: &#123;</span><br><span class="line">    <span class="type">Button</span>(<span class="string">&quot;OK&quot;</span>)&#123;</span><br><span class="line">        <span class="comment">// buttonç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, message: &#123;</span><br><span class="line">    <span class="type">Text</span>(<span class="string">&quot;ä¸€ä¸ªé€‰æ‹©é¡¹çš„Alert&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å½“actionä¸­çš„buttonæ•°é‡ä¸åŒæ—¶ä¼šè‡ªåŠ¨åˆ‡æ¢alertçš„æ˜¾ç¤ºæ ¼å¼</p>
<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3pcgv2l0dj213s0mgjuh.jpg"></image></pre>
</details>

<h4 id="ActionSheet"><a href="#ActionSheet" class="headerlink" title="ActionSheet"></a>ActionSheet</h4><p>ActionSheetå°†è¢«åºŸå¼ƒ,è¢«.confirmationDialogæ›¿ä»£</p>
<p>SwiftUIç»™VIewå¢åŠ äº†.confirmationDialogçš„æ‰©å±•,ç»™å®šä¸€ä¸ªç»‘å®šçš„å€¼,å½“è¿™ä¸ªå€¼å‘ç”Ÿå˜åŒ–çš„æ—¶å€™(true),è§¦å‘ActionSheetçš„äº‹ä»¶ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">.confirmationDialog(<span class="string">&quot;é€‰æ‹©ä½ éœ€è¦çš„é€‰é¡¹&quot;</span>, isPresented: <span class="variable">$isPresented</span>) &#123;</span><br><span class="line">    <span class="type">Button</span>(<span class="string">&quot;Update&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// choose update</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Button</span>(<span class="string">&quot;Delete&quot;</span>, role: .destructive) &#123;</span><br><span class="line">        <span class="comment">// choose delete</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Button</span>(<span class="string">&quot;Cancel&quot;</span>, role:  .cancel) &#123;</span><br><span class="line">        <span class="comment">// choose cancel</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24egy1h3pctoaj0pj213k0mfaco.jpg"></image></pre>
</details>

<h3 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h3><p>Image,ç±»ä¼¼äºUIImageView,ç›¸å¯¹äºUIimageview,Imageæ§ä»¶å¯ä»¥æ›´åŠ ç®€å•çš„è®¾ç½®åœ†è§’,è¾¹æ¡†,é˜´å½±ç­‰å±æ€§ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">Image</span>(<span class="string">&quot;stmarylake&quot;</span>)</span><br><span class="line">.resizable() <span class="comment">// å¿…é¡»å…ˆè®¾ç½®å¯ä»¥é‡è®¾å°ºå¯¸æ‰å¯ä»¥æ”¹å˜å›¾ç‰‡åŸå§‹å°ºå¯¸</span></span><br><span class="line">.frame(width: <span class="number">100</span>, height: <span class="number">100</span>, alignment: .center)</span><br><span class="line">.clipShape(<span class="type">Rectangle</span>()) <span class="comment">// è¾¹ç¼˜åˆ‡å‰²</span></span><br><span class="line">.overlay(<span class="type">Rectangle</span>().stroke(.white, lineWidth: <span class="number">4</span>), alignment: .bottom)<span class="comment">// è¦†ç›–ä¸€ä¸ªç­‰å¤§å°çš„æ–¹å—å¢åŠ 4çš„å®½åº¦çš„strokeç”¨æ¥åšè¾¹æ¡†</span></span><br><span class="line">.shadow(radius: <span class="number">10</span>)<span class="comment">// é˜´å½±</span></span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3jk79vi59j214p0mf76j.jpg"></image></pre>
</details>

<h3 id="WebImage"><a href="#WebImage" class="headerlink" title="WebImage"></a>WebImage</h3><p>SwiftUIä¸­çš„VIewæ§ä»¶å¯ä»¥æ§åˆ¶å…¶ç”Ÿå‘½å‘¨æœŸ,åœ¨onAppearçš„æ—¶å€™è¿›è¡ŒURLå›¾ç‰‡ä¸‹è½½,ä¸‹è½½æˆåŠŸåæ›¿æ¢imageå³å¯ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">Image</span>(uiImage: baseImage)</span><br><span class="line">.resizable()</span><br><span class="line">.frame(height: <span class="number">200</span>)</span><br><span class="line">.aspectRatio(contentMode: .fit)</span><br><span class="line">.onAppear &#123;</span><br><span class="line">    downloadImageWithURL(url: url)</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">downloadImageWithURL</span>(<span class="params">url</span>: <span class="type">String</span>?) &#123;</span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> urlStr <span class="operator">=</span> url, <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: urlStr) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">  <span class="type">SwiftUIDemoHelper</span>.defult.downLoadImageWithURL(url: url) &#123; receivedSize, totalSize <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">let</span> progress <span class="operator">=</span> <span class="type">Float</span>(receivedSize) <span class="operator">/</span> <span class="type">Float</span>(totalSize)</span><br><span class="line">      downloadTaskProgress <span class="operator">=</span> progress</span><br><span class="line">  &#125; completion: &#123; res <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">switch</span> res &#123;</span><br><span class="line">      <span class="keyword">case</span> .success(<span class="keyword">let</span> img):</span><br><span class="line">          baseImage <span class="operator">=</span> img</span><br><span class="line">          downloadTaskProgress <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">      <span class="keyword">case</span> .failure(<span class="keyword">_</span>):</span><br><span class="line">          downloadError <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3uxv5n357j213q0natdv.jpg"></image></pre>
</details>

<p>å½“ç„¶å¯ä»¥ä½¿ç”¨kfå›¾ç‰‡åº“æ¥è¿›è¡Œç½‘ç»œå›¾ç‰‡çš„ä¸‹è½½å’Œç¼“å­˜ç®¡ç†ã€‚</p>
<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹é•¿æ—¶é—´ä¸‹è½½çš„åŠ è½½æ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3uxr4o7zbg20oo1hcx6p.gif" height = 400></image></pre>
</details>

<h3 id="Webview"><a href="#Webview" class="headerlink" title="Webview"></a>Webview</h3><p>SwiftUIæ²¡æœ‰å†å°è£…ä¸€å¥—æ–°çš„Webviewå®¹å™¨,ç›´æ¥æ¡¥æ¥WKWebViewå³å¯ã€‚</p>
<p>å¦‚ä½•å’ŒUIKitè¿›è¡Œæ¡¥æ¥å‚è€ƒåç»­æ¡¥æ¥éƒ¨åˆ†ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> WebKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WebviewDemo</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> url: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;https://www.baidu.com&quot;</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> pageTitle: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;Webview&quot;</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">       <span class="type">SWWkWebview</span>(url: <span class="variable">$url</span>, pageTitle: <span class="variable">$pageTitle</span>)</span><br><span class="line">            .navigationTitle(pageTitle)</span><br><span class="line">            .navigationBarTitleDisplayMode(.inline)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SWWkWebview</span>: <span class="title class_ inherited__">UIViewRepresentable</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">UIViewType</span> <span class="operator">=</span> <span class="type">WKWebView</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> url: <span class="type">String</span></span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> pageTitle: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIView</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">WKWebView</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> view <span class="operator">=</span> <span class="type">WKWebView</span>()</span><br><span class="line">        view.navigationDelegate <span class="operator">=</span> context.coordinator</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: url) &#123;</span><br><span class="line">            view.load(<span class="type">URLRequest</span>(url: url))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> view</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIView</span>(<span class="keyword">_</span> <span class="params">uiView</span>: <span class="type">WKWebView</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> val <span class="operator">=</span>  <span class="type">Coordinator</span>()</span><br><span class="line">        val.updateTitle <span class="operator">=</span> &#123; title <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.pageTitle <span class="operator">=</span> title</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> val</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span>, <span class="title class_ inherited__">WKNavigationDelegate</span> &#123;</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">var</span> updateTitle: ((<span class="type">String</span>) -&gt; <span class="type">Void</span>)<span class="operator">?</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">webView</span>(<span class="keyword">_</span> <span class="params">webView</span>: <span class="type">WKWebView</span>, <span class="params">didFinish</span> <span class="params">navigation</span>: <span class="type">WKNavigation</span>!) &#123;</span><br><span class="line">            webView.evaluateJavaScript(<span class="string">&quot;document.title&quot;</span>) &#123; (result, error) <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">let</span> title: <span class="type">String</span> <span class="operator">=</span> <span class="type">String</span>(describing: result <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span><br><span class="line">                <span class="keyword">self</span>.updateTitle<span class="operator">?</span>(title)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3uqhsiluvj213m0nc42w.jpg"></image></pre>
</details>

<hr>
<h2 id="æ¡¥æ¥UIKit"><a href="#æ¡¥æ¥UIKit" class="headerlink" title="æ¡¥æ¥UIKit"></a>æ¡¥æ¥UIKit</h2><p>SwiftUIå¯ä»¥è‡ªç”±çš„å’Œå½“å‰é¡¹ç›®ä¸­çš„frameworkåä½œï¼Œä¸è®ºä½ æ˜¯UIKitè¿˜æ˜¯APPKitæˆ–è€…æ˜¯WatchKitã€‚è¿™é‡Œæˆ‘ä»¬ç®€å•è¯´ä¸‹å¦‚ä½•æ¡¥æ¥UIKitã€‚</p>
<h3 id="UIViewRepresentable"><a href="#UIViewRepresentable" class="headerlink" title="UIViewRepresentable"></a>UIViewRepresentable</h3><p>æœ‰ä¸€äº›Viewè¿˜æœªè¢«SwiftUIåŸç”Ÿå®ç°ï¼Œéœ€è¦ä»UIKitä¸­æ¡¥æ¥è€Œæ¥ï¼Œä¾‹å¦‚å‰é¢çš„<a href="#Webview">WebviewDemo</a>ã€‚å½“ç„¶ä¸€äº›è‡ªå·±å°è£…çš„Viewæˆ–è€…ä¸‰æ–¹åº“Viewå‡å¯æ¡¥æ¥åˆ°SwiftUIä¸­å±•ç¤ºã€‚å½“æˆ‘ä»¬éœ€è¦åœ¨SwiftUIä½¿ç”¨UIKitä¸­çš„Viewæ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå®ç°äº†UIViewRepresentableåè®®çš„ç»“æ„ä½“ä½œä¸ºæˆ‘ä»¬çš„æ¡¥æ¥Viewã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">protocol</span> <span class="title class_">UIViewRepresentable</span> : <span class="title class_ inherited__">View</span> <span class="keyword">where</span> <span class="title class_ inherited__">Self</span>.<span class="title class_ inherited__">Body</span> == <span class="title class_ inherited__">Never</span> &#123;</span><br><span class="line">    <span class="comment">/// é¦–å…ˆéœ€è¦ç¡®å®šä½ è¦æ¡¥æ¥çš„Viewçš„ç±»å‹</span></span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">UIViewType</span> : <span class="type">UIView</span></span><br><span class="line">    <span class="comment">/// å¿…é¡»å®ç°çš„åè®®ï¼Œç³»ç»Ÿåœ¨åˆå§‹åŒ–ç»“æ„ä½“çš„æ—¶å€™ä¼šåˆå§‹åŒ–ä½ çš„View</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIView</span>(<span class="params">context</span>: <span class="keyword">Self</span>.<span class="type">Context</span>) -&gt; <span class="keyword">Self</span>.<span class="type">UIViewType</span></span><br><span class="line">    <span class="comment">/// å¿…é¡»å®ç°çš„åè®®ï¼ŒSwiftUIæ›´æ–°çš„æ—¶å€™ä¼šè°ƒç”¨æ­¤æ–¹æ³•è®©ä½ çš„ViewåŒæ­¥æ›´æ–°</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIView</span>(<span class="keyword">_</span> <span class="params">uiView</span>: <span class="keyword">Self</span>.<span class="type">UIViewType</span>, <span class="params">context</span>: <span class="keyword">Self</span>.<span class="type">Context</span>)</span><br><span class="line">    <span class="comment">/// éå¿…é¡»å®ç°çš„åè®®ï¼Œç›¸å½“äº UIView çš„ deinit æ–¹æ³•ï¼Œå¯ä»¥åœ¨å…¶ä¸­åšä¸€äº›è¯¸å¦‚åˆ é™¤é€šçŸ¥ observerï¼Œåœæ­¢ timer ç­‰æ¸…ç†å·¥ä½œ</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">dismantleUIView</span>(<span class="keyword">_</span> <span class="params">uiView</span>: <span class="keyword">Self</span>.<span class="type">UIViewType</span>, <span class="params">coordinator</span>: <span class="keyword">Self</span>.<span class="type">Coordinator</span>)</span><br><span class="line">    <span class="comment">/// åè°ƒå™¨ï¼Œå½“å‰ç»“æ„ä½“ä»UIKitä¸­è·å–æ•°æ®çš„é€”å¾„ï¼Œä¸€èˆ¬ç”¨æ¥å®ç°UIKit View çš„ä»£ç†</span></span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">Coordinator</span> <span class="operator">=</span> <span class="type">Void</span></span><br><span class="line">    <span class="comment">/// åˆ›å»ºä¸€ä¸ªåè°ƒå™¨ï¼Œç”¨æ¥è¿æ¥SwiftUIå’ŒUIKitï¼ŒmakeUIViewä¹‹å‰å°±ä¼šè°ƒç”¨</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="keyword">Self</span>.<span class="type">Coordinator</span></span><br><span class="line">    <span class="comment">/// å­˜å‚¨ä¸€äº›æ•°æ®çš„ä¸Šä¸‹æ–‡</span></span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">Context</span> <span class="operator">=</span> <span class="type">UIViewRepresentableContext</span>&lt;<span class="keyword">Self</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¡¥æ¥è¿‡ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸ºï¼š</p>
<p><img src="https://cdn.zcx.info/e6c9d24ely1h3x76m90gnj20b80buglq.jpg" alt="4"></p>
<p>å…¶ä¸­updateUIViewæ–¹æ³•ä¼šéšç€Viewçš„åˆ·æ–°è°ƒç”¨å¤šæ¬¡ã€‚</p>
<h3 id="UIViewControllerRepresentable"><a href="#UIViewControllerRepresentable" class="headerlink" title="UIViewControllerRepresentable"></a>UIViewControllerRepresentable</h3><p>ç±»ä¼¼äºæ¡¥æ¥UIViewï¼ŒSwiftUIä¹Ÿç»™å‡ºäº†æ¡¥æ¥UIViewControllerçš„æ–¹å¼</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">protocol</span> <span class="title class_">UIViewControllerRepresentable</span> : <span class="title class_ inherited__">View</span> <span class="keyword">where</span> <span class="title class_ inherited__">Self</span>.<span class="title class_ inherited__">Body</span> == <span class="title class_ inherited__">Never</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">UIViewControllerType</span> : <span class="type">UIViewController</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIViewController</span>(<span class="params">context</span>: <span class="keyword">Self</span>.<span class="type">Context</span>) -&gt; <span class="keyword">Self</span>.<span class="type">UIViewControllerType</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIViewController</span>(<span class="keyword">_</span> <span class="params">uiViewController</span>: <span class="keyword">Self</span>.<span class="type">UIViewControllerType</span>, <span class="params">context</span>: <span class="keyword">Self</span>.<span class="type">Context</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="keyword">Self</span>.<span class="type">Coordinator</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">Context</span> <span class="operator">=</span> <span class="type">UIViewControllerRepresentableContext</span>&lt;<span class="keyword">Self</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»å®ç°ä¸Šæ¥çœ‹æ¡¥æ¥Viewå’ŒViewControlleréƒ½æ˜¯åŒä¸€ç§å®ç°æ–¹å¼ï¼Œéƒ½å€ŸåŠ©äº†ç”Ÿæˆä¸€ä¸ªåè°ƒå™¨Coordinatoræ¥è¿æ¥äºŒè€…ã€‚</p>
<hr>
<h2 id="æ•°æ®æµ"><a href="#æ•°æ®æµ" class="headerlink" title="æ•°æ®æµ"></a>æ•°æ®æµ</h2><p>SwiftUIçš„è®¾è®¡ç†å¿µæ˜¯ï¼Œæ‰€æœ‰æ•°æ®<strong>æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª</strong>æ•°æ®æºã€‚ç‰©ç†å†…å­˜ä¸­ä»…ä»…ä¿å­˜ä¸€ä»½æ•°æ®,å…¶ä½™åœ°æ–¹å‡å¼•ç”¨å…¶æŒ‡é’ˆåœ°å€ã€‚</p>
<h3 id="State"><a href="#State" class="headerlink" title="@State"></a>@State</h3><p>SwiftUIä¸­å¤§é‡ä½¿ç”¨ç»“æ„ä½“<code>Struct</code>,ç»“æ„ä½“ä¸­çš„å˜é‡ä¸€èˆ¬æ˜¯ä¸èƒ½ä¿®æ”¹çš„,ä½†æ˜¯åœ¨Viewå±‚çº§ä¸­ä¼šéšç€ç”¨æˆ·æ“ä½œæˆ–è€…å…¶ä»–æ¡ä»¶è§¦å‘æ•°æ®çš„å˜åŒ–,è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¯¥å¦‚ä½•è®©æ•°æ®å˜åŒ–çš„åŒæ—¶ç•Œé¢è·Ÿéšåˆ·æ–°å˜åŒ–å‘¢ã€‚</p>
<p>å¦‚æœè§†å›¾éœ€è¦å­˜å‚¨å®ƒå¯ä»¥ä¿®æ”¹çš„æ•°æ®ï¼Œè¯·ä½¿ç”¨<a href="https://developer.apple.com/documentation/swiftui/state"><code>State</code></a>å±æ€§åŒ…è£…å™¨å£°æ˜ä¸€ä¸ªå˜é‡ã€‚</p>
<p>ä¾‹å¦‚æˆ‘ä»¬åœ¨å¼€å…³Demoä¸­ä½¿ç”¨äº†ç”¨<code>@State</code>åŒ…è£¹ç€çš„<code>open</code>å±æ€§,å½“è§¦å‘å¼€å…³onchangeæ–¹æ³•çš„æ—¶å€™ä¼šç›´æ¥æ”¹å˜openå±æ€§çš„å€¼ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ToggleDemo</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> <span class="keyword">open</span>: <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Form</span>&#123;</span><br><span class="line">            <span class="type">Toggle</span>(<span class="string">&quot;å¼€å…³&quot;</span>, isOn: <span class="variable">$open</span>)</span><br><span class="line">                .onChange(of: <span class="keyword">open</span>) &#123; newValue <span class="keyword">in</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;åˆ‡æ¢äº†å¼€å…³çŠ¶æ€&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;å¼€å…³çŠ¶æ€: <span class="subst">\(<span class="keyword">open</span>.description)</span>&quot;</span>)</span><br><span class="line">        &#125;.navigationTitle(<span class="string">&quot;Toggle&quot;</span>)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šä¿—çš„ç†è§£ä¸ºstructå†…çš„å±æ€§éƒ½æ˜¯ä¸å¯å˜çš„,ä½†æ˜¯å½“ä½ çš„Viewçš„bodyæƒ³è¦ç›‘å¬æŸä¸ªå±æ€§çš„æ—¶å€™å¯ä»¥ç»™è¿™ä¸ªå±æ€§å¢åŠ @Stateä¿®é¥°ç¬¦,è¿™æ ·çš„è¯å°±å¯ä»¥åœ¨structå†…éƒ¨ç›´æ¥ä¿®æ”¹æ­¤å˜é‡è€Œä¸å†ä½¿ç”¨mutating,åŒæ—¶å½“æ­¤å˜é‡å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ä¼šè§¦å‘Viewçš„é‡è½½å’Œåˆ·æ–°ã€‚</p>
<p>åœ¨Stateå•è¯çš„è¯­å¢ƒä¸‹ç†è§£è¿™ä¸ªä¿®é¥°ç¬¦ä¼šæ›´å®¹æ˜“â€“çŠ¶æ€å˜é‡ã€‚å®è´¨ä¸ºå½“ç»“æ„ä½“ä¸­çš„å±æ€§å‘ç”Ÿäº†æ”¹å˜,Swiftä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Structæ¥æ›¿æ¢åŸæ¥çš„Structã€‚è€Œ@State èƒ½å¤Ÿå‘ç°è¿™ç§å˜åŒ–ï¼Œå¹¶è‡ªåŠ¨é‡æ–°åŠ è½½è§†å›¾ã€‚</p>
<p>SwiftUIåœ¨åˆ«çš„å­˜å‚¨ä½ç½®ä¸“é—¨å­˜æ”¾ä½¿ç”¨@Stateä¿®é¥°çš„å˜é‡,æ¥ç»•è¿‡ç»“æ„ä½“çš„é™åˆ¶ã€‚</p>
<p>æ³¨æ„,è¿™ç§ç”¨æ³•ç ´åäº†å¸¸è¯†ä¸­çš„ç»“æ„ä½“çš„è§„åˆ™,@State æ˜¯ä¸“é—¨ä¸ºå­˜å‚¨åœ¨ä¸€ä¸ªç»“æ„ä½“ä¸­çš„ç®€å•å±æ€§è€Œè®¾è®¡çš„,æ‰€ä»¥å°½é‡å°†ä½¿ç”¨@Stateä¿®é¥°çš„å˜é‡è®¾ç½®ä¸ºç§æœ‰çš„(private)ã€‚</p>
<p>å€¼å¾—ä¸€æçš„æ˜¯SwiftUIæ”¯æŒåœ¨ä»»ä½•çº¿ç¨‹å®‰å…¨åœ°ä¿®æ”¹@Stateä¿®é¥°çš„å˜é‡ã€‚</p>
<h3 id="Binding"><a href="#Binding" class="headerlink" title="@Binding"></a>@Binding</h3><p>ç”±ä¸Šä¸€èŠ‚çš„@Stateæˆ‘ä»¬å¯ä»¥åšåˆ°æ•°æ®æºå˜åŒ–çš„æ—¶å€™åˆ·æ–°View,å½“ç„¶æœ‰æ—¶å€™ä¼šå‡ºç°ä¸€äº›ç›¸åçš„åœºæ™¯,æ¯”å¦‚ä¸€äº›Viewçš„æ“ä½œå˜åŒ–äº§ç”Ÿäº†æ–°çš„æ•°æ®éœ€è¦å›ä¼ ç»™å¦ä¸€ä¸ªViewæ˜¾ç¤º,ä¾‹å¦‚ä¹‹å‰çš„WebviewDemoä¸­æ¡¥æ¥Wkwebviewçš„SWWkWebviewç±»ã€‚</p>
<p>åœ¨Wkwebviewçš„WKNavigationDelegateä»£ç†ä¸­å‘ç°WebviewåŠ è½½å®Œæ¯•ä¹‹åæ‰§è¡ŒJSä»£ç æ¥è·å–é¡µé¢çš„æ ‡é¢˜,ç„¶ååå‘ä¼ é€’åˆ°ä¸Šå±‚é¡µé¢çš„å¯¼èˆªæ¡ä¸Šæ˜¾ç¤ºã€‚</p>
<p>è¿™ç§æƒ…å†µé€‚åˆä½¿ç”¨@Bindingä¿®é¥°ç¬¦æ¥ä¿®é¥°å±æ€§è®©SwiftUIçŸ¥æ™“è¿™é‡Œéœ€è¦ä½¿ç”¨æŒ‡é’ˆä¼ é€’,è€Œéå€¼ä¼ é€’(Swiftä¸­çš„structå†…å±æ€§èµ‹å€¼é»˜è®¤æ˜¯å€¼ä¼ é€’)ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">WebviewDemo</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> url: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;https://www.36kr.com&quot;</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> pageTitle: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;Webview&quot;</span> <span class="comment">// é»˜è®¤çš„æ ‡é¢˜,çŠ¶æ€å˜é‡</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">       <span class="type">SWWkWebview</span>(url: <span class="variable">$url</span>, pageTitle: <span class="variable">$pageTitle</span>)<span class="comment">// æ³¨æ„@Bindingçš„å±æ€§éœ€è¦ä½¿ç”¨$ç¬¦å·æ¥ä¼ é€’æŒ‡é’ˆå€¼</span></span><br><span class="line">            .navigationTitle(pageTitle)<span class="comment">// pageTitleæ”¹å˜æ—¶ä¼šæ›´æ–°å¯¼èˆªæ æ ‡é¢˜</span></span><br><span class="line">            .navigationBarTitleDisplayMode(.inline)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SWWkWebview</span>: <span class="title class_ inherited__">UIViewRepresentable</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">UIViewType</span> <span class="operator">=</span> <span class="type">WKWebView</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// @Bindingä¿®é¥°çš„å±æ€§,è¯´æ˜è¿™ä¸ªå±æ€§éœ€è¦æŒ‡é’ˆä¼ é€’,ä¸èƒ½ä½¿ç”¨å€¼ä¼ é€’</span></span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> url: <span class="type">String</span></span><br><span class="line">    <span class="comment">// æŒ‡é’ˆä¼ é€’æ‰èƒ½å¤Ÿåšåˆ°ä¸å¢åŠ åˆ«çš„æ“ä½œå°±èƒ½ç›´æ¥æ”¹å˜å¤–éƒ¨ç¯å¢ƒçš„å±æ€§å€¼</span></span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> pageTitle: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeUIView</span>(<span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">WKWebView</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> view <span class="operator">=</span> <span class="type">WKWebView</span>()</span><br><span class="line">        view.navigationDelegate <span class="operator">=</span> context.coordinator</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> url <span class="operator">=</span> <span class="type">URL</span>(string: url) &#123;</span><br><span class="line">            view.load(<span class="type">URLRequest</span>(url: url))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> view</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">updateUIView</span>(<span class="keyword">_</span> <span class="params">uiView</span>: <span class="type">WKWebView</span>, <span class="params">context</span>: <span class="type">Context</span>) &#123;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">makeCoordinator</span>() -&gt; <span class="type">Coordinator</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> val <span class="operator">=</span>  <span class="type">Coordinator</span>()</span><br><span class="line">        val.updateTitle <span class="operator">=</span> &#123; title <span class="keyword">in</span></span><br><span class="line">            <span class="comment">//è¿™é‡Œæ›´æ–°pageTitleæŒ‡é’ˆæŒ‡å‘çš„å±æ€§çš„å€¼</span></span><br><span class="line">            <span class="keyword">self</span>.pageTitle <span class="operator">=</span> title</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> val</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Coordinator</span>: <span class="title class_ inherited__">NSObject</span>, <span class="title class_ inherited__">WKNavigationDelegate</span> &#123;</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">var</span> updateTitle: ((<span class="type">String</span>) -&gt; <span class="type">Void</span>)<span class="operator">?</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">func</span> <span class="title function_">webView</span>(<span class="keyword">_</span> <span class="params">webView</span>: <span class="type">WKWebView</span>, <span class="params">didFinish</span> <span class="params">navigation</span>: <span class="type">WKNavigation</span>!) &#123;</span><br><span class="line">            webView.evaluateJavaScript(<span class="string">&quot;document.title&quot;</span>) &#123; (result, error) <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">let</span> title: <span class="type">String</span> <span class="operator">=</span> <span class="type">String</span>(describing: result <span class="operator">??</span> <span class="string">&quot;&quot;</span>)</span><br><span class="line">                <span class="comment">// è¿™é‡Œæ¯æ¬¡åŠ è½½é¡µé¢éƒ½è·å–é¡µé¢çš„æ ‡é¢˜,ç„¶åæ‰§è¡Œblockè¿›è¡ŒSWWkWebviewç»“æ„ä½“çš„æ›´æ–°</span></span><br><span class="line">                <span class="keyword">self</span>.updateTitle<span class="operator">?</span>(title)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶@Bindingçš„é“¾æ¥æ˜¯åŒå‘çš„,ä¸ä»…å¯ä»¥ä»ä¸‹å‘ä¸Šä¿®æ”¹æ•°æ®,åœ¨ä¸Šå±‚Viewä¿®æ”¹çš„ä¸‹å±‚Viewç»‘å®šçš„æ•°æ®å±æ€§çš„æ—¶å€™,ä¸‹å±‚Viewä¹Ÿä¼šå—åˆ°å½±å“ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°æ•°æ®æµå‘å›¾:</p>
<p><img src="https://docs-assets.developer.apple.com/published/d98251c2fac9fc4f6843be1e4836cb93/Managing-User-Interface-State-1@2x.png" alt="åŸºæœ¬æ•°æ®æµå‘"></p>
<p>é¦–å…ˆæˆ‘ä»¬åœ¨ä¸Šå±‚Viewä¸­å­˜åœ¨ä¸€ä¸ª@Stateä¿®é¥°çš„çŠ¶æ€å˜é‡,ä¸Šå±‚Viewä¼šè§‚å¯Ÿæ­¤å˜é‡çš„å˜åŒ–éšä¹‹åˆ·æ–°ç•Œé¢,ç›¸åº”åˆ·æ–°çš„Viewå¯èƒ½æ˜¯å¦å¤–ä¸€ä¸ªä¸‹å±‚VIew,ä¸è¿‡è¿™ä¸ªå¹¶ä¸å½±å“æ—¢å®šçš„åˆ·æ–°è§„åˆ™ã€‚è¿™ç§æ•°æ®æµå‘ä¸ºå•å‘ç»‘å®šã€‚</p>
<p>å…¶æ¬¡æˆ‘ä»¬å¯ä»¥æŠŠçŠ¶æ€å˜é‡çš„æŒ‡é’ˆä¼ é€’ç»™ä¸‹å±‚@Bindingä¿®é¥°çš„å±æ€§å˜é‡,å½“ä»»ä½•ä¸€æ–¹ä¿®æ”¹æ­¤å±æ€§çš„æ—¶å€™éƒ½ä¼šè§¦å‘è§‚å¯Ÿè€…æ›´æ–°å…¨éƒ¨çš„Viewã€‚è¿™ç§æ•°æ®æµå‘ä¸ºåŒå‘ç»‘å®šã€‚</p>
<p>ä»ä¸Šå›¾å¯ä»¥è§‚å¯Ÿåˆ°,å½“ä½¿ç”¨@Stateå±æ€§æ¥ä¿®é¥°çš„æ—¶å€™å¯ä»¥è®¤ä¸ºæ­¤å±æ€§ä¸ºå€¼çš„çœŸå®æ¥æº,å½“ä½¿ç”¨@Bindingä¿®é¥°å±æ€§çš„æ—¶å€™å¯ä»¥è®¤ä¸ºæ­¤å±æ€§ä¸ºçœŸå®å€¼çš„æŒ‡é’ˆã€‚</p>
<p>ç±»ä¼¼çš„å½“çœ‹åˆ°å¸¦æœ‰Stateå•è¯çš„ä¿®é¥°ç¬¦æ—¶éƒ½å¯ä»¥è®¤ä¸ºå½“å‰å±æ€§ä¸ºå€¼çš„çœŸå®æ¥æºï¼Œä¸”å½“å‰Viewæ˜¯è¿™ä¸ªå±æ€§çš„åŸå§‹æŒæœ‰è€…ã€‚</p>
<h3 id="ObservableObjectã€-Publishedã€-StateObject"><a href="#ObservableObjectã€-Publishedã€-StateObject" class="headerlink" title="@ObservableObjectã€@Publishedã€@StateObject"></a>@ObservableObjectã€@Publishedã€@StateObject</h3><p>è™½ç„¶Swiftä¸­æ¨èä½¿ç”¨Struct,ä½†æ˜¯Classçš„ä½¿ç”¨è¿˜æ˜¯ä¸å¯ç¼ºå°‘çš„ä¸€ç¯ã€‚ç›¸æ¯”äºç»“æ„ä½“çš„å€¼ä¼ é€’,classé»˜è®¤è¿›è¡Œçš„å°±æ˜¯æŒ‡é’ˆä¼ é€’ã€‚é‚£ä¹ˆæŒ‡é’ˆä¼ é€’çš„Classæ˜¯å¦å°±è‡ªåŠ¨è·å¾—äº†ç±»ä¼¼äº@Stateå’Œ@Bindingçš„åŠŸèƒ½å‘¢?</p>
<p>ç­”æ¡ˆæ˜¯NO</p>
<p>SwiftUIä¸­å¹¶ä¸ä¼šå› ä¸ºä½ ä¼ é€’è¿›æ¥çš„æ˜¯ä¸€ä¸ªç±»å˜é‡å°±é»˜è®¤è‡ªåŠ¨åˆ·æ–°æ˜¾ç¤ºã€‚æƒ³è¦è¾¾åˆ°è¿™æ ·çš„æ•ˆæœå¿…é¡»ä½¿å½“å‰ç±»æ»¡è¶³ObservableObjectåè®®ã€‚</p>
<p>ObservableObjectå­—é¢æ„æ€,å¯è§‚å¯Ÿå¯¹è±¡ã€‚åœ¨ç±»ä¸­å¯ä»¥æ·»åŠ @Publishedä¿®é¥°ç¬¦æ¥å‘Šè¯‰SwiftUIè¿™ä¸ªç±»ä¸­çš„è¿™ä¸ªå±æ€§å¯ä»¥å‘å¸ƒè®¢é˜…ã€‚</p>
<p>ä¾‹å¦‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªå¯ä»¥æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯çš„æ–‡æœ¬å¯ä¸€ä¸ªç‚¹å‡»ä¸€ä¸‹å¢åŠ ä¸€å²çš„æŒ‰é’®ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name <span class="operator">=</span> <span class="string">&quot;Apple&quot;</span></span><br><span class="line">    <span class="keyword">var</span> age <span class="operator">=</span> <span class="number">15</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CustomViews</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> user <span class="operator">=</span> <span class="type">User</span>()</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span>&#123;</span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;å½“å‰çš„ç”¨æˆ·å:<span class="subst">\(user.name)</span>&quot;</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;å½“å‰çš„ç”¨æˆ·å¹´é¾„:<span class="subst">\(user.age)</span>å²&quot;</span>)</span><br><span class="line">                <span class="type">Button</span>(<span class="string">&quot;ä¸€å¹´è¿‡å»äº†&quot;</span>) &#123;</span><br><span class="line">                    user.age <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;ä¸€å¹´åçš„å¹´é¾„:<span class="subst">\(user.age)</span>&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationTitle(<span class="string">&quot;è‡ªå®šä¹‰viewç»„ä»¶&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3w250asb2j213u0mqwgy.jpg"></image></pre>
</details>

<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç‚¹äº†å¾ˆå¤šæ¬¡æŒ‰é’®,å†…å­˜ä¸­çš„ageå­—æ®µå·²ç»å˜æˆäº†25,ç•Œé¢ä¸Šå´ä¾æ—§æ˜¾ç¤ºä¸ºåŸå§‹çš„å€¼,è¿™æ˜¯å› ä¸ºUserç±»æ˜¯ä¸å¯è§‚å¯Ÿçš„,æ‰€ä»¥å½“Userä¸­çš„å­—æ®µå‘ç”Ÿæ”¹å˜çš„æ—¶å€™ä¸èƒ½è§¦å‘é¡µé¢çš„åˆ·æ–°.</p>
<p>ç°åœ¨æˆ‘ä»¬ä¸ºUserç±»å¢åŠ å¯è§‚å¯Ÿå±æ€§</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>: <span class="title class_ inherited__">ObservableObject</span> &#123;</span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> name <span class="operator">=</span> <span class="string">&quot;Apple&quot;</span></span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> age <span class="operator">=</span> <span class="number">15</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CustomViews</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="comment">// ä»¥å‰ä½¿ç”¨@ObservableObjectçš„æ—¶å€™æœ‰userå±æ€§è¢«å¼‚å¸¸é‡Šæ”¾çš„é£é™©,æ”¹ä¸ºä½¿ç”¨@StateObjectä¿®é¥°ç¬¦</span></span><br><span class="line">    <span class="meta">@StateObject</span> <span class="keyword">private</span> <span class="keyword">var</span> user <span class="operator">=</span> <span class="type">User</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span>&#123;</span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;å½“å‰çš„ç”¨æˆ·å:<span class="subst">\(user.name)</span>&quot;</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;å½“å‰çš„ç”¨æˆ·å¹´é¾„:<span class="subst">\(user.age)</span>å²&quot;</span>)</span><br><span class="line">                <span class="type">Button</span>(<span class="string">&quot;ä¸€å¹´è¿‡å»äº†&quot;</span>) &#123;</span><br><span class="line">                    user.age <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;ä¸€å¹´åçš„å¹´é¾„:<span class="subst">\(user.age)</span>&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationTitle(<span class="string">&quot;è‡ªå®šä¹‰viewç»„ä»¶&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<details>
<summary><font color=gray>ç‚¹å‡»æŸ¥çœ‹è¿è¡Œæ•ˆæœ</font> </summary>
  <pre><image src="https://cdn.zcx.info/e6c9d24ely1h3w27hniv2j213o0luad5.jpg"></image></pre>
</details>

<p>å¯ä»¥çœ‹åˆ°éšç€æˆ‘ä»¬çš„ç‚¹å‡»å¢åŠ userçš„ageå­—æ®µå€¼,ç•Œé¢ä¸Šæ˜¾ç¤ºçš„å¹´é¾„æ–‡å­—ä¹Ÿéšä¹‹å¢åŠ .</p>
<p>å½“ç„¶ä½ éœ€è¦ç»™å¯è§‚å¯Ÿçš„å¯¹è±¡å¢åŠ **@StateObject**ä¿®é¥°ç¬¦</p>
<p><strong>ä¸ºä»€ä¹ˆä¸ä½¿ç”¨@ObservedObjectä¿®é¥°ç¬¦å‘¢?</strong></p>
<ol>
<li><p>è¿™å°†ç¡®ä¿ User å®ä¾‹åœ¨è§†å›¾æ›´æ–°æ—¶ä¸ä¼šè¢«ç ´åã€‚ä»¥å‰å¯èƒ½å·²ç»ä½¿ç”¨ @ObservedObject æ¥è·å¾—ç›¸åŒçš„ç»“æœï¼Œä½†è¿™æ˜¯æœ‰é£é™©çš„ã€‚æœ‰æ—¶ @ObservedObject å¯èƒ½ä¼šæ„å¤–é‡Šæ”¾å®ƒæ­£åœ¨å­˜å‚¨çš„å¯¹è±¡ï¼Œå› ä¸ºå®ƒä¸æ˜¯è®¾è®¡ä¸ºæœ€ç»ˆçš„çœŸç›¸æ¥æºç›®çš„ï¼Œä½† @StateObject å°±ä¸ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œå› æ­¤åº”è¯¥æ”¹ç”¨å®ƒã€‚</p>
</li>
<li><p>@StateObject å’Œ @ObservedObject ä¹‹é—´æœ‰ä¸€ä¸ªé‡è¦çš„åŒºåˆ«ï¼Œå³<strong>æ‰€æœ‰æƒ</strong>ï¼Œå“ªä¸ªè§†å›¾åˆ›å»ºäº†å¯¹è±¡ï¼Œå“ªä¸ªè§†å›¾åªæ˜¯åœ¨ç›‘è§†å®ƒã€‚è§„åˆ™æ˜¯è¿™æ ·çš„ï¼šé¦–å…ˆåˆ›å»ºå¯¹è±¡çš„è§†å›¾å¿…é¡»ä½¿ç”¨**@StateObject**ï¼Œå‘Šè¯‰ SwiftUI å®ƒæ˜¯æ•°æ®çš„æ‰€æœ‰è€…å¹¶è´Ÿè´£ä¿æŒå®ƒçš„æ´»åŠ¨ï¼Œæ‰€æœ‰å…¶å®ƒè§†å›¾éƒ½å¿…é¡»ä½¿ç”¨ <strong>@ObservedObject</strong> æ¥å‘Šè¯‰ SwiftUIï¼Œå®ƒä»¬æƒ³è¦è§‚å¯Ÿå¯¹è±¡çš„å˜åŒ–ä½†ä¸ç›´æ¥æ‹¥æœ‰å®ƒã€‚å³æ¯ä¸ªå¯¹è±¡åº”è¯¥åªä½¿ç”¨ä¸€æ¬¡ @StateObjectï¼Œå®ƒåº”è¯¥åœ¨è´Ÿè´£åˆ›å»ºå¯¹è±¡çš„ä»»ä½•è§†å›¾ä¸­ï¼Œå…±äº«å¯¹è±¡çš„æ‰€æœ‰å…¶å®ƒè§†å›¾éƒ½åº”ä½¿ç”¨@ObservedObjectã€‚</p>
</li>
</ol>
<p><strong>æ€è€ƒ1: æˆ‘ä»¬èƒ½å¯¹Classä½¿ç”¨@Stateä¿®é¥°å—?</strong></p>
<p>å¯ä»¥,åªä¸è¿‡ä½¿ç”¨@Stateä¿®é¥°çš„æ—¶å€™åªæœ‰å½“å‰å€¼å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ‰ä¼šè§¦å‘Viewå˜åŒ–,å½“è¢«ä¿®é¥°çš„æ˜¯Classç±»å‹çš„å˜é‡æ—¶,ç±»å†…å®¹çš„å±æ€§æ”¹å˜å¹¶ä¸èƒ½æ”¹å˜å½“å‰ç±»çš„å€¼(æŒ‡é’ˆ).æ‰€ä»¥å¿…é¡»è§¦å‘ç±»çš„å½“å‰å€¼æ”¹å˜çš„æ—¶å€™æ‰èƒ½å’Œè§‚å¯Ÿè€…äº§ç”Ÿä¸€æ ·çš„æ•ˆæœ.</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name <span class="operator">=</span> <span class="string">&quot;Apple&quot;</span></span><br><span class="line">    <span class="keyword">var</span> age <span class="operator">=</span> <span class="number">15</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CustomViews</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">var</span> user <span class="operator">=</span> <span class="type">User</span>()</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationView</span>&#123;</span><br><span class="line">            <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;å½“å‰çš„ç”¨æˆ·å:<span class="subst">\(user.name)</span>&quot;</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;å½“å‰çš„ç”¨æˆ·å¹´é¾„:<span class="subst">\(user.age)</span>å²&quot;</span>)</span><br><span class="line">                <span class="type">Button</span>(<span class="string">&quot;ä¸€å¹´è¿‡å»äº†&quot;</span>) &#123;</span><br><span class="line">                  <span class="comment">// ç›´æ¥ç”Ÿæˆæ–°çš„ç±»,æˆ–è€…åšç±»çš„æ·±æ‹·è´åæ”¹å˜ageæ•°å€¼</span></span><br><span class="line">                    <span class="keyword">let</span> userB <span class="operator">=</span> <span class="type">User</span>()</span><br><span class="line">                    userB.name <span class="operator">=</span> user.name</span><br><span class="line">                    userB.age <span class="operator">=</span> user.age <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">                    user <span class="operator">=</span> userB</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .navigationTitle(<span class="string">&quot;è‡ªå®šä¹‰viewç»„ä»¶&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ€è€ƒ2: æˆ‘ä»¬å¯ä»¥å¯¹ç»“æ„ä½“ä½¿ç”¨@StateObjectå—?</strong></p>
<p>å¾ˆé—æ†¾ä¸èƒ½, å› ä¸º@StateObjectä¿®é¥°ç¬¦å¿…é¡»è¦æ±‚å±æ€§æ»¡è¶³ObservableObjectåè®®,è€Œéclassç±»å‹ä¸èƒ½éµå¾ªåè®®.</p>
<h3 id="EnvironmentObject"><a href="#EnvironmentObject" class="headerlink" title="@EnvironmentObject"></a>@EnvironmentObject</h3><p>æ€è€ƒä¸€ç§åœºæ™¯ï¼Œå¦‚æœæ‚¨æœ‰è§†å›¾ Aï¼Œå¹¶ä¸”è§†å›¾ A æœ‰ä¸€äº›è§†å›¾ E æƒ³è¦çš„æ•°æ®ï¼Œä½¿ç”¨@ObservedObject è§†å›¾ A éœ€è¦å°†å¯¹è±¡äº¤ç»™è§†å›¾ Bï¼Œè§†å›¾ B å°†æŠŠå®ƒäº¤ç»™è§†å›¾ Cï¼Œç„¶åæ˜¯è§†å›¾ Dï¼Œæœ€åæ˜¯è§†å›¾ Eï¼Œæ‰€æœ‰ä¸­é—´è§†å›¾éƒ½éœ€è¦å‘é€å¯¹è±¡ï¼Œå³ä½¿å®ƒä»¬å®é™…ä¸Šå¹¶æ²¡æœ‰éœ€è¦å®ƒã€‚</p>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨@EnvironmentObject ï¼Œè§†å›¾ A å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¹¶å°†å…¶æ”¾å…¥ç¯å¢ƒä¸­ï¼›ç„¶åï¼Œå…¶ä¸­çš„ä»»ä½•è§†å›¾éƒ½å¯ä»¥éšæ—¶é€šè¿‡è¯·æ±‚è®¿é—®è¯¥ç¯å¢ƒå¯¹è±¡ï¼Œè€Œä¸å¿…æ˜¾å¼ä¼ é€’å®ƒï¼Œè¿™æ ·ä¼šä½¿æˆ‘ä»¬çš„ä»£ç æ›´ç®€å•ã€‚</p>
<p>ä¾‹å¦‚ä¹‹å‰çš„Demoç§çš„åˆ—è¡¨æ•°æ®:</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SwiftUIDemoApp</span>: <span class="title class_ inherited__">App</span> &#123;</span><br><span class="line">    <span class="meta">@StateObject</span> <span class="keyword">private</span> <span class="keyword">var</span> features <span class="operator">=</span> <span class="type">FeatureInfoModel</span>()</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">Scene</span> &#123;</span><br><span class="line">        <span class="type">WindowGroup</span> &#123;</span><br><span class="line">            <span class="type">DemoHomeView</span>().environmentObject(features)<span class="comment">//è¿™é‡Œå‘ç¯å¢ƒå˜é‡ä¸­æ·»åŠ äº†ä¸€ä¸ªFeatureInfoModel</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FeatureListHomeView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> feature: <span class="type">FeatureInfoModel</span> <span class="comment">//è¿™ä¸ªviewä»ç¯å¢ƒå˜é‡ä¸­è·å–äº†FeatureInfoModel</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">      <span class="type">NavigationView</span>&#123;</span><br><span class="line">          <span class="type">List</span> &#123;</span><br><span class="line">              <span class="type">ForEach</span>(feature.demoFeatures.featureSections, id: \.<span class="keyword">self</span>) &#123; sec <span class="keyword">in</span></span><br><span class="line">                  <span class="type">Section</span>(sec.featureSectionName) &#123;</span><br><span class="line">                      <span class="type">ForEach</span>(sec.featureList, id: \.<span class="keyword">self</span>) &#123; item <span class="keyword">in</span></span><br><span class="line">                          <span class="type">NavigationLink</span> &#123;</span><br><span class="line">                              getDestinationViews(featureItem: item)</span><br><span class="line">                          &#125; label: &#123;</span><br><span class="line">                              <span class="type">DemoRowView</span>(title: item.featureName, subTitle: item.featureDesc)</span><br><span class="line">                          &#125;</span><br><span class="line">                      &#125;.onDelete &#123; offset <span class="keyword">in</span></span><br><span class="line">                          deleteRow(offset: offset, from: sec)</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;.listStyle(.in<span class="keyword">set</span>)</span><br><span class="line">          .navigationTitle(<span class="string">&quot;åŸºç¡€æ§ä»¶&quot;</span>)</span><br><span class="line">          .navigationBarTitleDisplayMode(.large)</span><br><span class="line">          .toolbar&#123;</span><br><span class="line">              <span class="type">EditButton</span>()</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜æ˜¾DemoHomeViewå’ŒFeatureListHomeViewä¸­é—´é—´éš”äº†ä¸€äº›å…¶ä»–Viewï¼Œç±»ä¼¼äºå…¨å±€å˜é‡å¯ä»¥ç›´æ¥è¯»å–ä½¿ç”¨ã€‚</p>
<p>é€šå¸¸EnvironmentObjectç”¨äºæ•´ä¸ªåº”ç”¨ç¨‹åºä¸­ä¸€äº›Viewéƒ½ä¾èµ–å’Œå…±äº«çš„æ•°æ®ï¼Œå› ä¸ºæ‰€æœ‰çš„è§†å›¾éƒ½æŒ‡å‘åŒä¸€ä¸ªæ¨¡å‹ï¼Œå½“è¢«ä¿®é¥°çš„å±æ€§å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰€æœ‰çš„è§†å›¾éƒ½ä¼šç«‹å³æ›´æ–°ï¼Œæ’é™¤äº†åº”ç”¨ç¨‹åºçš„ä¸åŒéƒ¨åˆ†å‡ºç°ä¸åŒæ­¥çš„é£é™©ã€‚</p>
<h2 id="åº”ç”¨ç¨‹åºè¡Œä¸ºæ§åˆ¶"><a href="#åº”ç”¨ç¨‹åºè¡Œä¸ºæ§åˆ¶" class="headerlink" title="åº”ç”¨ç¨‹åºè¡Œä¸ºæ§åˆ¶"></a>åº”ç”¨ç¨‹åºè¡Œä¸ºæ§åˆ¶</h2><h3 id="UIApplicationDelegate"><a href="#UIApplicationDelegate" class="headerlink" title="UIApplicationDelegate"></a>UIApplicationDelegate</h3><p>ä½œä¸ºä¸€ä¸ªå®Œæ•´çš„APPï¼Œå¼€å‘è€…åº”è¯¥å¯ä»¥æ§åˆ¶APPçš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦ä¸€ä¸ª<a href="https://developer.apple.com/documentation/uikit/uiapplicationdelegate"><code>UIApplicationDelegate</code></a>ç±»å‹çš„å¯¹è±¡æ¥æ‰¿è½½Appç”Ÿå‘½å‘¨æœŸå†…å„ç§è¡Œä¸ºçš„ç›¸åº”ã€‚</p>
<p>ä½†æ˜¯åˆ›å»ºSwiftUIé¡¹ç›®çš„æ—¶å€™Xcodeå¹¶æ²¡æœ‰ç»™æˆ‘ä»¬é»˜è®¤åˆ›å»ºApplegate.swiftæ–‡ä»¶ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬éœ€è¦å®ç°UIApplicationDelegateæ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨åˆ›å»ºApplegate.swiftæ–‡ä»¶ï¼Œå¹¶ä¸”è®©æˆ‘ä»¬çš„Applegateç±»éµå¾ªNSObjectåè®®å’ŒUIApplicationDelegateåè®®ï¼Œç„¶åå®ç°æˆ‘ä»¬éœ€è¦çš„æ–¹æ³•ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">APPDelegate</span>: <span class="title class_ inherited__">NSObject</span>, <span class="title class_ inherited__">UIApplicationDelegate</span>, <span class="title class_ inherited__">ObservableObject</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">application</span>(<span class="keyword">_</span> <span class="params">application</span>: <span class="type">UIApplication</span>,</span><br><span class="line">                     <span class="params">didFinishLaunchingWithOptions</span> <span class="params">launchOptions</span>: [<span class="type">UIApplication</span>.<span class="params">LaunchOptionsKey</span> : <span class="keyword">Any</span>]<span class="operator">?</span> <span class="operator">=</span> <span class="literal">nil</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;didFinishLaunchingWithOptions&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// SwiftUIä¸­ä¸€äº›æ–¹æ³•ä¸èƒ½è§¦å‘</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">applicationDidReceiveMemoryWarning</span>(<span class="keyword">_</span> <span class="params">application</span>: <span class="type">UIApplication</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;log-DidReceiveMemoryWarning&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">applicationDidBecomeActive</span>(<span class="keyword">_</span> <span class="params">application</span>: <span class="type">UIApplication</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;log-applicationDidBecomeActive&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">applicationDidEnterBackground</span>(<span class="keyword">_</span> <span class="params">application</span>: <span class="type">UIApplication</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;log-applicationDidEnterBackground&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ç°äº†ä»£ç†æ–¹æ³•åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å‘Šè¯‰SwiftUIåœ¨å“ªé‡Œå¢åŠ æˆ‘ä»¬çš„ä»£ç†ï¼Œåœ¨@mainå…¥å£çš„structä¸­æ·»åŠ @UIApplicationDelegateAdaptoræ ‡è®°ï¼ŒSwiftUIä¼šè‡ªåŠ¨è¯†åˆ«æˆ‘ä»¬çš„ä»£ç†ç±»ï¼Œå¹¶åœ¨åˆé€‚çš„æ—¶æœºè°ƒç”¨å¯¹åº”çš„ä»£ç†æ–¹æ³•ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@main</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SwiftUIDemoApp</span>: <span class="title class_ inherited__">App</span> &#123;</span><br><span class="line">   </span><br><span class="line">  <span class="meta">@UIApplicationDelegateAdaptor</span> <span class="keyword">private</span> <span class="keyword">var</span> appdelegate: <span class="type">APPDelegate</span></span><br><span class="line">    <span class="comment">//@UIApplicationDelegateAdaptor(APPDelegate.self) var appdelegate è¿™ä¸ªå†™æ³•ä¹Ÿå¯ä»¥</span></span><br><span class="line">   <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯”è¾ƒæ–¹ä¾¿çš„æ˜¯å¦‚æœä½ çš„APPDelegateç±»éµå¾ªäº†ObservableObjectåè®®ï¼ŒSwiftUIä¼šè‡ªåŠ¨æŠŠ@UIApplicationDelegateAdaptorä¿®é¥°çš„å±æ€§æ”¾åˆ°å…¨å±€ç¯å¢ƒå˜é‡é‡Œå»ï¼Œä¾‹å¦‚è¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰å£°æ˜å…¨å±€ç¯å¢ƒå˜é‡ï¼Œä½†æ˜¯åœ¨ä¸‹å±‚çš„Viewä¸­ä¾æ—§å¯ä»¥ä½¿ç”¨å…¨å±€ç¯å¢ƒå˜é‡è·å–ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">FeatureListHomeView</span>: <span class="title class_ inherited__">View</span> &#123;  </span><br><span class="line"> <span class="comment">// è¿™é‡Œå»è·å–ç¯å¢ƒå˜é‡</span></span><br><span class="line"> <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> appdelegate: <span class="type">APPDelegate</span></span><br><span class="line"> <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">NavigationView</span> &#123;</span><br><span class="line">      <span class="operator">...</span></span><br><span class="line">    &#125;.onAppear &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æˆ‘åœ¨Appå†…éƒ¨çš„viewè·å–åˆ°äº†å…¨å±€çš„appdelegateä¸­çš„nameå±æ€§<span class="subst">\(appdelegate.name)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œéšç€APIçš„æ›´æ–°ï¼Œæœ‰äº›ä»£ç†æ–¹æ³•ä¸å†ç”±UIApplicationDelegateè°ƒç”¨ã€‚</p>
<p>ä¾‹å¦‚Appå‰åå°åˆ‡æ¢çš„ä»£ç†ï¼ŒiOS13ä»¥å‰ï¼Œç”±UIApplicationDelegateæ¥æ§åˆ¶ç”Ÿå‘½å‘¨æœŸï¼ŒiOS13ä»¥åï¼Œç”±UISceneDelegateæ¥æ§åˆ¶ç”Ÿå‘½å‘¨æœŸã€‚åœ¨iOS 13ä¹‹åä¸ºäº†è§£å†³iPadOSå±•ç¤ºå¤šçª—å£çš„é—®é¢˜ï¼Œç”¨UISceneæ›¿ä»£äº†ä¹‹å‰UIWindowæ¥ç®¡ç†è§†å›¾ã€‚</p>
<p>iOS14ä»¥åAppleåˆç»™SwiftUIæä¾›äº†æ›´ä¼˜é›…çš„APIæ¥æ˜¾ç¤ºå’Œæ§åˆ¶Sceneã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@main</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SwiftUIDemoApp</span>: <span class="title class_ inherited__">App</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Environment</span>(\.scenePhase) <span class="keyword">var</span> scenePhase</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">Scene</span> &#123;</span><br><span class="line">      <span class="type">WindowGroup</span> &#123;</span><br><span class="line">          <span class="type">DemoHomeView</span>()</span><br><span class="line">      &#125;.onChange(of: scenePhase) &#123; newValue <span class="keyword">in</span></span><br><span class="line">          <span class="keyword">switch</span> newValue &#123;</span><br><span class="line">          <span class="keyword">case</span> .active:</span><br><span class="line">              <span class="built_in">print</span>(<span class="string">&quot;active&quot;</span>)</span><br><span class="line">          <span class="keyword">case</span> .background:</span><br><span class="line">              <span class="built_in">print</span>(<span class="string">&quot;background&quot;</span>)</span><br><span class="line">          <span class="keyword">case</span> .inactive:</span><br><span class="line">              <span class="built_in">print</span>(<span class="string">&quot;inactive&quot;</span>)</span><br><span class="line">          <span class="keyword">@unknown</span> <span class="keyword">default</span>:</span><br><span class="line">              <span class="keyword">break</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="UIWindowSceneDelegate"><a href="#UIWindowSceneDelegate" class="headerlink" title="UIWindowSceneDelegate"></a>UIWindowSceneDelegate</h3><p>å¤šçª—å£ç®¡ç†å’ŒAppä»£ç†ç±»ä¼¼ï¼Œå¹³å¸¸ç”¨çš„è¾ƒå°‘ã€‚</p>
<p>å¦‚æœä½¿ç”¨äº†åœºæ™¯å§”æ‰˜UIWindowSceneDelegateï¼Œä¹Ÿéœ€è¦è‡ªè¡Œåˆ›å»ºå§”æ‰˜æ–‡ä»¶SceneDelegateã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SceneDelegate</span>: <span class="title class_ inherited__">NSObject</span>, <span class="title class_ inherited__">UIWindowSceneDelegate</span>, <span class="title class_ inherited__">ObservableObject</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">windowScene</span>( <span class="keyword">_</span> <span class="params">windowScene</span>: <span class="type">UIWindowScene</span>,<span class="params">performActionFor</span> <span class="params">shortcutItem</span>: <span class="type">UIApplicationShortcutItem</span> ) <span class="keyword">async</span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="comment">// Do something with the shortcut...</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åç›´æ¥åœ¨Appdelegateç±»ä¸­çš„æ–¹æ³•ä¸­è¿”å›åœºæ™¯å§”æ‰˜ç±»å³å¯ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">application</span>(<span class="keyword">_</span> <span class="params">application</span>: <span class="type">UIApplication</span>, <span class="params">configurationForConnecting</span> <span class="params">connectingSceneSession</span>: <span class="type">UISceneSession</span>, <span class="params">options</span>: <span class="type">UIScene</span>.<span class="type">ConnectionOptions</span>) -&gt; <span class="type">UISceneConfiguration</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> configuration <span class="operator">=</span> <span class="type">UISceneConfiguration</span>(name: <span class="literal">nil</span>,sessionRole: connectingSceneSession.role)</span><br><span class="line">  <span class="keyword">if</span> connectingSceneSession.role <span class="operator">==</span> .windowApplication &#123;</span><br><span class="line">      configuration.delegateClass <span class="operator">=</span> <span class="type">SceneDelegate</span>.<span class="keyword">self</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> configuration</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„ï¼Œå¦‚æœä½ çš„SceneDelegateç±»éµå¾ªäº†ObservableObjectåè®®ï¼ŒSwiftUIä¼šè‡ªåŠ¨æŠŠå½“å‰ç±»å‹çš„å±æ€§æ”¾åˆ°ç¯å¢ƒç¯å¢ƒå˜é‡é‡Œå»ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>__block å…³é”®å­—æ¢ç©¶</title>
    <url>/2020/09/23/block/</url>
    <content><![CDATA[<h3 id="block-æ˜¯å¹²ä»€ä¹ˆç”¨çš„"><a href="#block-æ˜¯å¹²ä»€ä¹ˆç”¨çš„" class="headerlink" title="__block æ˜¯å¹²ä»€ä¹ˆç”¨çš„"></a>__block æ˜¯å¹²ä»€ä¹ˆç”¨çš„</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int val = 10;   </span><br><span class="line">MyBlock block = ^&#123;</span><br><span class="line">    NSLog(@&quot;val = %d&quot;,val);</span><br><span class="line">&#125;;</span><br><span class="line">block();</span><br><span class="line">//è¾“å‡º</span><br><span class="line">2020-09-22 14:24:47.018497+0800 MyDemo[2987:2658512] val = 10</span><br></pre></td></tr></table></figure>

<p>ä»ä¸€æ®µç®€å•çš„<code>code</code>è¯´èµ·ï¼Œåœ¨<code>block</code>ä¸­ä¿®æ”¹valçš„å€¼è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>ç›´æ¥åœ¨<code>block</code>ä¸­ä¿®æ”¹ä¼šæŠ¥ç¼–è¯‘é”™è¯¯<code>Variable is not assignable (missing __block type specifier)</code> </p>
<p>æ˜¾è€Œæ˜“è§æˆ‘ä»¬åªéœ€è¦åœ¨<code>val</code>å˜é‡å‰åŠ <code>__block</code>å…³é”®å­—å³å¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">__block int val = 10;</span><br><span class="line">MyBlock block = ^&#123;</span><br><span class="line">    val += 10;</span><br><span class="line">    NSLog(@&quot;val = %d&quot;,val);</span><br><span class="line">&#125;;</span><br><span class="line">block();</span><br><span class="line">//è¾“å‡º</span><br><span class="line">2020-09-22 14:29:38.065700+0800 MyDemo[2991:2660066] val = 20</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬ç®€å•çš„åœ¨<code>block</code>ä¸­ä¿®æ”¹äº†<code>val</code>çš„å€¼ã€‚</p>
<h3 id="block-åŸç†æ€è€ƒæ¨æµ‹"><a href="#block-åŸç†æ€è€ƒæ¨æµ‹" class="headerlink" title="__block åŸç†æ€è€ƒæ¨æµ‹"></a>__block åŸç†æ€è€ƒæ¨æµ‹</h3><p>so whyï¼Ÿç°åœ¨åˆ°äº†æ¢ç©¶å…¶æ‰€ä»¥ç„¶çš„æ—¶å€™äº†ã€‚</p>
<p>ç”±äº<code>objc</code>å°è£…çš„è¾ƒæ·±ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ<code>objc</code>ä»£ç è½¬æ¢æˆ<code>c++</code>ä»£ç ä¸€æ¢ç©¶ç«Ÿ</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">xcrun -sdk iphoneos clang -arch arm64 -rewrite-objc main.m</span><br></pre></td></tr></table></figure>

<p>åœ¨<code>main.m</code>æ–‡ä»¶å¤¹å†…æ‰§è¡Œè¿™æ¡å‘½ä»¤ç”Ÿæˆä¸€ä¸ª<code>main.cpp</code>çš„<code>c++</code>ç±»</p>
<p>åœ¨<code>xcode</code>ä¸­æ‰“å¼€,åœ¨è¯¥ç±»ä¸­æœç´¢<code>main</code>æ–¹æ³•.</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*è¿™ä¸ªæ—¶å€™ä½¿ç”¨çš„æ˜¯è¿™äº›code</span></span><br><span class="line"><span class="comment">int val = 10;   </span></span><br><span class="line"><span class="comment">MyBlock block = ^&#123;</span></span><br><span class="line"><span class="comment">    NSLog(@&quot;val = %d&quot;,val);</span></span><br><span class="line"><span class="comment">&#125;;</span></span><br><span class="line"><span class="comment">block();</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    NSString * appDelegateClassName;</span><br><span class="line">    <span class="comment">/* @autoreleasepool */</span> &#123; __AtAutoreleasePool __autoreleasepool; </span><br><span class="line"></span><br><span class="line">        appDelegateClassName = <span class="built_in">NSStringFromClass</span>(((<span class="built_in">Class</span> (*)(id, SEL))(<span class="type">void</span> *)objc_msgSend)((id)<span class="built_in">objc_getClass</span>(<span class="string">&quot;AppDelegate&quot;</span>), <span class="built_in">sel_registerName</span>(<span class="string">&quot;class&quot;</span>)));</span><br><span class="line">				<span class="comment">// æˆ‘ä»¬å£°æ˜çš„autoå˜é‡</span></span><br><span class="line">        <span class="type">int</span> val = <span class="number">10</span>;</span><br><span class="line">        <span class="comment">// æˆ‘ä»¬å£°æ˜çš„block        </span></span><br><span class="line">        MyBlock block = ((<span class="built_in">void</span> (*)())&amp;__main_block_impl_0((<span class="type">void</span> *)__main_block_func_0, &amp;__main_block_desc_0_DATA, val));</span><br><span class="line">				<span class="comment">// blockçš„è°ƒç”¨</span></span><br><span class="line">        ((<span class="built_in">void</span> (*)(__block_impl *))((__block_impl *)block)-&gt;FuncPtr)((__block_impl *)block);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, __null, appDelegateClassName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>__main_block_impl_0</code>è¿™ä¸ªä¸œè¥¿ï¼Œæ˜¯æˆ‘ä»¬åˆ›å»ºçš„<code>block</code>åœ¨<code>c++</code>é‡Œé¢çš„å®ç°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span><span class="params">(*MyBlock)</span><span class="params">(<span class="type">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">__main_block_impl_0</span> &#123;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">__block_impl</span> impl;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">__main_block_desc_0</span>* Desc;</span><br><span class="line">  <span class="type">int</span> val; <span class="comment">// è¿™ä¸ªåœ°æ–¹çœ‹åˆ°blockå†…éƒ¨æœ‰ç”Ÿæˆä¸€ä¸ªå¯¹è±¡æ¥ä¿å­˜æˆ‘ä»¬åˆ›å»ºçš„valæ¥ä½¿ç”¨</span></span><br><span class="line">  __main_block_impl_0(<span class="type">void</span> *fp, <span class="keyword">struct</span> __main_block_desc_0 *desc, <span class="type">int</span> _val, <span class="type">int</span> flags=<span class="number">0</span>) : <span class="built_in">val</span>(_val) &#123;</span><br><span class="line">    impl.isa = &amp;_NSConcreteStackBlock;</span><br><span class="line">    impl.Flags = flags;</span><br><span class="line">    impl.FuncPtr = fp;</span><br><span class="line">    Desc = desc;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„<code>__block_impl</code>æ˜¯blockæ•°æ®ç»“æ„åœ¨c++çš„å®ç°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">__block_impl</span> &#123;</span><br><span class="line">  <span class="type">void</span> *isa; <span class="comment">// ç”±æ­¤å¯è§blockåœ¨åº•å±‚ä¹Ÿæ˜¯ä¸€ç§objcå¯¹è±¡</span></span><br><span class="line">  <span class="type">int</span> Flags;</span><br><span class="line">  <span class="type">int</span> Reserved;</span><br><span class="line">  <span class="type">void</span> *FuncPtr; <span class="comment">// blocké‡Œä¿å­˜çš„å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜èƒ½æ‰¾åˆ°æˆ‘ä»¬çš„<code>NSLog</code>æ–¹æ³•<code>__main_block_func_0</code></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> __main_block_func_0(<span class="keyword">struct</span> __main_block_impl_0 *__cself) &#123;</span><br><span class="line">  <span class="type">int</span> val = __cself-&gt;val; <span class="comment">// ä»è‡ªèº«çš„ç»“æ„ä½“ä¸­å–å‡ºvalå¯¹è±¡æ¥ä½¿ç”¨</span></span><br><span class="line">	<span class="built_in">NSLog</span>((NSString*)&amp;__NSConstantStringImpl__var_folders_j2__3l5gw_93rz1_jfmq7r7wwph0000gn_T_main_18d90f_mi_0,</span><br><span class="line">      val);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä»è€ŒçŸ¥é“äº†<code>block</code>ä¼šæ•è·<code>auto</code>ç±»å‹çš„å˜é‡åˆ°è‡ªèº«çš„ç»“æ„ä½“ï¼Œè¿™æ—¶å€™ä¼šç”Ÿæˆä¸€ä¸ªæ–°å˜é‡<code>val</code>æ¥ä½¿ç”¨ã€‚</p>
<p>è™½ç„¶æ•è·åˆ°äº†å˜é‡ï¼Œä½†æ˜¯æ­¤å˜é‡éå½¼å˜é‡ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½åœ¨è¿™é‡Œä¿®æ”¹å¤–éƒ¨çš„å€¼ã€‚</p>
<p>å›æƒ³æˆ‘ä»¬é‡è§çš„å„ç§ç±»å‹çš„<code>block</code>æˆ‘ä»¬å‘ç°å£°æ˜ä¸º<code>static</code>çš„å˜é‡ä¸éœ€è¦åŠ <code>__block</code>å°±å¯ä»¥ç›´æ¥ä¿®æ”¹å€¼:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">static int staticVal = 10;        </span><br><span class="line">MyBlock block = ^&#123;</span><br><span class="line">    staticVal += 10;</span><br><span class="line">    NSLog(@&quot;staticVal = %d&quot;,staticVal);</span><br><span class="line">&#125;;</span><br><span class="line">block();</span><br><span class="line">//è¾“å‡º</span><br><span class="line">2020-09-22 14:41:08.103780+0800 MyDemo[3004:2662839] staticVal = 20</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆ<code>static</code>çš„å˜é‡æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿç›¸åº”çš„æˆ‘ä»¬å¯ä»¥çœ‹çœ‹ä»–åœ¨<code>block</code>ç»“æ„ä½“é‡Œé¢åˆ°åº•æ˜¯æ€ä¹ˆåšçš„ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">__main_block_impl_0</span> &#123;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">__block_impl</span> impl;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">__main_block_desc_0</span>* Desc;</span><br><span class="line">  <span class="type">int</span> *staticVal; <span class="comment">// ç”±æ­¤å¯ä»¥çœ‹åˆ°blockæ‹¿åˆ°äº†staticValçš„æŒ‡é’ˆ</span></span><br><span class="line">  __main_block_impl_0(<span class="type">void</span> *fp, <span class="keyword">struct</span> __main_block_desc_0 *desc, <span class="type">int</span> *_staticVal, <span class="type">int</span> flags=<span class="number">0</span>) : <span class="built_in">staticVal</span>(_staticVal) &#123;</span><br><span class="line">    impl.isa = &amp;_NSConcreteStackBlock;</span><br><span class="line">    impl.Flags = flags;</span><br><span class="line">    impl.FuncPtr = fp;</span><br><span class="line">    Desc = desc;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// blockå°è£…çš„æ–¹æ³•</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __main_block_func_0(<span class="keyword">struct</span> __main_block_impl_0 *__cself) &#123;</span><br><span class="line">  <span class="type">int</span> *staticVal = __cself-&gt;staticVal; <span class="comment">// bound by copy</span></span><br><span class="line">	(*staticVal) += <span class="number">10</span>;</span><br><span class="line">  <span class="built_in">NSLog</span>((NSString *)&amp;__NSConstantStringImpl__var_folders_j2__3l5gw_93rz1_jfmq7r7wwph0000gn_T_main_68799d_mi_0,(*staticVal));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°äº†æŒ‡é’ˆå°±æ˜¯æ‹¿åˆ°äº†ä»–,åŸæ¥<code>static</code>ç±»å‹çš„å˜é‡æ˜¯è¿™ä¹ˆåšçš„ï¼Œä»”ç»†æƒ³æƒ³æ˜ç™½åæ­£ä»–ä¼šä¸€ç›´å­˜åœ¨å†…å­˜ä¸­ï¼Œåªè¦æ‹¿åˆ°äº†ä»–çš„æŒ‡é’ˆå°±å¯ä»¥åœ¨ä»»æ„æ—¶é—´è®¿é—®ä»–è€Œä¸ç”¨æ‹…å¿ƒé‡æŒ‡é’ˆçš„é—®é¢˜å•¦ã€‚</p>
<p>é‚£ä¹ˆåªè¦æˆ‘ä»¬æƒ³åŠæ³•èƒ½åœ¨<code>block</code>é‡Œé¢è®¿é—®<code>autoå˜é‡</code>çš„<code>æŒ‡é’ˆ</code>åŒæ—¶ä¿è¯è¿™ä¸ªå˜é‡ä¸ä¼šè¢«<code>é‡Šæ”¾</code>æ˜¯ä¸æ˜¯å°±èƒ½åœ¨<code>block</code>é‡Œé¢ä¿®æ”¹å˜é‡äº†å‘¢ï¼Ÿ</p>
<h3 id="block-åº•å±‚å®ç°éªŒè¯"><a href="#block-åº•å±‚å®ç°éªŒè¯" class="headerlink" title="__block åº•å±‚å®ç°éªŒè¯"></a>__block åº•å±‚å®ç°éªŒè¯</h3><p>ç°åœ¨æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>__block</code>çš„<code>c++</code>å®ç°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">__main_block_impl_0</span> &#123;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">__block_impl</span> impl;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">__main_block_desc_0</span>* Desc;</span><br><span class="line">  __Block_byref_val_0 *val; <span class="comment">// æˆ‘ä»¬å‘ç°è¿™é‡Œå¢åŠ äº†ä¸€ä¸ª__Block_byref_val_0 çš„ç»“æ„ä½“ å¹¶å‘½åä¸ºval</span></span><br><span class="line">  __main_block_impl_0(<span class="type">void</span> *fp, <span class="keyword">struct</span> __main_block_desc_0 *desc, __Block_byref_val_0 *_val, <span class="type">int</span> flags=<span class="number">0</span>) : <span class="built_in">val</span>(_val-&gt;__forwarding) &#123;</span><br><span class="line">    impl.isa = &amp;_NSConcreteStackBlock;</span><br><span class="line">    impl.Flags = flags;</span><br><span class="line">    impl.FuncPtr = fp;</span><br><span class="line">    Desc = desc;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// blockå°è£…çš„æ–¹æ³•</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __main_block_func_0(<span class="keyword">struct</span> __main_block_impl_0 *__cself) &#123;</span><br><span class="line">  __Block_byref_val_0 *val = __cself-&gt;val; <span class="comment">// bound by ref</span></span><br><span class="line">  (val-&gt;__forwarding-&gt;val) += <span class="number">10</span>;<span class="comment">// ä½¿ç”¨valçš„__forwardingæŒ‡é’ˆæ¥æ‹¿valç»“æ„ä½“ä¸­çš„valå¯¹è±¡è¿›è¡Œèµ‹å€¼</span></span><br><span class="line">  <span class="built_in">NSLog</span>((NSString *)&amp;__NSConstantStringImpl__var_folders_j2__3l5gw_93rz1_jfmq7r7wwph0000gn_T_main_00193b_mi_0,  	(val-&gt;__forwarding-&gt;val));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äº<code>__Block_byref_val_0</code>å¯ä»¥æ‰¾åˆ°</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span><span class="params">(*MyBlock)</span><span class="params">(<span class="type">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">__Block_byref_val_0</span> &#123;</span><br><span class="line"> <span class="type">void</span> *__isa;</span><br><span class="line"> __Block_byref_val_0 *__forwarding; <span class="comment">// è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘äº†è‡ªèº«</span></span><br><span class="line"> <span class="type">int</span> __flags;</span><br><span class="line"> <span class="type">int</span> __size;</span><br><span class="line"> <span class="type">int</span> val;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°blockä½¿ç”¨äº†ä¸€ä¸ªå¯¹è±¡<code>__Block_byref_val_0</code>æŠŠ<code>val</code>å¯¹è±¡åŒ…ä½ä¹‹åè¿›è¡Œä½¿ç”¨ã€‚</p>
<p>ä½†æ˜¯è¿™ä¸ªå¯¹è±¡é‡Œé¢çš„valåˆ°åº•æ˜¯ä¸æ˜¯æˆ‘ä»¬å®šä¹‰çš„é‚£ä¸ªå‘¢ï¼Ÿ</p>
<p>è¿™é‡Œå¯ä»¥æŠŠ<code>c++</code>çš„ç»“æ„ä½“æ‹·è´åˆ°<code>objc</code>ä¸­è¿›è¡Œä¸€æ¬¡è½¬æ¢å°±èƒ½æ‹¿åˆ°è¿™ä¸ªå¯¹è±¡äº†</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">__Block_byref_val_0</span> &#123;</span><br><span class="line"> <span class="type">void</span> *__isa; </span><br><span class="line"> <span class="keyword">struct</span> <span class="title class_">__Block_byref_val_0</span> *__forwarding; </span><br><span class="line"> <span class="type">int</span> __flags; </span><br><span class="line"> <span class="type">int</span> __size;</span><br><span class="line"> <span class="type">int</span> val; </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">__block_impl</span> &#123;</span><br><span class="line">  <span class="type">void</span> *isa;</span><br><span class="line">  <span class="type">int</span> Flags;</span><br><span class="line">  <span class="type">int</span> Reserved;</span><br><span class="line">  <span class="type">void</span> *FuncPtr;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="keyword">struct</span> <span class="title class_">__main_block_desc_0</span> &#123;</span><br><span class="line">  <span class="type">size_t</span> reserved;</span><br><span class="line">  <span class="type">size_t</span> Block_size;</span><br><span class="line">  <span class="built_in">void</span> (*copy)(<span class="type">void</span>);</span><br><span class="line">  <span class="built_in">void</span> (*dispose)(<span class="type">void</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">__main_block_impl_0</span> &#123;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">__block_impl</span> impl;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">__main_block_desc_0</span>* Desc;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">__Block_byref_val_0</span> *val; <span class="comment">// by ref</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">__block <span class="type">int</span> val = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">MyBlock block = ^&#123;</span><br><span class="line">    val += <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">NSLog</span>(@<span class="string">&quot;val = %d&quot;</span>,val);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">block</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">__main_block_impl_0</span> * blockImpl = (__bridge <span class="keyword">struct</span> __main_block_impl_0 *) block; <span class="comment">//è¿™é‡Œåšä¸€ä¸ªæ¡¥æ¥ï¼ˆå¯¹è±¡è½¬æ¢ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(@<span class="string">&quot;val = %p&quot;</span>,&amp;val);</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬åœ¨<code>debug</code>çš„æ–­ç‚¹è¿›æ¥çš„æ—¶å€™å»æ‰¾<code>blockImpl</code>ä¸­valå¯¹è±¡çš„åœ°å€,å†å¯¹æ¯”æ‰“å°å‡ºæ¥çš„<code>val</code>çš„åœ°å€</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2020-09-22 16:57:00.771793+0800 MyDemo[3028:2688246] val = 20</span><br><span class="line">(lldb) p/x &amp;(blockImpl-&gt;val-&gt;val)</span><br><span class="line">(int *) $0 = 0x00000002811c36f8</span><br><span class="line">2020-09-22 16:57:05.581925+0800 MyDemo[3028:2688246] val = 0x2811c36f8</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>__main_block_impl_0</code>å¯¹è±¡ä¸­çš„<code>val</code>å¯¹è±¡çš„<code>val</code>å­—æ®µçš„åœ°å€å’Œæˆ‘ä»¬å®šä¹‰çš„<code>val</code>çš„åœ°å€ç›¸åŒã€‚</p>
<p>è‡³æ­¤,æˆ‘ä»¬æ˜ç™½äº†__blockæ˜¯å¦‚ä½•è¿ä½œçš„ã€‚</p>
<h3 id="blockæ˜¯å¦‚ä½•ä¿è¯autoå˜é‡ä¸è¢«é‡Šæ”¾çš„"><a href="#blockæ˜¯å¦‚ä½•ä¿è¯autoå˜é‡ä¸è¢«é‡Šæ”¾çš„" class="headerlink" title="__blockæ˜¯å¦‚ä½•ä¿è¯autoå˜é‡ä¸è¢«é‡Šæ”¾çš„"></a>__blockæ˜¯å¦‚ä½•ä¿è¯autoå˜é‡ä¸è¢«é‡Šæ”¾çš„</h3><p>ä»ä¸Šé¢æ¥çœ‹ æˆ‘ä»¬å·²ç»èƒ½åœ¨blockå†…éƒ¨æ‹¿åˆ°autoå˜é‡çš„åœ°å€äº†ï¼Œé‚£ä¹ˆåªè¦èƒ½ä¿è¯blockç”Ÿå‘½å‘¨æœŸä¸­è¿™ä¸ªå˜é‡ä¸ä¼šè¢«é‡Šæ”¾æ‰å°±å¯ä»¥å®ç°åœ¨blockä¸­ä¿®æ”¹ä»–çš„å€¼äº†ï¼çœ‹èµ·æ¥ç¦»æˆ‘ä»¬çš„ç›®æ ‡ä¸è¿œäº†ã€‚</p>
<p>å†æŠŠç›®å…‰æŠ•å‘main.cppæ–‡ä»¶,æˆ‘ä»¬å¯ä»¥å‘ç°ä¸‰ä¸ªæ–¹æ³•</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> __main_block_copy_0(<span class="keyword">struct</span> __main_block_impl_0*dst, <span class="keyword">struct</span> __main_block_impl_0*src) &#123;_Block_object_assign((<span class="type">void</span>*)&amp;dst-&gt;val, (<span class="type">void</span>*)src-&gt;val, <span class="number">8</span><span class="comment">/*BLOCK_FIELD_IS_BYREF*/</span>);&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __main_block_dispose_0(<span class="keyword">struct</span> __main_block_impl_0*src) &#123;_Block_object_dispose((<span class="type">void</span>*)src-&gt;val, <span class="number">8</span><span class="comment">/*BLOCK_FIELD_IS_BYREF*/</span>);&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="keyword">struct</span> <span class="title class_">__main_block_desc_0</span> &#123;</span><br><span class="line">  <span class="type">size_t</span> reserved;</span><br><span class="line">  <span class="type">size_t</span> Block_size;</span><br><span class="line">  <span class="built_in">void</span> (*copy)(<span class="keyword">struct</span> __main_block_impl_0*, <span class="keyword">struct</span> __main_block_impl_0*); </span><br><span class="line">  <span class="built_in">void</span> (*dispose)(<span class="keyword">struct</span> __main_block_impl_0*);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ARCç¯å¢ƒä¸‹,ç³»ç»Ÿä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æŠŠåœ¨æ ˆä¸­çš„è®¿é—®<code>auto</code>å˜é‡çš„<code>block</code>ç»™<code>copy</code>åˆ°å †ä¸Šå»ã€‚</p>
<p>åœ¨æ‰§è¡Œ<code>copy</code>æ–¹æ³•çš„æ—¶å€™<code>block</code>ä¼šæ‰§è¡Œ <code>__main_block_copy_ </code>æ–¹æ³•å¯¹<code>__main_block_impl_</code>å¯¹è±¡è¿›è¡Œä¸€æ¬¡å¼ºå¼•ç”¨ã€‚è¯¥æ–¹æ³•ä¸­æ‰§è¡Œäº†<code>_Block_object_assign</code>å¯¹åŒ…è£¹<code>val</code>çš„å¯¹è±¡è¿›è¡Œ<code>retain</code>æ“ä½œ,è¿™é‡Œæç„¶å¤§æ‚Ÿ,æ˜ç™½ä¸ºä»€ä¹ˆ<code>block</code>å®¹æ˜“å¯¼è‡´<code>å¾ªç¯å¼•ç”¨</code>å’Œ<code>å†…å­˜æ³„æ¼</code>äº†ã€‚</p>
<p>å¯¹åº”çš„,åœ¨<code>block</code>å°†è¦é‡Šæ”¾çš„æ—¶å€™æ‰§è¡Œ<code>__main_block_dispose_</code>æ–¹æ³•æ¥é‡Šæ”¾<code>__main_block_impl_</code>å¯¹è±¡ã€‚</p>
<h3 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h3><p><code>__forwarding</code>æŒ‡é’ˆä¸ºä»€ä¹ˆä¼šæŒ‡å‘è‡ªå·±,æŒ‡å‘è‡ªèº«çš„æŒ‡é’ˆæ˜¯å¦å¤šä½™å‘¢ï¼Ÿ</p>
<p>åè¿‡æ¥çœ‹ï¼Œå¦‚æœåœ¨blockå¤–éƒ¨ä¿®æ”¹æ‰<code>__block</code>ä¿®é¥°çš„å˜é‡çš„å€¼æ—¶<code>block</code>å†…éƒ¨çš„<code>__Block_byref_val_0</code>çš„<code>val</code>å€¼ä¼šè·Ÿéšæ”¹å˜å—ï¼Ÿä¼šæ”¹å˜çš„è¯åˆæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>iOS ä¸€é”®å”¤èµ·APPæ–¹æ¡ˆå‚è€ƒ</title>
    <url>/2021/12/06/iOS%20Web%E5%94%A4%E8%B5%B7APP%E6%96%B9%E6%A1%88%E5%8F%82%E8%80%83/</url>
    <content><![CDATA[<h2 id="iOS-ä¸€é”®å”¤èµ·APPæ–¹æ¡ˆå‚è€ƒ"><a href="#iOS-ä¸€é”®å”¤èµ·APPæ–¹æ¡ˆå‚è€ƒ" class="headerlink" title="iOS ä¸€é”®å”¤èµ·APPæ–¹æ¡ˆå‚è€ƒ"></a>iOS ä¸€é”®å”¤èµ·APPæ–¹æ¡ˆå‚è€ƒ</h2><p>ç§»åŠ¨ç«¯ä¸šåŠ¡å‘å±•è¿‡ç¨‹ä¸­ï¼Œå‡ ä¹æ¯ä¸ªå…¬å¸éƒ½ä¼šæœ‰æ´»åŠ¨å®£ä¼ æˆ–è€…è¿è¥å¼•æµçš„éœ€æ±‚ã€‚è¿™äº›éœ€æ±‚çš„å®ç°ä¸å¤–ä¹å¼€å‘ä¸€äº›å¸å¼•äººçš„HTMLé¡µé¢ï¼Œåœ¨é¡µé¢çš„æŸäº›äº‹ä»¶çš„å“åº”ä¸­å¼•å¯¼ç”¨æˆ·ä¸‹è½½APPæˆ–è€…æ‰“å¼€å·²ç»ä¸‹è½½çš„APPã€‚</p>
<p>åŸºæœ¬æµç¨‹ä¸ºï¼š</p>
<ol>
<li><p>ç­–åˆ’è¿è¥æŠ•æ”¾æ´»åŠ¨é“¾æ¥ï¼ˆæ–°ç”¨æˆ·é€çº¢åŒ…æˆ–è€…PDDç ä¸€åˆ€ï¼‰</p>
</li>
<li><p>ç”¨æˆ·ç‚¹å‡»æ´»åŠ¨é“¾æ¥è¿›å…¥æ´»åŠ¨é¡µé¢</p>
</li>
<li><p>ç”¨æˆ·è¢«å¸å¼•æˆ–è¯±å¯¼ç‚¹å‡»æŸä¸ªæŒ‰é’®è§¦å‘äº‹ä»¶</p>
</li>
<li><p>H5é¡µé¢è°ƒèµ·ç›¸å…³APP</p>
</li>
<li><p>APPå“åº”è°ƒèµ·å¹¶æ¥åŠ›æ‰“å¼€å¯¹åº”é¡µé¢</p>
</li>
</ol>
<p>æˆ‘ä»¬è¿™é‡Œä¸»è¦è¯´ä¸€è¯´4ã€5ä¸¤æ­¥å…¶ä¸­çš„ç»†èŠ‚å¤„ç†ï¼Œä¹Ÿæ˜¯å¯¹æœ€è¿‘ç›¸å…³çš„ä¸šåŠ¡çš„ä¸€ä¸ªæ€»ç»“ã€‚</p>
<h3 id="DeepLinkæŠ€æœ¯"><a href="#DeepLinkæŠ€æœ¯" class="headerlink" title="DeepLinkæŠ€æœ¯"></a>DeepLinkæŠ€æœ¯</h3><p>åœ¨<code>iOS9</code>ä¹‹å‰åªæœ‰é€šè¿‡<code>URL Scheme</code>èƒ½å¤Ÿå”¤èµ·ä¸€ä¸ªAPPã€‚</p>
<p><code>Scheme</code>å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªAPPçš„åå­—ï¼Œå› ä¸ºæ˜¯<code>URL Scheme</code>æ‰€ä»¥éµå¾ªURLçš„ä¹¦å†™æ ¼å¼ï¼Œç±»æ¯”äº<code>http://www.baidu.com</code>ï¼Œå…¶ä¸­<code>http</code>å°±æ˜¯å®ƒçš„<code>Scheme</code>ã€‚</p>
<p>æ¯ä¸ªAPPå¯ä»¥è®¾ç½®è‡ªå·±çš„Schemeï¼Œå³ç»™è‡ªå·±èµ·ä¸ªåå­—ï¼Œæ–¹ä¾¿â€åˆ«äººâ€œå«æˆ‘çš„æ—¶å€™æˆ‘å¯ä»¥å¬å¾—æ‡‚ã€‚</p>
<p>ä¾‹å¦‚æˆ‘ä»¬èµ·äº†ä¸ª<code>Scheme</code>å«<code>kr</code>ï¼Œé‚£ä¹ˆåœ¨H5é¡µé¢å†…å¯ä»¥é€šè¿‡ <code>openURL()</code>çš„æ–¹å¼æ‰“å¼€ <code>kr://testPage</code>é“¾æ¥è°ƒèµ·æˆ‘ä»¬çš„APPï¼Œå½“ç„¶å¦‚æœä½ çŸ¥é“åˆ«äººçš„<code>Scheme</code>å°±å¯ä»¥è°ƒèµ·ä»–çš„APPã€‚</p>
<p>è¿™ä¸ªæ—¶å€™å°±éœ€è¦H5å’ŒAPPçº¦å®šå¥½è¿æ¥çš„<code>path</code>å’Œ<code>parameter</code>ï¼ŒAPPç«¯æ ¹æ®è°ƒèµ·çš„é“¾æ¥ä¸­çš„<code>Path</code>æ¥ç¡®å®šè¦è·³è½¬çš„ç›®çš„é¡µï¼Œæ ¹æ®ä¼ å‚æ¥è·å–éœ€è¦çš„æ•°æ®æ¯”å¦‚æ–‡ç« IDã€ç”¨æˆ·IDç­‰ï¼Œç„¶åæ ¹æ®å‚æ•°åŠ è½½åŸç”Ÿé¡µé¢ã€‚è¿™æ ·å°±å®Œæˆäº†ä»H5åˆ°åŸç”ŸAPPçš„æ¥åŠ›è·³è½¬ã€‚</p>
<hr>
<h4 id="å¦‚ä½•ç»™è‡ªå·±çš„APPâ€èµ·åâ€ï¼Ÿ"><a href="#å¦‚ä½•ç»™è‡ªå·±çš„APPâ€èµ·åâ€ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç»™è‡ªå·±çš„APPâ€èµ·åâ€ï¼Ÿ"></a>å¦‚ä½•ç»™è‡ªå·±çš„APPâ€èµ·åâ€ï¼Ÿ</h4><p>æ³¨å†ŒURL Schemeï¼Œå³é…ç½®info.plist æ–‡ä»¶</p>
<p><img src="https://cdn.zcx.info/008i3skNly1gv92vcxu6jj60u206ewex02.jpg"></p>
<h4 id="å¦‚ä½•å“åº”è¢«è°ƒç”¨çš„è·³è½¬"><a href="#å¦‚ä½•å“åº”è¢«è°ƒç”¨çš„è·³è½¬" class="headerlink" title="å¦‚ä½•å“åº”è¢«è°ƒç”¨çš„è·³è½¬"></a>å¦‚ä½•å“åº”è¢«è°ƒç”¨çš„è·³è½¬</h4><p>æ£€æµ‹åˆ°H5å‘è‡ªå·±å‘èµ·äº†è°ƒç”¨è¯·æ±‚ï¼Œæˆ‘ä»¬éœ€è¦å¯¹è¯·æ±‚è¿›è¡Œå“åº”ã€‚åœ¨AppDelegateç±»ä¸­é€šè¿‡ç³»ç»Ÿé¢„ç•™æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// iOS9ä¹‹å‰ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¤„ç†å¤–éƒ¨URLè°ƒç”¨ </span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">application</span>(<span class="keyword">_</span> <span class="params">application</span>: <span class="type">UIApplication</span>, <span class="params">handleOpen</span> <span class="params">url</span>: <span class="type">URL</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>iOS9ä¹‹åä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¤„ç†å¤–éƒ¨URLè°ƒç”¨ï¼Œç¤ºä¾‹ä»£ç ä¸­å±•ç¤ºäº†è‹¥å¹²ä¸ªå¯ä»¥è°ƒèµ·APPçš„é€”å¾„ï¼Œæ ¹æ®å…·ä½“çš„è·¯å¾„å’Œå‚æ•°æ¥å¤„ç†ä¸åŒçš„é€»è¾‘ã€‚ </p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">application</span>(<span class="keyword">_</span> <span class="params">app</span>: <span class="type">UIApplication</span>, <span class="params">open</span> <span class="params">url</span>: <span class="type">URL</span>, <span class="params">options</span>: [<span class="type">UIApplication</span>.<span class="params">OpenURLOptionsKey</span> : <span class="keyword">Any</span>]) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">  <span class="comment">// ä¸‰æ–¹ç™»å½•å›è°ƒ</span></span><br><span class="line">  <span class="keyword">if</span> <span class="type">LoginSettings</span>.handleOpenURL(url) <span class="operator">??</span> <span class="literal">false</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç¥ç­–SDKå›è°ƒ</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">let</span> sensor <span class="operator">=</span> <span class="type">SensorsAnalyticsSDK</span>.sharedInstance(), sensor.handleSchemeUrl(url) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// zfbæ”¯ä»˜å›è°ƒ</span></span><br><span class="line">  <span class="keyword">if</span> url.host <span class="operator">==</span> <span class="type">Constants</span>.<span class="type">KrOpenAppSource</span>.<span class="type">AliPayHost</span> &#123;</span><br><span class="line">      <span class="type">KrThirdPayManager</span>.default.processOrderWithZfbPaymentResult(url: url)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Todayå°ç»„ä»¶ç‚¹å‡»</span></span><br><span class="line">  <span class="keyword">if</span> url.host <span class="operator">==</span> <span class="type">Constants</span>.<span class="type">KrOpenAppSource</span>.<span class="type">TodayExtensionHost</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">let</span> queryItems <span class="operator">=</span> url.queryItems, <span class="operator">!</span>queryItems.isEmpty &#123;</span><br><span class="line">          <span class="keyword">if</span> <span class="keyword">let</span> query <span class="operator">=</span> url.queryItems<span class="operator">?</span>.first &#123;</span><br><span class="line">              <span class="keyword">if</span> <span class="keyword">let</span> route <span class="operator">=</span> query.value, query.name <span class="operator">==</span> <span class="type">Constants</span>.<span class="type">KrOpenAppSource</span>.<span class="type">TodayExtensionQueryNews</span> &#123;</span><br><span class="line">                  <span class="type">Router2</span>.pushURL(route, <span class="type">TrackInfo</span>(source: <span class="type">TrackSource</span>.todayExtension))</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// widgetå°ç»„ä»¶ç‚¹å‡»</span></span><br><span class="line">  <span class="keyword">if</span> url.host <span class="operator">==</span> <span class="type">Constants</span>.<span class="type">KrOpenAppSource</span>.<span class="type">WidgetExtensionHost</span> &#123;</span><br><span class="line">      <span class="type">Router2</span>.pushURL(urlStr, <span class="type">TrackInfo</span>(source: <span class="type">TrackSource</span>.widgetExtension))</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// URL Scheme å”¤èµ·app</span></span><br><span class="line">  <span class="keyword">if</span> canAppHandleURL(url) &#123;</span><br><span class="line">      <span class="keyword">let</span> urlString <span class="operator">=</span> url.description</span><br><span class="line">      <span class="keyword">let</span> tempArray <span class="operator">=</span> urlString.components(separatedBy: <span class="string">&quot;route/&quot;</span>)</span><br><span class="line">      <span class="keyword">if</span> <span class="operator">!</span>tempArray.isEmpty, tempArray.count <span class="operator">&gt;</span> <span class="number">0</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> route <span class="operator">=</span> tempArray[<span class="number">1</span>]</span><br><span class="line">          <span class="type">Router2</span>.pushURL(route, <span class="type">TrackInfo</span>(source: <span class="type">TrackSource</span>.linkedMe))</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// app store å”¤èµ·</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">let</span> sourceApp <span class="operator">=</span> options[<span class="type">UIApplication</span>.<span class="type">OpenURLOptionsKey</span>.sourceApplication] <span class="keyword">as?</span> <span class="type">String</span>,</span><br><span class="line">     sourceApp <span class="operator">==</span> <span class="type">Constants</span>.<span class="type">KrOpenAppSource</span>.<span class="type">AppStore</span> &#123;</span><br><span class="line">      <span class="type">TrackManager</span>.track(event: .appLaunch)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¤„ç†æ—§ç‰ˆå¾®ä¿¡é€šè¿‡URLå¯åŠ¨Appæ—¶ä¼ é€’çš„æ•°æ®</span></span><br><span class="line">  <span class="keyword">if</span> url.scheme <span class="operator">==</span> <span class="type">ShareManager</span>.<span class="type">Wechat</span>.appID &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="type">WXApi</span>.handleOpen(url, delegate:<span class="keyword">self</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="DeepLinkçš„å±€é™æ€§"><a href="#DeepLinkçš„å±€é™æ€§" class="headerlink" title="DeepLinkçš„å±€é™æ€§"></a>DeepLinkçš„å±€é™æ€§</h4><h5 id="æ— æ³•æ£€æµ‹ç›®æ ‡APPæ˜¯å¦å®‰è£…"><a href="#æ— æ³•æ£€æµ‹ç›®æ ‡APPæ˜¯å¦å®‰è£…" class="headerlink" title="æ— æ³•æ£€æµ‹ç›®æ ‡APPæ˜¯å¦å®‰è£…"></a>æ— æ³•æ£€æµ‹ç›®æ ‡APPæ˜¯å¦å®‰è£…</h5><blockquote>
<p>æˆ‘çŸ¥é“ä½ å«ä»€ä¹ˆå°±å¯ä»¥è°ƒèµ·ä½ ï¼Œä½†æ˜¯æˆ‘ä¸çŸ¥é“ä½ åœ¨ä¸åœ¨ã€‚</p>
</blockquote>
<p>H5æ— æ³•è·å–APPæ˜¯å¦å·²ç»å®‰è£…è¿‡ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†çš„å¤„ç†æ–¹æ¡ˆæ˜¯åœ¨å‘èµ·è°ƒç”¨APPçš„é“¾æ¥ä¹‹åå‡ ç§’ç›´æ¥è·³è½¬åˆ°å¯¹åº”APPçš„ä¸‹è½½é¡µé¢ã€‚</p>
<p>å³å¦‚æœèƒ½å¤Ÿè°ƒèµ·APPï¼Œç”¨æˆ·å°±ä¸ä¼šå†å…³æ³¨H5é¡µé¢ï¼Œ H5é¡µé¢è·³åˆ°å“ªé‡Œç”¨æˆ·ä¹Ÿçœ‹ä¸è§ã€‚</p>
<p>åä¹‹å°±ç¨ç­‰ä¸€ä¸‹è·³è½¬åˆ°APPçš„ä¸‹è½½é¡µé¢å¼•å¯¼ç”¨æˆ·ä¸‹è½½ã€‚</p>
<h5 id="Schemeå†²çª"><a href="#Schemeå†²çª" class="headerlink" title="Schemeå†²çª"></a>Schemeå†²çª</h5><blockquote>
<p>å’Œä½ å«å‘¨æ°ä¼¦æˆ‘ä¹Ÿå«å‘¨æ°ä¼¦ä¸€æ ·ï¼Œå¤§å®¶éƒ½æ˜¯å‘¨æ°ä¼¦ã€‚</p>
<p>å½“å‘¨æ°ä¼¦çœŸæ­£å›åº”ä½ çš„å‘¼å”¤çš„æ—¶å€™ä½ æ‰çŸ¥é“ä½ è°ƒèµ·çš„æ˜¯å“ªä¸ªå‘¨æ°ä¼¦ï¼ŒçœŸ~è–›å®šè°”çš„å‘¨æ°ä¼¦â€¦</p>
</blockquote>
<p>ç”±äºæ¯å®¶çš„APPéƒ½è‡ªå·±æ³¨å†Œè‡ªå·±çš„URL Schemeï¼Œæ‰€ä»¥æœ‰å¯èƒ½å‡ºç°ä¸¤å®¶APPçš„URL Schemeæ³¨å†Œçš„ä¸€æ ·çš„æƒ…å†µã€‚å½“ä¸¤ä¸ªAPPéƒ½å®‰è£…ä¹‹åå°±ä¼šå‡ºç°é—®é¢˜ï¼Œä¸ç¡®å®šè°ƒèµ·çš„æ˜¯å“ªä¸ªAPPã€‚</p>
<h5 id="è°ƒèµ·æµç¨‹å†—ä½™ä¸”å¯èƒ½è¢«é˜»æ–­"><a href="#è°ƒèµ·æµç¨‹å†—ä½™ä¸”å¯èƒ½è¢«é˜»æ–­" class="headerlink" title="è°ƒèµ·æµç¨‹å†—ä½™ä¸”å¯èƒ½è¢«é˜»æ–­"></a>è°ƒèµ·æµç¨‹å†—ä½™ä¸”å¯èƒ½è¢«é˜»æ–­</h5><blockquote>
<p>å°†åœ¨xxxä¸­æ‰“å¼€é¡µé¢ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ</p>
</blockquote>
<p>ç”±äºæ˜¯ä½¿ç”¨jsæ–¹æ³•openURLæ¥è°ƒèµ·çš„APPï¼Œåœ¨è°ƒèµ·ä¹‹å‰ç³»ç»Ÿä¼šè¯¢é—®ä½ æ˜¯å¦åœ¨xxxAPPä¸­æ‰“å¼€è¿æ¥ã€‚</p>
<p>è¿™ä¸ªè¯¢é—®æ˜¯ä¸€ä¸ªæ¯”è¾ƒçªå…€çš„alertå¼¹çª—ï¼Œæ‰€ä»¥åœ¨ä¸çŸ¥æƒ…çš„ç”¨æˆ·çœ‹æ¥å¯èƒ½ä¼šè®¤ä¸ºå­˜åœ¨ä¸€å®šçš„é£é™©ä»è€Œå–æ¶ˆæ‰“å¼€å¯¼è‡´å”¤èµ·APPä¸­æ–­ã€‚å¦‚æœåœ¨è¿™é‡Œä¸­æ–­åˆ™ç”¨æˆ·ææœ‰å¯èƒ½ä¼šç›´æ¥è¿”å›ä¸Šä¸€é¡µæˆ–è€…ç›´æ¥å–æ¶ˆæ•´ä¸ªæ“ä½œï¼Œå‰åŠŸå°½å¼ƒï¼</p>
<h3 id="UniversalLinkæŠ€æœ¯"><a href="#UniversalLinkæŠ€æœ¯" class="headerlink" title="UniversalLinkæŠ€æœ¯"></a>UniversalLinkæŠ€æœ¯</h3><blockquote>
<p>Seamlessly link to content inside your app, or on your website in iOS 9 or later. With universal links, you can always give users the most integrated mobile experience, even when your app isnâ€™t installed on their device.</p>
<p>è‹¹æœå¼€å‘æ–‡æ¡£</p>
</blockquote>
<p><code>UniversalLink </code>æŠ€æœ¯æ˜¯è‹¹æœåœ¨<code>iOS9</code>ä¹‹åæ¨å‡ºçš„ä¸€ç§ä½¿ç”¨<code>HTTPS</code>åè®®çš„ï¼Œå¯ä»¥æ–¹ä¾¿å¾—ä½¿ç”¨å·²ç»å­˜åœ¨çš„é“¾æ¥åŒæ—¶æ‰“å¼€ç½‘å€å’Œå”¤èµ·APPçš„æ–°åŠŸèƒ½ã€‚</p>
<p>ç›¸å¯¹äºDeepLinkæŠ€æœ¯æ¥è¯´ï¼ŒUniversalLinkåœ¨ä½¿ç”¨ä½“éªŒä¸Šæ˜¯ç±»ä¼¼çš„ã€‚æ˜æ˜¾åŒºåˆ«åœ¨äºç”¨æˆ·ç‚¹å‡»äº†æ”¯æŒçš„é€šç”¨é“¾æ¥åä¼šç›´æ¥è°ƒèµ·APPï¼Œè¿›å…¥APPå†…éƒ¨å¤„ç†é€»è¾‘ï¼Œè€Œä¸ä¼šå†å¼¹èµ·æç¤ºä¿¡æ¯å¼¹çª—ä»¥è¾¾åˆ°ä»H5é¡µé¢æ— ç¼è¡”æ¥åˆ°APPå†…éƒ¨çš„æ•ˆæœã€‚ï¼ˆå¯èƒ½ä¼šåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨UniversalLinkæ—¶è¿˜ä¼šå¼¹çª—ï¼Œä½†æ˜¯æˆæƒä¹‹åå°±ä¸å†å¼¹å‡ºäº†ï¼‰</p>
<h4 id="UniversalLinkçš„ä¼˜ç‚¹"><a href="#UniversalLinkçš„ä¼˜ç‚¹" class="headerlink" title="UniversalLinkçš„ä¼˜ç‚¹"></a>UniversalLinkçš„ä¼˜ç‚¹</h4><p>ä½†æ˜¯ç›¸å¯¹äº<code>DeepLink</code>æŠ€æœ¯ï¼Œ<code>UniversalLink</code>æŠ€æœ¯è¿˜å…·æœ‰ç€ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p>
<p><strong>å”¯ä¸€</strong>ï¼šä¸è‡ªå®šä¹‰<code>URL</code>æ–¹æ¡ˆä¸åŒï¼Œå…¶ä»–åº”ç”¨æ— æ³•å£°æ˜é€šç”¨é“¾æ¥ï¼Œå› ä¸ºé€šç”¨é“¾æ¥ä½¿ç”¨çš„æ˜¯æŒ‡å‘æ‚¨ç½‘ç«™çš„æ ‡å‡†<code>HTTP</code>æˆ–<code>HTTPS</code>é“¾æ¥</p>
<blockquote>
<ul>
<li><strong>Unique.</strong> Unlike custom URL schemes, universal links canâ€™t be claimed by other apps, because they use standard HTTP or HTTPS links to your website.</li>
</ul>
</blockquote>
<p>æ¯ä¸ªAPPæ§åˆ¶è‡ªèº«å¯ä»¥æ”¯æŒçš„é€šç”¨é“¾æ¥çš„åŸŸåï¼Œç”±äºåŸŸåçš„æ³¨å†Œå’Œè§£æéƒ½å…·æœ‰å”¯ä¸€æ€§ï¼Œé€šç”¨é“¾æ”¯æŒçš„åŸŸåä¸€å®šä¸ä¼šå‡ºç°å’Œåˆ«å®¶APPé‡å¤çš„æƒ…å†µã€‚</p>
<hr>
<p><strong>å®‰å…¨</strong>ï¼šå½“ç”¨æˆ·å®‰è£…æ‚¨çš„åº”ç”¨ç¨‹åºæ—¶ï¼ŒiOSä¼šæ£€æŸ¥æ‚¨å·²ä¸Šä¼ åˆ°WebæœåŠ¡å™¨çš„æ–‡ä»¶ï¼Œä»¥ç¡®ä¿æ‚¨çš„ç½‘ç«™å…è®¸æ‚¨çš„åº”ç”¨ç¨‹åºä»£è¡¨å…¶æ‰“å¼€URLã€‚åªæœ‰æ‚¨å¯ä»¥åˆ›å»ºå’Œä¸Šä¼ æ­¤æ–‡ä»¶ï¼Œå› æ­¤æ‚¨çš„ç½‘ç«™ä¸åº”ç”¨ç¨‹åºçš„å…³è”æ˜¯å®‰å…¨çš„ã€‚</p>
<blockquote>
<ul>
<li><strong>Secure.</strong> When users install your app, iOS checks a file that youâ€™ve uploaded to your web server to make sure that your website allows your app to open URLs on its behalf. Only you can create and upload this file, so the association of your website with your app is secure.</li>
</ul>
</blockquote>
<p>é€šç”¨é“¾æ¥çš„åŸŸåé…ç½®å†™åœ¨é¡¹ç›®ä¸­ä¸”æ¯ä¸ªå¯ä»¥æ”¯æŒé€šç”¨é“¾çš„åŸŸåéƒ½éœ€è¦ä¸Šä¼ ä¸€ä»½æä¾›åˆ¤æ–­æ˜¯å¦æ»¡è¶³é€šç”¨é“¾æ¥å¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚</p>
<p>é…ç½®æ–‡ä»¶è§„å®šäº†æ”¯æŒé€šç”¨é“¾åŠŸèƒ½çš„åŸŸååçš„pathå’Œå¯ä»¥è°ƒèµ·çš„APPï¼Œæ¯”å¦‚é…ç½®æ–‡ä»¶ä¸­è§„å®šäº†<code>www.abc.com/app/UniversalLink/*</code>è¿™ä¸ªè·¯å¾„å¯ä»¥æ‰“å¼€<code>abcAPP</code>ï¼Œé‚£ä¹ˆåªæœ‰è®¿é—®å¯¹åº”çš„é“¾æ¥æ‰èƒ½è°ƒèµ·å¯¹åº”çš„APPã€‚</p>
<hr>
<p><strong>çµæ´»</strong>ï¼šå³ä½¿æœªå®‰è£…æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œé€šç”¨é“¾æ¥ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚å¦‚æœæœªå®‰è£…æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œç‚¹å‡»æŒ‡å‘æ‚¨ç½‘ç«™çš„é“¾æ¥å¯åœ¨Safariä¸­æ‰“å¼€å†…å®¹ã€‚</p>
<blockquote>
<ul>
<li><strong>Flexible.</strong> Universal links work even when your app is not installed. When your app isnâ€™t installed, tapping a link to your website opens the content in Safari, as users expect.</li>
</ul>
</blockquote>
<p>ä¸ç”¨ç®¡ç”¨æˆ·æ˜¯å¦å®‰è£…äº†å¯¹åº”çš„APPï¼Œå¦‚æœæ²¡æœ‰å®‰è£…å¯¹åº”çš„APPï¼Œç”¨æˆ·ç‚¹å‡»çš„é“¾æ¥ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„é¡µé¢åœ°å€ï¼Œä¼šåœ¨æµè§ˆå™¨ä¸­ç»§ç»­æ‰“å¼€æ‰€ç‚¹å‡»çš„é“¾æ¥å‘ˆç°å‡ºå¯¹åº”çš„å†…å®¹ã€‚</p>
<p>å¸¸è§„çš„åšæ³•æ˜¯åœ¨æŸä¸ªé€šç”¨é“¾é“¾æ¥çš„åœ°å€ä¸Šæ”¾APPçš„ä¸‹è½½å¼•å¯¼é¡µï¼Œå¦‚æœç”¨æˆ·æœªå®‰è£…APPè€Œç‚¹å‡»äº†é€šç”¨é“¾æ¥å°±ä¼šç›´æ¥è·³è½¬åˆ°ä¸‹è½½é¡µã€‚</p>
<p>å¯¹äºiOSç”¨æˆ·æ¥è¯´è¿™ä¸ªä¸‹è½½é¡µä¹Ÿå¯ä»¥å°è¯•é‡å®šå‘åˆ°<code>App Store</code>çš„é€šç”¨é“¾æ¥ã€‚<code>App Store</code>å¯¹æ¯ä¸ªAPPçš„ä¸‹è½½é¡µé¢éƒ½æä¾›äº†å¯ç”¨çš„é€šç”¨é“¾æ¥ï¼Œé‡å®šå‘åˆ°<code>App Store</code>é€šç”¨é“¾ä¼šç›´æ¥è°ƒèµ·åº”ç”¨å•†åº—ä¸”æ‰“å¼€APPä¸‹è½½é¡µã€‚</p>
<hr>
<p><strong>ç®€å•</strong>ï¼šä¸€ä¸ªURLæ—¢é€‚ç”¨äºæ‚¨çš„ç½‘ç«™ï¼Œä¹Ÿé€‚ç”¨äºæ‚¨çš„åº”ç”¨ç¨‹åºã€‚</p>
<blockquote>
<ul>
<li><strong>Simple.</strong> One URL works for both your website and your app.</li>
</ul>
</blockquote>
<p>ä¸€ä¸ªæ­£å¸¸ä½¿ç”¨çš„URLå³å¯å½“åšé€šç”¨é“¾åŠŸèƒ½è¿›è¡Œé…ç½®ï¼ŒåŒæ—¶ä¸å½±å“å…¶æœ¬èº«çš„é¡µé¢å’ŒåŠŸèƒ½ã€‚</p>
<hr>
<p><strong>ç§æœ‰</strong>ï¼šå…¶ä»–åº”ç”¨ç¨‹åºå¯ä»¥ä¸æ‚¨çš„åº”ç”¨ç¨‹åºé€šä¿¡ï¼Œè€Œæ— éœ€çŸ¥é“æ‚¨çš„åº”ç”¨ç¨‹åºæ˜¯å¦å·²å®‰è£…ã€‚</p>
<blockquote>
<ul>
<li><strong>Private.</strong> Other apps can communicate with your app without needing to know whether your app is installed.</li>
</ul>
</blockquote>
<p>é€šç”¨é“¾å¯ä»¥æš´éœ²ç»™åˆ«çš„åº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œåƒæ‰“å¼€æ™®é€šçš„webviewä¸€æ ·çš„æ–¹å¼è°ƒèµ·APPï¼Œè€Œä¸ç”¨å…³å¿ƒä½ æ˜¯å¦çœŸæ­£ä¸‹è½½äº†APPã€‚ä½ çš„é€šç”¨é“¾çš„åŠŸèƒ½å’Œè®¾ç½®å¯¹å…¶ä»–APPæ¥è¯´æ˜¯é€æ˜çš„ã€‚</p>
<hr>
<p><strong>çŸ­ä¿¡ã€å¤‡å¿˜å½•ã€é‚®ä»¶å†…éƒ¨å‡å¯ä½¿ç”¨</strong>ï¼š</p>
<blockquote>
<p>ä½¿ç”¨é€šç”¨é“¾çš„ä¸€å¤§ä¼˜åŠ¿ã€‚</p>
</blockquote>
<p>åœ¨iOSç³»ç»Ÿè‡ªå¸¦çš„çŸ­ä¿¡ã€å¤‡å¿˜å½•ç”šè‡³é‚®ä»¶å†…çš„ç½‘é¡µé“¾æ¥çš„ç‚¹å‡»ä¹Ÿå¯ä»¥æ­£å¸¸è°ƒèµ·APPï¼Œè¿™æ ·å‘é€ç»™ç”¨æˆ·çš„å¼•æµçŸ­ä¿¡æˆ–è€…é‚®ä»¶ä¸­å‡å¯é™„å¸¦å¯¹åº”æ´»åŠ¨çš„é“¾æ¥ï¼Œå¦‚æœç”¨æˆ·æœ‰å®‰è£…æˆ‘ä»¬çš„APPï¼Œåœ¨ç‚¹å‡»é“¾æ¥æ—¶å¯ä»¥ç›´æ¥å¯¼å‘åˆ°APPå†…éƒ¨å¯¹åº”çš„æ´»åŠ¨é¡µé¢ï¼Œä¸å†éœ€è¦Safariåšä¸­é—´äººè§’è‰²ã€‚å¦‚æœç”¨æˆ·æœªå®‰è£…APPåˆ™è·³åˆ°å¯¹åº”çš„æ´»åŠ¨é¡µé¢ï¼Œç„¶åé‡å®šå‘åˆ°App Storeçš„ä¸‹è½½é¡µã€‚</p>
<hr>
<h4 id="å¦‚ä½•é…ç½®UniversalLink"><a href="#å¦‚ä½•é…ç½®UniversalLink" class="headerlink" title="å¦‚ä½•é…ç½®UniversalLink"></a>å¦‚ä½•é…ç½®UniversalLink</h4><p>ç½‘ä¸Šå¾ˆå¤šæœ‹å‹éƒ½åˆ†äº«äº†ä»–ä»¬é…ç½®UniversalLinkçš„è¿‡ç¨‹ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯å»ºè®®å»è‹¹æœå®˜ç½‘ä¸ŠæŒ‰ç…§æœ€æ–°çš„æ–‡æ¡£è¯´æ˜è¿›è¡Œé…ç½®ã€‚</p>
<p><a href="https://developer.apple.com/documentation/xcode/supporting-associated-domains">Support Universal Links</a></p>
<blockquote>
<ul>
<li>Create an <code>apple-app-site-association</code> file that contains JSON data about the URLs that your app can handle.</li>
<li>Upload the <code>apple-app-site-association</code> file to your HTTPS web server. You can place the file at the root of your server or in the <code>.well-known</code> subdirectory.</li>
<li>Prepare your app to handle universal links.</li>
</ul>
</blockquote>
<p>å¤§ä½“ä¸Šåˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤:</p>
<ol>
<li><p>åœ¨xcodeçš„Associated Domainsé…ç½®é¡¹ä¸­æ·»åŠ ä½ éœ€è¦æ˜ å°„çš„é“¾æ¥</p>
<p>ä¸€èˆ¬éœ€è¦å…ˆå»å¼€å‘è€…è´¦å·çš„ç®¡ç†ç½‘ç«™ä¸Šä¸ºAPPæ ¹è¯ä¹¦å¼€é€šè¿™ä¸ªåŠŸèƒ½ï¼Œç„¶ååœ¨XCodeä¸Šè¿›è¡ŒåŸŸåé…ç½®ã€‚</p>
<p><img src="https://cdn.zcx.info/008i3skNly1gvw7qzmkjdj30zn07lglw.jpg"></p>
</li>
<li><p>åˆ›å»º<code>apple-app-site-association</code>æ–‡ä»¶å¹¶ç¼–è¾‘é…ç½®</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;applinks&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;apps&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;details&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;appID&quot;</span><span class="punctuation">:</span> <span class="string">&quot;9JA89QQLNQ.com.apple.wwdc&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;/wwdc/news/&quot;</span><span class="punctuation">,</span> <span class="string">&quot;/videos/wwdc/2015/*&quot;</span><span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;appID&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ABCD1234.com.apple.wwdc&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;*&quot;</span> <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>The <code>appIDs</code> and <code>apps</code> keys specify the application identifiers for the apps that are available for use on this website along with their service types. Use the following format for the values in these keys:</p>
<p><Application Identifier Prefix>.<Bundle Identifier></p>
<p>å‰ç¼€ä½¿ç”¨APPId å¯ä»¥åœ¨ App Store Connectç½‘ç«™ä¸Šæ‰¾åˆ°APPçš„idï¼Œåé¢æ˜¯APPçš„Bundle IDï¼Œå¯ä»¥åœ¨Xcodeç­¾åç®¡ç†çš„åœ°æ–¹æ‰¾</p>
</blockquote>
</li>
<li><p>å°†<code>apple-app-site-association</code>æ–‡ä»¶æ”¾åœ¨é“¾æ¥çš„åŸŸåæœåŠ¡æ ¹ç›®å½•ä¸‹</p>
<p>è¿™ä¸ªæ–‡ä»¶ä½¿ç”¨jsonæ ¼å¼ä½†æ˜¯å¹¶ä¸èƒ½è®¾ç½®.jsonæ‰©å±•åï¼Œä»…ä»…ä½œä¸ºçº¯æ–‡æœ¬æ–‡ä»¶æ”¾åœ¨å¯¹åº”é“¾æ¥åŸŸåä¸‹çš„æ ¹ç›®å½•æˆ–è€…<code>.well-known</code>ç›®å½•ä¸‹ï¼Œä»¥æ–¹ä¾¿ç³»ç»Ÿè®¿é—®åˆ°é…ç½®ã€‚</p>
<p>æ¯”å¦‚ä½ å…³è”çš„åŸŸåä¸º <a href="http://www.test.com/">www.test.com</a> ï¼Œå°±éœ€è¦æŠŠ<code>apple-app-site-association</code>æ–‡ä»¶æ”¾åœ¨æœåŠ¡å™¨çš„æ ¹ç›®å½•ä¸‹ï¼Œåœ¨æµè§ˆå™¨è®¿é—®</p>
<p><a href="https://www.test.com/apple-app-site-association">https://www.test.com/apple-app-site-association</a> é“¾æ¥å¯ä»¥ä¸‹è½½æ­¤æ–‡ä»¶æˆ–è€…ç›´æ¥æ‰“å¼€æ­¤æ–‡ä»¶ã€‚</p>
</li>
</ol>
<h4 id="é…ç½®UniversalLinkéœ€è¦æ³¨æ„çš„é—®é¢˜"><a href="#é…ç½®UniversalLinkéœ€è¦æ³¨æ„çš„é—®é¢˜" class="headerlink" title="é…ç½®UniversalLinkéœ€è¦æ³¨æ„çš„é—®é¢˜"></a>é…ç½®UniversalLinkéœ€è¦æ³¨æ„çš„é—®é¢˜</h4><ol>
<li>é…ç½®<code>apple-app-site-association</code>çš„åŸŸåå¿…é¡»æ”¯æŒHTTPSï¼Œä¸”è®¿é—®çš„é“¾æ¥æ²¡æœ‰è¢«é‡å®šå‘</li>
<li>æ¯ä¸ªè¢«é“¾æ¥çš„åŸŸåä¸‹éƒ½è¦æœ‰è‡ªèº«çš„é…ç½®<code>apple-app-site-association</code>æ–‡ä»¶ï¼Œ<strong><code>www.test.com</code>å’Œ <code>test.com</code> ä¸æ˜¯åŒä¸€ä¸ªåŸŸå</strong>ï¼Œå¦‚æœéœ€è¦æ¯ä¸ªåŸŸåéƒ½éœ€è¦é€šç”¨é“¾æ¥åŠŸèƒ½åˆ™éœ€è¦æ¯ä¸ªåŸŸåä¸‹éƒ½é…ç½®ä¸€ä¸ªå¯¹åº”çš„æ–‡ä»¶ã€‚<strong>å¦‚æœè¿™ä¸¤ä¸ªåŸŸåæœ‰é‡å†™è§„åˆ™ä¸”å±äºåŒä¸€å°æœåŠ¡å™¨åˆ™ä¼šä¼˜å…ˆç”Ÿæ•ˆ<code>www.test.com</code>è€Œå¿½ç•¥<code>test.com</code></strong>ã€‚ï¼ˆè™½ç„¶å¤§éƒ¨åˆ†å…¬å¸éƒ½æ˜¯å°†test.comé‡å†™ä¸º<a href="http://www.test.com,ä½†æ˜¯ä¹Ÿæœ‰ä¸ºäº†seoåå‘é‡å†™çš„ä¾‹å­)/">www.test.comï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸ºäº†SEOåå‘é‡å†™çš„ä¾‹å­ï¼‰</a></li>
<li>ä» macOS 11 å’Œ iOS 14 å¼€å§‹ï¼Œåº”ç”¨ç¨‹åºä¸å†ç›´æ¥å‘æ‚¨çš„ç½‘ç»œæœåŠ¡å™¨è¯·æ±‚<code>apple-app-site-association</code>æ–‡ä»¶ã€‚ç›¸åï¼Œä»–ä»¬å°†è¿™äº›è¯·æ±‚å‘é€åˆ°ä¸“ç”¨äºå…³è”åŸŸçš„ Apple ç®¡ç†çš„å†…å®¹äº¤ä»˜ç½‘ç»œ (CDN)ã€‚æ‰€ä»¥åœ¨APPå¯åŠ¨é˜¶æ®µä¸ä¼šæŠ“åˆ°å¯¹åº”åŸŸåå’Œè·¯å¾„çš„è¯·æ±‚äº†ã€‚</li>
<li>ç¬¬ä¸€æ¬¡å®‰è£…APPçš„æ—¶å€™è‹¹æœCDNæœåŠ¡ä¼šåœ¨24 å°æ—¶å†…ä¸ºæ‚¨çš„åŸŸè¯·æ±‚<code>apple-app-site-association</code>æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œéç¬¬ä¸€æ¬¡å®‰è£…æ—¶æ¯å‘¨æ£€æŸ¥ä¸€æ¬¡é€šç”¨é“¾é…ç½®æ›´æ–°ã€‚</li>
</ol>
<h3 id="ç‰¹æ®Šçš„å¾®ä¿¡ç¯å¢ƒ"><a href="#ç‰¹æ®Šçš„å¾®ä¿¡ç¯å¢ƒ" class="headerlink" title="ç‰¹æ®Šçš„å¾®ä¿¡ç¯å¢ƒ"></a>ç‰¹æ®Šçš„å¾®ä¿¡ç¯å¢ƒ</h3><p>é‰´äºå›½å†…çš„ç½‘ç»œç¤¾äº¤å¤§ç¯å¢ƒåŸºæœ¬ä»¥å¾®ä¿¡ä¸ºä¸­å¿ƒï¼Œæ‰€ä»¥æ¯ä¸ªAPPçš„å¼•æµéƒ½ç»•ä¸å¼€å¾®ä¿¡ç”Ÿæ€ç¯å¢ƒã€‚</p>
<p>è€Œå¾®ä¿¡å±äºåº”ç”¨å±‚APPï¼Œå¹¶ä¸èƒ½åƒæ“ä½œç³»ç»Ÿä¸€æ ·å¼€æ”¾ï¼ŒåŸºäºå®‰å…¨æ€§è€ƒè™‘ï¼Œå¾®ä¿¡é’ˆå¯¹Deeplinkå’ŒUniversalLinkå‡åšäº†ä¸åŒç¨‹åº¦çš„å±è”½ã€‚</p>
<h4 id="å®‰å…¨åŸŸåå›è°ƒ"><a href="#å®‰å…¨åŸŸåå›è°ƒ" class="headerlink" title="å®‰å…¨åŸŸåå›è°ƒ"></a>å®‰å…¨åŸŸåå›è°ƒ</h4><p>åœ¨å¾®ä¿¡å†…éƒ¨æµè§ˆå™¨ä¸­æ˜¯æ— æ³•ç›´æ¥è°ƒèµ·Deeplinkçš„ï¼Œä¸€èˆ¬é€šè¿‡å¾®ä¿¡åˆ†äº«å‡ºé“¾æ¥å¡ç‰‡ï¼Œæ‰“å¼€ç›®çš„é¡µé¢åå†é€šè¿‡å¾®ä¿¡å¼€æ”¾å¹³å°æä¾›çš„å®‰å…¨åŸŸååŠŸèƒ½æ¥åšDeeplinkè°ƒç”¨ã€‚</p>
<p>jsè°ƒç”¨å®‰å…¨åŸŸåä¸‹çš„DeepLinkåä¼šé€šè¿‡å¾®ä¿¡çš„onReqå›è°ƒæ¥æ¥æ”¶è¯·æ±‚ï¼Œç„¶åè§£æä¼ é€’çš„æ•°æ®è¿›è€Œåšå‡ºé¡µé¢è·³è½¬åŠŸèƒ½ã€‚</p>
<p>å¤§ä½“çš„é€»è¾‘å¦‚ä¸‹</p>
<p><img src="https://cdn.zcx.info/008i3skNly1gw4bj7l2lej31280u0411.jpg" alt="å¾®ä¿¡ç¯å¢ƒä¸‹ä½¿ç”¨DeepLinkæµç¨‹"></p>
<h4 id="é€šç”¨é“¾è·³è½¬"><a href="#é€šç”¨é“¾è·³è½¬" class="headerlink" title="é€šç”¨é“¾è·³è½¬"></a>é€šç”¨é“¾è·³è½¬</h4><p>è€Œé’ˆå¯¹UniversalLinkçš„å±è”½åˆ™è¡¨ç°ä¸ºæ— æ³•é€šè¿‡UniversalLinkè°ƒèµ·APPï¼Œåªèƒ½æ‰“å¼€å¯¹åº”çš„è½åœ°é¡µã€‚ä¸è¿‡æœ€è¿‘ç”±äºæŸäº›æ”¿ç­–çš„è°ƒæ•´ï¼Œå¾®ä¿¡é’ˆå¯¹UniversalLinkçš„å±è”½å·²ç»è¢«æ”¾å¼€äº†ã€‚ç›®å‰å¯ä»¥æ­£å¸¸åœ¨å¾®ä¿¡ç¯å¢ƒå†…ä½¿ç”¨é€šç”¨é“¾è·³è½¬åŠŸèƒ½ï¼ˆåªè¦ä½ è¦è·³è½¬çš„ç›®çš„é“¾æ¥å’Œå½“å‰é“¾æ¥æ˜¯è·¨åŸŸçš„å¹¶ä¸”æ­£ç¡®å®‰è£…é…ç½®äº†å¯¹åº”çš„é€šç”¨é“¾çš„APPï¼‰ã€‚</p>
<p><img src="https://cdn.zcx.info/008i3skNly1gw7uwunklrj31da0u0n07.jpg"></p>
<h4 id="å±è”½é“¾æ¥åˆ†äº«"><a href="#å±è”½é“¾æ¥åˆ†äº«" class="headerlink" title="å±è”½é“¾æ¥åˆ†äº«"></a>å±è”½é“¾æ¥åˆ†äº«</h4><p>é‰´äºå¯¹UniversalLinkçš„æ”¾å¼€ï¼Œå¾®ä¿¡å¯¹æŸäº›ç«äº‰å¯¹æ‰‹åšå‡ºäº†é™åˆ¶é“¾æ¥åˆ†äº«çš„åŠŸèƒ½ã€‚æ¯”å¦‚æŸå¤šå¤šå’ŒæŸå®æ˜¯æ— æ³•ä½¿ç”¨å¾®ä¿¡å¡ç‰‡åˆ†äº«çš„ï¼Œæ‰€ä»¥é’ˆå¯¹è¿™ç§åœºæ™¯ä»–ä»¬åšå‡ºäº†åˆ†äº«æ–‡å­—åˆ°å¾®ä¿¡çš„åŠŸèƒ½ï¼Œå³å‘é€å¸¸ä¸€å¤§ä¸²å¸¦æ ‡è¯†ç çš„æ–‡æœ¬åˆ°å¾®ä¿¡ï¼Œç„¶åé€šè¿‡ç³»ç»Ÿç²˜è´´æ¿ä½œä¸ºä¸­è½¬åˆ°APPå†…ï¼ˆå¸¸è§çš„â€œå¤åˆ¶è¿™æ®µè¯åˆ°xxxAPPæ‰“å¼€å³å¯è·å¾—xxxçº¢åŒ…â€ï¼‰ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¸è®ºæ˜¯DeepLinkæŠ€æœ¯ è¿˜æ˜¯UniversalLinkæŠ€æœ¯ï¼Œéƒ½å¯ä»¥å®ç°æˆ‘ä»¬çš„éœ€æ±‚ã€‚</p>
<p>åœ¨ä½¿ç”¨ä½“éªŒä¸Šæ¥è¯´è¿˜æ˜¯UniversalLinkæŠ€æœ¯æ›´èƒœä¸€ç­¹ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>ä¸€é”®å”¤èµ·</tag>
      </tags>
  </entry>
  <entry>
    <title>iOS-OCRå®è·µ</title>
    <url>/2021/08/31/iOS-OCR%E5%AE%9E%E8%B7%B5/</url>
    <content><![CDATA[<h2 id="éœ€æ±‚èƒŒæ™¯"><a href="#éœ€æ±‚èƒŒæ™¯" class="headerlink" title="éœ€æ±‚èƒŒæ™¯"></a>éœ€æ±‚èƒŒæ™¯</h2><p>è¿‘æœŸè€æ¿æå‡ºäº†æŸäº›éœ€æ±‚å¯èƒ½éœ€è¦å€ŸåŠ©OCRèƒ½åŠ›æ¥è¿›è¡Œå›¾ç‰‡åˆ°æ–‡æœ¬çš„è½¬æ¢ã€‚</p>
<p>ä»¥ä¸‹å‡ ç§æ–¹æ¡ˆæ˜¯å¯¹å½“å‰å¯ç”¨çš„å…è´¹çš„OCRçš„è°ƒç ”ã€‚</p>
<h2 id="Vision"><a href="#Vision" class="headerlink" title="Vision"></a>Vision</h2><blockquote>
<p>Vision æ˜¯ Apple åœ¨ WWDC 2017 æ¨å‡ºçš„å›¾åƒè¯†åˆ«æ¡†æ¶ï¼Œå®ƒåŸºäº Core MLï¼Œæ‰€ä»¥å¯ä»¥ç†è§£æˆ Apple çš„å·¥ç¨‹å¸ˆè®¾è®¡äº†ä¸€ç§ç®—æ³•æ¨¡å‹ï¼Œç„¶ååˆ©ç”¨ Core ML è®­ç»ƒï¼Œæœ€åæ•´åˆæˆä¸€ä¸ªæ–°çš„æ¡†æ¶ï¼Œç›¸æ¯”å¼€æºæ¨¡å‹ç„¶åè®©å¼€å‘è€…è‡ªå·±æ•´åˆèµ·æ¥ï¼Œè¿™ç§æ–¹å¼æ›´å®‰å…¨ä¹Ÿæ›´æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨ã€‚</p>
</blockquote>
<h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><blockquote>
<p>The Vision framework performs face and face landmark detection, text detection, barcode recognition, image registration, and general feature tracking. Vision also allows the use of custom Core ML models for tasks like classification or object detection.</p>
</blockquote>
<p>ä»å®˜æ–¹æ–‡æ¡£ä¸­å¯ä»¥å¾—åˆ°Visionæ¡†æ¶èƒ½åšçš„äº‹æƒ…</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Face Detection and Recognition</td>
<td>é¢éƒ¨æ£€æµ‹</td>
</tr>
<tr>
<td align="left">Machine Learning Image Analysis</td>
<td>æœºå™¨å­¦ä¹ å›¾åƒåˆ†æ</td>
</tr>
<tr>
<td align="left">Barcode Detection</td>
<td>çŸ©é˜µç &#x2F;æ¡å½¢ç æ£€æµ‹</td>
</tr>
<tr>
<td align="left">Image Alignment Analysis</td>
<td>å›¾åƒå¯¹é½åˆ†æ</td>
</tr>
<tr>
<td align="left">Text Detection</td>
<td>æ–‡å­—æ£€æµ‹</td>
</tr>
<tr>
<td align="left">Horizon Detection</td>
<td>æ°´å¹³é¢æ£€æµ‹</td>
</tr>
<tr>
<td align="left">Object Detection and Tracking</td>
<td>ç‰©ä½“æ£€æµ‹å’Œè¿½è¸ª</td>
</tr>
</tbody></table>
<h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><p>å¯¹äºæˆ‘ä»¬éœ€è¦çš„OCRåŠŸèƒ½ï¼ŒText Detectionå°±å¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œè‡³äºåˆ«çš„åŠŸèƒ½æœ‰å…´è¶£çš„å¯ä»¥è¯•ä¸€ä¸‹ã€‚</p>
<p>Demoä¸­çš„ä»£ç ä¹Ÿæ¯”è¾ƒç®€å•å°±å®ç°äº†åŠŸèƒ½</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ª<code>VNImageRequestHandler</code>æ¥æŒæœ‰ä¼ å…¥çš„å›¾ç‰‡</li>
<li>åˆ›å»ºä¸€ä¸ª<code>VNRecognizeTextRequest</code>è¯·æ±‚&#x2F;è¯·æ±‚é˜Ÿåˆ—</li>
<li>åˆ›å»ºä¸€ä¸ª<code>VNRequestCompletionHandler</code>å‡½æ•°æŒ‡é’ˆ&#x2F;blockå¤„ç†è¯†åˆ«æˆåŠŸçš„å›è°ƒ</li>
<li>Perform the text-recognition request. æ‰§è¡Œè¯·æ±‚</li>
</ol>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//public typealias VNRequestCompletionHandler = (VNRequest, Error?) -&gt; Void</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/// è‹¹æœåŸç”Ÿè¯†åˆ« å‡†ç¡®ç‡é«˜ é€Ÿåº¦å¿«</span></span><br><span class="line"><span class="keyword">@objc</span> <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">ocrAction</span>() &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> path <span class="operator">=</span> <span class="keyword">self</span>.path, <span class="keyword">let</span> img <span class="operator">=</span> <span class="type">UIImage</span>(contentsOfFile: path) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> cgImage <span class="operator">=</span> img.cgImage <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    <span class="comment">// éœ€è¦æ³¨æ„çš„å†™æ³•</span></span><br><span class="line">    <span class="keyword">let</span> requestHandler <span class="operator">=</span> <span class="type">VNImageRequestHandler</span>(cgImage: cgImage)</span><br><span class="line">    <span class="comment">// å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ/block</span></span><br><span class="line">    <span class="keyword">let</span> request <span class="operator">=</span> <span class="type">VNRecognizeTextRequest</span>(completionHandler: recognizeTextHandler)</span><br><span class="line">    <span class="comment">// åªæœ‰ios14ä»¥ä¸Šæ”¯æŒä¸­æ–‡è¯†åˆ«</span></span><br><span class="line">    request.recognitionLanguages <span class="operator">=</span> [<span class="string">&quot;zh-Hans&quot;</span>,<span class="string">&quot;zh-Hant&quot;</span>,<span class="string">&quot;en-US&quot;</span>]</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="comment">// Perform the text-recognition request.</span></span><br><span class="line">        <span class="keyword">try</span> requestHandler.perform([request])</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Unable to perform the requests: <span class="subst">\(error)</span>.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// è¯†åˆ«æˆåŠŸçš„å›è°ƒ </span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">recognizeTextHandler</span>(<span class="params">request</span>: <span class="type">VNRequest</span>, <span class="params">error</span>: <span class="type">Error</span>?) &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> observations <span class="operator">=</span> request.results <span class="keyword">as?</span> [<span class="type">VNRecognizedTextObservation</span>] <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> recognizedStrings <span class="operator">=</span> observations.compactMap &#123; observation <span class="keyword">in</span></span><br><span class="line">        <span class="comment">// Return the string of the top VNRecognizedText instance.</span></span><br><span class="line">        <span class="keyword">return</span> observation.topCandidates(<span class="number">1</span>).first<span class="operator">?</span>.string</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Process the recognized strings.</span></span><br><span class="line"> 	 	<span class="keyword">var</span> res <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> str <span class="keyword">in</span> recognizedStrings &#123;</span><br><span class="line">        res  <span class="operator">=</span> <span class="string">&quot;<span class="subst">\(res)</span><span class="subst">\(str)</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    resultLabel.text <span class="operator">=</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h3><p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li>iOSç³»ç»Ÿå†…ç½®çš„APIï¼Œæ— éœ€å¼•å…¥å¤šä½™æ–‡ä»¶ç›´æ¥è°ƒç”¨ã€‚</li>
<li>APIä½¿ç”¨æ¯”è¾ƒç®€å•ï¼Œä¸ç”¨è€ƒè™‘å¤šçº¿ç¨‹åˆ‡æ¢ï¼ŒæˆåŠŸå›è°ƒå·²ç»å…¨éƒ¨å›åˆ°äº†ä¸»çº¿ç¨‹ã€‚</li>
<li>å®æµ‹è¯†åˆ«å‡†ç¡®åº¦è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ã€‚</li>
</ol>
<p>ç¼ºç‚¹ï¼š</p>
<p>åªæœ‰iOS14ä»¥ä¸Šçš„ç³»ç»Ÿç‰ˆæœ¬æ”¯æŒè®¾ç½®è¯†åˆ«ä¸­æ–‡ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥åˆ¤æ–­è¿™ä¸ªAPIæ‰€æ”¯æŒè¯†åˆ«çš„è¯­è¨€ã€‚<code>request.recognitionLanguages</code>å±æ€§æ”¯æŒè®¾ç½®ISOæ ‡å‡†è¯­è¨€ä»£ç ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     @brief Returns all the supported languages for a given text recognition level. Note that a language supported in one recognition level might not be available in another.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">class</span> <span class="keyword">func</span> <span class="title function_">supportedRecognitionLanguages</span>(<span class="keyword">for</span> recognitionLevel: <span class="type">VNRequestTextRecognitionLevel</span>, revision requestRevision: <span class="type">Int</span>) <span class="keyword">throws</span> -&gt; [<span class="type">String</span>]</span><br></pre></td></tr></table></figure>

<p><a href="https://developer.apple.com/documentation/vision/recognizing_text_in_images">æ›´å¤šVisionè¯†åˆ«æ–‡å­—ç›¸å…³æ–‡æ¡£å¯å‚è€ƒï¼šRecognizing Text in Images</a></p>
<h2 id="Tesseract"><a href="#Tesseract" class="headerlink" title="Tesseract"></a>Tesseract</h2><blockquote>
<p>Tesseract æ˜¯ä¸€ä¸ª OCR åº“,ç›®å‰ç”± Google èµåŠ©(Google ä¹Ÿæ˜¯ä¸€å®¶ä»¥ OCR å’Œæœºå™¨å­¦ä¹ æŠ€æœ¯é—»åäºä¸–çš„å…¬å¸)ã€‚Tesseract æ˜¯ç›®å‰å…¬è®¤æœ€ä¼˜ç§€ã€æœ€ç²¾ç¡®çš„å¼€æº OCR ç³»ç»Ÿï¼Œé™¤äº†æé«˜çš„ç²¾ç¡®åº¦ï¼ŒTesseract ä¹Ÿå…·æœ‰å¾ˆé«˜çš„çµæ´»æ€§ã€‚å®ƒå¯ä»¥é€šè¿‡è®­ç»ƒè¯†åˆ«å‡ºä»»ä½•å­—ä½“ï¼Œä¹Ÿå¯ä»¥è¯†åˆ«å‡ºä»»ä½• Unicode å­—ç¬¦ã€‚Tesseract OCR è¯¥è½¯ä»¶åŒ…åŒ…å«ä¸€ä¸ª OCR å¼•æ“ â€“ libtesseract å’Œä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åº â€“ tesseractã€‚ Tesseract 4 å¢åŠ äº†ä¸€ä¸ªåŸºäº OCR å¼•æ“çš„æ–°ç¥ç»ç½‘ç»œï¼ˆLSTMï¼‰ï¼Œè¯¥å¼•æ“ä¸“æ³¨äºçº¿è·¯è¯†åˆ«ï¼Œä½†ä»ç„¶æ”¯æŒ Tesseract 3 çš„ä¼ ç»Ÿ Tesseract OCR å¼•æ“ï¼Œè¯¥å¼•æ“é€šè¿‡è¯†åˆ«å­—ç¬¦æ¨¡å¼æ¥å·¥ä½œã€‚é€šè¿‡ä½¿ç”¨ Legacy OCR Engine æ¨¡å¼ï¼ˆâ€“oem 0ï¼‰å¯ç”¨ä¸ Tesseract 3 çš„å…¼å®¹æ€§ã€‚å®ƒè¿˜éœ€è¦è®­ç»ƒæœ‰ç´ çš„æ•°æ®æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶æ”¯æŒä¼ ç»Ÿå¼•æ“ï¼Œä¾‹å¦‚æ¥è‡ª tessdata å­˜å‚¨åº“çš„æ–‡ä»¶ã€‚</p>
<p><a href="https://github.com/tesseract-ocr/tesseract">GitHub Address</a></p>
</blockquote>
<h3 id="Tesseract-OCR-iOS"><a href="#Tesseract-OCR-iOS" class="headerlink" title="Tesseract-OCR-iOS"></a>Tesseract-OCR-iOS</h3><blockquote>
<p>Tesseract-OCR-iOS æ˜¯ç”±<code>gali8</code>ä½¿ç”¨<code>Objective-C</code>å°è£…çš„åŸºäº<code>Tesseract 3.03-rc1</code>çš„iOSç‰ˆæœ¬åº“ã€‚<br><a href="https://github.com/gali8/Tesseract-OCR-iOS">GitHub Address</a></p>
</blockquote>
<h3 id="Useage"><a href="#Useage" class="headerlink" title="Useage"></a>Useage</h3><ol>
<li>é€šè¿‡<code>cocopods</code>å¯ä»¥ç›´æ¥å¼•å…¥æ­¤åº“ã€‚</li>
</ol>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment">#PodFile</span></span><br><span class="line">pod <span class="string">&#x27;TesseractOCRiOS&#x27;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>æ¡Œé¢åˆ›å»ºä¸€ä¸ª<code>tessdata</code>æ–‡ä»¶å¤¹</p>
</li>
<li><p>å°†è®­ç»ƒå¥½çš„ä¸­æ–‡è¯­è¨€æ–‡å­—æ•°æ®é›†<code>chi_sim.traineddata</code>æ”¾å…¥<code>tessdata</code>æ–‡ä»¶å¤¹</p>
</li>
<li><p>å°†tessdataæ–‡ä»¶å¤¹æ‹–åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼Œ<code>Added folders</code> é€‰æ‹© <code>Create folder references</code>åˆ›å»ºç´¢å¼•å…³ç³»</p>
<blockquote>
<p>ä¹‹æ‰€ä»¥åˆ›å»ºç´¢å¼•ï¼Œæ˜¯å› ä¸ºTesseractå†…éƒ¨æ˜¯ä½¿ç”¨é™æ€è·¯å¾„è®¿é—®çš„è¯­è¨€èµ„æºæ–‡ä»¶</p>
</blockquote>
</li>
<li><p>ä½¿ç”¨ä¸­æ–‡è¯­è¨€åˆ›å»º<code>G8Tesseract</code></p>
</li>
<li><p>è®¾ç½®<code>G8Tesseract</code>éœ€è¦è¯†åˆ«çš„<code>image</code></p>
</li>
<li><p>è°ƒç”¨<code>recognize()</code>æ–¹æ³•ï¼ŒåŒæ­¥æ–¹æ³•ï¼Œä¼šé˜»å¡è¿›ç¨‹</p>
</li>
<li><p>è¯»å–<code>recognizedText</code>å±æ€§å­—æ®µ</p>
</li>
</ol>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// google Tesseractè¯†åˆ«</span></span><br><span class="line"><span class="keyword">@objc</span> <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">ocrActionTesseract</span>() &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> path <span class="operator">=</span> <span class="keyword">self</span>.path, <span class="keyword">let</span> img <span class="operator">=</span> <span class="type">UIImage</span>(contentsOfFile: path) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    <span class="keyword">let</span> g8Rec <span class="operator">=</span> <span class="type">G8Tesseract</span>(language: <span class="string">&quot;chi_sim&quot;</span>)</span><br><span class="line">    g8Rec<span class="operator">?</span>.image <span class="operator">=</span> img</span><br><span class="line">    g8Rec<span class="operator">?</span>.engineMode <span class="operator">=</span> .tesseractOnly</span><br><span class="line">    g8Rec<span class="operator">?</span>.pageSegmentationMode <span class="operator">=</span> .autoOnly</span><br><span class="line">    g8Rec<span class="operator">?</span>.recognize()</span><br><span class="line">    resultLabel.text <span class="operator">=</span> g8Rec<span class="operator">?</span>.recognizedText</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é›†æˆè¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼š</p>
<ol>
<li><p><code>actual_tessdata_num_entries_ &lt;= TESSDATA_NUM_ENTRIES:Error: Assert failed: in file ..\..\ccutil\tes...</code></p>
<p>åŸå› ï¼šè®­ç»ƒæ•°æ®å’Œsdkç‰ˆæœ¬å·ä¸ä¸€è‡´<br>è§£å†³æ–¹æ³•ï¼šå» <a href="https://github.com/tesseract-ocr/tessdoc/blob/master/tess3/Data-Files.md#data-files-for-version-302">v3.0.2ç‰ˆæœ¬è®­ç»ƒæ•°æ®</a>ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„è®­ç»ƒæ•°æ®</p>
</li>
<li><p><code>setenv(&quot;TESSDATA_PREFIX&quot;, [_absoluteDataPath stringByAppendingString:@&quot;/&quot;].fileSystemRepresentation, 1);</code> å¤„å´©æºƒ</p>
<p>åŸå› ï¼šæœªçŸ¥ï¼Œå¯èƒ½æ˜¯ä»£ç BUG<br>è§£å†³æ–¹æ³•ï¼šä¸ä½¿ç”¨ä½œè€…æä¾›çš„SwiftDemoä¸­çš„<code>OperationQueue</code>ç›´æ¥ä½¿ç”¨<code>G8Tesseract</code>ç±»</p>
</li>
</ol>
<h3 id="ä¼˜ç¼ºç‚¹-1"><a href="#ä¼˜ç¼ºç‚¹-1" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h3><p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li>Tesseract å¯ä»¥æ”¯æŒè‡ªå®šä¹‰è®­ç»ƒæ•°æ®ï¼Œå¯ä»¥æ ¹æ®è‡ªèº«çš„éœ€æ±‚è¿›è¡Œæ•°æ®è®­ç»ƒã€‚å¯ä»¥å®ç°æ‰‹å†™å­—ä½“æˆ–å…¶ä»–ä¸è§„åˆ™å­—ä½“çš„è¯†åˆ«ã€‚</li>
<li>è¯†åˆ«å‡†ç¡®ç‡å‚ç…§è®­ç»ƒç»“æœï¼Œåœ¨å¤§é‡ä¸šåŠ¡æ•°æ®çš„æ”¯æŒä¸‹å¯èƒ½ä¼šè¾¾åˆ°è¾ƒé«˜çš„å‡†ç¡®ç‡ã€‚</li>
<li>æ— iOSç³»ç»Ÿç‰ˆæœ¬è¦æ±‚ï¼Œæˆ–åŸºæœ¬æ»¡è¶³ä½ç‰ˆæœ¬è¦æ±‚</li>
</ol>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li><code>Tesseract-OCR-iOS</code> åº“ä¸å†ç»´æŠ¤å’Œæ›´æ–°ï¼Œä»£ç BUGæ— äººè§£å†³ï¼Œ<code>Tesseract</code>ç‰ˆæœ¬ä¾æ—§åœç•™åœ¨3.0ç‰ˆæœ¬ï¼Œé™åˆ¶ä½¿ç”¨3.0ç‰ˆæœ¬çš„è®­ç»ƒæ•°æ®é›†ã€‚è‹¥ä¸è‡ªè¡Œè®­ç»ƒï¼Œä½ç‰ˆæœ¬è®­ç»ƒæ•°æ®æ¯”è¾ƒéš¾æ‰¾ã€‚è‡ªè¡Œforkè¿›è¡ŒäºŒæ¬¡å¼€å‘å­¦ä¹ æˆæœ¬è¾ƒé«˜ã€‚</li>
<li><code>Tesseract-OCR-iOS</code>åº“è‡ªè¡Œæµ‹è¯•ç»“æœå¯¹ç®€ä½“ä¸­æ–‡çš„è¯†åˆ«å‡†ç¡®ç‡ç¨ä½ï¼Œå¯èƒ½æ˜¯å› ä¸º<code>Tesseract</code>ç‰ˆæœ¬è¿‡ä½ã€‚</li>
<li>å¼•å…¥æ­¤ä¸‰æ–¹åº“çš„æˆæœ¬è¿‡é«˜ï¼ŒåŸºæœ¬çš„ç®€ä½“ä¸­æ–‡è®­ç»ƒæ•°æ®é›†å¤§å°å°±ä¸º40+MBï¼Œå¼•å…¥å·¥ç¨‹å†…ä¼šæ˜¾è‘—å¢åŠ IPAåŒ…ä½“ç§¯å¤§å°ï¼Œå½±å“APPä¸‹è½½å’Œåˆ†å‘</li>
</ol>
<h2 id="OnLine-OCR"><a href="#OnLine-OCR" class="headerlink" title="OnLine OCR"></a>OnLine OCR</h2><p>æœåŠ¡å•†è¾ƒå¤šï¼Œä¹Ÿæœ‰å…è´¹è¯•ç”¨ç‰ˆï¼Œå¯è¡¡é‡ä¸šåŠ¡ä¸éœ€æ±‚é€‰æ‹©ã€‚</p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>å¦‚æœOCRä¸æ˜¯Appçš„æ ¸å¿ƒåŠŸèƒ½è¿˜æ˜¯å°½é‡é€‰æ‹©<code>Vision</code>ï¼Œ<code>Apple</code>é©¬ä¸Šè¦æ›´æ–°<code>iOS15</code>ç‰ˆæœ¬ï¼Œéšç€æ—¶é—´å‘å±•<code>iOS14</code>ä»¥ä¸Šçš„ç”¨æˆ·æ•°é‡ä¼šè¶Šæ¥è¶Šå¤šï¼Œç›¸ä¿¡ç³»ç»Ÿç‰ˆæœ¬é™åˆ¶ä¸ä¼šæ°¸è¿œæ˜¯APPåŠŸèƒ½å‘å±•çš„ç“¶é¢ˆã€‚</p>
<p>å¦‚æœOCRæ˜¯APPçš„æ ¸å¿ƒåŠŸèƒ½æˆ–ä¸šåŠ¡ç›¸å…³ï¼Œå»ºè®®è‡ªè¡Œå¯¹æœ€æ–°çš„<code>Tesseract</code> è¿›è¡Œc++æ¥å£å°è£…æˆ–è€…å¯¹<code>Tesseract-OCR-iOS</code>åº“äºŒæ¬¡å¼€å‘æ›´æ–°ç‰ˆæœ¬å¹¶è¿›è¡Œç»´æŠ¤ã€‚</p>
<p>æˆ–è€…é€‰æ‹©ä½¿ç”¨æ”¶è´¹åœ¨çº¿ä¸šåŠ¡ï¼Œå¤§éƒ¨åˆ†åœºæ™¯ä¸‹èŠ±é’±éƒ½èƒ½è§£å†³æŠ€æœ¯é—®é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯è°ƒç ”</tag>
      </tags>
  </entry>
  <entry>
    <title>iOS-i18nåŠ¨æ€åŒ–æ€è€ƒ</title>
    <url>/2025/03/27/iOS-i18n%E5%8A%A8%E6%80%81%E5%8C%96%E6%80%9D%E8%80%83/</url>
    <content><![CDATA[<h2 id="ä¸€ã€é¡¹ç›®èƒŒæ™¯"><a href="#ä¸€ã€é¡¹ç›®èƒŒæ™¯" class="headerlink" title="ä¸€ã€é¡¹ç›®èƒŒæ™¯"></a>ä¸€ã€é¡¹ç›®èƒŒæ™¯</h2><p>åœ¨å…¨çƒåŒ–ä¸šåŠ¡å¿«é€Ÿå‘å±•çš„èƒŒæ™¯ä¸‹ï¼Œæˆ‘ä»¬çš„æ•™è‚²ç±»åº”ç”¨éœ€è¦æ”¯æŒ18+è¯­è¨€ã€è¦†ç›–100+å›½å®¶åœ°åŒºçš„æœ¬åœ°åŒ–éœ€æ±‚ã€‚</p>
<h2 id="äºŒã€ç°çŠ¶åˆ†æ"><a href="#äºŒã€ç°çŠ¶åˆ†æ" class="headerlink" title="äºŒã€ç°çŠ¶åˆ†æ"></a>äºŒã€ç°çŠ¶åˆ†æ</h2><p>ç›®å‰iOSç«¯åœ¨åŸºäºç³»ç»Ÿçº§çš„.Stringæ–‡ä»¶æ”¯æŒå¤šè¯­èƒ½åŠ›çš„åŸºç¡€ä¸Šåˆå¢åŠ äº†ä¸€å±‚åŠ¨æ€Jsonå¤šè¯­ã€‚</p>
<p>ä¸ºäº†è·å–åŠ¨æ€ä¿®å¤å¤šè¯­çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬é¢å¤–å®ç°äº†ä¸€å¥—åŠ¨æ€æ‹‰å–å¤šä¸ªscopeä¸‹çš„18ç§è¯­è¨€jsonçš„åŠŸèƒ½ã€‚æ”¯æŒserverã€æœ¬åœ°æ–‡ä»¶ã€å†…å­˜ä¸‰çº§ç¼“å­˜ã€‚</p>
<p>åœ¨æ ¹æ®å¤šè¯­keyæå–æ–‡æœ¬æ—¶ä¼šå…ˆåˆ°åŠ¨æ€å¤šè¯­æ¨¡å—å»æŸ¥è¯¢ï¼Œå¦‚æœæŸ¥ä¸åˆ°ç›®æ ‡å­—ç¬¦ä¸²åˆ™ä¼šå›é€€åˆ°ç³»ç»ŸNSLocalizedStringè·å–æ–‡æœ¬ã€‚</p>
<p>ä¸»è¦å®ç°ç‰¹ç‚¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// å†…å­˜ç®¡ç†æ ¸å¿ƒé€»è¾‘</span><br><span class="line">- (NSDictionary *)getCurrentLanguagesData &#123;</span><br><span class="line">    NSMutableDictionary *stableLanguages = [NSMutableDictionary dictionary];</span><br><span class="line">    [self.subScopes enumerateObjects...]; // å…¨é‡åˆå¹¶å¤šè¯­æ•°æ®</span><br><span class="line">    return stableLanguages; // äº§ç”Ÿå†…å­˜å³°å€¼</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°å­˜é—®é¢˜ ï¼š</p>
<p>i18næ¨¡å—åœ¨è®¾è®¡é˜¶æ®µä¸ºäº†è·å–åŠ¨æ€åŒ–èƒ½åŠ›æŠ•å…¥äº†è¾ƒå¤šçš„èµ„æºã€‚ä½†æ˜¯åæœŸåœ¨åº”ç”¨é˜¶æ®µå‘ç°å…¶åŠ¨æ€åŒ–èƒ½åŠ›å¹¶æœªå¸¦æ¥å¾ˆå¤§çš„æ”¶ç›Šã€‚å¹¶ä¸”åœ¨ç»å†äº†å¤§æ‰¹é‡çš„æœ¬åœ°å¤šè¯­ä¿®æ”¹éœ€æ±‚åå‘ç°åœ¨è¿™ç§åœºæ™¯ä¸‹éœ€è¦è€ƒè™‘åŒå€çš„æ›´æ–°æˆæœ¬ã€‚</p>
<p>ä¸€ä¸ªç‰ˆæœ¬çš„APPå‘å¸ƒåå…¶å†…éƒ¨ä½¿ç”¨çš„å¤šè¯­K-Vä¹ŸåŸºæœ¬å›ºå®šï¼Œæ‰€è°“çš„åŠ¨æ€åŒ–çš„èƒ½åŠ›ä»…ä»…æ˜¯ä¸ºäº†æ”¯æŒåŠ¨æ€ä¸‹å‘å¤šè¯­åšçƒ­æ›´æ–°ã€‚åœ¨é•¿æ—¶é—´çš„è¿­ä»£å’Œå®è·µä¸­å‘ç°å¤šè¯­çƒ­æ›´æ–°çš„æ¬¡æ•°è¾ƒå°‘ï¼Œå¯¹æ–‡æœ¬ç¿»è¯‘çš„è°ƒæ•´çš„ä¼˜å…ˆçº§ä¹Ÿä¸é«˜ï¼Œå¯ä»¥æ¥å—å‘ç‰ˆæ›´æ–°ã€‚</p>
<p>ç”±äºæ”¯æŒçƒ­æ›´æ–°ï¼Œæˆ‘ä»¬åœ¨å¼€å‘é˜¶æ®µå¯¹å¤šè¯­ç¿»è¯‘çš„å‡†å…¥æ ‡å‡†ä¹Ÿé€æ¸åŠ£åŒ–ï¼Œç”šè‡³å‡ºç°äº†ä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒå‰ä¸åšå¤šè¯­èµ°æŸ¥ç›´æ¥ä¸Šçº¿ä¾èµ–åŠ¨æ€èƒ½åŠ›å†çƒ­ä¿®çš„æƒ…å†µã€‚</p>
<p>è€Œä¸”éšç€ä¸‹å‘çš„jsoné€æ¸å¢å¤§ï¼ŒAPPçš„å¯åŠ¨å‘¨æœŸå†…åŠ è½½åŠ¨æ€å¤šè¯­çš„å¼€é”€ä¹Ÿé€æ¸å¢å¤§ï¼Œç›®å‰çº¯jsonæ•°æ®å·²ç»æœ‰5mbå·¦å³ï¼Œå…¨é‡åŠ è½½åˆ°å†…å­˜ä¸­éœ€è¦æ¶ˆè€—çš„å†…å­˜ä¼šæ›´å¤šã€‚æ‰€ä»¥è¿™é‡Œè€ƒè™‘å°†å†…å­˜åŠ è½½Jsonæ›¿æ¢ä¸ºç³»ç»Ÿçº§çš„ä½¿ç”¨Bundleè·å–æ•°æ®ä»¥å‡è½»å†…å­˜å‹åŠ›ã€‚</p>
<h2 id="ä¸‰ã€æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”"><a href="#ä¸‰ã€æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”" class="headerlink" title="ä¸‰ã€æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”"></a>ä¸‰ã€æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”</h2><h3 id="1-å†…å­˜JSONæ–¹æ¡ˆ"><a href="#1-å†…å­˜JSONæ–¹æ¡ˆ" class="headerlink" title="1. å†…å­˜JSONæ–¹æ¡ˆ"></a>1. å†…å­˜JSONæ–¹æ¡ˆ</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// å½“å‰å®ç°æ–¹å¼</span><br><span class="line">- (void)syncSubscopesWithHashId:(NSString *)hashId </span><br><span class="line">                      timestamp:(NSString *)timestamp</span><br><span class="line">                         config:(UGI18NConfigModel *)i18nConfig &#123;</span><br><span class="line">    // å†…å­˜åˆå¹¶é€»è¾‘...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¼˜åŠ¿ ï¼šçƒ­æ›´æ–°å³æ—¶ç”Ÿæ•ˆ åŠ£åŠ¿ ï¼šå†…å­˜å ç”¨é«˜ï¼Œæ— æ³•åˆ©ç”¨ç³»ç»Ÿä¼˜åŒ–</p>
<h3 id="2-åŠ¨æ€Bundleæ–¹æ¡ˆ"><a href="#2-åŠ¨æ€Bundleæ–¹æ¡ˆ" class="headerlink" title="2. åŠ¨æ€Bundleæ–¹æ¡ˆ"></a>2. åŠ¨æ€Bundleæ–¹æ¡ˆ</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// æ–°å¢åŠ¨æ€Bundleæ”¯æŒ</span><br><span class="line">@property (nonatomic, strong) NSMutableArray&lt;NSBundle *&gt; *dynamicBundles;</span><br><span class="line"></span><br><span class="line">- (NSString *)localizedStringForKey:(NSString *)key &#123;</span><br><span class="line">    for (NSBundle *bundle in _dynamicBundles) &#123;</span><br><span class="line">        NSString *value = [bundle localizedStringForKey:key value:nil table:nil];</span><br><span class="line">        if (value) return value;</span><br><span class="line">    &#125;</span><br><span class="line">    return [super localizedStringForKey:key];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¼˜åŠ¿ ï¼š</p>
<ul>
<li>ç³»ç»Ÿçº§å†…å­˜ç®¡ç†</li>
<li>æ”¯æŒæ¨¡å—åŒ–æ›´æ–°</li>
<li>æ— ç¼å…¼å®¹Xcode</li>
</ul>
<h2 id="å››ã€åŠ¨æ€Bundleæ–¹æ¡ˆè®¾è®¡"><a href="#å››ã€åŠ¨æ€Bundleæ–¹æ¡ˆè®¾è®¡" class="headerlink" title="å››ã€åŠ¨æ€Bundleæ–¹æ¡ˆè®¾è®¡"></a>å››ã€åŠ¨æ€Bundleæ–¹æ¡ˆè®¾è®¡</h2><h3 id="æ¶æ„è®¾è®¡"><a href="#æ¶æ„è®¾è®¡" class="headerlink" title="æ¶æ„è®¾è®¡"></a>æ¶æ„è®¾è®¡</h3><ul>
<li>åŠ¨æ€bundleä»£æ›¿å†…å­˜jsonç¼“å­˜</li>
<li>ç³»ç»Ÿbundleåšé™æ€å…œåº•</li>
<li>ä¸šåŠ¡æ¨¡å—æ— æ„Ÿç›´æ¥è°ƒç”¨</li>
</ul>
<h3 id="æ ¸å¿ƒå®ç°"><a href="#æ ¸å¿ƒå®ç°" class="headerlink" title="æ ¸å¿ƒå®ç°"></a>æ ¸å¿ƒå®ç°</h3><p><strong>1. åŠ¨æ€åŠ è½½å™¨ï¼ˆUGI18NScopeæ‰©å±•ï¼‰</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// åŠ¨æ€Bundleç®¡ç†</span><br><span class="line">- (void)loadDynamicBundles &#123;</span><br><span class="line">    NSString *path = [NSSearchPath...];</span><br><span class="line">    NSArray *langDirs = [fm contentsOfDirectoryAtPath:path];</span><br><span class="line">  </span><br><span class="line">    for (NSString *dir in langDirs) &#123;</span><br><span class="line">        if ([dir.pathExtension isEqualToString:@&quot;lproj&quot;]) &#123;</span><br><span class="line">            NSBundle *bundle = [NSBundle bundleWithPath:...];</span><br><span class="line">            [_dynamicBundles addObject:bundle];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2. è¯»å†™åˆ†ç¦»æœºåˆ¶</strong></p>
<ul>
<li>è¯»è·¯å¾„ï¼šMainBundle â†’ DynamicBundles é“¾å¼æŸ¥è¯¢</li>
<li>å†™è·¯å¾„ï¼šPythonè„šæœ¬ç”Ÿæˆæ ‡å‡†.lprojç»“æ„</li>
</ul>
<ol start="3">
<li>æ›´æ–°æµç¨‹</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[SSZipArchive unzipFileAtPath:zipPath toDestination:cacheDir];</span><br><span class="line">[[UGI18NScope sharedInstance] loadDynamicBundles];</span><br></pre></td></tr></table></figure>

<h2 id="äº”ã€æ€§èƒ½ä¼˜åŒ–"><a href="#äº”ã€æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="äº”ã€æ€§èƒ½ä¼˜åŒ–"></a>äº”ã€æ€§èƒ½ä¼˜åŒ–</h2><h3 id="1-å†…å­˜ä¼˜åŒ–å¯¹æ¯”"><a href="#1-å†…å­˜ä¼˜åŒ–å¯¹æ¯”" class="headerlink" title="1. å†…å­˜ä¼˜åŒ–å¯¹æ¯”"></a>1. å†…å­˜ä¼˜åŒ–å¯¹æ¯”</h3><table>
<thead>
<tr>
<th>æ–¹æ¡ˆ</th>
<th>å¯åŠ¨å†…å­˜</th>
<th>è¯­è¨€åˆ‡æ¢è€—æ—¶</th>
<th>å³°å€¼å†…å­˜</th>
</tr>
</thead>
<tbody><tr>
<td>å†…å­˜Json</td>
<td>82MB</td>
<td>420ms</td>
<td>105MB</td>
</tr>
<tr>
<td>åŠ¨æ€Bundle</td>
<td>35MB</td>
<td>150ms</td>
<td>60MB</td>
</tr>
</tbody></table>
<h3 id="2-æ‡’åŠ è½½æœºåˆ¶"><a href="#2-æ‡’åŠ è½½æœºåˆ¶" class="headerlink" title="2. æ‡’åŠ è½½æœºåˆ¶"></a>2. æ‡’åŠ è½½æœºåˆ¶</h3><p>ç³»ç»Ÿé€šè¿‡NSBundleçš„NSCacheå®ç°ï¼š</p>
<ul>
<li>é¦–æ¬¡è®¿é—®å­—ç¬¦ä¸²æ—¶åŠ è½½å¯¹åº”è¯­è¨€æ–‡ä»¶</li>
<li>å†…å­˜å‹åŠ›æ—¶è‡ªåŠ¨é‡Šæ”¾æœªä½¿ç”¨èµ„æº</li>
<li>ç›¸åŒkeyè‡ªåŠ¨å¤ç”¨ç¼“å­˜</li>
</ul>
<h2 id="å…­ã€æœªæ¥å±•æœ›"><a href="#å…­ã€æœªæ¥å±•æœ›" class="headerlink" title="å…­ã€æœªæ¥å±•æœ›"></a>å…­ã€æœªæ¥å±•æœ›</h2><h3 id="1-æ¶æ„æ¼”è¿›æ–¹å‘"><a href="#1-æ¶æ„æ¼”è¿›æ–¹å‘" class="headerlink" title="1. æ¶æ„æ¼”è¿›æ–¹å‘"></a>1. æ¶æ„æ¼”è¿›æ–¹å‘</h3><ul>
<li><strong>æ™ºèƒ½åŒ–åŠ è½½ç­–ç•¥</strong> ï¼šåŸºäºç”¨æˆ·è¡Œä¸ºé¢„æµ‹çš„é¢„åŠ è½½æœºåˆ¶</li>
<li><strong>äº‘ç«¯ååŒæ–¹æ¡ˆ</strong> ï¼šCDNåˆ†å‘+å·®åˆ†æ›´æ–°ï¼ˆDelta Updateï¼‰</li>
<li><strong>ARå›½é™…åŒ–æ”¯æŒ</strong> ï¼šåŠ¨æ€åŠ è½½3Dæ¨¡å‹çš„å¤šè¯­èµ„æº</li>
</ul>
<h3 id="2-å·¥å…·é“¾å»ºè®¾"><a href="#2-å·¥å…·é“¾å»ºè®¾" class="headerlink" title="2. å·¥å…·é“¾å»ºè®¾"></a>2. å·¥å…·é“¾å»ºè®¾</h3><ul>
<li><strong>è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·</strong> ï¼šå¤šè¯­è¦†ç›–ç‡æ£€æµ‹</li>
<li><strong>å¯è§†åŒ–ç›‘æ§å¹³å°</strong> ï¼šå®æ—¶æŸ¥çœ‹å„è¯­è¨€æ¨¡å—åŠ è½½çŠ¶æ€</li>
</ul>
<h3 id="3-è·¨å¹³å°æ‰©å±•"><a href="#3-è·¨å¹³å°æ‰©å±•" class="headerlink" title="3. è·¨å¹³å°æ‰©å±•"></a>3. è·¨å¹³å°æ‰©å±•</h3><ul>
<li><strong>Flutteræ··åˆæ–¹æ¡ˆ</strong> ï¼šé€šè¿‡MethodChannelå…±äº«Bundleèµ„æº</li>
<li><strong>React Nativeé€‚é…</strong> ï¼šæ„å»ºJS-Nativeçš„å­—ç¬¦ä¸²æ˜ å°„æ¡¥æ¥</li>
</ul>
<h2 id="ä¸ƒã€æ€»ç»“"><a href="#ä¸ƒã€æ€»ç»“" class="headerlink" title="ä¸ƒã€æ€»ç»“"></a>ä¸ƒã€æ€»ç»“</h2><p>æˆ‘ä»¬çš„é‡å¿ƒåº”è¯¥ç”±æ”¯æŒå¤šè¯­çš„åŠ¨æ€åŒ–è½¬ä¸ºæå‡å¤šè¯­ç¿»è¯‘çš„å‡†å…¥æ ‡å‡†ï¼Œå¼±åŒ–çƒ­æ›´æ–°èƒ½åŠ›ï¼Œå°½é‡ä¸ä¾èµ–çƒ­æ›´æ–°æ¥åšä¸€ä¸ªä¸è§„èŒƒçš„æ“ä½œã€‚</p>
<p>æœªæ¥å°†æŒç»­ä¼˜åŒ–å¤šè¯­èµ„æºçš„åŠ è½½æ•ˆç‡ï¼Œæ„å»ºè¦†ç›–å…¨å¹³å°çš„å›½é™…åŒ–è§£å†³æ–¹æ¡ˆï¼Œä¸ºå…¨çƒ1.2äº¿ç”¨æˆ·æä¾›æ›´æµç•…çš„æœ¬åœ°åŒ–ä½“éªŒ</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>i18n</tag>
      </tags>
  </entry>
  <entry>
    <title>iOS Crashç±»å‹æ€»ç»“</title>
    <url>/2025/03/12/iOSCrash%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[<h1 id="iOS-Crashç±»å‹æ€»ç»“"><a href="#iOS-Crashç±»å‹æ€»ç»“" class="headerlink" title="iOS Crashç±»å‹æ€»ç»“"></a>iOS Crashç±»å‹æ€»ç»“</h1><p>iOS APPç³»ç»Ÿcrashä¸»è¦åˆ†ä¸¤ç±»ï¼šä¸€ç±»æ˜¯Objective-C Exceptionï¼Œä¸€ç±»æ˜¯Unix Signal Exceptionã€‚ä¸‹é¢è¯¦ç»†ä»‹ç»ã€‚</p>
<blockquote>
<p>å´©æºƒæ—¥å¿—è·¯å¾„ï¼š~&#x2F;Library&#x2F;Logs&#x2F;CrashReporter&#x2F;MobileDevice</p>
</blockquote>
<h2 id="ä¸€ã€Objective-C-Exception"><a href="#ä¸€ã€Objective-C-Exception" class="headerlink" title="ä¸€ã€Objective-C Exception"></a>ä¸€ã€Objective-C Exception</h2><p>ä¾‹å¦‚NSDictionaryåŠ å…¥nilã€æ•°ç»„è®¿é—®è¶Šç•Œç­‰ã€‚ä¸»è¦æœ‰å¦‚ä¸‹ç±»å‹ï¼š</p>
<h3 id="1-NSInvalidArgumentException"><a href="#1-NSInvalidArgumentException" class="headerlink" title="1. NSInvalidArgumentException"></a>1. NSInvalidArgumentException</h3><p>éæ³•å‚æ•°å¼‚å¸¸(NSInvalidArgumentException)æ˜¯Objective-Cä»£ç æœ€å¸¸å‡ºç°çš„é”™è¯¯ã€‚å¹³æ—¶åœ¨å†™ä»£ç æ—¶éœ€è¦å¤šåŠ æ³¨æ„ï¼ŒåŠ å¼ºå¯¹å‚æ•°çš„æ£€æŸ¥ï¼Œé¿å…ä¼ å…¥éæ³•å‚æ•°å¯¼è‡´å¼‚å¸¸ï¼Œå…¶ä¸­å°¤ä»¥nilå‚æ•°ä¸ºç”šã€‚</p>
<p>ä¸»è¦åœºæ™¯åŒ…æ‹¬ï¼š</p>
<h4 id="1-1-é›†åˆæ•°æ®çš„å‚æ•°ä¼ é€’"><a href="#1-1-é›†åˆæ•°æ®çš„å‚æ•°ä¼ é€’" class="headerlink" title="1.1 é›†åˆæ•°æ®çš„å‚æ•°ä¼ é€’"></a>1.1 é›†åˆæ•°æ®çš„å‚æ•°ä¼ é€’</h4><p>æ¯”å¦‚NSMutableArrayã€NSMutableDictionaryçš„æ•°æ®æ“ä½œï¼š</p>
<ul>
<li>NSDictionaryä¸èƒ½åˆ é™¤nilçš„key</li>
<li>NSDictionaryä¸èƒ½æ·»åŠ nilçš„å¯¹è±¡</li>
<li>ä¸èƒ½æ’å…¥nilçš„å¯¹è±¡</li>
<li>å…¶ä»–ä¸€äº›nilå‚æ•°</li>
</ul>
<h4 id="1-2-å…¶ä»–APIçš„ä½¿ç”¨"><a href="#1-2-å…¶ä»–APIçš„ä½¿ç”¨" class="headerlink" title="1.2 å…¶ä»–APIçš„ä½¿ç”¨"></a>1.2 å…¶ä»–APIçš„ä½¿ç”¨</h4><p>APPä¸€èˆ¬éƒ½ä¼šæœ‰ç½‘ç»œæ“ä½œï¼Œå…ä¸äº†ä½¿ç”¨ç½‘ç»œç›¸å…³æ¥å£ï¼Œæ¯”å¦‚NSURLçš„åˆå§‹åŒ–ï¼Œä¸èƒ½ä¼ å…¥nilçš„httpåœ°å€ã€‚</p>
<h4 id="1-3-æœªå®ç°çš„æ–¹æ³•"><a href="#1-3-æœªå®ç°çš„æ–¹æ³•" class="headerlink" title="1.3 æœªå®ç°çš„æ–¹æ³•"></a>1.3 æœªå®ç°çš„æ–¹æ³•</h4><ul>
<li>.hæ–‡ä»¶é‡Œå‡½æ•°åï¼Œå´å¿˜äº†ä¿®æ”¹.mæ–‡ä»¶é‡Œå¯¹åº”çš„å‡½æ•°å</li>
<li>ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æ—¶ï¼Œæ²¡æœ‰æ·»åŠ â€-ObjCâ€ flag</li>
<li>MRCæ—¶ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯å› ä¸ºå¯¹è±¡è¢«æå‰releaseäº†ï¼Œåœ¨ä½ å¿ƒé‡Œä¸å¸Œæœ›ä»–releaseçš„æƒ…å†µä¸‹ï¼ŒæŒ‡é’ˆè¿˜åœ¨ï¼Œå¯¹è±¡å·²ç»ä¸åœ¨äº†</li>
</ul>
<h3 id="2-NSRangeException"><a href="#2-NSRangeException" class="headerlink" title="2. NSRangeException"></a>2. NSRangeException</h3><p>è¶Šç•Œå¼‚å¸¸(NSRangeException)ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸å‡ºç°çš„å¼‚å¸¸ï¼Œæœ‰å¦‚ä¸‹å‡ ç§ç±»å‹ï¼š</p>
<ol>
<li>æ•°ç»„æœ€å¤§ä¸‹æ ‡å¤„ç†é”™è¯¯<ul>
<li>æ¯”å¦‚æ•°ç»„é•¿åº¦countï¼Œindexçš„ä¸‹æ ‡èŒƒå›´[0, count-1]ï¼Œåœ¨å¼€å‘æ—¶ï¼Œå¯èƒ½indexçš„æœ€å¤§å€¼è¶…è¿‡æ•°ç»„çš„èŒƒå›´</li>
</ul>
</li>
<li>ä¸‹æ ‡çš„å€¼æ˜¯å…¶ä»–å˜é‡èµ‹å€¼<ul>
<li>è¿™æ ·ä¼šæœ‰å¾ˆå¤§çš„ä¸ç¡®å®šæ€§ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•´æ•°å€¼</li>
</ul>
</li>
<li>ä½¿ç”¨ç©ºæ•°ç»„<ul>
<li>å¦‚æœä¸€ä¸ªæ•°ç»„åˆšåˆšåˆå§‹åŒ–ï¼Œè¿˜æ˜¯ç©ºçš„ï¼Œå°±å¯¹å®ƒè¿›è¡Œç›¸å…³æ“ä½œ</li>
</ul>
</li>
</ol>
<blockquote>
<p>ä¸ºäº†é¿å…NSRangeExceptionçš„å‘ç”Ÿï¼Œå¿…é¡»å¯¹ä¼ å…¥çš„indexå‚æ•°è¿›è¡Œåˆæ³•æ€§æ£€æŸ¥ï¼Œæ˜¯å¦åœ¨é›†åˆæ•°æ®çš„ä¸ªæ•°èŒƒå›´å†…ã€‚</p>
</blockquote>
<h3 id="3-NSGenericException"><a href="#3-NSGenericException" class="headerlink" title="3. NSGenericException"></a>3. NSGenericException</h3><p>NSGenericExceptionè¿™ä¸ªå¼‚å¸¸æœ€å®¹æ˜“å‡ºç°åœ¨foreachæ“ä½œä¸­ã€‚åœ¨for-inå¾ªç¯ä¸­å¦‚æœä¿®æ”¹æ‰€éå†çš„æ•°ç»„ï¼Œæ— è®ºä½ æ˜¯addæˆ–removeï¼Œéƒ½ä¼šå‡ºé”™ã€‚â€for-inâ€çš„å†…éƒ¨éå†ä½¿ç”¨äº†ç±»ä¼¼Iteratorè¿›è¡Œè¿­ä»£éå†ï¼Œä¸€æ—¦å…ƒç´ å˜åŠ¨ï¼Œä¹‹å‰çš„å…ƒç´ å…¨éƒ¨è¢«å¤±æ•ˆã€‚</p>
<blockquote>
<p>åœ¨foreachçš„å¾ªç¯å½“ä¸­ï¼Œæœ€å¥½ä¸è¦å»è¿›è¡Œå…ƒç´ çš„ä¿®æ”¹åŠ¨ä½œï¼Œè‹¥éœ€è¦ä¿®æ”¹ï¼Œå¾ªç¯æ”¹ä¸ºforéå†ï¼Œç”±äºå†…éƒ¨æœºåˆ¶ä¸åŒï¼Œä¸ä¼šäº§ç”Ÿä¿®æ”¹åç»“æœå¤±æ•ˆçš„é—®é¢˜ã€‚</p>
</blockquote>
<h3 id="4-NSInternalInconsistencyException"><a href="#4-NSInternalInconsistencyException" class="headerlink" title="4. NSInternalInconsistencyException"></a>4. NSInternalInconsistencyException</h3><p>ä¸ä¸€è‡´å¯¼è‡´å‡ºç°çš„å¼‚å¸¸ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>NSDictionaryå½“åšNSMutableDictionaryæ¥ä½¿ç”¨ï¼Œä»ä»–ä»¬å†…éƒ¨çš„æœºç†æ¥è¯´ï¼Œå°±ä¼šäº§ç”Ÿä¸€äº›é”™è¯¯</li>
</ul>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSMutableDictionary</span> *info = method <span class="keyword">return</span> to <span class="built_in">NSDictionary</span> type;</span><br><span class="line">[info setObject:<span class="string">@&quot;sxm&quot;</span> forKey:<span class="string">@&quot;name&quot;</span>];</span><br></pre></td></tr></table></figure>

<ul>
<li>xibç•Œé¢ä½¿ç”¨æˆ–è€…çº¦æŸè®¾ç½®ä¸å½“</li>
</ul>
<h3 id="5-NSFileHandleOperationException"><a href="#5-NSFileHandleOperationException" class="headerlink" title="5. NSFileHandleOperationException"></a>5. NSFileHandleOperationException</h3><p>å¤„ç†æ–‡ä»¶æ—¶çš„ä¸€äº›å¼‚å¸¸ï¼Œæœ€å¸¸è§çš„è¿˜æ˜¯å­˜å‚¨ç©ºé—´ä¸è¶³çš„é—®é¢˜ï¼Œæ¯”å¦‚åº”ç”¨é¢‘ç¹çš„ä¿å­˜æ–‡æ¡£ï¼Œç¼“å­˜èµ„æ–™æˆ–è€…å¤„ç†æ¯”è¾ƒå¤§çš„æ•°æ®ã€‚</p>
<blockquote>
<p>åœ¨æ–‡ä»¶å¤„ç†é‡Œï¼Œéœ€è¦è€ƒè™‘åˆ°æ‰‹æœºå­˜å‚¨ç©ºé—´çš„é—®é¢˜ã€‚</p>
</blockquote>
<h3 id="6-NSMallocException"><a href="#6-NSMallocException" class="headerlink" title="6. NSMallocException"></a>6. NSMallocException</h3><p>è¿™ä¹Ÿæ˜¯å†…å­˜ä¸è¶³çš„é—®é¢˜ï¼Œæ— æ³•åˆ†é…è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ã€‚</p>
<h3 id="7-å…¶ä»–å¸¸è§Crash"><a href="#7-å…¶ä»–å¸¸è§Crash" class="headerlink" title="7. å…¶ä»–å¸¸è§Crash"></a>7. å…¶ä»–å¸¸è§Crash</h3><ul>
<li>KVOç›¸å…³Crash<ul>
<li>ç§»é™¤æœªæ³¨å†Œçš„è§‚å¯Ÿè€…</li>
<li>é‡å¤ç§»é™¤è§‚å¯Ÿè€…</li>
<li>æ·»åŠ äº†è§‚å¯Ÿè€…ä½†æ˜¯æ²¡æœ‰å®ç° <code>-observeValueForKeyPath:ofObject:change:context:</code>æ–¹æ³•</li>
<li>æ·»åŠ ç§»é™¤keypath&#x3D;nil</li>
<li>æ·»åŠ ç§»é™¤observer&#x3D;nil</li>
</ul>
</li>
<li>unrecognized selector sent to instanceï¼ˆè¿™ç§ä¹Ÿç»å¸¸æ˜¯é‡æŒ‡é’ˆé—®é¢˜ï¼‰</li>
</ul>
<h2 id="äºŒã€Unix-Signal-Exception"><a href="#äºŒã€Unix-Signal-Exception" class="headerlink" title="äºŒã€Unix Signal Exception"></a>äºŒã€Unix Signal Exception</h2><h3 id="å¸¸è§ä¿¡å·ç±»å‹"><a href="#å¸¸è§ä¿¡å·ç±»å‹" class="headerlink" title="å¸¸è§ä¿¡å·ç±»å‹"></a>å¸¸è§ä¿¡å·ç±»å‹</h3><ol>
<li><p><strong>SIGHUP</strong></p>
<ul>
<li>æœ¬ä¿¡å·åœ¨ç”¨æˆ·ç»ˆç«¯è¿æ¥(æ­£å¸¸æˆ–éæ­£å¸¸)ç»“æŸæ—¶å‘å‡º</li>
<li>é€šå¸¸æ˜¯åœ¨ç»ˆç«¯çš„æ§åˆ¶è¿›ç¨‹ç»“æŸæ—¶ï¼Œé€šçŸ¥åŒä¸€sessionå†…çš„å„ä¸ªä½œä¸š</li>
</ul>
</li>
<li><p><strong>SIGINT</strong></p>
<ul>
<li>ç¨‹åºç»ˆæ­¢(interrupt)ä¿¡å·</li>
<li>åœ¨ç”¨æˆ·é”®å…¥INTRå­—ç¬¦(é€šå¸¸æ˜¯Ctrl-C)æ—¶å‘å‡ºï¼Œç”¨äºé€šçŸ¥å‰å°è¿›ç¨‹ç»„ç»ˆæ­¢è¿›ç¨‹</li>
</ul>
</li>
<li><p><strong>SIGQUIT</strong></p>
<ul>
<li>ç±»ä¼¼SIGINTï¼Œä½†ç”±QUITå­—ç¬¦(é€šå¸¸æ˜¯Ctrl-)æ¥æ§åˆ¶</li>
<li>è¿›ç¨‹åœ¨å› æ”¶åˆ°SIGQUITé€€å‡ºæ—¶ä¼šäº§ç”Ÿcoreæ–‡ä»¶</li>
</ul>
</li>
<li><p><strong>SIGABRT</strong></p>
<ul>
<li>è°ƒç”¨abortå‡½æ•°ç”Ÿæˆçš„ä¿¡å·</li>
</ul>
</li>
<li><p><strong>SIGBUS</strong></p>
<ul>
<li>éæ³•åœ°å€ï¼ŒåŒ…æ‹¬å†…å­˜åœ°å€å¯¹é½(alignment)å‡ºé”™</li>
<li>ä¸SIGSEGVçš„åŒºåˆ«åœ¨äºåè€…æ˜¯ç”±äºå¯¹åˆæ³•å­˜å‚¨åœ°å€çš„éæ³•è®¿é—®è§¦å‘çš„</li>
</ul>
</li>
<li><p><strong>SIGFPE</strong></p>
<ul>
<li>è‡´å‘½çš„ç®—æœ¯è¿ç®—é”™è¯¯ä¿¡å·</li>
<li>åŒ…æ‹¬æµ®ç‚¹è¿ç®—é”™è¯¯ã€æº¢å‡ºåŠé™¤æ•°ä¸º0ç­‰</li>
</ul>
</li>
<li><p><strong>SIGKILL</strong></p>
<ul>
<li>ç”¨æ¥ç«‹å³ç»“æŸç¨‹åºçš„è¿è¡Œ</li>
<li>æœ¬ä¿¡å·ä¸èƒ½è¢«é˜»å¡ã€å¤„ç†å’Œå¿½ç•¥</li>
</ul>
</li>
<li><p><strong>SIGSEGV</strong></p>
<ul>
<li>è¯•å›¾è®¿é—®æœªåˆ†é…ç»™è‡ªå·±çš„å†…å­˜</li>
<li>è¯•å›¾å¾€æ²¡æœ‰å†™æƒé™çš„å†…å­˜åœ°å€å†™æ•°æ®</li>
</ul>
</li>
<li><p><strong>SIGPIPE</strong></p>
<ul>
<li>ç®¡é“ç ´è£‚</li>
<li>é€šå¸¸åœ¨è¿›ç¨‹é—´é€šä¿¡äº§ç”Ÿ</li>
</ul>
</li>
</ol>
<h3 id="iOSä¸­å¸¸è§çš„ç³»ç»Ÿä¿¡å·"><a href="#iOSä¸­å¸¸è§çš„ç³»ç»Ÿä¿¡å·" class="headerlink" title="iOSä¸­å¸¸è§çš„ç³»ç»Ÿä¿¡å·"></a>iOSä¸­å¸¸è§çš„ç³»ç»Ÿä¿¡å·</h3><p>åœ¨iOS crashä¸­ä¸»è¦æ˜¯SIGKILLã€SIGSEGVã€SIGABRTã€SIGTRAPï¼Œå¼•èµ·ç³»ç»Ÿä¿¡å·crashä¸»è¦æœ‰å†…å­˜æ³„éœ²ã€é‡æŒ‡é’ˆç­‰ã€‚</p>
<h3 id="ç‰¹æ®Šç±»å‹Crash"><a href="#ç‰¹æ®Šç±»å‹Crash" class="headerlink" title="ç‰¹æ®Šç±»å‹Crash"></a>ç‰¹æ®Šç±»å‹Crash</h3><table>
<thead>
<tr>
<th>é”™è¯¯ç </th>
<th>å«ä¹‰</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>0x8badf00d</td>
<td>â€œate bad foodâ€</td>
<td>åœ¨å¯åŠ¨ã€ç»ˆæ­¢åº”ç”¨æˆ–å“åº”ç³»ç»Ÿäº‹ä»¶èŠ±è´¹è¿‡é•¿æ—¶é—´</td>
</tr>
<tr>
<td>0xdeadfa11</td>
<td>â€œdead fallâ€</td>
<td>ç”¨æˆ·å¼ºåˆ¶é€€å‡ºï¼ˆç³»ç»Ÿæ— å“åº”æ—¶ï¼Œç”¨æˆ·æŒ‰ç”µæºå¼€å…³å’ŒHOMEï¼‰</td>
</tr>
<tr>
<td>0xbaaaaaad</td>
<td>-</td>
<td>ç”¨æˆ·æŒ‰ä½Homeé”®å’ŒéŸ³é‡é”®ï¼Œè·å–å½“å‰å†…å­˜çŠ¶æ€ï¼Œä¸ä»£è¡¨å´©æºƒ</td>
</tr>
<tr>
<td>0xbad22222</td>
<td>-</td>
<td>VoIPåº”ç”¨å› ä¸ºæ¢å¤å¾—å¤ªé¢‘ç¹å¯¼è‡´crash</td>
</tr>
<tr>
<td>0xc00010ff</td>
<td>â€œcool offâ€</td>
<td>å› ä¸ºå¤ªçƒ«äº†è¢«å¹²æ‰</td>
</tr>
<tr>
<td>0xdead10cc</td>
<td>â€œdead lockâ€</td>
<td>å› ä¸ºåœ¨åå°æ—¶ä»ç„¶å æ®ç³»ç»Ÿèµ„æºï¼ˆæ¯”å¦‚é€šè®¯å½•ï¼‰è¢«å¹²æ‰</td>
</tr>
</tbody></table>
<h2 id="ä¸‰ã€Crashè§£å†³æ–¹æ¡ˆ"><a href="#ä¸‰ã€Crashè§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€Crashè§£å†³æ–¹æ¡ˆ"></a>ä¸‰ã€Crashè§£å†³æ–¹æ¡ˆ</h2><h3 id="1-Objective-C-Exceptionå¤„ç†"><a href="#1-Objective-C-Exceptionå¤„ç†" class="headerlink" title="1. Objective-C Exceptionå¤„ç†"></a>1. Objective-C Exceptionå¤„ç†</h3><p>NSInvalidArgumentExceptionã€NSRangeExceptionè¿™ä¸€ç±»å¾ˆå¥½é‡ç°ï¼Œèƒ½å¤Ÿå¤ç°å®šä½å°±å¥½è§£å†³ã€‚éœ€è¦å†™ä»£ç çš„æ—¶å€™å¤šåšéªŒè¯ï¼Œä¹Ÿå¯ä»¥æŠŠä¸€äº›éªŒè¯å†™å‡ºcategoryï¼Œç»Ÿä¸€ä½¿ç”¨ã€‚</p>
<p>ä¾‹å¦‚æ•°ç»„è®¿é—®å®‰å…¨å°è£…ï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line">- (<span class="type">id</span>)safeObjectAtIndex:(<span class="built_in">NSUInteger</span>)index &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="keyword">self</span>.count) &#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="keyword">self</span> objectAtIndex:index];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)safeAddObject:(<span class="type">id</span>)object &#123;</span><br><span class="line">    <span class="keyword">if</span> (object) &#123;</span><br><span class="line">        [<span class="keyword">self</span> addObject:object];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ä»£ç ç»Ÿä¸€ä½¿ç”¨ï¼Œå¯ä»¥é¿å…ä¸€äº›é—®é¢˜ã€‚è¿˜å¯ä»¥åœ¨æœ‰å¼‚å¸¸çš„æ—¶å€™åŠ å…¥æ—¥å¿—æˆ–è€…ä¸ŠæŠ¥ã€‚</p>
<h3 id="2-ä¿¡å·ç±»Crashå¤„ç†"><a href="#2-ä¿¡å·ç±»Crashå¤„ç†" class="headerlink" title="2. ä¿¡å·ç±»Crashå¤„ç†"></a>2. ä¿¡å·ç±»Crashå¤„ç†</h3><ul>
<li>ä¸»è¦é€šè¿‡åˆ†ææ˜¯å¦æ˜¯ç³»ç»Ÿcrashï¼Œè¿˜æ˜¯å†…å­˜æ³„éœ²ã€å¤šçº¿ç¨‹é—®é¢˜ç­‰</li>
<li>å†…å­˜æ³„éœ²å¯ä»¥é€šè¿‡instrumentå®šä½ï¼Œä¹Ÿå¯ä»¥åœ¨Xcodeå¼€å¯zombieé€‰é¡¹å®šä½</li>
<li>retain-cycleå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·æ£€æµ‹</li>
</ul>
<h3 id="3-Crashä¸ŠæŠ¥æœºåˆ¶"><a href="#3-Crashä¸ŠæŠ¥æœºåˆ¶" class="headerlink" title="3. Crashä¸ŠæŠ¥æœºåˆ¶"></a>3. Crashä¸ŠæŠ¥æœºåˆ¶</h3><p>å®é™…é¡¹ç›®ä¸­é€šå¸¸ä¼šæ¥å…¥crashä¸ŠæŠ¥å·¥å…·ï¼Œå¦‚è…¾è®¯Buglyã€‚è¿™äº›ä¸ŠæŠ¥åŸç†æ˜¯æ³¨å†Œå¯¹åº”çš„å¤„ç†handleUncaughtExceptionå’Œä¿¡å·handleï¼š</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¼‚å¸¸å¤„ç†</span></span><br><span class="line"><span class="type">void</span> InstallUncaughtExceptionHandler(<span class="type">void</span>) &#123;</span><br><span class="line">    <span class="built_in">NSSetUncaughtExceptionHandler</span>(&amp;handleUncaughtException);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> handleUncaughtException(<span class="built_in">NSException</span> *exception) &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *crashInfo = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;Exception nameï¼š%@\nException reasonï¼š%@\nException stackï¼š%@&quot;</span>,</span><br><span class="line">                          [exception name], </span><br><span class="line">                          [exception reason], </span><br><span class="line">                          [exception callStackSymbols]];</span><br><span class="line">    [CrashReporter saveCrash:crashInfo];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿¡å·ç›‘å¬</span></span><br><span class="line"><span class="type">void</span> InstallSignalHandler(<span class="type">void</span>) &#123;</span><br><span class="line">    signal(SIGHUP, handleSignalException);</span><br><span class="line">    signal(SIGINT, handleSignalException);</span><br><span class="line">    signal(SIGQUIT, handleSignalException);</span><br><span class="line">    signal(SIGABRT, handleSignalException);</span><br><span class="line">    signal(SIGILL, handleSignalException);</span><br><span class="line">    signal(SIGSEGV, handleSignalException);</span><br><span class="line">    signal(SIGFPE, handleSignalException);</span><br><span class="line">    signal(SIGBUS, handleSignalException);</span><br><span class="line">    signal(SIGPIPE, handleSignalException);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> handleSignalException(<span class="type">int</span> signal) &#123;</span><br><span class="line">    <span class="built_in">NSMutableString</span> *crashInfo = [[<span class="built_in">NSMutableString</span> alloc] init];</span><br><span class="line">    [crashInfo appendString:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;signal:%d\n&quot;</span>, signal]];</span><br><span class="line">    [crashInfo appendString:<span class="string">@&quot;Stack:\n&quot;</span>];</span><br><span class="line">  </span><br><span class="line">    <span class="type">void</span> *callstack[<span class="number">128</span>];</span><br><span class="line">    <span class="type">int</span> frames = backtrace(callstack, <span class="number">128</span>);</span><br><span class="line">    <span class="type">char</span> **strs = backtrace_symbols(callstack, frames);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; frames; ++i) &#123;</span><br><span class="line">        [crashInfo appendFormat:<span class="string">@&quot;%s\n&quot;</span>, strs[i]];</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    [CrashReporter saveCrash:crashInfo];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·crashçš„æ—¶å€™å­˜å‚¨crashä¿¡æ¯ï¼Œç„¶åå†æ¬¡å¯åŠ¨å¯¹åº”ä¸ŠæŠ¥ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šè¿˜æœ‰ä¸€äº›æ¿€è¿›çš„å¤„ç†æ–¹æ³•ï¼Œhookç³»ç»Ÿå¯¹åº”å‡½æ•°ä¸è®©app crashã€‚ä½†å³ä¾¿ä¸crashï¼Œå‡ºäº†é—®é¢˜appä½“éªŒä¹Ÿä¸å¥½äº†ï¼Œä¹Ÿå¯èƒ½ç”¨ä¸äº†äº†ã€‚å»ºè®®è°¨æ…ä½¿ç”¨è¿™ç§æ–¹æ¡ˆã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>è°ƒè¯•</tag>
        <tag>é”™è¯¯å¤„ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>iOSå­—ç¬¦ä¸²å®‰å…¨æˆªå–åŠä»»æ„ä½ç½®æ’å…¥</title>
    <url>/2021/04/22/iOS%E5%AD%97%E7%AC%A6%E5%92%8C%E5%AD%97%E7%B4%A0%E7%B0%87/</url>
    <content><![CDATA[<h2 id="ä¸€ä¸ªå°é—®é¢˜å¼•èµ·çš„æ€è€ƒ"><a href="#ä¸€ä¸ªå°é—®é¢˜å¼•èµ·çš„æ€è€ƒ" class="headerlink" title="ä¸€ä¸ªå°é—®é¢˜å¼•èµ·çš„æ€è€ƒ"></a>ä¸€ä¸ªå°é—®é¢˜å¼•èµ·çš„æ€è€ƒ</h2><p>æœ€è¿‘åšä¸€ä¸ªè¾“å…¥æ¡†ç²˜è´´æ’å…¥æ–‡å­—çš„éœ€æ±‚æ—¶é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼š</p>
<p>è¾“å…¥æ¡†ä¸­è¾“å…¥äº†æ–‡å­—å’Œè¡¨æƒ…ç¬¦ğŸ˜ƒğŸ˜ƒğŸ˜ƒï¼ˆemojiï¼‰è®¡ç®—å‡ºçš„å…‰æ ‡locationå’Œå®é™…æ„Ÿå®˜ä¸Šçš„å­—ç¬¦ä¸ªæ•°ä¸ä¸€è‡´ï¼Œæœ€åå¯¼è‡´æ–‡å­—æ’å…¥çš„ä½ç½®ä¸å¯¹ã€‚</p>
<p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>æŸ¥é˜…èµ„æ–™å‘ç°æ˜¯Unicodeç¼–ç å’ŒUTF-16ç¼–ç çš„è®¾è®¡ç‰¹ç‚¹å¯¼è‡´çš„æ­¤ç°è±¡ã€‚</p>
<h2 id="å­—ç¬¦å’Œå­—ç´ ç°‡å®šä¹‰è¯´æ˜"><a href="#å­—ç¬¦å’Œå­—ç´ ç°‡å®šä¹‰è¯´æ˜" class="headerlink" title="å­—ç¬¦å’Œå­—ç´ ç°‡å®šä¹‰è¯´æ˜"></a>å­—ç¬¦å’Œå­—ç´ ç°‡å®šä¹‰è¯´æ˜</h2><blockquote>
<p>Characters and Grapheme Clusters</p>
</blockquote>
<blockquote>
<p>Itâ€™s common to think of a string as a sequence of characters, but when working with <code>NSString</code> objects, or with Unicode strings in general, in most cases it is better to deal with substrings rather than with individual characters. The reason for this is that what the user perceives as a character in text may in many cases be represented by multiple characters in the string. <code>NSString</code> has a large inventory of methods for properly handling Unicode strings, which in general make Unicode compliance easy, but there are a few precautions you should observe.</p>
</blockquote>
<p>æˆ‘ä»¬é€šå¸¸å°†<code>String</code>è§†ä¸º<code>Characters</code>åºåˆ—ï¼Œç”¨æˆ·èƒ½çœ‹åˆ°çš„æ–‡æœ¬ä¸­çš„<code>String</code>å¯èƒ½ç”±å­—ç¬¦ä¸²ä¸­çš„å¤šä¸ª<code>Characters</code>è¡¨ç¤ºï¼Œæ‰€ä»¥åœ¨å¤„ç†<code>NSString</code>å¯¹è±¡æˆ–ä¸€èˆ¬çš„<code>Unicode</code>å­—ç¬¦ä¸²æ—¶ï¼Œå¤„ç†å­å­—ç¬¦ä¸²å¤§å¤šæ•°æƒ…å†µä¸‹æ¯”å¤„ç†å•ä¸ªå­—ç¬¦æ›´å¥½ã€‚å°½ç®¡<code>NSString</code>æœ‰å¤§é‡æ­£ç¡®å¤„ç†<code>Unicode</code>å­—ç¬¦ä¸²çš„æ–¹æ³•æ¸…å•ï¼Œä½†æ˜¯ä»æœ‰ä¸€äº›ä½ éœ€è¦æ³¨æ„çš„é¢„é˜²æªæ–½ã€‚</p>
<hr>
<blockquote>
<p><code>NSString</code> objects are conceptually UTF-16 with platform endianness. That doesnâ€™t necessarily imply anything about their internal storage mechanism; what it means is that <code>NSString</code> lengths, character indexes, and ranges are expressed in terms of UTF-16 units, and that the term â€œcharacterâ€ in <code>NSString</code> method names refers to 16-bit platform-endian UTF-16 units. This is a common convention for string objects. In most cases, clients donâ€™t need to be overly concerned with this; as long as you are dealing with substrings, the precise interpretation of the range indexes is not necessarily significant.</p>
</blockquote>
<p>ä»æ¦‚å¿µä¸Šè®²<code>NSString</code>æ˜¯<code>UTF-16</code>å¹³å°å­—èŠ‚åºç¼–ç ,ä½†è¿™å¹¶ä¸ä¸€å®šæ„å‘³ç€å…¶å†…éƒ¨å­˜å‚¨æœºåˆ¶ã€‚è¿™æ„å‘³ç€**<code>NSString</code>é•¿åº¦ï¼Œå­—ç¬¦ç´¢å¼•å’ŒèŒƒå›´ä»¥<code>UTF-16</code>å•ä½è¡¨ç¤º**ï¼Œ<code>NSString</code>æ–¹æ³•åç§°ä¸­çš„<code>â€œcharacterâ€</code>ä¸€è¯æ˜¯æŒ‡16ä½å¹³å°å­—èŠ‚åºçš„<code>UTF-16</code>å•ä½ã€‚è¿™æ˜¯å­—ç¬¦ä¸²å¯¹è±¡çš„é€šç”¨çº¦å®šã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¸å¿…å¯¹æ­¤å¤ªåœ¨æ„ï¼Œåªè¦æ‚¨æ­£åœ¨å¤„ç†å­å­—ç¬¦ä¸²ï¼ŒèŒƒå›´ç´¢å¼•çš„ç²¾ç¡®è§£é‡Šå°±ä¸ä¸€å®šå¾ˆé‡è¦ã€‚(ç²¾ç¡®ç´¢å¼•å¸¸ç”¨åœ¨å¤„ç†emojiç›¸å…³ï¼Œå¸¸è§„ä¸€ä¸ªå­—ç¬¦å‹å¯¹åº”çš„é•¿åº¦æ˜¯1ï¼Œemojiä¸åŒçš„è¡¨æƒ…å¯¹åº”çš„æ˜¯2æˆ–3)</p>
<hr>
<blockquote>
<p>The vast majority of Unicode code points used for writing living languages are represented by single UTF-16 units. However, some less common Unicode code points are represented in UTF-16 by surrogate pairs. A surrogate pair is a sequence of two UTF-16 units, taken from specific reserved ranges, that together represent a single Unicode code point. CFString has functions for converting between surrogate pairs and the UTF-32 representation of the corresponding Unicode code point. When dealing with <code>NSString</code> objects, one constraint is that substring boundaries usually should not separate the two halves of a surrogate pair. This is generally automatic for ranges returned from most Cocoa methods, but if you are constructing substring ranges yourself you should keep this in mind. However, this is not the only constraint you should consider.</p>
</blockquote>
<blockquote>
<p>åè¯è§£é‡Š</p>
<p><strong>surrogate pairs: ä»£ç†å¯¹</strong></p>
<p>UTF-16æ˜¯æ—©æœŸUnicodeé—ç•™ä¸‹çš„å†å²äº§ç‰©ï¼ŒåŸæœ¬è¢«è®¾è®¡æˆå…·æœ‰å›ºå®šå®½åº¦çš„16ä½ç¼–ç æ ¼å¼ã€‚ä¸ºæ”¯æŒè¶…è¿‡U+FFFFçš„å¢è¡¥å­—ç¬¦ï¼Œè®¾ç«‹äº†ä»£ç†æœºåˆ¶</p>
<p>åœ¨BMPå†…çš„å­—ç¬¦ï¼Œä»ç„¶æŒ‰ç…§<a href="https://baike.baidu.com/item/UTF-16">UTF-16</a>çš„ç¼–ç è§„åˆ™ï¼Œä½¿ç”¨ä¸¤ä¸ªå­—ç¬¦æ¥è¡¨ç¤ºã€‚ [1] ï¼ˆæ³¨ï¼šBMPå†…çš„å­—ç¬¦ç¼–ç ï¼Œä¸åŒ…å«ä»U+D800åˆ°U+DFFFçš„é¢„ç•™ç ä½ã€‚è¿™äº›é¢„ç•™ç ä½å°±æ°å¥½ç”¨äºæ‰©å±•å­—ç¬¦ç¼–ç ï¼‰</p>
<p>å¢è¡¥å­—ç¬¦çš„ç¼–ç å€¼å·²ç»è¶…è¿‡äº†BMPçš„ç¼–ç èŒƒå›´ï¼Œæ‰€ä»¥ï¼Œéœ€è¦ä½¿ç”¨ä¸€å¯¹UTF-16å­—ç¬¦æ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚UTF-16ç¼–ç ä»¥16ä½æ— ç¬¦å·æ•´æ•°ä¸ºå•ä½ã€‚æˆ‘ä»¬æŠŠUnicodeç¼–ç è®°ä½œUã€‚ç¼–ç è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>å¦‚æœU&lt;0x10000ï¼ŒUçš„UTF-16ç¼–ç å°±æ˜¯Uå¯¹åº”çš„16ä½æ— ç¬¦å·æ•´æ•°ã€‚</p>
</li>
<li><p>å¦‚æœUâ‰¥0x10000ï¼Œ</p>
</li>
<li><ul>
<li>æˆ‘ä»¬å…ˆè®¡ç®—Uâ€™&#x3D;U-0x10000ï¼Œ</li>
<li>ç„¶åå°†Uâ€™å†™æˆäºŒè¿›åˆ¶å½¢å¼ï¼šyyyy yyyy yyxx xxxx xxxxï¼Œ</li>
<li>Uçš„UTF-16ç¼–ç ï¼ˆäºŒè¿›åˆ¶ï¼‰å°±æ˜¯ï¼š110110yyyyyyyyyy 110111xxxxxxxxxxã€‚</li>
</ul>
</li>
</ul>
<p>è¿™ä¸¤ä¸ªå­—ç¬¦å°±ç§°ä¸ºsurrogate pairï¼ˆä»£ç†å¯¹ï¼‰ã€‚ç¬¬ä¸€ä¸ªä»£ç†å­—ç¬¦ä¸º16ä½ç¼–ç ï¼ŒèŒƒå›´ä¸ºU+D800åˆ°U+DFFFï¼Œç¬¬äºŒä¸ªä»£ç†å­—ç¬¦ä¹Ÿæ˜¯ä¸€ä¸ª16ä½ç¼–ç ï¼ŒèŒƒå›´ä¸ºU+DC00 to U+DFFFã€‚</p>
</blockquote>
<p>ä¸–ç•Œä¸Šå­˜åœ¨çš„è¯­è¨€ä¸­ç»å¤§å¤šæ•°çš„<code>Unicode </code>ç¼–ç éƒ½ç”±å•ä¸ª<code>UTF-16</code>å•å…ƒè¡¨ç¤ºï¼Œä½†æ˜¯ä»ç„¶æœ‰å°‘éƒ¨åˆ†<code>Unicode</code>ç¼–ç æ˜¯ä½¿ç”¨ä»£ç†å¯¹<code>surrogate pairs</code>æ¥è¡¨ç¤ºã€‚ä»£ç†å¯¹æ˜¯ä»ç‰¹å®šä¿ç•™èŒƒå›´ä¸­æå–çš„ä¸¤ä¸ª<code>UTF-16</code>å•å…ƒçš„åºåˆ—ï¼Œå®ƒä»¬ä¸€èµ·ä»£è¡¨ä¸€ä¸ª<code>Unicode</code>ä»£ç ç‚¹ã€‚<code>CFString</code>å…·æœ‰åœ¨ä»£ç†å¯¹å’Œç›¸åº”<code>Unicode</code>ä»£ç ç‚¹çš„<code>UTF-32</code>è¡¨ç¤ºä¹‹é—´è¿›è¡Œè½¬æ¢çš„åŠŸèƒ½ã€‚å¤„ç†<code>NSString</code>æ—¶ï¼Œå­å­—ç¬¦ä¸²è¾¹ç•Œä¸åº”å°†ä»£ç†å¯¹çš„ä¸¤åŠåˆ†å¼€ï¼Œ<strong>å¤§å¤šæ•°<code>Cocoa </code>æ–¹æ³•ä¼šè‡ªåŠ¨è¿”å›æ­£ç¡®çš„<code>Range</code></strong>ï¼Œä½†æ˜¯å¦‚æœæ‚¨è‡ªå·±æ„é€ å­å­—ç¬¦ä¸²èŒƒå›´ï¼Œåˆ™åº”ç‰¢è®°è¿™ä¸€ç‚¹ã€‚ä½†æ˜¯ï¼Œè¿™ä¸æ˜¯æ‚¨åº”è¯¥è€ƒè™‘çš„å”¯ä¸€çº¦æŸã€‚</p>
<hr>
<blockquote>
<p>In many writing systems, a single character may be composed of a base letter plus an accent or other decoration. The number of possible letters and accents precludes Unicode from representing each combination as a single code point, so in general such combinations are represented by a base character followed by one or more combining marks. For compatibility reasons, Unicode does have single code points for a number of the most common combinations; these are referred to as precomposed forms, and Unicode normalization transformations can be used to convert between precomposed and decomposed representations. However, even if a string is fully precomposed, there are still many combinations that must be represented using a base character and combining marks. For most text processing, substring ranges should be arranged so that their boundaries do not separate a base character from its associated combining marks.</p>
</blockquote>
<p>åœ¨è®¸å¤šä¹¦å†™ç³»ç»Ÿä¸­ï¼Œå•ä¸ªå­—ç¬¦å¯ä»¥ç”±ä¸€ä¸ªåŸºæœ¬å­—æ¯åŠ ä¸Šä¸€ä¸ªé‡éŸ³ç¬¦å·æˆ–å…¶ä»–è£…é¥°ç»„æˆã€‚å¯èƒ½çš„å­—æ¯å’Œé‡éŸ³çš„æ•°é‡ä½¿Unicodeæ— æ³•å°†æ¯ä¸ªç»„åˆè¡¨ç¤ºä¸ºå•ä¸ªä»£ç ç‚¹ï¼Œå› æ­¤ï¼Œé€šå¸¸ï¼Œæ­¤ç±»ç»„åˆç”¨åŸºæœ¬å­—ç¬¦è¡¨ç¤ºï¼Œåè·Ÿä¸€ä¸ªæˆ–å¤šä¸ªç»„åˆæ ‡è®°ã€‚å‡ºäºå…¼å®¹æ€§åŸå› ï¼ŒUnicodeç¡®å®ä¸ºè®¸å¤šæœ€å¸¸è§çš„ç»„åˆæä¾›äº†å•ä¸ªä»£ç ç‚¹ã€‚è¿™äº›è¢«ç§°ä¸ºé¢„ç»„åˆå½¢å¼ï¼Œå¹¶ä¸”Unicodeè§„èŒƒåŒ–è½¬æ¢å¯ç”¨äºåœ¨é¢„ç»„åˆå’Œåˆ†è§£è¡¨ç¤ºä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚ä½†æ˜¯ï¼Œå³ä½¿å®Œå…¨é¢„å…ˆç»„æˆäº†å­—ç¬¦ä¸²ï¼Œå¯¹äºå¤§å¤šæ•°æ–‡æœ¬å¤„ç†ï¼Œ<strong>ä¹Ÿåº”è¯¥ä½¿å­å­—ç¬¦ä¸²èŒƒå›´çš„è¾¹ç•Œä¸ä¼šå°†åŸºå­—ç¬¦ä¸å…¶ç›¸å…³çš„ç»„åˆæ ‡è®°åˆ†å¼€</strong>ã€‚</p>
<hr>
<blockquote>
<p>In addition, there are writing systems in which characters represent a combination of parts that are more complicated than accent marks. In Korean, for example, a single Hangul syllable can be composed of two or three subparts known as jamo. In the Indic and Indic-influenced writing systems common throughout South and Southeast Asia, single written characters often represent combinations of consonants, vowels, and marks such as viramas, and the Unicode representations of these writing systems often use code points for these individual parts, so that a single character may be composed of multiple code points. For most text processing, substring ranges should also be arranged so that their boundaries do not separate the jamo in a single Hangul syllable, or the components of an Indic consonant cluster.</p>
</blockquote>
<p>æ­¤å¤–ï¼Œæœ‰äº›ä¹¦å†™ç³»ç»Ÿä¸­ï¼Œå­—ç¬¦ä»£è¡¨çš„æ˜¯æ¯”é‡éŸ³ç¬¦å·æ›´å¤æ‚çš„éƒ¨åˆ†çš„ç»„åˆã€‚ä¾‹å¦‚ï¼Œåœ¨éŸ©è¯­ä¸­ï¼Œä¸€ä¸ªå•å­—éŸ³èŠ‚å¯ä»¥ç”±ä¸¤ä¸ªæˆ–ä¸‰ä¸ªè¢«ç§°ä¸ºjamoçš„å­éŸ³èŠ‚ç»„æˆã€‚åœ¨éåŠå—äºšå’Œä¸œå—äºšçš„å°åº¦è¯­å’Œå—å°åº¦è¯­å½±å“çš„ä¹¦å†™ç³»ç»Ÿä¸­ï¼Œå•ä¸ªä¹¦å†™å­—ç¬¦é€šå¸¸ä»£è¡¨è¾…éŸ³ã€å…ƒéŸ³å’Œè¯¸å¦‚viramasç­‰æ ‡è®°çš„ç»„åˆï¼Œè€Œè¿™äº›ä¹¦å†™ç³»ç»Ÿçš„Unicodeè¡¨ç¤ºé€šå¸¸ä½¿ç”¨ä»£ç ç‚¹æ¥è¡¨ç¤ºè¿™äº›å•ç‹¬çš„éƒ¨åˆ†ï¼Œä½¿å•ä¸ªå­—ç¬¦å¯ä»¥ç”±å¤šä¸ªä»£ç ç‚¹ç»„æˆã€‚å¯¹äºå¤§å¤šæ•°æ–‡æœ¬å¤„ç†ï¼Œè¿˜åº”è¯¥ä½¿å­å­—ç¬¦ä¸²èŒƒå›´çš„è¾¹ç•Œä¸ä¼šå°†jamoåˆ†éš”åœ¨å•ä¸ªéŸ©æ–‡éŸ³èŠ‚ä¸­ï¼Œä¹Ÿä¸ä¼šå°†å°åº¦è¯­è¾…éŸ³é›†ç¾¤çš„ç»„æˆéƒ¨åˆ†åˆ†å¼€ã€‚<strong>ï¼ˆç›¸å¯¹äºé‡éŸ³ç¬¦å·è¿˜æœ‰æ›´å¤æ‚çš„ç¼–ç ç»“æ„ï¼Œä¾‹å¦‚éŸ©æ–‡å’Œå°åº¦æ–‡ï¼Œå¯¹äºè¿™äº›æ›´å¤æ‚çš„ç»“æ„ä¹Ÿåº”è¯¥ä¿æŒä»£ç†å¯¹ä¸èƒ½è¢«æ‹†åˆ†ï¼‰</strong></p>
<hr>
<p>In general, these combinationsâ€”surrogate pairs, base characters plus combining marks, Hangul jamo, and Indic consonant clustersâ€”are referred to as grapheme clusters. In order to take them into account, you can use <code>NSString</code>â€™s <code>rangeOfComposedCharacterSequencesForRange:</code> or <code>rangeOfComposedCharacterSequenceAtIndex:</code> methods, or <code>CFStringGetRangeOfComposedCharactersAtIndex</code>. These can be used to adjust string indexes or substring ranges so that they fall on grapheme cluster boundaries, taking into account all of the constraints mentioned above. These methods should be the default choice for programmatically determining the boundaries of user-perceived characters.:</p>
<p>é€šå¸¸ï¼Œè¿™äº›ç»„åˆï¼ˆä»£ç†å¯¹ï¼ŒåŸºæœ¬å­—ç¬¦åŠ ç»„åˆæ ‡è®°ï¼ŒHangul jamoå’Œå°åº¦è¾…éŸ³ç°‡ï¼‰è¢«ç§°ä¸ºå­—ç´ ç°‡ã€‚ä¸ºäº†å°†å®ƒä»¬è€ƒè™‘åœ¨å†…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>NSString</code>çš„<a href="https://developer.apple.com/documentation/foundation/nsstring/1410993-rangeofcomposedcharactersequence"><code>rangeOfComposedCharacterSequencesForRange:</code></a>æˆ–<code>rangeOfComposedCharacterSequenceAtIndex:</code>æ–¹æ³•ï¼Œæˆ–<code>CFStringGetRangeOfComposedCharactersAtIndex</code>ã€‚è€ƒè™‘åˆ°ä¸Šè¿°æ‰€æœ‰çº¦æŸï¼Œè¿™äº›å¯ç”¨äºè°ƒæ•´å­—ç¬¦ä¸²ç´¢å¼•æˆ–å­å­—ç¬¦ä¸²èŒƒå›´ï¼Œä½¿å®ƒä»¬è½åœ¨å­—ç´ ç°‡è¾¹ç•Œä¸Šã€‚è¿™äº›æ–¹æ³•åº”è¯¥æ˜¯é€šè¿‡ç¼–ç¨‹ç¡®å®šç”¨æˆ·æ„ŸçŸ¥å­—ç¬¦è¾¹ç•Œçš„é»˜è®¤é€‰æ‹©ã€‚</p>
<hr>
<blockquote>
<p>In some cases, Unicode algorithms deal with multiple characters in ways that go beyond even grapheme cluster boundaries. Unicode casing algorithms may convert a single character into multiple characters when going from lowercase to uppercase; for example, the standard uppercase equivalent of the German character â€œÃŸâ€ is the two-letter sequence â€œSSâ€. Localized collation algorithms in many languages consider multiple-character sequences as single units; for example, the sequence â€œchâ€ is treated as a single letter for sorting purposes in some European languages. In order to deal properly with cases like these, it is important to use standard <code>NSString</code> methods for such operations as casing, sorting, and searching, and to use them on the entire string to which they are to apply. Use <code>NSString</code> methods such as <code>lowercaseString</code>, <code>uppercaseString</code>, <code>capitalizedString</code>, <code>compare:</code> and its variants, <code>rangeOfString:</code> and its variants, and <code>rangeOfCharacterFromSet:</code> and its variants, or their CFString equivalents. These all take into account the complexities of Unicode string processing, and the searching and sorting methods in particular have many options to control the types of equivalences they are to recognize.</p>
</blockquote>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒUnicodeç®—æ³•ä»¥ç”šè‡³è¶…å‡ºå­—ç´ ç°‡è¾¹ç•Œçš„æ–¹å¼å¤„ç†å¤šä¸ªå­—ç¬¦ã€‚ä»å°å†™å˜ä¸ºå¤§å†™æ—¶ï¼ŒUnicodeå¤§å°å†™ç®—æ³•å¯ä»¥å°†å•ä¸ªå­—ç¬¦è½¬æ¢ä¸ºå¤šä¸ªå­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œå¾·è¯­å­—ç¬¦â€œÃŸâ€çš„æ ‡å‡†å¤§å†™å­—æ¯ç­‰åŒäºä¸¤ä¸ªå­—æ¯çš„åºåˆ—â€œ SSâ€ã€‚</p>
<p>è®¸å¤šè¯­è¨€ä¸­çš„æœ¬åœ°åŒ–æ’åºè§„åˆ™ç®—æ³•å°†å¤šå­—ç¬¦åºåˆ—è§†ä¸ºå•ä¸ªå•å…ƒã€‚ä¾‹å¦‚åœ¨æŸäº›æ¬§æ´²è¯­è¨€ä¸­ï¼Œå‡ºäºæ’åºç›®çš„ï¼Œåºåˆ—â€œ châ€è¢«è§†ä¸ºå•ä¸ªå­—æ¯ã€‚</p>
<p>åœ¨æ•´ä¸ªå­—ç¬¦ä¸²ä¸Šä½¿ç”¨æ ‡å‡†<code>NSString</code>æ–¹æ³•è¿›è¡Œè¯¸å¦‚å¤§å°å†™ï¼Œæ’åºå’Œæœç´¢ä¹‹ç±»çš„æ“ä½œå¯ä»¥æ­£ç¡®å¤„ç†æ­¤ç±»æƒ…å†µã€‚ä½¿ç”¨<code>NSString</code>æ–¹æ³•ï¼Œå¦‚<code>lowercaseString</code>ï¼Œ<code>uppercaseString</code>ï¼Œ<code>capitalizedString</code>ï¼Œ<code>compare:</code>å’Œå…¶å˜ä½“ï¼Œ<code>rangeOfString:</code>å’Œå…¶å˜ä½“ï¼Œå’Œ<code>rangeOfCharacterFromSet:</code>å…¶å˜ä½“ï¼Œæˆ–å®ƒä»¬çš„ç­‰ä»·CFStringå­—ç¬¦ä¸²æ–¹æ³•ã€‚</p>
<p>æ‰€æœ‰è¿™äº›éƒ½è€ƒè™‘åˆ°äº†Unicodeå­—ç¬¦ä¸²å¤„ç†çš„å¤æ‚æ€§ï¼Œç‰¹åˆ«æ˜¯æœç´¢å’Œæ’åºæ–¹æ³•å…·æœ‰è®¸å¤šé€‰é¡¹æ¥æ§åˆ¶å®ƒä»¬è¦è¯†åˆ«çš„ç­‰ä»·ç±»å‹ã€‚</p>
<hr>
<blockquote>
<p>In some less common cases, it may be necessary to tailor the definition of grapheme clusters to a particular need. The issues involved in determining and tailoring grapheme cluster boundaries are covered in detail in <a href="http://unicode.org/reports/tr29/">Unicode Standard Annex #29</a>, which gives a number of examples and some algorithms. The Unicode standard in general is the best source for information about Unicode algorithms and the considerations involved in processing Unicode strings.</p>
<p>If you are interested in grapheme cluster boundaries from the point of view of cursor movement and insertion point positioning, and you are using the Cocoa text system, you should know that on OS X v10.5 and later, <code>NSLayoutManager</code> has API support for determining insertion point positions within a line of text as it is laid out. Note that insertion point boundaries are not identical to glyph boundaries; a ligature glyph in some cases, such as an â€œfiâ€ ligature in Latin script, may require an internal insertion point on a user-perceived character boundary. See <em><a href="https://developer.apple.com/library/archive/documentation/TextFonts/Conceptual/CocoaTextArchitecture/Introduction/Introduction.html#//apple_ref/doc/uid/TP40009459">Cocoa Text Architecture Guide</a></em> for more information.</p>
</blockquote>
<p>åœ¨ä¸€äº›ä¸å¤ªå¸¸è§çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½æœ‰å¿…è¦æ ¹æ®ç‰¹å®šéœ€è¦å®šåˆ¶å­—ç´ ç°‡çš„å®šä¹‰ã€‚<a href="http://unicode.org/reports/tr29/">Unicodeæ ‡å‡†é™„ä»¶ï¼ƒ29</a>ä¸­è¯¦ç»†ä»‹ç»äº†ç¡®å®šå’Œè°ƒæ•´å­—ç´ ç°‡è¾¹ç•Œçš„é—®é¢˜ï¼Œè¯¥<a href="http://unicode.org/reports/tr29/">é™„ä»¶</a>æä¾›äº†è®¸å¤šç¤ºä¾‹å’Œä¸€äº›ç®—æ³•ã€‚é€šå¸¸ï¼ŒUnicodeæ ‡å‡†æ˜¯æœ‰å…³Unicodeç®—æ³•ä»¥åŠå¤„ç†Unicodeå­—ç¬¦ä¸²æ‰€æ¶‰åŠçš„æ³¨æ„äº‹é¡¹çš„æœ€ä½³ä¿¡æ¯æ¥æºã€‚</p>
<p>å¦‚æœæ‚¨ä»å…‰æ ‡ç§»åŠ¨å’Œæ’å…¥ç‚¹å®šä½çš„è§’åº¦å¯¹å­—å½¢ç°‡è¾¹ç•Œæ„Ÿå…´è¶£ï¼Œå¹¶ä¸”æ‚¨æ­£åœ¨ä½¿ç”¨Cocoaæ–‡æœ¬ç³»ç»Ÿï¼Œåˆ™åº”è¯¥çŸ¥é“åœ¨OS X v10.5å’Œæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œ<code>NSLayoutManager</code>APIæ”¯æŒç¡®å®šæ’å…¥ç‚¹å¸ƒç½®åœ¨ä¸€è¡Œæ–‡æœ¬ä¸­çš„ä½ç½®ã€‚è¯·æ³¨æ„ï¼Œæ’å…¥ç‚¹è¾¹ç•Œä¸å­—å½¢è¾¹ç•Œä¸åŒï¼›åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿å­—å­—å½¢ï¼ˆä¾‹å¦‚æ‹‰ä¸è¯­è„šæœ¬ä¸­çš„â€œ fiâ€è¿å­—ï¼‰å¯èƒ½éœ€è¦åœ¨ç”¨æˆ·æ„ŸçŸ¥çš„å­—ç¬¦è¾¹ç•Œä¸Šçš„å†…éƒ¨æ’å…¥ç‚¹ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ã€Š<em><a href="https://developer.apple.com/library/archive/documentation/TextFonts/Conceptual/CocoaTextArchitecture/Introduction/Introduction.html#//apple_ref/doc/uid/TP40009459">Cocoaæ–‡æœ¬ä½“ç³»ç»“æ„æŒ‡å—ã€‹</a></em>ã€‚</p>
<h2 id="ä¸€ç§å®‰å…¨æˆªå–çš„æ–¹æ³•"><a href="#ä¸€ç§å®‰å…¨æˆªå–çš„æ–¹æ³•" class="headerlink" title="ä¸€ç§å®‰å…¨æˆªå–çš„æ–¹æ³•"></a>ä¸€ç§å®‰å…¨æˆªå–çš„æ–¹æ³•</h2><p>ç”±ä¸Šæ–‡å¯çŸ¥ String æä¾›ç³»ç»Ÿæ–¹æ³•æ¥è¯†åˆ«å®Œæ•´çš„å¯è§å­—ç¬¦</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">rangeOfComposedCharacterSequencesForRange:</span><br><span class="line">rangeOfComposedCharacterSequenceAtIndex:</span><br><span class="line">è¿™ä¸¤ä¸ªæ–¹æ³•è¿”å›äº†ç»™å®šrangeå†…åŒ…å«çš„å®Œæ•´å­—ç¬¦çš„ç´¢å¼•åœ°å€</span><br><span class="line">ç»™å®šåˆå§‹ range <span class="operator">=</span> <span class="number">0</span> <span class="number">0</span>ï¼ˆlocation <span class="operator">=</span> <span class="number">0</span>ï¼Œ length <span class="operator">=</span> <span class="number">0</span>ï¼‰</span><br><span class="line">â€œhelloâ€ è¿”å› <span class="number">0</span> <span class="number">1</span> æˆªå–ä¸º â€œhâ€</span><br><span class="line">â€œğŸ˜€helloâ€ è¿”å› <span class="number">0</span> <span class="number">2</span> æˆªå–ä¸º â€œğŸ˜€â€</span><br></pre></td></tr></table></figure>

<p><strong>å­—ç¬¦ä¸²æˆªå–æˆ–è€…åœ¨å…‰æ ‡å¤„æ’å…¥å­—ç¬¦åº”é»˜è®¤ä½¿ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•æ¥è·å–å¯è§†å­—ç¬¦è¾¹ç•Œæ¥é¿å…ä»£ç†å¯¹è¢«æ‹†å¼€å¯¼è‡´çš„æ˜¾ç¤ºbug</strong></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// åœ¨å­—ç¬¦ä¸²ä¸­å…‰æ ‡ä½ç½®æ’å…¥å­å­—ç¬¦ä¸²çš„æ–¹æ³• </span></span><br><span class="line"><span class="comment">/// - Parameters:</span></span><br><span class="line"><span class="comment">///   - baseString: è¢«æ’å…¥çš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">///   - location: å…‰æ ‡ä½ç½® selectedRange.location</span></span><br><span class="line"><span class="comment">///   - insertString: è¦æ’å…¥çš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">/// - Returns: æ’å…¥åå®Œæ•´å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">insertStringTo</span>(<span class="params">baseString</span>: <span class="type">String</span>, <span class="params">location</span>: <span class="type">Int</span>, <span class="params">insertString</span>: <span class="type">String</span>) -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> leadingString <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">var</span> trailingString <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">var</span> range <span class="operator">=</span> <span class="type">NSRange</span>(location: <span class="number">0</span>, length: <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">while</span> range.length <span class="operator">&lt;</span> baseString.count &#123;</span><br><span class="line">            <span class="keyword">let</span> r <span class="operator">=</span> baseString.rangeOfComposedCharacterSequence(at: baseString.index(baseString.startIndex,</span><br><span class="line">                                                                                     offsetBy: range.length))</span><br><span class="line">            leadingString <span class="operator">=</span> <span class="type">String</span>(baseString[<span class="operator">..&lt;</span>r.upperBound])</span><br><span class="line">            trailingString <span class="operator">=</span> <span class="type">String</span>(baseString[r.upperBound<span class="operator">...</span>])  </span><br><span class="line">            <span class="keyword">if</span> location <span class="operator">&lt;=</span> leftString.count &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;<span class="subst">\(leadingString)</span><span class="subst">\(insertString)</span><span class="subst">\(trailingString)</span>&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            range <span class="operator">=</span> <span class="type">NSRange</span>(location: <span class="number">0</span>, length: leadingString.unicodeScalars.count)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç›¸å…³é“¾æ¥åŠèµ„æ–™"><a href="#ç›¸å…³é“¾æ¥åŠèµ„æ–™" class="headerlink" title="ç›¸å…³é“¾æ¥åŠèµ„æ–™"></a>ç›¸å…³é“¾æ¥åŠèµ„æ–™</h2><p><a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Strings/Articles/stringsClusters.html">åŸæ–‡é“¾æ¥å­—ç¬¦å’Œå­—ç´ ç°‡</a></p>
<p><a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Strings/introStrings.html#//apple_ref/doc/uid/10000035-SW1">å­—ç¬¦ä¸²ç¼–ç¨‹æŒ‡å—</a></p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>å¤šè¯»æ–‡æ¡£</tag>
      </tags>
  </entry>
  <entry>
    <title>iOSæ–‡ä»¶ç³»ç»Ÿç¼–ç¨‹æŒ‡å—</title>
    <url>/2025/03/12/iOS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h1 id="iOSæ–‡ä»¶ç³»ç»Ÿç¼–ç¨‹æŒ‡å—"><a href="#iOSæ–‡ä»¶ç³»ç»Ÿç¼–ç¨‹æŒ‡å—" class="headerlink" title="iOSæ–‡ä»¶ç³»ç»Ÿç¼–ç¨‹æŒ‡å—"></a>iOSæ–‡ä»¶ç³»ç»Ÿç¼–ç¨‹æŒ‡å—</h1><p><a href="https://developer.apple.com/library/archive/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/FileSystemOverview/NaN">iOSæ–‡ä»¶ç³»ç»Ÿç¼–ç¨‹æŒ‡å—</a></p>
<blockquote>
<p>æ–‡ä»¶ç³»ç»Ÿå¤„ç†æ•°æ®æ–‡ä»¶ã€åº”ç”¨ç¨‹åºä»¥åŠä¸æ“ä½œç³»ç»Ÿæœ¬èº«å…³è”çš„æ–‡ä»¶çš„æŒä¹…å­˜å‚¨ã€‚å› æ­¤ï¼Œæ–‡ä»¶ç³»ç»Ÿæ˜¯æ‰€æœ‰è¿›ç¨‹ä½¿ç”¨çš„åŸºæœ¬èµ„æºä¹‹ä¸€ã€‚</p>
<p>APFS æ˜¯ macOSã€iOSã€watchOS å’Œ tvOS ä¸­çš„é»˜è®¤æ–‡ä»¶ç³»ç»Ÿã€‚APFS å–ä»£ HFS+ ä½œä¸º iOS 10.3 åŠæ›´é«˜ç‰ˆæœ¬ä»¥åŠ macOS High Sierra åŠæ›´é«˜ç‰ˆæœ¬çš„é»˜è®¤æ–‡ä»¶ç³»ç»Ÿã€‚</p>
</blockquote>
<h2 id="å…³äº-iOS-æ–‡ä»¶ç³»ç»Ÿ"><a href="#å…³äº-iOS-æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="å…³äº iOS æ–‡ä»¶ç³»ç»Ÿ"></a>å…³äº iOS æ–‡ä»¶ç³»ç»Ÿ</h2><p>iOS æ–‡ä»¶ç³»ç»Ÿé¢å‘ç‹¬ç«‹è¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚ä¸ºäº†ä¿æŒç³»ç»Ÿç®€å•ï¼ŒiOS è®¾å¤‡çš„ç”¨æˆ·æ— æ³•ç›´æ¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿï¼Œåº”ç”¨åº”éµå¾ªæ­¤çº¦å®šã€‚</p>
<img src="https://cdn.zcx.info/202303291747602.png" style="zoom:50%;" />

<h2 id="iOS-æ ‡å‡†ç›®å½•ï¼šæ–‡ä»¶æ‰€åœ¨çš„ä½ç½®"><a href="#iOS-æ ‡å‡†ç›®å½•ï¼šæ–‡ä»¶æ‰€åœ¨çš„ä½ç½®" class="headerlink" title="iOS æ ‡å‡†ç›®å½•ï¼šæ–‡ä»¶æ‰€åœ¨çš„ä½ç½®"></a>iOS æ ‡å‡†ç›®å½•ï¼šæ–‡ä»¶æ‰€åœ¨çš„ä½ç½®</h2><table>
<thead>
<tr>
<th align="left">ç›®å½•</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>AppName.app</code></td>
<td align="left">è¿™æ˜¯åº”ç”¨ç¨‹åºçš„æ†ç»‘åŒ…ã€‚æ­¤ç›®å½•åŒ…å«åº”ç”¨ç¨‹åºåŠå…¶æ‰€æœ‰èµ„æºã€‚æ‚¨ä¸èƒ½å†™å…¥æ­¤ç›®å½•ã€‚ä¸ºé˜²æ­¢ç¯¡æ”¹ï¼Œæ†ç»‘ç›®å½•åœ¨å®‰è£…æ—¶è¿›è¡Œäº†ç­¾åã€‚å†™å…¥æ­¤ç›®å½•ä¼šæ›´æ”¹ç­¾åå¹¶é˜»æ­¢æ‚¨çš„åº”ç”¨ç¨‹åºå¯åŠ¨ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥è·å¾—å¯¹å­˜å‚¨åœ¨åº”ç”¨ç¨‹åºåŒ…ä¸­çš„ä»»ä½•èµ„æºçš„åªè¯»è®¿é—®æƒé™ã€‚æ­¤ç›®å½•çš„å†…å®¹æœªç”± iTunes æˆ– iCloud å¤‡ä»½ã€‚ä½†æ˜¯ï¼ŒiTunes ä¼šå¯¹ä» App Store è´­ä¹°çš„ä»»ä½•åº”ç”¨ç¨‹åºæ‰§è¡Œåˆå§‹åŒæ­¥ã€‚</td>
</tr>
<tr>
<td align="left"><code>Documents/</code></td>
<td align="left">ä½¿ç”¨æ­¤ç›®å½•å­˜å‚¨ç”¨æˆ·ç”Ÿæˆçš„å†…å®¹ã€‚è¯¥ç›®å½•çš„å†…å®¹å¯ä»¥é€šè¿‡æ–‡ä»¶å…±äº«æä¾›ç»™ç”¨æˆ·ï¼›å› æ­¤ï¼Œè¯¥ç›®å½•åº”è¯¥åªåŒ…å«æ‚¨å¯èƒ½å¸Œæœ›å‘ç”¨æˆ·å…¬å¼€çš„æ–‡ä»¶ã€‚æ­¤ç›®å½•çš„å†…å®¹ç”± iTunes å’Œ iCloud å¤‡ä»½ã€‚</td>
</tr>
<tr>
<td align="left"><code>Documents/Inbox</code></td>
<td align="left">ä½¿ç”¨æ­¤ç›®å½•å¯è®¿é—®å¤–éƒ¨å®ä½“è¦æ±‚æ‚¨çš„åº”ç”¨ç¨‹åºæ‰“å¼€çš„æ–‡ä»¶ã€‚å…·ä½“æ¥è¯´ï¼ŒMail ç¨‹åºå°†ä¸æ‚¨çš„åº”ç”¨ç›¸å…³è”çš„ç”µå­é‚®ä»¶é™„ä»¶æ”¾åœ¨è¯¥ç›®å½•ä¸­ã€‚æ–‡æ¡£äº¤äº’æ§åˆ¶å™¨ä¹Ÿå¯ä»¥åœ¨å…¶ä¸­æ”¾ç½®æ–‡ä»¶ã€‚æ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥è¯»å–å’Œåˆ é™¤æ­¤ç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œä½†ä¸èƒ½åˆ›å»ºæ–°æ–‡ä»¶æˆ–å†™å…¥ç°æœ‰æ–‡ä»¶ã€‚å¦‚æœç”¨æˆ·è¯•å›¾ç¼–è¾‘æ­¤ç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå¿…é¡»åœ¨è¿›è¡Œä»»ä½•æ›´æ”¹ä¹‹å‰é™é»˜å°†å…¶ç§»å‡ºç›®å½•ã€‚æ­¤ç›®å½•çš„å†…å®¹ç”± iTunes å’Œ iCloud å¤‡ä»½ã€‚</td>
</tr>
<tr>
<td align="left"><code>Library/</code></td>
<td align="left">è¿™æ˜¯æ‰€æœ‰éç”¨æˆ·æ•°æ®æ–‡ä»¶çš„é¡¶çº§ç›®å½•ã€‚æ‚¨é€šå¸¸å°†æ–‡ä»¶æ”¾åœ¨å‡ ä¸ªæ ‡å‡†å­ç›®å½•ä¹‹ä¸€ä¸­ã€‚iOS åº”ç”¨é€šå¸¸ä½¿ç”¨<code>Application Support</code>å’Œ<code>Caches</code>å­ç›®å½•ï¼›ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰å­ç›®å½•ã€‚å°†<code>Library</code>å­ç›®å½•ç”¨äºæ‚¨ä¸æƒ³å‘ç”¨æˆ·å…¬å¼€çš„ä»»ä½•æ–‡ä»¶ã€‚æ‚¨çš„åº”ç”¨ä¸åº”å°†è¿™äº›ç›®å½•ç”¨äºç”¨æˆ·æ•°æ®æ–‡ä»¶ã€‚ç›®å½•çš„å†…å®¹<code>Library</code>ï¼ˆå­ç›®å½•é™¤å¤–<code>Caches</code>ï¼‰ç”± iTunes å’Œ iCloud å¤‡ä»½ã€‚</td>
</tr>
<tr>
<td align="left"><code>tmp/</code></td>
<td align="left">ä½¿ç”¨æ­¤ç›®å½•å†™å…¥ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨ä¹‹é—´ä¿ç•™çš„ä¸´æ—¶æ–‡ä»¶ã€‚å½“ä¸å†éœ€è¦æ—¶ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºåº”ä»è¯¥ç›®å½•ä¸­åˆ é™¤æ–‡ä»¶ï¼›ä½†æ˜¯ï¼Œå½“æ‚¨çš„åº”ç”¨ç¨‹åºæœªè¿è¡Œæ—¶ï¼Œç³»ç»Ÿå¯èƒ½ä¼šæ¸…é™¤æ­¤ç›®å½•ã€‚æ­¤ç›®å½•çš„å†…å®¹æœªç”± iTunes æˆ– iCloud å¤‡ä»½ã€‚</td>
</tr>
</tbody></table>
<h2 id="APP-æ–‡ä»¶åº”è¯¥å­˜æ”¾çš„ä½ç½®"><a href="#APP-æ–‡ä»¶åº”è¯¥å­˜æ”¾çš„ä½ç½®" class="headerlink" title="APP æ–‡ä»¶åº”è¯¥å­˜æ”¾çš„ä½ç½®"></a>APP æ–‡ä»¶åº”è¯¥å­˜æ”¾çš„ä½ç½®</h2><p>ä¸ºé˜²æ­¢ iOS è®¾å¤‡ä¸Šçš„åŒæ­¥å’Œå¤‡ä»½è¿‡ç¨‹èŠ±è´¹å¾ˆé•¿æ—¶é—´ï¼Œè¯·é€‰æ‹©æ”¾ç½®æ–‡ä»¶çš„ä½ç½®ã€‚</p>
<p>å­˜å‚¨å¤§æ–‡ä»¶çš„åº”ç”¨ç¨‹åºä¼šå‡æ…¢å¤‡ä»½åˆ° iTunes æˆ– iCloud çš„è¿‡ç¨‹ã€‚</p>
<p>è¿™äº›åº”ç”¨ç¨‹åºè¿˜ä¼šå ç”¨ç”¨æˆ·çš„å¤§é‡å¯ç”¨å­˜å‚¨ç©ºé—´ï¼Œè¿™å¯èƒ½ä¼šä¿ƒä½¿ç”¨æˆ·åˆ é™¤è¯¥åº”ç”¨ç¨‹åºæˆ–ç¦æ­¢å°†è¯¥åº”ç”¨ç¨‹åºçš„æ•°æ®å¤‡ä»½åˆ° iCloudã€‚</p>
<p>è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œæ‚¨åº”è¯¥æ ¹æ®ä»¥ä¸‹å‡†åˆ™å­˜å‚¨åº”ç”¨ç¨‹åºæ•°æ®ï¼š</p>
<ul>
<li>å°†ç”¨æˆ·æ•°æ®æ”¾å…¥<code>Documents/</code>. ç”¨æˆ·æ•°æ®é€šå¸¸åŒ…æ‹¬æ‚¨å¯èƒ½å¸Œæœ›å‘ç”¨æˆ·å…¬å¼€çš„ä»»ä½•æ–‡ä»¶â€”â€”æ‚¨å¯èƒ½å¸Œæœ›ç”¨æˆ·åˆ›å»ºã€å¯¼å…¥ã€åˆ é™¤æˆ–ç¼–è¾‘çš„ä»»ä½•æ–‡ä»¶ã€‚å¯¹äºç»˜å›¾åº”ç”¨ç¨‹åºï¼Œç”¨æˆ·æ•°æ®åŒ…æ‹¬ç”¨æˆ·å¯èƒ½åˆ›å»ºçš„ä»»ä½•å›¾å½¢æ–‡ä»¶ã€‚å¯¹äºæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå®ƒåŒ…æ‹¬æ–‡æœ¬æ–‡ä»¶ã€‚è§†é¢‘å’ŒéŸ³é¢‘åº”ç”¨ç¨‹åºç”šè‡³å¯èƒ½åŒ…å«ç”¨æˆ·ä¸‹è½½ä»¥ä¾›ç¨åè§‚çœ‹æˆ–æ”¶å¬çš„æ–‡ä»¶ã€‚</li>
<li>å°†åº”ç”¨ç¨‹åºåˆ›å»ºçš„æ”¯æŒæ–‡ä»¶æ”¾åœ¨è¯¥<code>Library/Application support/</code>ç›®å½•ä¸­ã€‚é€šå¸¸ï¼Œæ­¤ç›®å½•åŒ…å«åº”ç”¨ç¨‹åºç”¨æ¥è¿è¡Œä½†åº”è¯¥å¯¹ç”¨æˆ·éšè—çš„æ–‡ä»¶ã€‚æ­¤ç›®å½•è¿˜å¯ä»¥åŒ…å«æ•°æ®æ–‡ä»¶ã€é…ç½®æ–‡ä»¶ã€æ¨¡æ¿å’Œä»åº”ç”¨ç¨‹åºåŒ…åŠ è½½çš„èµ„æºçš„ä¿®æ”¹ç‰ˆæœ¬ã€‚</li>
<li>è¯·è®°ä½ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šå¤‡ä»½<code>Documents/</code>å’Œä¸­çš„æ–‡ä»¶ã€‚æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨é”®<code>Application Support/</code>è°ƒç”¨ä»å¤‡ä»½ä¸­æ’é™¤æ–‡ä»¶ã€‚ä»»ä½•å¯ä»¥é‡æ–°åˆ›å»ºæˆ–ä¸‹è½½çš„æ–‡ä»¶éƒ½å¿…é¡»ä»å¤‡ä»½ä¸­æ’é™¤ã€‚è¿™å¯¹äºå¤§å‹åª’ä½“æ–‡ä»¶å°¤ä¸ºé‡è¦ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºä¸‹è½½è§†é¢‘æˆ–éŸ³é¢‘æ–‡ä»¶ï¼Œè¯·ç¡®ä¿å®ƒä»¬ä¸åŒ…å«åœ¨å¤‡ä»½ä¸­ã€‚<code> -[NSURL setResourceValue:forKey:error:]``NSURLIsExcludedFromBackupKey</code></li>
<li>å°†ä¸´æ—¶æ•°æ®æ”¾åœ¨<code>tmp/</code>ç›®å½•ä¸­ã€‚ä¸´æ—¶æ•°æ®åŒ…æ‹¬æ‚¨ä¸éœ€è¦é•¿æ—¶é—´ä¿ç•™çš„ä»»ä½•æ•°æ®ã€‚è¯·è®°ä½åœ¨å®Œæˆè¿™äº›æ–‡ä»¶åå°†å…¶åˆ é™¤ï¼Œä»¥å…å®ƒä»¬ç»§ç»­å ç”¨ç”¨æˆ·è®¾å¤‡ä¸Šçš„ç©ºé—´ã€‚å½“æ‚¨çš„åº”ç”¨ç¨‹åºæœªè¿è¡Œæ—¶ï¼Œç³»ç»Ÿä¼šå®šæœŸæ¸…é™¤è¿™äº›æ–‡ä»¶ï¼›å› æ­¤ï¼Œæ‚¨ä¸èƒ½æŒ‡æœ›è¿™äº›æ–‡ä»¶åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºç»ˆæ­¢åä»ç„¶å­˜åœ¨ã€‚</li>
<li>å°†æ•°æ®ç¼“å­˜æ–‡ä»¶æ”¾åœ¨<code>Library/Caches/</code>ç›®å½•ä¸­ã€‚ç¼“å­˜æ•°æ®å¯ç”¨äºéœ€è¦æ¯”ä¸´æ—¶æ•°æ®ä¿ç•™æ›´é•¿æ—¶é—´ä½†ä¸å¦‚æ”¯æŒæ–‡ä»¶é‚£ä¹ˆé•¿çš„ä»»ä½•æ•°æ®ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œåº”ç”¨ç¨‹åºä¸éœ€è¦ç¼“å­˜æ•°æ®å³å¯æ­£å¸¸è¿è¡Œï¼Œä½†å¯ä»¥ä½¿ç”¨ç¼“å­˜æ•°æ®æ¥æé«˜æ€§èƒ½ã€‚ç¼“å­˜æ•°æ®çš„ç¤ºä¾‹åŒ…æ‹¬ï¼ˆä½†ä¸é™äºï¼‰æ•°æ®åº“ç¼“å­˜æ–‡ä»¶å’Œæš‚æ—¶çš„å¯ä¸‹è½½å†…å®¹ã€‚è¯·æ³¨æ„ï¼Œ<strong>ç³»ç»Ÿå¯èƒ½ä¼šåˆ é™¤è¯¥<code>Caches/</code>ç›®å½•ä»¥é‡Šæ”¾ç£ç›˜ç©ºé—´</strong>ï¼Œå› æ­¤æ‚¨çš„åº”ç”¨å¿…é¡»èƒ½å¤Ÿæ ¹æ®éœ€è¦é‡æ–°åˆ›å»ºæˆ–ä¸‹è½½è¿™äº›æ–‡ä»¶ã€‚</li>
</ul>
<h2 id="iCloud-æ–‡ä»¶å‚¨å­˜å®¹å™¨"><a href="#iCloud-æ–‡ä»¶å‚¨å­˜å®¹å™¨" class="headerlink" title="iCloud æ–‡ä»¶å‚¨å­˜å®¹å™¨"></a>iCloud æ–‡ä»¶å‚¨å­˜å®¹å™¨</h2><p>iCloud ä¸ºä½¿ç”¨ iCloud çš„åº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªç»“æ„åŒ–çš„æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼š</p>
<ul>
<li>åº”ç”¨ç¨‹åºæœ‰ä¸€ä¸ªä¸»è¦çš„ iCloud å®¹å™¨ç›®å½•ï¼Œç”¨äºå­˜å‚¨å®ƒä»¬çš„æœ¬æœºæ–‡ä»¶ã€‚ä»–ä»¬è¿˜å¯ä»¥è®¿é—®åœ¨å…¶åº”ç”¨ç¨‹åºæˆæƒä¸­åˆ—å‡ºçš„è¾…åŠ© iCloud å®¹å™¨ç›®å½•ã€‚</li>
<li>åœ¨æ¯ä¸ªå®¹å™¨ç›®å½•ä¸­ï¼Œæ–‡ä»¶è¢«åˆ†ä¸ºâ€œæ–‡æ¡£â€å’Œæ•°æ®ã€‚ä½äº<code>Documents</code>å­ç›®å½•ï¼ˆæˆ–å…¶å­ç›®å½•ä¹‹ä¸€ï¼‰ä¸­çš„æ¯ä¸ªæ–‡ä»¶æˆ–æ–‡ä»¶åŒ…éƒ½ä½œä¸ºå¯ä»¥å•ç‹¬åˆ é™¤çš„å•ç‹¬æ–‡æ¡£å‘ˆç°ç»™ç”¨æˆ·ï¼ˆé€šè¿‡ macOS å’Œ iOS ä¸­çš„ iCloud UIï¼‰ã€‚ä»»ä½•ä¸åœ¨<code>Documents</code>å…¶å­ç›®å½•ä¸­æˆ–å…¶å­ç›®å½•ä¹‹ä¸€çš„å†…å®¹éƒ½è¢«è§†ä¸ºæ•°æ®ï¼Œå¹¶åœ¨ iCloud UI ä¸­æ˜¾ç¤ºä¸ºå•ä¸ªæ¡ç›®ã€‚</li>
</ul>
<p>ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ç•Œé¢ä¸­åˆ›å»ºå’ŒæŸ¥çœ‹çš„æ–‡æ¡£ï¼ˆä¾‹å¦‚ Pagesã€Numbers å’Œ Keynote ä¸­çš„æ–‡æ¡£æµè§ˆå™¨ï¼‰åº”å­˜å‚¨åœ¨è¯¥<code>Documents</code>ç›®å½•ä¸­ã€‚</p>
<p>å¦ä¸€ä¸ªå¯èƒ½è¿›å…¥<code>Documents</code>ç›®å½•çš„æ–‡ä»¶ç¤ºä¾‹æ˜¯ä¿å­˜çš„æ¸¸æˆï¼ŒåŒæ ·æ˜¯å› ä¸ºå®ƒä»¬æ˜¯åº”ç”¨ç¨‹åºå¯èƒ½æä¾›æŸç§é€‰æ‹©æ–¹æ³•çš„ä¸œè¥¿ã€‚</p>
<p>åº”ç”¨ç¨‹åºä¸å¸Œæœ›ç”¨æˆ·ç›´æ¥æŸ¥çœ‹æˆ–ä¿®æ”¹çš„ä»»ä½•å†…å®¹éƒ½åº”æ”¾åœ¨<code>Documents</code>ç›®å½•ä¹‹å¤–ã€‚åº”ç”¨ç¨‹åºå¯ä»¥åœ¨å®¹å™¨ç›®å½•ä¸­åˆ›å»ºä»»ä½•å­ç›®å½•ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥æ ¹æ®éœ€è¦æ’åˆ—ç§æœ‰æ–‡ä»¶ã€‚</p>
<p>åº”ç”¨ç¨‹åºåœ¨ iCloud å®¹å™¨ç›®å½•ä¸­åˆ›å»ºæ–‡ä»¶å’Œç›®å½•çš„æ–¹å¼ä¸å®ƒä»¬åˆ›å»ºæœ¬åœ°æ–‡ä»¶å’Œç›®å½•çš„æ–¹å¼å®Œå…¨ç›¸åŒã€‚å¹¶ä¸”æ‰€æœ‰æ–‡ä»¶çš„å±æ€§éƒ½è¢«ä¿å­˜ï¼Œå¦‚æœä»–ä»¬å‘æ–‡ä»¶æ·»åŠ æ‰©å±•å±æ€§ï¼Œè¿™äº›å±æ€§ä¹Ÿä¼šè¢«å¤åˆ¶åˆ° iCloud å’Œç”¨æˆ·çš„å…¶ä»–è®¾å¤‡ä¸Šã€‚</p>
<p>iCloud å®¹å™¨è¿˜å…è®¸å­˜å‚¨æ— éœ€åˆ›å»ºæ–‡æ¡£æ ¼å¼å³å¯è½»æ¾è®¿é—®çš„é”®å€¼å¯¹ã€‚</p>
<h2 id="ç³»ç»Ÿå¦‚ä½•è¯†åˆ«æ–‡ä»¶ä¸­çš„å†…å®¹ç±»å‹"><a href="#ç³»ç»Ÿå¦‚ä½•è¯†åˆ«æ–‡ä»¶ä¸­çš„å†…å®¹ç±»å‹" class="headerlink" title="ç³»ç»Ÿå¦‚ä½•è¯†åˆ«æ–‡ä»¶ä¸­çš„å†…å®¹ç±»å‹"></a>ç³»ç»Ÿå¦‚ä½•è¯†åˆ«æ–‡ä»¶ä¸­çš„å†…å®¹ç±»å‹</h2><p>è¯†åˆ«æ–‡ä»¶å†…å®¹ç±»å‹çš„ä¸»è¦æŠ€æœ¯æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li>ç»Ÿä¸€ç±»å‹æ ‡è¯†ç¬¦ (UTI)</li>
<li>æ–‡ä»¶æ‰©å±•å</li>
</ul>
<p><em>ç»Ÿä¸€ç±»å‹æ ‡è¯†ç¬¦</em>æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒå”¯ä¸€åœ°æ ‡è¯†è¢«è®¤ä¸ºå…·æœ‰â€œç±»å‹â€çš„ä¸€ç±»å®ä½“ã€‚UTI ä¸ºæ‰€æœ‰åº”ç”¨ç¨‹åºå’ŒæœåŠ¡å¯ä»¥è¯†åˆ«å’Œä¾èµ–çš„æ•°æ®æä¾›ä¸€è‡´çš„æ ‡è¯†ç¬¦ã€‚å®ƒä»¬ä¹Ÿæ¯”å¤§å¤šæ•°å…¶ä»–æŠ€æœ¯æ›´çµæ´»ï¼Œå› ä¸ºæ‚¨å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥è¡¨ç¤ºä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œè€Œä¸ä»…ä»…æ˜¯æ–‡ä»¶å’Œç›®å½•ã€‚UTI çš„ä¾‹å­åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>public.text</code>â€” æ ‡è¯†æ–‡æœ¬æ•°æ®çš„å…¬å…±ç±»å‹ã€‚</li>
<li><code>public.jpeg</code>â€” æ ‡è¯† JPEG å›¾åƒæ•°æ®çš„å…¬å…±ç±»å‹ã€‚</li>
<li><code>com.apple.bundle</code>â€” æ ‡è¯†æ†ç»‘åŒ…ç›®å½•çš„ Apple ç±»å‹ã€‚</li>
<li><code>com.apple.application-bundle</code>â€” æ ‡è¯†æ†ç»‘åº”ç”¨ç¨‹åºçš„ Apple ç±»å‹ã€‚</li>
</ul>
<p>æ¯å½“åŸºäº UTI çš„æ¥å£å¯ç”¨äºæŒ‡å®šæ–‡ä»¶ç±»å‹æ—¶ï¼Œæ‚¨åº”è¯¥ä¼˜å…ˆé€‰æ‹©è¯¥æ¥å£è€Œä¸æ˜¯å…¶ä»–ä»»ä½•æ¥å£ã€‚</p>
<p>è®¸å¤š macOS ç•Œé¢å…è®¸æ‚¨æŒ‡å®šä¸æ‚¨è¦ä½¿ç”¨çš„æ–‡ä»¶æˆ–ç›®å½•ç›¸å¯¹åº”çš„ UTIã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨â€œæ‰“å¼€â€é¢æ¿ä¸­ï¼Œæ‚¨å¯ä»¥å°† UTI ç”¨ä½œæ–‡ä»¶è¿‡æ»¤å™¨ï¼Œå¹¶å°†ç”¨æˆ·é€‰æ‹©çš„æ–‡ä»¶ç±»å‹é™åˆ¶ä¸ºæ‚¨çš„åº”ç”¨å¯ä»¥å¤„ç†çš„æ–‡ä»¶ç±»å‹ã€‚</p>
<p>å‡ ä¸ª AppKit ç±»ï¼ŒåŒ…æ‹¬<code>NSDocument</code>ã€<code>NSPasteboard</code>å’Œ<code>NSImage</code>ï¼Œéƒ½æ”¯æŒ UTIã€‚åœ¨ iOS ä¸­ï¼ŒUTI ä»…ç”¨äºæŒ‡å®šç²˜è´´æ¿ç±»å‹ã€‚</p>
<p>ç³»ç»Ÿç¡®å®šç»™å®šæ–‡ä»¶çš„ UTI çš„ä¸€ç§æ–¹æ³•æ˜¯æŸ¥çœ‹å…¶æ–‡ä»¶æ‰©å±•åã€‚</p>
<p><em>æ–‡ä»¶æ‰©å±•å</em>æ˜¯é™„åŠ åˆ°æ–‡ä»¶æœ«å°¾çš„ä¸€ä¸²å­—ç¬¦ï¼Œå¹¶ç”¨å¥ç‚¹ä¸ä¸»æ–‡ä»¶ååˆ†éš”ã€‚æ¯ä¸ªå”¯ä¸€çš„å­—ç¬¦ä¸²æ ‡è¯†ä¸€ä¸ªç‰¹å®šç±»å‹çš„æ–‡ä»¶ã€‚</p>
<p>ä¾‹å¦‚ï¼Œ<code>.strings</code>æ‰©å±•åæ ‡è¯†å…·æœ‰å¯æœ¬åœ°åŒ–å­—ç¬¦ä¸²æ•°æ®çš„èµ„æºæ–‡ä»¶ï¼Œè€Œ<code>.png</code>æ‰©å±•åæ ‡è¯†å…·æœ‰ä¾¿æºå¼ç½‘ç»œå›¾å½¢æ ¼å¼çš„å›¾åƒæ•°æ®çš„æ–‡ä»¶ã€‚</p>
<blockquote>
<p>**æ³¨æ„ï¼š**ç”±äºå¥ç‚¹å­—ç¬¦åœ¨ macOS å’Œ iOS æ–‡ä»¶åä¸­æ˜¯æœ‰æ•ˆå­—ç¬¦ï¼Œå› æ­¤åªæœ‰æ–‡ä»¶åä¸­æœ€åä¸€ä¸ªå¥ç‚¹ä¹‹åçš„å­—ç¬¦æ‰è¢«è§†ä¸ºæ–‡ä»¶æ‰©å±•åçš„ä¸€éƒ¨åˆ†ã€‚æœ€åä¸€ä¸ªå¥ç‚¹å·¦ä¾§çš„æ‰€æœ‰å†…å®¹éƒ½è¢«è§†ä¸ºæ–‡ä»¶åæœ¬èº«çš„ä¸€éƒ¨åˆ†ã€‚</p>
</blockquote>
<p>å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºå®šä¹‰äº†è‡ªå®šä¹‰æ–‡ä»¶æ ¼å¼ï¼Œæ‚¨åº”è¯¥åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºæ–‡ä»¶ä¸­æ³¨å†Œè¿™äº›æ ¼å¼å’Œä»»ä½•å…³è”çš„æ–‡ä»¶æ‰©å±•å<code>Info.plist</code>ã€‚</p>
<p>è¯¥<code>CFBundleDocumentTypes</code>å¯†é’¥æŒ‡å®šæ‚¨çš„åº”ç”¨å¯è¯†åˆ«å¹¶èƒ½å¤Ÿæ‰“å¼€çš„æ–‡ä»¶æ ¼å¼ã€‚</p>
<p>ä»»ä½•è‡ªå®šä¹‰æ–‡ä»¶æ ¼å¼çš„æ¡ç›®éƒ½åº”åŒ…æ‹¬æ–‡ä»¶æ‰©å±•åå’Œä¸æ–‡ä»¶å†…å®¹å¯¹åº”çš„ UTIã€‚</p>
<p>ç³»ç»Ÿä½¿ç”¨è¯¥ä¿¡æ¯å°†å…·æœ‰é€‚å½“ç±»å‹çš„æ–‡ä»¶å®šå‘åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºã€‚</p>
<h2 id="æ–‡ä»¶ã€å¹¶å‘å’Œçº¿ç¨‹å®‰å…¨"><a href="#æ–‡ä»¶ã€å¹¶å‘å’Œçº¿ç¨‹å®‰å…¨" class="headerlink" title="æ–‡ä»¶ã€å¹¶å‘å’Œçº¿ç¨‹å®‰å…¨"></a>æ–‡ä»¶ã€å¹¶å‘å’Œçº¿ç¨‹å®‰å…¨</h2><p>ç”±äºä¸æ–‡ä»¶ç›¸å…³çš„æ“ä½œæ¶‰åŠä¸ç¡¬ç›˜çš„äº¤äº’ï¼Œå› æ­¤ä¸å¤§å¤šæ•°å…¶ä»–æ“ä½œç›¸æ¯”é€Ÿåº¦è¾ƒæ…¢ï¼Œå› æ­¤ iOS å’Œ macOS ä¸­çš„å¤§å¤šæ•°ä¸æ–‡ä»¶ç›¸å…³çš„ç•Œé¢åœ¨è®¾è®¡æ—¶éƒ½è€ƒè™‘åˆ°äº†å¹¶å‘æ€§ã€‚ä¸€äº›æŠ€æœ¯å°†å¼‚æ­¥æ“ä½œç»“åˆåˆ°å®ƒä»¬çš„è®¾è®¡ä¸­ï¼Œå¤§å¤šæ•°å…¶ä»–æŠ€æœ¯å¯ä»¥ä»è°ƒåº¦é˜Ÿåˆ—æˆ–è¾…åŠ©çº¿ç¨‹å®‰å…¨åœ°æ‰§è¡Œã€‚</p>
<table>
<thead>
<tr>
<th align="left">ç±»&#x2F;æŠ€æœ¯</th>
<th align="left">ç¬”è®°</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>NSFileManager</code></td>
<td align="left"><code>NSFileManager</code>å¯¹äºå¤§å¤šæ•°ä»»åŠ¡ï¼Œä»å¤šä¸ªåå°çº¿ç¨‹åŒæ—¶ä½¿ç”¨é»˜è®¤å¯¹è±¡æ˜¯å®‰å…¨çš„ã€‚æ­¤è§„åˆ™çš„å”¯ä¸€ä¾‹å¤–æ˜¯ä¸æ–‡ä»¶ç®¡ç†å™¨çš„å§”æ‰˜äº¤äº’çš„ä»»åŠ¡ã€‚å°†æ–‡ä»¶ç®¡ç†å™¨å¯¹è±¡ä¸å§”æ‰˜ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå»ºè®®æ‚¨åˆ›å»ºè¯¥ç±»çš„å”¯ä¸€å®ä¾‹<code>NSFileManager</code>å¹¶å°†å§”æ‰˜ä¸è¯¥å®ä¾‹ä¸€èµ·ä½¿ç”¨ã€‚ç„¶åï¼Œæ‚¨åº”è¯¥ä¸€æ¬¡ä»ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨æ‚¨çš„å”¯ä¸€å®ä¾‹ã€‚</td>
</tr>
<tr>
<td align="left"><code>GCD</code></td>
<td align="left">GCD æœ¬èº«å¯ä»¥å®‰å…¨åœ°ä»ä»»ä½•çº¿ç¨‹ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œæ‚¨ä»ç„¶æœ‰è´£ä»»ä»¥çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ç¼–å†™æ‚¨çš„å—ã€‚</td>
</tr>
<tr>
<td align="left"><code>NSFileHandle</code>, <code>NSData</code>, <code>Cocoa streams</code></td>
<td align="left">å¤§å¤šæ•°ç”¨äºè¯»å–å’Œå†™å…¥æ–‡ä»¶æ•°æ®çš„ Foundation å¯¹è±¡éƒ½å¯ä»¥åœ¨ä»»ä½•å•ä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨ï¼Œä½†ä¸åº”åŒæ—¶åœ¨å¤šä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨ã€‚</td>
</tr>
<tr>
<td align="left">Open and Save panels</td>
<td align="left">å› ä¸ºå®ƒä»¬æ˜¯ç”¨æˆ·ç•Œé¢çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥æ‚¨åº”è¯¥å§‹ç»ˆä»åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ä¸­æ˜¾ç¤ºå’Œæ“ä½œæ‰“å¼€å’Œä¿å­˜é¢æ¿ã€‚</td>
</tr>
<tr>
<td align="left">POSIX çº¿ç¨‹</td>
<td align="left">ç”¨äºæ“ä½œæ–‡ä»¶çš„ POSIX çº¿ç¨‹é€šå¸¸è¢«è®¾è®¡ä¸ºä»ä»»ä½•çº¿ç¨‹å®‰å…¨åœ°æ“ä½œã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ç›¸åº”çš„æ‰‹å†Œé¡µã€‚</td>
</tr>
<tr>
<td align="left"><code>NSURL</code>å’Œ<code>NSString</code></td>
<td align="left">ç”¨äºæŒ‡å®šè·¯å¾„çš„ä¸å¯å˜å¯¹è±¡å¯ä»¥å®‰å…¨åœ°ä»ä»»ä½•çº¿ç¨‹ä½¿ç”¨ã€‚å› ä¸ºå®ƒä»¬æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥æ‚¨ä¹Ÿå¯ä»¥åŒæ—¶ä»å¤šä¸ªçº¿ç¨‹å¼•ç”¨å®ƒä»¬ã€‚å½“ç„¶ï¼Œè¿™äº›å¯¹è±¡çš„å¯å˜ç‰ˆæœ¬ä¸€æ¬¡åªèƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨ã€‚</td>
</tr>
<tr>
<td align="left"><code>NSEnumerator</code>åŠå…¶å­ç±»</td>
<td align="left">æšä¸¾å™¨å¯¹è±¡å¯ä»¥å®‰å…¨åœ°ä»ä»»ä½•å•ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œä½†ä¸åº”åŒæ—¶ä»å¤šä¸ªçº¿ç¨‹ä½¿ç”¨ã€‚</td>
</tr>
</tbody></table>
<p>å³ä½¿æ‚¨ä½¿ç”¨çº¿ç¨‹å®‰å…¨æ¥å£æ¥æ“ä½œæ–‡ä»¶ï¼Œå½“å¤šä¸ªçº¿ç¨‹æˆ–å¤šä¸ªè¿›ç¨‹è¯•å›¾å¯¹åŒä¸€ä¸ªæ–‡ä»¶è¿›è¡Œæ“ä½œæ—¶ï¼Œé—®é¢˜ä»ç„¶ä¼šå‡ºç°ã€‚</p>
<p>å°½ç®¡æœ‰é˜²æ­¢å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶ä¿®æ”¹æ–‡ä»¶çš„ä¿æŠ¤æªæ–½ï¼Œä½†è¿™äº›ä¿æŠ¤æªæ–½å¹¶ä¸æ€»æ˜¯ä¿è¯å§‹ç»ˆå¯¹æ–‡ä»¶è¿›è¡Œç‹¬å è®¿é—®ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>å¤šè¯»æ–‡æ¡£</tag>
        <tag>çŸ¥è¯†ç‚¹</tag>
      </tags>
  </entry>
  <entry>
    <title>iOSç«¯ ASRä¼˜åŒ–</title>
    <url>/2024/05/20/iOS%E7%AB%AF%20ASR%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<h1 id="iOSç«¯-ASRä¼˜åŒ–"><a href="#iOSç«¯-ASRä¼˜åŒ–" class="headerlink" title="iOSç«¯ ASRä¼˜åŒ–"></a>iOSç«¯ ASRä¼˜åŒ–</h1><h1 id="ASR-Automatic-Speech-Recognition"><a href="#ASR-Automatic-Speech-Recognition" class="headerlink" title="ASR(Automatic Speech Recognition)"></a>ASR(Automatic Speech Recognition)</h1><p>ASRæ˜¯ä¸€ç§å°†è¯­éŸ³ä¿¡å·è½¬æ¢ä¸ºæ–‡æœ¬çš„æŠ€æœ¯ï¼Œå®ƒå¯ä»¥å¸®åŠ©äººä»¬æ›´æ–¹ä¾¿åœ°ä¸è®¡ç®—æœºè¿›è¡Œäº¤äº’ã€‚æˆ‘ä»¬çš„AIä½œä¸šå°èŠ‚åœ¨å½•åˆ¶è¿‡ç¨‹ä¸­ä¼šåŒæ­¥è°ƒç”¨ASRæœåŠ¡å•†å®æ—¶å°†ç”¨æˆ·å½•åˆ¶çš„è¯­éŸ³è½¬æˆä¸ºæ–‡å­—ï¼Œåœ¨å½•åˆ¶å®Œæˆåæ ¹æ®ASRç»“æœè®¡ç®—æµç•…åº¦ã€è¯­é€Ÿè¯„åˆ†ï¼Œåœ¨ä¸Šä¼ ä½œä¸šçš„æ—¶å€™å°†ASRç»“æœåŒæ—¶ä¸Šä¼ åˆ°æœåŠ¡ç«¯è¿›è¡ŒAIåˆ†æã€‚</p>
<p>å¯è§AIä½œä¸šçš„æµç•…åº¦ç»´åº¦è¯„åˆ†ã€è¯­é€Ÿç»´åº¦è¯„åˆ†å’ŒAIåˆ†ææŠ¥å‘Šä¸­çš„å…³é”®è¯åˆ†æã€å£å¤´ç¦…åˆ†æã€åœé¡¿åˆ†æéƒ½æ˜¯å»ºç«‹åœ¨è·å¾—å‡†ç¡®çš„ASRç»“æœä¸Šçš„ã€‚æ‰€ä»¥æ„å»ºä¸€ä¸ªå‡†ç¡®å¯é çš„è¯­éŸ³è¯†åˆ«æœåŠ¡æ˜¯AIä½œä¸šå°èŠ‚çš„åŸºæœ¬è¦æ±‚ï¼Œä¹Ÿæ˜¯AIä½œä¸šå°èŠ‚çš„åˆ†æå‡†ç¡®åº¦å’Œç”¨æˆ·æ»¡æ„åº¦çš„å…³é”®ã€‚</p>
<h1 id="ASR-å­˜åœ¨çš„é—®é¢˜"><a href="#ASR-å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="ASR å­˜åœ¨çš„é—®é¢˜"></a>ASR å­˜åœ¨çš„é—®é¢˜</h1><h2 id="çƒ­è¯-è¯åº“é—®é¢˜"><a href="#çƒ­è¯-è¯åº“é—®é¢˜" class="headerlink" title="çƒ­è¯&#x2F;è¯åº“é—®é¢˜"></a>çƒ­è¯&#x2F;è¯åº“é—®é¢˜</h2><p>ASRæœåŠ¡éœ€è¦æ‰‹å·¥æ ¡å‡†ä¸€äº›ç”Ÿåƒ»ä¸“ä¸šè¯è¯­çš„å‘éŸ³æˆ–åŒéŸ³è¯è¯†åˆ«ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€éœ€è¦ASRæœåŠ¡å•†æä¾›è¯åº“&#x2F;çƒ­è¯åŠŸèƒ½ï¼ŒåŒæ—¶å¯¹ä¸åŒçš„ç”¨æˆ·&#x2F;ä¼ä¸šç”šè‡³æ¯ä¸€æ¬¡ASRè¯†åˆ«è¿‡ç¨‹éƒ½å¯èƒ½éœ€è¦ä¸åŒçš„çƒ­è¯ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ:</strong></p>
<p>é’ˆå¯¹CNã€COã€COM&#x2F;TW&#x2F;IO è¿™ä¸‰ä¸ªç¯å¢ƒå¹³å°ï¼Œè°ƒç ”æ”¯æŒçƒ­è¯çš„æœåŠ¡å•†å¹¶æµ‹è¯•æ•ˆæœã€‚CN é‡‡ç”¨äº†é˜¿é‡Œå¬æ‚Ÿï¼ŒCOé‡‡ç”¨äº†AmiVoiceï¼ŒCOM&#x2F;TW&#x2F;IO ä¼šé‡‡ç”¨å¾®è½¯ã€‚</p>
<h2 id="Socketè¿æ¥ç¨³å®šæ€§é—®é¢˜"><a href="#Socketè¿æ¥ç¨³å®šæ€§é—®é¢˜" class="headerlink" title="Socketè¿æ¥ç¨³å®šæ€§é—®é¢˜"></a>Socketè¿æ¥ç¨³å®šæ€§é—®é¢˜</h2><p><strong>å¹¶å‘æ§åˆ¶</strong></p>
<p>ç›®å‰é‡‡ç”¨çš„å‡ å®¶æœåŠ¡å•†å¯¹å®æ—¶è¯­éŸ³è¯†åˆ«çš„æŠ€æœ¯æ–¹æ¡ˆéƒ½æ˜¯ä½¿ç”¨Socketå°†å½•åˆ¶é‡‡é›†çš„éŸ³é¢‘æ•°æ®æ¨æµåˆ°å‚å•†çš„æœåŠ¡ç«¯è¿›è¡Œå®æ—¶è¯†åˆ«ã€‚æ¯å®¶å‚å•†å¯¹å¹¶å‘æ•°æ§åˆ¶éƒ½æ˜¯ä¸åŒçš„ï¼Œå¦‚æœæ–°çš„Socketè¯·æ±‚è¾¾åˆ°æœ€å¤§å¹¶å‘æ•°é‡ä¼šæ— æ³•è¿æ¥åˆ°æœåŠ¡å•†ã€‚ï¼ˆè¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡è”ç³»æœåŠ¡å•†æé«˜å¹¶å‘æ•°é‡ä¸Šé™æ¥è§£å†³ï¼Œä½†æ˜¯å¹¶ä¸èƒ½æ— é™æé«˜ï¼‰ã€‚</p>
<p><strong>ç½‘ç»œæ³¢åŠ¨</strong></p>
<p>ç«¯ä¸Šå‘èµ·çš„Socketè¿æ¥çš„ç¨³å®šæ€§æ˜¯ä¸å¯é çš„å®¹æ˜“å—åˆ°çŸ­æ—¶é€šè®¯è´¨é‡æ³¢åŠ¨å½±å“å¯¼è‡´è¶…æ—¶æ–­è¿ã€‚</p>
<p><strong>æ–­çº¿é‡è¿ï¼Ÿ</strong></p>
<p>ç”±äºæµç•…åº¦ä»¥åŠåœé¡¿åˆ†æå¼ºä¾èµ–ASRè¿”å›çš„æ–­å¥ç»“æœå’ŒWordåç§»æ—¶é—´ï¼Œæ–­è¿ä¹‹åé‡è¿çš„æ–­å¥ç»“æœä¸­çš„èµ·å§‹æ—¶é—´é‡ç½®ä¸º0ä»è€Œå¯¼è‡´åœé¡¿åˆ†æå’Œæµç•…åº¦æ‰“åˆ†ä¸å‡†ã€‚å¹¶ä¸”æœåŠ¡å•†æœ‰å¹¶å‘æ•°æ§åˆ¶ï¼Œé‡è¿ä¹Ÿä¸ä¸€å®šèƒ½è¿ä¸Šã€‚</p>
<p>å¦‚æœä¸è€ƒè™‘å¹¶å‘æ§åˆ¶ç›´æ¥é‡è¿ï¼Œæœ¬åœ°ç»´æŠ¤å½•åˆ¶çš„ç»å¯¹æ—¶é—´ï¼Œä»…ä¾èµ–ASRç»“æœä¸­çš„ç›¸å¯¹æ—¶é—´å»æ‹¼æ¥å®Œæ•´æ—¶é—´è½´ä¹Ÿæ˜¯æœ‰é—®é¢˜çš„ã€‚å› ä¸ºASRç»“æœä¸­å­˜åœ¨æ•´å¥å’Œå•è¯çš„æ–­å¥ï¼Œè¿™ä¸ªæ–­å¥ä¾èµ–è¿ç»­çš„éŸ³é¢‘è¾“å…¥ã€‚å¦‚æœæœåŠ¡æ–­å¼€è¿æ¥åæˆ‘ä»¬æœ¬åœ°å­˜å‚¨éŸ³é¢‘æ•°æ®ï¼Œé‡è¿åå†æ¬¡è¿›è¡Œè¯†åˆ«ï¼Œè¿™æ ·æ‹¿åˆ°çš„ç»“æœçš„æ–­å¥ä¸€å®šæ˜¯é”™è¯¯çš„ï¼ˆä¸€å®šä¼šæœ‰ç‰©ç†ä¸­æ–­çš„ç‰¹å¾æ–­å¥ï¼‰ã€‚</p>
<p>æ‰€ä»¥Google Voice v1çš„è¯†åˆ«ä¸€ç›´å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼ŒGoogle v1ï¼ˆiOSï¼‰ç›®å‰ä¼šæ¯60sä¸­æ–­é‡è¿ä¸€æ¬¡ï¼Œå³ä½¿ç”¨æˆ·åœ¨æ­¤æ—¶é—´ç‚¹æ— åœé¡¿ï¼Œå…¶è¯†åˆ«ç»“æœä¹Ÿä¼šåœ¨æ¯ä¸ª60så¤„éƒ½æœ‰ä¸€ä¸ªæ–­å¥ã€‚éè¿ç»­çš„æ•°æ®ä¸€å®šä¼šå‡ºç°å¼‚å¸¸çš„åœé¡¿ï¼Œå¯¹ç»“æœå½±å“éå¸¸å¤§ä¼šå¯¼è‡´æµç•…åº¦åˆ†æä¸å¯ç”¨ã€‚åç»­ä¼šé’ˆå¯¹COM&#x2F;TW&#x2F;IOç«™ç‚¹åˆ‡æ¢å¾®è½¯è¯­éŸ³è¯†åˆ«æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p><strong>æ–­è¿æ—¶ç”¨æˆ·æ— æ„ŸçŸ¥ï¼Œç›´æ¥å½±å“æäº¤ä½œä¸šä¸»æµç¨‹</strong></p>
<p>ç›®å‰ASRå‘ç”Ÿäº†æ–­è¿æˆ–ä¸å¯ç”¨é—®é¢˜ç”¨æˆ·æ˜¯è¾ƒéš¾æ„ŸçŸ¥çš„ï¼ˆåªæœ‰æ–‡å­—è¯†åˆ«æ˜¯å¦æ˜¾ç¤ºçš„åŒºåˆ«ï¼‰ï¼Œå¹¶ä¸”ç›´æ¥å½±å“æ­¤æ¬¡å½•åˆ¶çš„æµç•…åº¦å’Œè¯­é€Ÿè¯„åˆ†ï¼ˆæ— æ•°æ®ä¼šæ˜¾ç¤ºä¸€å›¢è¿·é›¾ï¼‰ã€‚å¦‚æœè®²å¸ˆå¼€å¯äº†æäº¤ä½œä¸šæœ€ä½åˆ†é™åˆ¶ä¼šç›´æ¥å¯¼è‡´è¯¥æ¬¡å½•åˆ¶æ— æ³•æäº¤ï¼Œç”¨æˆ·å›åˆ°â€œä¸Šä¼ è§†é¢‘ä½œä¸šâ€æµç¨‹æ¯”è¾ƒè¿œï¼Œå¯èƒ½ä¼šé—´æ¥å¯¼è‡´è¯¥æ¬¡å½•åˆ¶ä½œåºŸï¼Œä¸šåŠ¡ä¸»æµç¨‹å¡æ­»ï¼Œååˆ†å½±å“ç”¨æˆ·ä½“éªŒã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong></p>
<p>è€ƒè™‘é€šè¿‡å¢åŠ ä¸€äº›å…œåº•çš„äº¤äº’å°†å‡ºç°ASRè¿æ¥é”™è¯¯çš„ä½œä¸šä»å®æ—¶å½•åˆ¶æµç¨‹å¿«é€Ÿå¯¼å‘åˆ°ä¸Šä¼ æµç¨‹ã€‚ä½¿ç”¨æœåŠ¡ç«¯å¼‚æ­¥åˆ†æä¸ºç«¯ä¸Šå®æ—¶è¿æ¥åšä¸€æ¬¡å…œåº•ï¼ˆç”¨æˆ·å¦‚æœå¯¹å½“æ¬¡å½•åˆ¶çš„ä½œä¸šæ¯”è¾ƒæ»¡æ„å¯ä»¥é€‰æ‹©ç›´æ¥æäº¤åˆ°æœåŠ¡ç«¯èµ°ä¸Šä¼ æµç¨‹ï¼Œå¦‚æœä¸æ»¡æ„å¯èƒ½ä¼šè‡ªè¡Œé‡å½•ï¼‰ã€‚</p>
<h1 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h1><h2 id="æ”¯æŒçƒ­è¯åŠŸèƒ½"><a href="#æ”¯æŒçƒ­è¯åŠŸèƒ½" class="headerlink" title="æ”¯æŒçƒ­è¯åŠŸèƒ½"></a>æ”¯æŒçƒ­è¯åŠŸèƒ½</h2><p>ä¸­æ–‡ï¼šå¬æ‚Ÿ æ”¯æŒä¸´æ—¶çƒ­è¯åˆ—è¡¨</p>
<p>æ—¥æ–‡ï¼šAmi æ”¯æŒä¸´æ—¶çƒ­è¯åˆ—è¡¨å’Œçƒ­è¯è¯åº“</p>
<p>è‹±æ–‡åŠå…¶ä»–ï¼šå¾®è½¯ æ”¯æŒä¸´æ—¶çƒ­è¯</p>
<p>å½“å‰æ”¯æŒä»¥ä¼ä¸šä¸ºç»´åº¦é…ç½®çƒ­è¯åˆ—è¡¨ï¼Œåœ¨æœåŠ¡ç«¯ç»´æŠ¤</p>
<p>æœªæ¥å¯ä»¥æ”¯æŒä»¥ä½œä¸šä¸ºç»´åº¦é…ç½®çƒ­è¯åˆ—è¡¨</p>
<h2 id="å¯è§‚æµ‹æ€§"><a href="#å¯è§‚æµ‹æ€§" class="headerlink" title="å¯è§‚æµ‹æ€§"></a>å¯è§‚æµ‹æ€§</h2><p>åœ¨å¾€æœŸçš„åŸºç¡€ä¸Šä¸°å¯Œäº†æ—¥å¿—ä¸ŠæŠ¥ã€‚</p>
<p>åœ¨å¸¸è§„çš„å„ä¸ªæœåŠ¡å•†Socketæˆ–è€…SDKçš„å…³é”®ç”Ÿå‘½å‘¨æœŸï¼ˆåˆå§‹åŒ–ã€å¼€å§‹è¯†åˆ«ã€åœæ­¢è¯†åˆ«ç­‰ï¼‰å’Œè¿”å›é”™è¯¯ä¿¡æ¯çš„å…³é”®èŠ‚ç‚¹å¢åŠ kibanaæ—¥å¿—ä¸ŠæŠ¥ã€‚</p>
<p>å¢åŠ ä¸€ä¸ª30sä¸ºå‘¨æœŸçš„å¿ƒè·³æ—¥å¿—ï¼Œè®°å½•è¯†åˆ«åˆ°çš„ç¨³æ€ç»“æœæ–‡æœ¬é•¿åº¦ï¼Œè¡¨ç¤ºASRæœåŠ¡ä»ç„¶åœ¨æ­£å¸¸è¿è¡Œã€‚</p>
<h2 id="é”™è¯¯é™çº§"><a href="#é”™è¯¯é™çº§" class="headerlink" title="é”™è¯¯é™çº§"></a>é”™è¯¯é™çº§</h2><p>å¦‚ä¸Šæ–¹æ–­çº¿çš„è§£å†³æ–¹æ¡ˆï¼Œå¢åŠ æ£€æµ‹åˆ°ASRæŠ¥é”™æ—¶å¢åŠ æœåŠ¡ç«¯å…œåº•æœºåˆ¶ã€‚</p>
<h2 id="æ”¯æŒåˆ‡æ¢ç«™ç‚¹å’Œè¯­è¨€ä½¿ç”¨ä¸åŒASRæœåŠ¡"><a href="#æ”¯æŒåˆ‡æ¢ç«™ç‚¹å’Œè¯­è¨€ä½¿ç”¨ä¸åŒASRæœåŠ¡" class="headerlink" title="æ”¯æŒåˆ‡æ¢ç«™ç‚¹å’Œè¯­è¨€ä½¿ç”¨ä¸åŒASRæœåŠ¡"></a>æ”¯æŒåˆ‡æ¢ç«™ç‚¹å’Œè¯­è¨€ä½¿ç”¨ä¸åŒASRæœåŠ¡</h2><p>åˆ‡æ¢è¯­è¨€ï¼š</p>
<p>ç›®å‰çš„æŠ€æœ¯æ–¹æ¡ˆå·²ç»æ”¯æŒæ ¹æ®ä¸åŒç«™ç‚¹çš„é˜¿æ³¢ç½—é…ç½®ä¸‹çš„æ ¹æ®è¯­è¨€ä¸‹å‘ASRæœåŠ¡å¹³å°ç±»å‹ï¼ŒAPPæ ¹æ®å¯¹åº”çš„ç±»å‹å¯åŠ¨ASRæœåŠ¡ã€‚</p>
<p>åˆ‡æ¢ç«™ç‚¹ï¼š</p>
<p>å½“å‰iOSé¡¹ç›®ä¸­ASRæœåŠ¡æŒ‰ç…§åŒ…æ¥åŒºåˆ†ï¼Œæ¯ä¸ªç«™ç‚¹å¼•å…¥çš„SDKæ˜¯ä¸åŒçš„ã€‚</p>
<p>CNåŒ… é˜¿é‡Œï¼ŒAMi</p>
<p>COåŒ… AMi ï¼ŒGoogleï¼Œ å¾®è½¯</p>
<p>COM AMi ï¼ŒGoogle ï¼Œå¾®è½¯</p>
<p>æœ‰äº›SDKå› ä¸ºåˆè§„é—®é¢˜ä¸å¯ä»¥æ¥å…¥ç‰¹å®šåŒ…  711 åªæœ‰Google ASR</p>
<p>UASRã€è…¾è®¯ã€AMIã€å¾®è½¯  è¿™å››ä¸ªASRæœåŠ¡æ”¯æŒåˆ‡æ¢ç«™ç‚¹ æ ¹æ®å¯¹åº”ç«™ç‚¹ä¸‹å‘çš„ç±»å‹å³å¯è°ƒèµ·å¯¹åº”çš„æœåŠ¡</p>
<p>åœ¨CNåŒ…è¿˜ä¿ç•™äº†é˜¿é‡ŒASRå…œåº•ï¼Œåˆ«çš„åŒ…ä½¿ç”¨å¾®è½¯ASRå…œåº•</p>
<p>å¦‚æœä¸‹å‘çš„ASRæœåŠ¡åœ¨å½“å‰åŒ…æ˜¯ç¼ºå¤±çš„åˆ™ä¼šä½¿ç”¨å…œåº•</p>
<p>iOS ä¼šåœ¨2024.10 å°è¯•å°†ä¸åŒç«™ç‚¹ç”¨åˆ°çš„ASR SDK å…¨éƒ¨å¼•å…¥å½“å‰åŒ…ä¸­ï¼Œå®ç°åˆ‡æ¢ç«™ç‚¹å°±å¯ä»¥åˆ‡æ¢æœåŠ¡çš„åŠŸèƒ½ã€‚ï¼ˆå®‰å“å·²ç»åˆå¹¶åˆ°ä¸€ä¸ªåŒ…ä¸­ã€‚ï¼‰</p>
<p>é£é™©ç‚¹åœ¨äºæ–°å¼•å…¥è…¾è®¯ASRSDK åŠ  å¼•å…¥å¤šä¸ªSDKä¼šä½¿åŒ…ä½“ç§¯å¢å¤§ï¼Œ</p>
<p>åˆå¹¶å‰ æ‰“åŒ… CN Debug æ¨¡å¼ä¸‹ 219MB</p>
<p>åˆå¹¶åæ‰“åŒ… CN Debug æ¨¡å¼ 219Mb</p>
<p>åŸºæœ¬æ— å½±å“</p>
<h2 id="æ—¥å¿—è®¾è®¡"><a href="#æ—¥å¿—è®¾è®¡" class="headerlink" title="æ—¥å¿—è®¾è®¡"></a>æ—¥å¿—è®¾è®¡</h2><p>ASRæœåŠ¡æå‡å¯è§‚æµ‹æ€§ï¼Œåœ¨ä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸè¿›è¡Œæ—¥å¿—ç›‘æµ‹ã€‚</p>
<p>æ‰€æœ‰ASRçš„æ—¥å¿—éƒ½ä»¥ <strong>UMUASRService</strong> ä¸ºkeyï¼Œåœ¨kibanaæœç´¢è¿™ä¸ªkeyè¿‡æ»¤ASRé—®é¢˜ã€‚</p>
<p>å‡†å¤‡é˜¶æ®µï¼š</p>
<p>è·å–ASRé…ç½®å¤±è´¥æ—¶ä¼šä¸ŠæŠ¥ refreshASRGlobalConfig fail</p>
<p>å¯åŠ¨æœåŠ¡ï¼š</p>
<p>buildASRServiceçš„æ—¶å€™æ‰“ä¸€æ¬¡ æºå¸¦æœåŠ¡ç«¯ä¸‹å‘çš„å¹³å°ç±»å‹</p>
<p>åˆå§‹åŒ–æœåŠ¡å¤±è´¥ä¼šæ‰“ä¸€æ¬¡æ—¥å¿—ï¼Œä¸åŒService æ ¹æ®SDKåˆå§‹åŒ–æ–¹å¼æ‰“çš„æ—¶æœºä¸åŒ</p>
<p>buildASRServiceå®Œæˆåæ‰“ä¸€æ¬¡ï¼Œæºå¸¦APPå®é™…é‡‡ç”¨çš„ASRç±»å‹ï¼ˆæ ¹æ®ç±»ååŒºåˆ†ï¼‰</p>
<p>æœåŠ¡è¿›è¡Œä¸­ï¼š</p>
<p>æ­£å¸¸åœºæ™¯â†’ åœ¨æ”¶åˆ°ç¨³æ€è¯†åˆ«ç»“æœåæ¯30s ä¸ŠæŠ¥ä¸€æ¬¡ASRæœåŠ¡å¿ƒè·³æ—¥å¿—ï¼Œæºå¸¦å½“æ¬¡è¯†åˆ«ç»“æœçš„æ–‡æœ¬é•¿åº¦ã€‚å¢åŠ å¿ƒè·³çš„ç›®çš„æ˜¯ç›‘æ§ASRæœåŠ¡æ˜¯å¦æ­£å¸¸æŒç»­è¿è¡Œ</p>
<p>å¼‚å¸¸åœºæ™¯â†’ æ”¶åˆ°ASRæœåŠ¡å•†SDKã€Serverå›è°ƒçš„é”™è¯¯ä¸ŠæŠ¥é”™è¯¯ä»£ç å’Œä¿¡æ¯æ—¥å¿—</p>
<p>æœåŠ¡ç»“æŸï¼š</p>
<p>æ‰“ä¸€æ¬¡ç»“æŸæ—¥å¿—</p>
]]></content>
      <categories>
        <category>iOSå¼€å‘</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>æ€§èƒ½ä¼˜åŒ–</tag>
        <tag>æ¶æ„è®¾è®¡</tag>
        <tag>asr</tag>
        <tag>è¯­éŸ³è¯†åˆ«</tag>
      </tags>
  </entry>
  <entry>
    <title>iOSç­¾åæœºåˆ¶</title>
    <url>/2022/11/05/iOS%E7%AD%BE%E5%90%8D%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<h1 id="iOSç­¾åæœºåˆ¶"><a href="#iOSç­¾åæœºåˆ¶" class="headerlink" title="iOSç­¾åæœºåˆ¶"></a>iOSç­¾åæœºåˆ¶</h1><h2 id="æ¦‚è¦"><a href="#æ¦‚è¦" class="headerlink" title="æ¦‚è¦"></a>æ¦‚è¦</h2><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>åœ¨iOSå¼€å‘ä¸­ï¼Œé…ç½®è¯ä¹¦æ€»æ˜¯ä¸€ä»¶ç¹ççš„å·¥ä½œï¼Œç½‘ä¸Šçš„æ•™ç¨‹æœ‰å¾ˆå¤šï¼ŒåŸºæœ¬éƒ½æ˜¯æ‰‹æŠŠæ‰‹çš„æ•™æ“ä½œï¼Œä½†æ˜¯å¦‚æœä¸äº†è§£ä¸ºä»€ä¹ˆè¦é…ç½®è¿™äº›ä¸œè¥¿ï¼Œå¯¹é…ç½®æµç¨‹å°±ä¸ä¼šæœ‰æ·±åˆ»çš„å°è±¡ã€‚</p>
<p>é…ç½®è¯ä¹¦æœ€å¤§çš„ä½œç”¨å°±æ˜¯ä¿è¯å®‰å…¨æ€§ï¼Œå®‰å…¨æ€§ä¸»è¦è¡¨ç°åœ¨ä»¥ä¸‹çš„å‡ ä¸ªæ–¹é¢ï¼š</p>
<p>1.ä¿è¯è‹¹æœæ‰‹æœºä¸‹è½½çš„Appæ˜¯ä»<strong>è‹¹æœå®˜ç½‘è®¤è¯</strong>çš„é€”å¾„ä¸‹è½½</p>
<p>2.ä¿è¯Appåœ¨è‹¹æœå®˜æ–¹æ³¨å†Œè¿‡çš„è®¾å¤‡ä¸Šè¿è¡Œ</p>
<p>3.ä¿è¯Appåœ¨ç‰¹å®šçš„è®¾å¤‡ä¸­è¿è¡Œï¼ˆå¼€å‘éœ€è¦ï¼‰</p>
<h3 id="æŠ€æœ¯æ”¯æŒ"><a href="#æŠ€æœ¯æ”¯æŒ" class="headerlink" title="æŠ€æœ¯æ”¯æŒ"></a>æŠ€æœ¯æ”¯æŒ</h3><p>è‹¹æœé‡‡ç”¨çš„æ˜¯<strong>æ•°å­—ç­¾å</strong>è¿›è¡ŒåŠ å¯†ï¼Œå®ƒæ˜¯åŸºäº<strong>éå¯¹ç§°åŠ å¯†ç®—æ³•å’Œæ‘˜è¦ç®—æ³•</strong>å®ç°çš„ï¼Œå’Œå¯¹ç§°åŠ å¯†ç®—æ³•ä¸åŒçš„æ˜¯**ï¼Œ**å¯¹ç§°åŠ å¯†é€šè¿‡åŒä¸€ä»½å¯†é’¥åŠ å¯†å’Œè§£å¯†æ•°æ®ï¼Œè€Œéå¯¹ç§°åŠ å¯†æœ‰ä¸¤ä¸ªå¯†é’¥ï¼Œåˆ†åˆ«æ˜¯å…¬é’¥å’Œç§é’¥ï¼Œç”¨å…¬é’¥åŠ å¯†çš„æ•°æ®ï¼Œè¦ç”¨ç§é’¥æ‰èƒ½è§£å¯†ï¼›ç”¨ç§é’¥åŠ å¯†çš„æ•°æ®ï¼Œè¦ç”¨å…¬é’¥æ‰èƒ½è§£å¯†ã€‚è¿™é‡Œçš„éå¯¹ç§°åŠ å¯†å°±æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„RSAï¼Œæƒ³è¦æ·±å…¥ç†è§£çš„ç«¥é‹å¯ä»¥è‡ªä¸»äº†è§£ã€‚</p>
<p>ä¸ºäº†æ›´å¥½çš„ç†è§£éå¯¹ç§°åŠ å¯†çš„å¥½å¤„ï¼Œæˆ‘ä¸¾ä¸€ä¸ªåœºæ™¯ä¾‹å­ï¼šAè¦å‘é€é‚®ä»¶ç»™Bï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­è¦ç¡®ä¿åœ¨ä¼ è¾“ä¸­é‚®ä»¶å†…å®¹æ²¡æœ‰è¢«ç¯¡æ”¹ï¼Œä¹Ÿå°±æ˜¯åªæœ‰Bå¯ä»¥æŸ¥çœ‹é‚®ä»¶çš„å†…å®¹ï¼›è¿˜è¦ç¡®ä¿è¿™ä¸ªé‚®ä»¶æ˜¯Aå‘é€è¿‡æ¥çš„ï¼Œä¸æ˜¯å…¶ä»–äººå‘é€çš„ã€‚æˆ‘ä»¬ç”¨éå¯¹ç§°åŠ å¯†çš„æ–¹å¼æ¥å¤„ç†ï¼šé¦–å…ˆå­˜Aå’ŒBå„æœ‰ä¸€å¯¹å…¬ç§é’¥ï¼ŒAæŒæœ‰ä»–è‡ªå·±çš„ç§é’¥å’ŒBçš„å…¬é’¥ï¼ŒBæŒæœ‰Açš„å…¬é’¥å’ŒBçš„ç§é’¥ï¼Œå…¬é’¥ä¸€èˆ¬æ˜¯ç»™åˆ«äººçš„ï¼Œç§é’¥åœ¨è‡ªå·±æ‰‹é‡Œã€‚Aå…ˆç”¨Bçš„å…¬é’¥ç»™é‚®ä»¶åŠ å¯†ï¼Œè¿™æ ·è¿™ä¸ªé‚®ä»¶åªèƒ½è¢«Bçš„ç§é’¥è§£å¼€ï¼Œä¿è¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸ä¼šè¢«ç¯¡æ”¹ï¼›Aç”¨è‡ªå·±çš„ç§é’¥å°†é‚®ä»¶åŠ å¯†ï¼ŒBè¦ç”¨Açš„å…¬é’¥å°†é‚®ä»¶è§£å¯†ï¼Œæ¥ç¡®ä¿è¿™æ˜¯Aå‘é€è¿‡æ¥çš„ã€‚è¿™å°±æ˜¯åŒå‘éªŒè¯ã€‚</p>
<h2 id="åŸºäºiOSå¼€å‘çš„ç­¾åæœºåˆ¶"><a href="#åŸºäºiOSå¼€å‘çš„ç­¾åæœºåˆ¶" class="headerlink" title="åŸºäºiOSå¼€å‘çš„ç­¾åæœºåˆ¶"></a>åŸºäºiOSå¼€å‘çš„ç­¾åæœºåˆ¶</h2><h3 id="ä»App-Storeå®‰è£…App"><a href="#ä»App-Storeå®‰è£…App" class="headerlink" title="ä»App Storeå®‰è£…App"></a>ä»App Storeå®‰è£…App</h3><p>è¿™ä¸ªç­¾åçš„æ–¹å¼ç›¸å¯¹ç®€å•ï¼Œåªéœ€è¦éªŒè¯Appæ˜¯ä»AppStoreä¸Šä¸‹è½½çš„å³å¯ã€‚è‹¹æœå®˜æ–¹ç”Ÿæˆä¸€å¯¹å…¬ç§é’¥ï¼Œåœ¨è‹¹æœè®¾å¤‡ä¸Šå†…ç½®ä¸€ä¸ªå…¬é’¥ï¼Œç§é’¥ç”±åå°ä¿ç®¡ï¼Œæˆ‘ä»¬ä¸Šä¼ Appåˆ°AppStoreæ—¶ï¼Œè‹¹æœåå°ç”¨ç§é’¥å¯¹Appè¿›è¡Œç­¾åï¼Œè®¾å¤‡åœ¨åœ¨AppåŒ…åï¼Œç”¨å†…ç½®å…¬é’¥éªŒè¯ç­¾åã€‚</p>
<p>æ€è€ƒï¼šæ¯ä¸ªè®¾å¤‡å’Œè‹¹æœåå°éƒ½æœ‰å¯¹åº”çš„ä¸€å¯¹å…¬ç§é’¥è¿˜æ˜¯åªæœ‰ä¸€å¯¹å…¬ç§é’¥ï¼Œæ¯ä¸ªè®¾å¤‡çš„å…¬é’¥éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœæ˜¯å‰è€…ï¼Œç»™Appç”¨ç§é’¥åŠ å¯†çš„æ—¶å€™æ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿ</p>
<p><strong>ç»“è®ºï¼šæ‰€æœ‰è‹¹æœè®¾å¤‡ä¸Šçš„å…¬é’¥éƒ½æ˜¯ä¸€æ ·çš„ã€‚</strong></p>
<h3 id="å…¶ä»–æ–¹å¼å®‰è£…App"><a href="#å…¶ä»–æ–¹å¼å®‰è£…App" class="headerlink" title="å…¶ä»–æ–¹å¼å®‰è£…App"></a>å…¶ä»–æ–¹å¼å®‰è£…App</h3><ul>
<li>é€šè¿‡Xcodeå°†Appè¿è¡Œåœ¨è®¾å¤‡ä¸Šï¼Œè°ƒè¯•ç”¨</li>
<li>ä¼ä¸šå†…éƒ¨åˆ†å‘ï¼Œå¯ä»¥ç›´æ¥å®‰è£…ä¼ä¸šè¯ä¹¦ç­¾ååçš„App</li>
<li>AD-Hocç›¸å½“äºä¼ä¸šåˆ†å‘çš„é™åˆ¶ç‰ˆï¼Œé™åˆ¶å®‰è£…è®¾å¤‡æ•°é‡</li>
</ul>
<p>ä»¥ä¸Šå‡ ç§åœºæ™¯å°±æ¯”è¾ƒå¤æ‚äº†ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿è¿™ä¸ªAppåŒ…çš„æ¥æºæ˜¯è‹¹æœå®˜æ–¹è®¤è¯çš„ï¼Œè¿˜è¦æŒ‡å®šè®¾å¤‡ä¿¡æ¯ï¼ˆä¸èƒ½éšä¾¿çš„è‹¹æœè®¾å¤‡éƒ½å¯ä»¥è¿è¡Œï¼‰ã€‚åœ¨äº†è§£è¿™äº›åœºæ™¯çš„ç­¾åè¿‡ç¨‹ä¹‹å‰æˆ‘ä»¬å…ˆæ€è€ƒä¸€äº›é—®é¢˜ï¼š</p>
<p>1.AppåŒ…ä¸èƒ½ä¸Šä¼ åˆ°App Storeä¸Šè¿›è¡Œç§é’¥åŠ å¯†äº†ï¼Œéœ€è¦é€šè¿‡å…¶ä»–ä»‹è´¨é—´æ¥éªŒè¯ï¼›</p>
<p>2.iPhoneä¸Šåªæœ‰ä¸€ä¸ªå…¬é’¥å¯ç”¨ï¼Œå¦‚ä½•éªŒè¯è¿™ä¹ˆå¤šä¿¡æ¯ï¼›</p>
<p>3.å¦‚ä½•é™åˆ¶è®¾å¤‡ã€æƒé™ç­‰é¢å¤–ä¿¡æ¯ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦é™¤äº†AppåŒ…ä»¥å¤–çš„ä¿¡æ¯æ¥è¿›è¡ŒéªŒè¯ï¼Œå°±æ˜¯å„ç§åŠ å¯†ä¹‹åçš„æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é…ç½®å¾ˆå¤šçš„è¯ä¹¦ã€‚</p>
<h3 id="åŠ å¯†æµç¨‹"><a href="#åŠ å¯†æµç¨‹" class="headerlink" title="åŠ å¯†æµç¨‹"></a>åŠ å¯†æµç¨‹</h3><p>1.åœ¨macä¸Šç”Ÿæˆä¸€å¯¹å…¬ç§é’¥ï¼Œå…¬é’¥Mï¼Œç§é’¥Mï¼Œè‹¹æœåå°å’Œè‹¹æœè®¾å¤‡æœ‰ä¸€å¯¹å…¬ç§é’¥ï¼Œå…¬é’¥Aï¼Œç§é’¥Aã€‚</p>
<p>2.å°†å…¬é’¥Mä¸Šä¼ åˆ°è‹¹æœåå°ï¼Œç”¨è‹¹æœåå°çš„ç§é’¥Aç­¾åå…¬é’¥Må¾—åˆ°äº†å…¬é’¥Mçš„ç­¾åï¼Œä»£ç§°hashM(ç§A)ï¼ŒhashM(ç§A)å’Œå…¬é’¥Mç»„æˆçš„æ•°æ®ç§°ä¸º<strong>è¯ä¹¦</strong>ã€‚ï¼ˆè¯ä¹¦æºå¸¦è‹¹æœå®˜æ–¹è®¤è¯ä¿¡æ¯ï¼Œéœ€è¦å’ŒAppåˆ°è¾¾è®¾å¤‡ä¸Šï¼‰</p>
<p>3.å¼€å‘å®Œæˆåï¼Œç”¨ç§é’¥Må¯¹Appè¿›è¡Œç­¾åï¼ŒåŒæ—¶å°†è¯ä¹¦ä¸€èµ·æ‰“åŒ…è¿›Appä¸­ï¼Œå®‰è£…åˆ°æ‰‹æœºã€‚</p>
<p>4.å®‰è£…æ—¶ï¼ŒiOSç³»ç»Ÿè·å¾—è¯ä¹¦ï¼Œç”¨å…¬é’¥AéªŒè¯hashM(ç§Aï¼‰ï¼Œå¾—åˆ°çš„ä¿¡æ¯å’Œè¯ä¹¦ä¸­çš„å…¬é’¥æ˜¯å¦ä¸€è‡´ã€‚</p>
<p><strong>ä»¥ä¸Šçš„æµç¨‹å¯ä»¥å®ŒæˆéªŒè¯Appæ˜¯å¦ç»è¿‡äº†è‹¹æœå®˜æ–¹è®¤å¯çš„éœ€æ±‚ï¼Œæ²¡æœ‰è§£å†³æ»¥ç”¨çš„é—®é¢˜ã€‚<strong>è¿™é‡Œçš„æ»¥ç”¨é—®é¢˜åŒ…æ‹¬ä»»ä½•Appéƒ½å¯ä»¥ç”¨è¿™ä¸ªè¯ä¹¦åœ¨ä»»ä½•è®¾å¤‡ä¸Šå®‰è£…è¿è¡Œï¼Œè¿™æ˜¯ä¸å…è®¸çš„ã€‚æˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›é™åˆ¶ä¿¡æ¯å¦‚AppIDã€è®¾å¤‡IDç­‰å’Œè¯ä¹¦</strong>å†ç”¨ç§é’¥Aè¿›è¡ŒåŠ å¯†</strong>ï¼Œåœ¨æœ€åçš„iOSç³»ç»ŸéªŒè¯çš„æ—¶å€™å°±å¯ä»¥åˆ¤æ–­è¿™äº›é™åˆ¶æ•°æ®æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚å¯ä»¥ç†è§£ä¸ºåˆè¿›è¡Œäº†ä¸€æ¬¡åŠ å¯†ã€‚å¾—åˆ°çš„æ•°æ®å°±æ˜¯æˆ‘ä»¬çŸ¥é“çš„<strong>Provisioning file</strong>ï¼ŒProvisioning fileé‡Œé¢å°±åŒ…å«äº†è¯ä¹¦å’Œä»¥ä¸Šæåˆ°çš„é¢å¤–ä¿¡æ¯ï¼Œä»¥åŠæ‰€æœ‰ä¿¡æ¯çš„ç­¾åã€‚</p>
<p>åœ¨ç¼–è¯‘ä¸€ä¸ªAppåï¼Œç”¨æœ¬åœ°çš„çš„ç§é’¥Må¯¹è¿™ä¸ªAppè¿›è¡Œç­¾åï¼ŒåŒæ—¶æŠŠProvisioning fileæ–‡ä»¶æ‰“åŒ…åˆ°Appä¸­ï¼Œæ–‡ä»¶åä¸ºembeded.mobileprovisionï¼ŒæŠŠAppå®‰è£…åˆ°æ‰‹æœºä¸Šã€‚ä»¥ä¸Šçš„è¿‡ç¨‹å°±æ˜¯åŠ å¯†çš„è¿‡ç¨‹ï¼Œçœ‹èµ·æ¥åŠ å¯†äº†å¾ˆå¤šå±‚ï¼Œè®©æˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹ï¼š</p>
<p><img src="https://cdn.zcx.info/1553500434698-48c63da0-2fac-490f-9b24-a5944fb17ae8.png"></p>
<h2 id="é…ç½®è¯ä¹¦ç®€è¦æµç¨‹"><a href="#é…ç½®è¯ä¹¦ç®€è¦æµç¨‹" class="headerlink" title="é…ç½®è¯ä¹¦ç®€è¦æµç¨‹"></a>é…ç½®è¯ä¹¦ç®€è¦æµç¨‹</h2><h3 id="è¯·æ±‚æ ¹è¯ä¹¦"><a href="#è¯·æ±‚æ ¹è¯ä¹¦" class="headerlink" title="è¯·æ±‚æ ¹è¯ä¹¦"></a>è¯·æ±‚æ ¹è¯ä¹¦</h3><p>åœ¨macä¸Šç”Ÿæˆä¸€å¯¹å…¬ç§é’¥ï¼Œå¹¶å°†å…¬é’¥ä¸Šä¼ åˆ°è‹¹æœåå°ï¼Œç”¨è‹¹æœåå°çš„ç§é’¥åŠ å¯†macå…¬é’¥ï¼Œå¾—åˆ°è¯ä¹¦</p>
<p>CSRç”Ÿæˆä¸€å¯¹å…¬ç§é’¥ï¼Œç§é’¥å§‹ç»ˆåœ¨Mac OSçš„Keychain Accessä¸­ï¼Œç”¨äºç­¾åï¼ˆCodeSignï¼‰å¯¹å¤–å‘å¸ƒçš„Appï¼Œå…¬é’¥ä¸€èˆ¬éšç€è¯ä¹¦ï¼ˆéšProvisioning Profileï¼ŒéšAppï¼‰æ•£å¸ƒå‡ºå»ï¼Œå¯¹Appç­¾åè¿›è¡Œæ ¡éªŒè®¤è¯ã€‚ç”¨æˆ·è¦ä¿æŠ¤å¥½æœ¬åœ°Keychainä¸­çš„private keyã€‚</p>
<p>åˆ›å»ºCSRæ–‡ä»¶ï¼šæ‰“å¼€é’¥åŒ™ä¸²-&gt;è¯ä¹¦åŠ©ç†-&gt;ä»è¯ä¹¦é¢å‘æœºæ„è¯·æ±‚è¯ä¹¦ã€‚æ³¨ï¼šCRSæ–‡ä»¶æ˜¯Cerificate Signing Requestçš„è‹±æ–‡ç¼©å†™ï¼Œå³è¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼Œ<strong>CerificateSigningRequestå°±æ˜¯æœ¬åœ°å…¬é’¥ï¼Œ.p12å°±æ˜¯æœ¬åœ°ç§é’¥ï¼Œå¯ä»¥å¯¼å…¥å…¶ä»–ç”µè„‘ï¼ŒåŒæ—¶å…¶ä»–ç”µè„‘ä¹Ÿåº”è¯¥å®‰è£…ä¸‹è½½ä¸‹æ¥çš„è¯ä¹¦ã€‚æ‰€ä»¥è¿™ä¸€æ­¥å›¢é˜Ÿå¼€å‘äººå‘˜å¾ˆå°‘æ“ä½œã€‚</strong></p>
<h3 id="æ·»åŠ è®¾å¤‡"><a href="#æ·»åŠ è®¾å¤‡" class="headerlink" title="æ·»åŠ è®¾å¤‡"></a>æ·»åŠ è®¾å¤‡</h3><p>è‹¹æœä¸¥æ ¼é™åˆ¶äº†çœŸæœºè°ƒè¯•çš„è®¾å¤‡ï¼Œå¦‚æœéœ€è¦çœŸæœºè°ƒè¯•éœ€è¦åœ¨<a href="https://developer.apple.com/account/resources/devices/list">å¼€å‘è€…åå°</a>æ·»åŠ æµ‹è¯•æœºçš„UDID</p>
<p><img src="https://cdn.zcx.info/202302211647247.png"></p>
<h3 id="æ–°å¢æè¿°æ–‡ä»¶"><a href="#æ–°å¢æè¿°æ–‡ä»¶" class="headerlink" title="æ–°å¢æè¿°æ–‡ä»¶"></a>æ–°å¢æè¿°æ–‡ä»¶</h3><p>æè¿°æ–‡ä»¶(Provisioning Profile)æ˜¯ä¸€ä¸ªè®°å½•äº†ä½ è¿™ä¸ªAppçš„åŠŸèƒ½å’Œæƒé™çš„è¯ä¹¦ã€‚</p>
<p>ä¸€èˆ¬ä¼šç”¨åˆ°ä»¥ä¸‹ä¸‰ç§ï¼š</p>
<p><strong>develop:è°ƒè¯•è¯ä¹¦ï¼ŒåŒ…å«è°ƒè¯•ä¿¡æ¯ï¼Œå®‰è£…æ—¶éœ€è¦è¯ä¹¦å·²åŠ å…¥è®¾å¤‡UDIDæˆ–è€…è¶Šç‹±è®¾å¤‡æ‰èƒ½å®‰è£…ã€‚</strong></p>
<p><strong>distributionï¼šæ­£å¼è¯ä¹¦ï¼Œå±è”½äº†è°ƒè¯•ä¿¡æ¯ï¼Œå‘å¸ƒåˆ°AppStoreæ‰€ç”¨ã€‚</strong></p>
<p><strong>ad-hocï¼šæµ‹è¯•è¯ä¹¦ï¼Œéœ€è¦ç»™åˆ«äººæµ‹è¯•ç”¨åˆ°ï¼Œå…è®¸ç”¨æˆ·ä»ç¬¬ä¸‰æ–¹ä¸‹è½½åº”ç”¨ï¼Œå¦‚è’²å…¬è‹±ã€‚</strong></p>
<h2 id="åˆ·æ–°è¯ä¹¦åŠæè¿°æ–‡ä»¶"><a href="#åˆ·æ–°è¯ä¹¦åŠæè¿°æ–‡ä»¶" class="headerlink" title="åˆ·æ–°è¯ä¹¦åŠæè¿°æ–‡ä»¶"></a>åˆ·æ–°è¯ä¹¦åŠæè¿°æ–‡ä»¶</h2><p>ä¸€èˆ¬åœ¨é‡æ–°è¯·æ±‚æ ¹è¯ä¹¦ä¹‹åéœ€è¦æ›´æ–°æ‰€æœ‰çš„æè¿°æ–‡ä»¶å†…çš„æ ¹è¯ä¹¦é…ç½®ã€‚</p>
<p>æ ¹è¯ä¹¦å’Œè¯ä¹¦å¯¹åº”çš„ç§é’¥éƒ½éœ€è¦æœ‰äººè¿›è¡Œç»´æŠ¤(æˆ–è€…ä½¿ç”¨fastlaneç»´æŠ¤)ï¼Œåœ¨å›¢é˜Ÿæ–°å¢æˆå‘˜ã€è®¾å¤‡æ—¶éœ€å‘æ”¾åˆ°å¯¹åº”çš„æœºå™¨ä¸­çš„é’¥åŒ™ä¸²å†…ï¼Œå¦åˆ™æ— æ³•è¿›è¡Œæ„å»ºå’Œä¸Šä¼ IPAã€‚</p>
<p>æè¿°æ–‡ä»¶æ›´æ–°åéœ€è¦åœ¨Xcodeçš„Userè®¾ç½®ä¸­æ‰¾åˆ°å¼€å‘è€…åˆ·æ–°ä¸€ä¸‹Profileï¼Œæˆ–è€…åˆ°Profileçš„ä¿å­˜æ–‡ä»¶å¤¹å†…æ¸…ç©ºé‡æ–°ä¸‹è½½ï¼Œä»¥é¿å…æè¿°æ–‡ä»¶æ›´æ–°ä¸åŠæ—¶é—®é¢˜å¯¼è‡´CI&#x2F;CDæ„å»ºå¤±è´¥ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>AIä½œä¸šèƒŒæ™¯æ¨¡ç³Šå®ç°æŠ€æœ¯æ–¹æ¡ˆ</title>
    <url>/2024/11/29/iOS%E8%83%8C%E6%99%AF%E6%A8%A1%E7%B3%8A%E5%AE%9E%E7%8E%B0%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/</url>
    <content><![CDATA[<h1 id="iOSèƒŒæ™¯æ¨¡ç³Šå®ç°æŠ€æœ¯æ–¹æ¡ˆ"><a href="#iOSèƒŒæ™¯æ¨¡ç³Šå®ç°æŠ€æœ¯æ–¹æ¡ˆ" class="headerlink" title="iOSèƒŒæ™¯æ¨¡ç³Šå®ç°æŠ€æœ¯æ–¹æ¡ˆ"></a>iOSèƒŒæ™¯æ¨¡ç³Šå®ç°æŠ€æœ¯æ–¹æ¡ˆ</h1><h2 id="éœ€æ±‚èƒŒæ™¯"><a href="#éœ€æ±‚èƒŒæ™¯" class="headerlink" title="éœ€æ±‚èƒŒæ™¯"></a>éœ€æ±‚èƒŒæ™¯</h2><p>æ™–è‡´æ—¥æœ¬æå‡ºå¾ˆå¤šä»£è¡¨åœ¨å®¶é‡Œå½•åˆ¶AIä½œä¸šï¼Œå¸Œæœ›å¯ä»¥å°†èƒŒæ™¯æ¨¡ç³Šï¼Œä¿æŠ¤ä»£è¡¨éšç§ã€‚</p>
<p>ç±»ä¼¼äºè…¾è®¯ä¼šè®®çš„èƒŒæ™¯è™šåŒ–åŠŸèƒ½ï¼Œå½•åˆ¶è§†é¢‘ä½œä¸š çš„æ—¶å€™å°†èƒŒæ™¯æ¨¡ç³ŠåŒ–ï¼Œåªä¿ç•™ç”¨æˆ·äººåƒåŒºåŸŸã€‚</p>
<h2 id="æŠ€æœ¯æ–¹æ¡ˆ"><a href="#æŠ€æœ¯æ–¹æ¡ˆ" class="headerlink" title="æŠ€æœ¯æ–¹æ¡ˆ"></a>æŠ€æœ¯æ–¹æ¡ˆ</h2><p>ä¸šç•Œå¯¹è¿™ä¸ªéœ€æ±‚çš„å®ç°æ–¹æ¡ˆåŸºæœ¬ä¸€è‡´ã€‚</p>
<p>é¦–å…ˆå½•åˆ¶è¿‡ç¨‹ä¸­å°†è§†é¢‘å¸§åšé«˜æ–¯æ¨¡ç³Šå½¢æˆèƒŒæ™¯æ¨¡ç³Šä¸­â€èƒŒæ™¯â€éƒ¨åˆ†ã€‚</p>
<p>ç„¶ååœ¨å®æ—¶çš„å°†æ¯ä¸€å¸§å›¾åƒä¸­åŒ…å«äººåƒçš„éƒ¨åˆ†â€œæ‰£â€å‡ºæ¥å½¢æˆä¸€å¼ é»‘ç™½åˆ†æ˜çš„ç°åº¦å›¾ï¼ˆmaskï¼‰ã€‚ä¸€èˆ¬æ˜¯äººåƒåŒºåŸŸä¸ºç™½è‰²ï¼ŒéäººåƒåŒºåŸŸä¸ºé»‘è‰²ã€‚</p>
<p>æœ€åä½¿ç”¨è‡ªå®šä¹‰ä¸‰è¾“å…¥çš„æ»¤é•œï¼Œåˆ†åˆ«ä¼ å…¥æ¨¡ç³Šåçš„èƒŒæ™¯è§†é¢‘å¸§+ç°åº¦maskå›¾+åŸå§‹è§†é¢‘å¸§ï¼Œé€šè¿‡ç‰‡å…ƒç€è‰²å™¨å¯¹æ¯ä¸€ä¸ªåƒç´ ç‚¹è¿›è¡Œé´é€‰ã€‚æ ¹æ®ç°åº¦å›¾çš„é¢œè‰²ï¼Œç™½è‰²å–åŸå§‹è§†é¢‘å¸§ï¼Œé»‘è‰²å–æ¨¡ç³Šè§†é¢‘å¸§ã€‚</p>
<p>è¿™æ ·å°±å½¢æˆäº†èƒŒæ™¯åŒºåŸŸæ˜¯æ¨¡ç³Šçš„ï¼ŒäººåƒåŒºåŸŸæ˜¯æ­£å¸¸çš„è§†é¢‘ï¼Œè¾¾åˆ°è¦æ±‚ã€‚</p>
<p>åœ¨è§†é¢‘å¸§å¤„ç†è¿™æ–¹é¢æˆ‘ä»¬é‡‡ç”¨é¡¹ç›®ä¸­å·²ç»å¼•å…¥çš„GPUImageåº“æ¥å®ç°ã€‚</p>
<h3 id="äººåƒåˆ†å‰²"><a href="#äººåƒåˆ†å‰²" class="headerlink" title="äººåƒåˆ†å‰²"></a>äººåƒåˆ†å‰²</h3><p>è¿™ä¸ªæŠ å›¾çš„æŠ€æœ¯æˆ‘ä»¬ç§°ä¸ºäººåƒåˆ†å‰²ï¼Œäººåƒåˆ†å‰²ç®—æ³•æœ‰å¾ˆå¤šç§ï¼Œå¸¸è§çš„åŒ…æ‹¬ï¼šåŸºäºé¢œè‰²å’Œçº¹ç†çš„æ–¹æ³•ã€åŸºäºè¾¹ç¼˜æ£€æµ‹çš„æ–¹æ³•ã€åŸºäºæ·±åº¦å­¦ä¹ çš„æ–¹æ³•ã€åŸºäºå›¾å‰²çš„æ–¹æ³•ç­‰ã€‚</p>
<p>ç›®å‰è¿™ä¸€æ­¥äº¤ç”±AIç»„ä¼™ä¼´æä¾›åŸºäºTensorFlowLiteObjCçš„æ·±åº¦å­¦ä¹ äººåƒåˆ†å‰²æ¨¡å‹æ¥å®ç°ã€‚</p>
<h3 id="è‡ªç ”æ¨¡å‹"><a href="#è‡ªç ”æ¨¡å‹" class="headerlink" title="è‡ªç ”æ¨¡å‹"></a>è‡ªç ”æ¨¡å‹</h3><h4 id="å®ç°ç»†èŠ‚"><a href="#å®ç°ç»†èŠ‚" class="headerlink" title="å®ç°ç»†èŠ‚"></a>å®ç°ç»†èŠ‚</h4><p>ç›®å‰chaochaoæä¾›äº†2ä¸ªæ¨¡å‹ã€‚</p>
<p>128x128_fp32.tflite æ”¯æŒè¾“å…¥128*128åƒç´ çš„å›¾ç‰‡</p>
<p>256x144_fp32.tflite æ”¯æŒè¾“å…¥256*144åƒç´ çš„å›¾ç‰‡</p>
<p>æ ¸å¿ƒè¯†åˆ«ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="string">&quot;UGPortraitTFliteProcessor.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UGPortraitTFliteProcessor</span>()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) cv::Mat cachedMat; <span class="comment">// ç¼“å­˜çš„ä¸€å¸§</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSDictionary</span> *cachedOutput; <span class="comment">//ç¼“å­˜çš„ä¸€å¸§è®¡ç®—ç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UGPortraitTFliteProcessor</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSArray</span>&lt; <span class="built_in">NSNumber</span> * &gt; *)getTensorShape &#123;</span><br><span class="line"><span class="built_in">CGSize</span> modelSize = <span class="keyword">self</span>.model.modelSize;</span><br><span class="line"><span class="built_in">NSNumber</span> *dimNum1 = [<span class="built_in">NSNumber</span> numberWithInt:modelSize.width];</span><br><span class="line"><span class="built_in">NSNumber</span> *dimNum2 = [<span class="built_in">NSNumber</span> numberWithInt:modelSize.height];</span><br><span class="line"><span class="built_in">NSArray</span>&lt; <span class="built_in">NSNumber</span> * &gt; *shape = @[ @<span class="number">1</span>, dimNum2, dimNum1, @<span class="number">3</span> ];</span><br><span class="line"><span class="keyword">return</span> shape;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (UGPortraitTFliteProcessor *)processor &#123;</span><br><span class="line"><span class="comment">// CGSize kTFliteModelSize = CGSizeMake(128, 128);</span></span><br><span class="line"><span class="built_in">CGSize</span> kTFliteModelSize = <span class="built_in">CGSizeMake</span>(<span class="number">256</span>, <span class="number">144</span>);</span><br><span class="line"><span class="built_in">NSBundle</span> *targetBundle = [<span class="built_in">NSBundle</span> bundleForClass:<span class="built_in">NSClassFromString</span>(<span class="string">@&quot;UGPortraitTFliteProcessor&quot;</span>)];</span><br><span class="line"><span class="built_in">NSURL</span> *bundleUrl = [targetBundle URLForResource:<span class="string">@&quot;Detection&quot;</span> withExtension:<span class="string">@&quot;bundle&quot;</span>];</span><br><span class="line"><span class="built_in">NSBundle</span> *finalBundle = [<span class="built_in">NSBundle</span> bundleWithURL:bundleUrl];</span><br><span class="line"><span class="comment">// NSString *filePath = [finalBundle pathForResource:@&quot;128x128_fp32&quot; ofType:@&quot;tflite&quot;];</span></span><br><span class="line"><span class="built_in">NSString</span> *filePath = [finalBundle pathForResource:<span class="string">@&quot;256x144_fp32&quot;</span> ofType:<span class="string">@&quot;tflite&quot;</span>];</span><br><span class="line">UGTFliteModel *model = [UGTFliteModel modelWithPath:filePath size:kTFliteModelSize];</span><br><span class="line">UGPortraitTFliteProcessor *processor = [UGPortraitTFliteProcessor processorWithModel:model];</span><br><span class="line"><span class="keyword">return</span> processor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œæ¨ç†</span></span><br><span class="line">- (<span class="built_in">NSDictionary</span> *)detectWithSampleBuffer:(<span class="built_in">CMSampleBufferRef</span>)sampleBuffer orientation:(<span class="built_in">UIInterfaceOrientation</span>)orientation isMirror:(<span class="type">BOOL</span>)isMirror &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è½¬æˆmat</span></span><br><span class="line">cv::Mat matOrigin = [UGTFliteUtil matFromCVPixelBuffer:<span class="built_in">CMSampleBufferGetImageBuffer</span>(sampleBuffer)];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å·®å€¼ä¼˜åŒ– å¦‚æœä¸¤å¸§ç”»é¢ç›¸å·®å°äº3% åˆ™ç›´æ¥ä½¿ç”¨ä¸Šä¸€å¸§çš„ç»“æœ(è¿™é‡Œä¿æŒç¼“å­˜çš„dataå’Œmatæ˜¯æˆå¯¹çš„)</span></span><br><span class="line"><span class="keyword">if</span>([<span class="keyword">self</span> isCacheAvailable] &amp;&amp; [UGTFliteUtil isChangeMinimalWithCurrentFrame:matOrigin lastFrame:_cachedMat threshold:<span class="number">0.035</span>]) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>.cachedOutput;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¡ç®—åŸå§‹size</span></span><br><span class="line"><span class="built_in">CGSize</span> sizeOrigin = orientation == <span class="built_in">UIInterfaceOrientationLandscapeRight</span> ? <span class="built_in">CGSizeMake</span>(matOrigin.cols, matOrigin.rows) : <span class="built_in">CGSizeMake</span>(matOrigin.rows, matOrigin.cols);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é•œåƒå’Œorientationç¿»è½¬</span></span><br><span class="line">cv::Mat matProcess = [UGTFliteUtil processMatWithOrientation:orientation isMirror:isMirror originMat:matOrigin];</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼©æ”¾åˆ°æ¨¡å‹æ¥æ”¶çš„sizeï¼Œ chaochaoè¯´è¿™ä¸ªæ¨¡å‹ä¸ç”¨ç­‰æ¯”ç¼©æ”¾ï¼Œå¯ä»¥æ‹‰ä¼¸å˜å½¢è¿›è¡Œæ¨ç†ï¼Œæ¨ç†ç»“æœå†åå‘æ‹‰ä¼¸è·å–å³å¯</span></span><br><span class="line">cv::Mat mat;</span><br><span class="line">cv::resize(matProcess, mat, cv::Size(<span class="keyword">self</span>.model.modelSize.width, <span class="keyword">self</span>.model.modelSize.height));</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„æ¨¡å‹éœ€æ±‚è¾“å…¥çš„æ˜¯å½’ä¸€åŒ–äºŒè¿›åˆ¶æ•°æ®</span></span><br><span class="line"><span class="built_in">NSData</span> *imageData = [UGTFliteUtil normalizedFloat32ImageDataFromCVMat:mat]; <span class="comment">// å½’ä¸€åŒ–å¤„ç†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡å‹å¼€å§‹æ‰§è¡Œæ¨ç†</span></span><br><span class="line"><span class="built_in">NSError</span> *error;</span><br><span class="line">[<span class="keyword">self</span>.interpreter resizeInputTensorAtIndex:<span class="number">0</span> toShape:[<span class="keyword">self</span> getTensorShape] error:&amp;error];</span><br><span class="line">TFLTensor *inputTensor = [<span class="keyword">self</span>.interpreter inputTensorAtIndex:<span class="number">0</span> error:&amp;error];</span><br><span class="line">[inputTensor copyData:imageData error:&amp;error];</span><br><span class="line">[<span class="keyword">self</span>.interpreter invokeWithError:&amp;error];</span><br><span class="line">TFLTensor *outputTensor = [<span class="keyword">self</span>.interpreter outputTensorAtIndex:<span class="number">0</span> error:&amp;error];</span><br><span class="line"><span class="built_in">NSData</span> *outputData = [outputTensor dataWithError:&amp;error];</span><br><span class="line"></span><br><span class="line"><span class="comment">// åç»­è§£ææ•°æ®</span></span><br><span class="line"><span class="built_in">NSDictionary</span> *resultDict = [<span class="keyword">self</span> detectWithTensorOutputData:outputData imageSize:sizeOrigin];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (error) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;Error++: %@&quot;</span>, error);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">self</span>.cachedOutput = resultDict;</span><br><span class="line"><span class="keyword">self</span>.cachedMat = matOrigin;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> resultDict;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// è§£ææ¨ç†æ•°æ®</span></span><br><span class="line">- (<span class="built_in">NSDictionary</span> *)detectWithTensorOutputData:(<span class="built_in">NSData</span> *)outputData imageSize:(<span class="built_in">CGSize</span>)imageSize &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¡ç®—åƒç´ æ€»æ•°</span></span><br><span class="line"><span class="type">int</span> inputWidth = <span class="keyword">self</span>.model.modelSize.width;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> inputHeight = <span class="keyword">self</span>.model.modelSize.height;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> num_pixels = inputHeight * inputWidth;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„OpenCV é‡Œé¢Matçš„åˆå§‹åŒ–æ˜¯ é«˜ * å®½ * é€šé“æ•°</span></span><br><span class="line">cv::Mat out_mask(inputHeight, inputWidth, CV_8UC1);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="type">float</span> *output = (<span class="keyword">const</span> <span class="type">float</span> *)outputData.bytes;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†æ¯ä¸ªåƒç´ å¹¶å¡«å…… out_mask è¿™ä¸ªè®¡ç®—æœ‰é—®é¢˜çš„ å®é™…æ˜¯ä¼šæœ‰ä¸åŒæ¦‚ç‡åˆ†å¸ƒçš„æ•°æ® ä¸æ˜¯é0å³1</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num_pixels; i++) &#123;</span><br><span class="line">out_mask.data[i] = (output[<span class="number">2</span> * i + <span class="number">1</span>] &gt; <span class="number">0.1</span>f) ? <span class="number">255</span> : <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è…èš€ è¿™ä¸ªä¼˜åŒ–æ”¹ä¸ºäº¤ç»™GPUImageå¤„ç† ä¸å†ä½¿ç”¨cv</span></span><br><span class="line"><span class="comment">// cv::Mat element = cv::getStructuringElement(cv::MORPH_RECT, cv::Size(3, 3));</span></span><br><span class="line"><span class="comment">// cv::erode(outputMat, outputMat, element);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é«˜æ–¯æ¨¡ç³Š è¿›è¡Œè¾¹ç¼˜ä¼˜åŒ– è¿™ä¸ªä¼˜åŒ–æ”¹ä¸ºäº¤ç»™GPUImageå¤„ç† ä¸å†ä½¿ç”¨cv</span></span><br><span class="line"><span class="comment">// cv::GaussianBlur(out_mask, out_mask, cv::Size(3, 3), 0, 0);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// maskå›¾å†æ”¾å¤§</span></span><br><span class="line">cv::Mat outputMat;</span><br><span class="line">cv::resize(out_mask, outputMat, cv::Size(imageSize.width, imageSize.height));</span><br><span class="line"></span><br><span class="line"><span class="built_in">UIImage</span> *outputImage = [UGTFliteUtil imageFromCVMat:outputMat];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> @&#123;<span class="string">@&quot;image&quot;</span>:outputImage, <span class="string">@&quot;imageWidth&quot;</span>:@(imageSize.width),<span class="string">@&quot;imageHeight&quot;</span>:@(imageSize.height)&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">BOOL</span>)isCacheAvailable &#123;</span><br><span class="line"><span class="keyword">return</span> !<span class="keyword">self</span>.cachedMat.empty() &amp;&amp; <span class="keyword">self</span>.cachedOutput;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>æ ¸å¿ƒæ¸²æŸ“ä»£ç å¦‚ä¸‹</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// èƒŒæ™¯æ¨¡ç³Šæ»¤é•œç»„</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="string">&quot;GPUImage.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="string">&quot;GPUImageThreeInputFilter.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="string">&quot;UGImageBackgroundBlurFilter.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *<span class="keyword">const</span> kUGImagePortraitMaskBlendFragmentShaderString = SHADER_STRING</span><br><span class="line">(</span><br><span class="line">precision highp <span class="type">float</span>;</span><br><span class="line"></span><br><span class="line">varying highp vec2 textureCoordinate;</span><br><span class="line">varying highp vec2 textureCoordinate2;</span><br><span class="line">varying highp vec2 textureCoordinate3;</span><br><span class="line"></span><br><span class="line">uniform sampler2D inputImageTexture;</span><br><span class="line">uniform sampler2D inputImageTexture2;</span><br><span class="line">uniform sampler2D inputImageTexture3;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main() &#123;</span><br><span class="line">vec4 baseColor = texture2D(inputImageTexture, textureCoordinate);</span><br><span class="line">vec4 blurredColor = texture2D(inputImageTexture2, textureCoordinate2);</span><br><span class="line">vec4 maskColor = texture2D(inputImageTexture3, textureCoordinate3);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¢„ä¹˜Alpha</span></span><br><span class="line">baseColor.rgb *= baseColor.a;</span><br><span class="line">blurredColor.rgb *= blurredColor.a;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ¹æ® maskColor çš„ç°åº¦å€¼è®¡ç®—æ··åˆçš„é€æ˜åº¦é€šé“</span></span><br><span class="line"><span class="type">float</span> maskValue = dot(maskColor.rgb, vec3(<span class="number">0.299</span>, <span class="number">0.587</span>, <span class="number">0.114</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¹³æ»‘å¤„ç†è¾¹ç•Œåƒç´ å€¼</span></span><br><span class="line"><span class="type">float</span> smoothMaskValue = smoothstep(<span class="number">0.0</span>, <span class="number">1.0</span>, maskValue);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ··åˆé¢œè‰²</span></span><br><span class="line">vec4 mixedColor = mix(blurredColor, baseColor, smoothMaskValue);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£é™¤é¢„ä¹˜Alpha</span></span><br><span class="line"><span class="keyword">if</span> (mixedColor.a &gt; <span class="number">0.0</span>) &#123;</span><br><span class="line">mixedColor.rgb /= mixedColor.a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gl_FragColor = mixedColor;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UGImagePortraitMaskBlendFilter</span> : <span class="title">GPUImageThreeInputFilter</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UGImagePortraitMaskBlendFilter</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line"><span class="keyword">self</span> = [<span class="variable language_">super</span> initWithFragmentShaderFromString:kUGImagePortraitMaskBlendFragmentShaderString];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–æ»¤é•œ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UGImageBackgroundBlurFilter</span>()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) GPUImageGaussianBlurFilter *blurFilter;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) UGImagePortraitMaskBlendFilter *blendInputFilter;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UGImageBackgroundBlurFilter</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="variable language_">super</span> init]) &#123;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–é«˜æ–¯æ¨¡ç³Šæ»¤é•œ</span></span><br><span class="line"><span class="keyword">self</span>.blurFilter = [[GPUImageGaussianBlurFilter alloc] init];</span><br><span class="line"><span class="keyword">self</span>.blurFilter.blurRadiusInPixels = <span class="number">31</span>;</span><br><span class="line">[<span class="keyword">self</span> addFilter:<span class="keyword">self</span>.blurFilter];</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–æ··åˆä¸‰è¾“å…¥æ»¤é•œ</span></span><br><span class="line"><span class="keyword">self</span>.blendInputFilter = [[UGImagePortraitMaskBlendFilter alloc] init];</span><br><span class="line">[<span class="keyword">self</span> addFilter:<span class="keyword">self</span>.blendInputFilter];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®æ»¤é•œé“¾</span></span><br><span class="line">[<span class="keyword">self</span>.blurFilter addTarget:<span class="keyword">self</span>.blendInputFilter atTextureLocation:<span class="number">1</span>];</span><br><span class="line">[<span class="keyword">self</span> setInitialFilters:@[<span class="keyword">self</span>.blurFilter, <span class="keyword">self</span>.blendInputFilter]];</span><br><span class="line">[<span class="keyword">self</span> setTerminalFilter:<span class="keyword">self</span>.blendInputFilter];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)setMaskImage:(<span class="built_in">UIImage</span> *)maskImage &#123;</span><br><span class="line"><span class="comment">// è…èš€ + é«˜æ–¯æ¨¡ç³Šè¿›è¡Œè¾¹ç¼˜ä¼˜åŒ–</span></span><br><span class="line">GPUImagePicture *maskImageSource = [[GPUImagePicture alloc] initWithImage:maskImage];</span><br><span class="line">GPUImageErosionFilter *erosionFilter = [[GPUImageErosionFilter alloc] initWithRadius:<span class="number">3</span>];</span><br><span class="line">GPUImageGaussianBlurFilter *blurFilter = [[GPUImageGaussianBlurFilter alloc] init];</span><br><span class="line">blurFilter.blurRadiusInPixels = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">[maskImageSource addTarget:erosionFilter];</span><br><span class="line">[erosionFilter addTarget:blurFilter];</span><br><span class="line">[blurFilter addTarget:<span class="keyword">self</span>.blendInputFilter atTextureLocation:<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">[erosionFilter useNextFrameForImageCapture];</span><br><span class="line">[blurFilter useNextFrameForImageCapture];</span><br><span class="line">[maskImageSource processImage];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="ç«¯ä¾§ä¼˜åŒ–"><a href="#ç«¯ä¾§ä¼˜åŒ–" class="headerlink" title="ç«¯ä¾§ä¼˜åŒ–"></a>ç«¯ä¾§ä¼˜åŒ–</h4><p>åœ¨å®ç°çš„è¿‡ç¨‹ä¸­å‘ç°ä¸€äº›é—®é¢˜ï¼Œä»APPä¾§åšäº†ä¸€äº›ä¼˜åŒ–ã€‚</p>
<h5 id="è¾¹ç¼˜ä¼˜åŒ–"><a href="#è¾¹ç¼˜ä¼˜åŒ–" class="headerlink" title="è¾¹ç¼˜ä¼˜åŒ–"></a>è¾¹ç¼˜ä¼˜åŒ–</h5><p>æ¨¡å‹è®¡ç®—å‡ºæ¥çš„maskå›¾åƒçš„é»‘ç™½åˆ†ç•Œæ¯”è¾ƒæ˜æ˜¾ï¼ˆåƒç´ ç‚¹é1å³0ï¼‰ï¼Œè§†è§‰æ•ˆæœä¸Šåœ¨èƒŒæ™¯å’Œäººåƒçš„åˆ†ç•Œå¤„æœ‰è¾ƒæ¸…æ™°çš„è¾¹ç•Œè½å·®ã€‚</p>
<p>é’ˆå¯¹è¿™ä¸ªé—®é¢˜æˆ‘ä»¬åœ¨ä½¿ç”¨æ¨ç†å‡ºæ¥çš„maskè¿›å…¥ç‰‡å…ƒç€è‰²å™¨é´é€‰åƒç´ ä¹‹å‰å…ˆè¿‡äº†ä¸€æ¬¡7ä¸ªåƒç´ çš„é«˜æ–¯æ¨¡ç³Šæ»¤é•œï¼Œå°†maskå›¾çš„è¾¹ç¼˜çš„é”‹åˆ©åŒºåŸŸæŠ¹å¹³ã€‚</p>
<p>è¾¹ç¼˜é«˜æ–¯æ¨¡ç³Šååˆ†ç•Œä¸å†è¿‡äºæ˜æ˜¾ï¼Œäººåƒå‘¨å›´ä¼šå­˜åœ¨ä¸€åœˆé€æ˜å’ŒåŠé€æ˜äº¤ç»‡çš„å…‰åœˆã€‚</p>
<p>å…‰åœˆçš„åŠå¾„å¤§å°å–å†³äºæ¨¡å‹æ¨ç†å‡ºæ¥çš„maskå›¾çš„å°ºå¯¸ï¼Œæ©ç å›¾è¶Šå¤§è¶Šç²¾ç»†ï¼Œå…‰åœˆè¶Šå°è¶Šè´´è¿‘çœŸå®çš„äººåƒã€‚ï¼ˆå’Œå°å›¾ç‰‡æ”¾å¤§ä¼šå˜é©¬èµ›å…‹åŒæ ·åŸç†ï¼‰</p>
<h5 id="è¾¹ç¼˜è…èš€"><a href="#è¾¹ç¼˜è…èš€" class="headerlink" title="è¾¹ç¼˜è…èš€"></a>è¾¹ç¼˜è…èš€</h5><p>ç»è¿‡è¾¹ç¼˜ä¼˜åŒ–äººåƒåŒºåŸŸåˆ†ç•Œç‚¹å¼±åŒ–åå‘ç°äººåƒå‘¨å›´çš„é€æ˜å…‰åœˆä¼šæ¼å‡ºä¸€äº›èƒŒæ™¯ä¿¡æ¯ã€‚</p>
<p>ä¸ºäº†é™ä½æ¼å‡ºçš„èƒŒæ™¯ä¿¡æ¯ï¼Œæˆ‘ä»¬åœ¨é«˜æ–¯æ¨¡ç³Šä¹‹å‰å¯¹æ©ç å›¾åšäº†ä¸€æ¬¡3åƒç´ çš„è…èš€ï¼Œå°†äººåƒåŒºåŸŸå‘å†…æ”¶ç¼©ã€‚</p>
<h5 id="æ’å€¼ä¼˜åŒ–"><a href="#æ’å€¼ä¼˜åŒ–" class="headerlink" title="æ’å€¼ä¼˜åŒ–"></a>æ’å€¼ä¼˜åŒ–</h5><p>ç»“åˆæˆ‘ä»¬çš„AIä½œä¸šçš„å½•åˆ¶åœºæ™¯ï¼ŒAPPç«¯å¯¹ä¸¤å¸§ä¹‹é—´å˜åŒ–ä¸è¶…è¿‡96.5%çš„ä¸å†æ‰§è¡Œæ¨ç†ï¼Œå¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šæé«˜å½•åˆ¶çš„å¸§ç‡ã€‚</p>
<p>è¯¥é˜ˆå€¼ç»è¿‡ä¸€äº›æµ‹è¯•å¾—å‡ºï¼Œå…¶æ•ˆæœä¸ºåˆ«çš„éƒ¨ä½å’ŒèƒŒæ™¯ä¸å˜ï¼Œä»…é¢éƒ¨å£å‹å‘ç”Ÿå˜åŒ–ï¼Œå…¶ä¸¤å¸§ä¹‹é—´çš„å·®è·å°äº3.5%ã€‚</p>
<h5 id="å¸§ç¼“å­˜"><a href="#å¸§ç¼“å­˜" class="headerlink" title="å¸§ç¼“å­˜"></a>å¸§ç¼“å­˜</h5><p>æ¨ç†æ¨¡å‹å­˜åœ¨æŠ¥é”™çš„å¯èƒ½ï¼Œæ¯ä¸€å¸§æ¨ç†æˆåŠŸå®Œæˆåéƒ½ä¼šç¼“å­˜è¯¥æ¨ç†ç»“æœã€‚</p>
<p>å¦‚æœå½“å‰å¸§æ¨ç†æŠ¥é”™åˆ™ä¼šä½¿ç”¨ä¸Šä¸€å¸§çš„ç»“æœï¼Œé¿å…å‡ºç°æ¨¡ç³Šå¤±æ•ˆæš´éœ²å®Œæ•´èƒŒæ™¯ä¿¡æ¯çš„æƒ…å†µã€‚</p>
<h4 id="é—ç•™é—®é¢˜"><a href="#é—ç•™é—®é¢˜" class="headerlink" title="é—ç•™é—®é¢˜"></a>é—ç•™é—®é¢˜</h4><p><strong>å‘å†…è…èš€å¯¼è‡´äººåƒè¾¹ç¼˜ç¼ºå¤±</strong></p>
<p>æ‰‹æŒ‡åŒºåŸŸæœ‰æ—¶å€™ä¼šå‡ºç°è¯†åˆ«è¯¯å·®å¯¼è‡´æ‰‹æŒ‡åŒºåŸŸæ¯”è¾ƒç»†å°ï¼Œå› ä¸ºå‘å†…è…èš€è€Œå‡ºç°æ‰‹æŒ‡è¢«è…èš€æ‰çš„é—®é¢˜ã€‚</p>
<p><strong>å¸§ç‡ä½</strong></p>
<p>ç«¯ä¸Šå½•åˆ¶çš„åŒæ—¶åšäº†è¿‡å¤šæ»¤é•œæ–¹é¢çš„å·¥ä½œï¼ŒåŒæ—¶å¤„ç†èƒŒæ™¯æ¨¡ç³Šå’Œäººè„¸ç¾é¢œï¼Œæ€§èƒ½è¾ƒä½ã€‚</p>
<p>ä¸å¼€èƒŒæ™¯æ¨¡ç³Šèƒ½è·‘æ»¡30pfsï¼Œå¼€äº†èƒŒæ™¯æ¨¡ç³Šä¼šé™ä½åˆ°10-15fpsã€‚</p>
<p><strong>æ¨¡å‹è¯†åˆ«ç²¾åº¦ä¸è¶³</strong></p>
<p>è¯†åˆ«ç²¾åº¦éš¾ä»¥è¾¾åˆ°äº§å“é¢„æœŸã€‚å½“å‰æ¨¡å‹å°ºå¯¸è¾ƒå°ï¼Œå¦‚æœæ¢é«˜ç²¾åº¦æ¨¡å‹ä¼šè¿›ä¸€æ­¥é™ä½å¸§ç‡ï¼Œè§†é¢‘ä¼šå¡ã€‚</p>
<h3 id="Vision-æ¨¡å‹"><a href="#Vision-æ¨¡å‹" class="headerlink" title="Vision æ¨¡å‹"></a>Vision æ¨¡å‹</h3><p>Vision æ˜¯ Apple åœ¨ WWDC 2017 æ¨å‡ºçš„å›¾åƒè¯†åˆ«æ¡†æ¶ã€‚Visionåº“é‡Œæœ¬èº«å°±å·²ç»è‡ªå¸¦äº†å¾ˆå¤šè®­ç»ƒå¥½çš„Core MLæ¨¡å‹ï¼Œäººè„¸è¯†åˆ«ã€æ¡å½¢ç æ£€æµ‹ç­‰ç­‰åŠŸèƒ½ã€‚</p>
<p>å¦‚æœä½ è¦å®ç°çš„åŠŸèƒ½åˆšå¥½æ˜¯Visionåº“æœ¬èº«å°±èƒ½å®ç°çš„ï¼Œé‚£ä¹ˆä½ ç›´æ¥ä½¿ç”¨Visionåº“è‡ªå¸¦çš„ä¸€äº›ç±»å’Œæ–¹æ³•å°±è¡Œï¼Œä½†æ˜¯å¦‚æœæƒ³è¦æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆè¿˜æ˜¯éœ€è¦ç»“åˆå…¶å®ƒCore MLæ¨¡å‹ã€‚</p>
<p>Apple å®˜æ–¹ä¹Ÿæä¾›äº†äººåƒåˆ†å‰²çš„æ¨¡å‹VNGeneratePersonSegmentationRequestï¼Œéœ€è¦iOS 15.0 ä»¥ä¸Šç³»ç»Ÿå¯ä»¥ä½¿ç”¨è¯¥APIã€‚</p>
<h4 id="æ ¸å¿ƒå®ç°"><a href="#æ ¸å¿ƒå®ç°" class="headerlink" title="æ ¸å¿ƒå®ç°"></a>æ ¸å¿ƒå®ç°</h4><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> (@available(iOS <span class="number">15.0</span>, *)) &#123;</span><br><span class="line">CVPixelBufferRef pixelBuffer = <span class="built_in">CMSampleBufferGetImageBuffer</span>(sampleBuffer);</span><br><span class="line"><span class="keyword">if</span> (!pixelBuffer) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">VNGeneratePersonSegmentationRequest *request = [[VNGeneratePersonSegmentationRequest alloc] init];</span><br><span class="line"><span class="comment">// å†³å®šä½¿ç”¨é«˜è´¨é‡çš„maskè¿˜æ˜¯é«˜é€Ÿåº¦çš„mask</span></span><br><span class="line">request.qualityLevel = VNGeneratePersonSegmentationRequestQualityLevelAccurate;</span><br><span class="line">request.outputPixelFormat = kCVPixelFormatType_OneComponent8;</span><br><span class="line"><span class="comment">// æ¨ç†äº§ç”Ÿmask</span></span><br><span class="line">VNImageRequestHandler *requestHandler = [[VNImageRequestHandler alloc] initWithCVPixelBuffer:pixelBuffer options:@&#123;&#125;];</span><br><span class="line"><span class="built_in">NSError</span> *error = <span class="literal">nil</span>;</span><br><span class="line">[requestHandler performRequests:@[request] error:&amp;error];</span><br><span class="line"><span class="keyword">if</span> (error) &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;Failed to perform segmentation request: %@&quot;</span>, error);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">VNPixelBufferObservation *mask = (VNPixelBufferObservation *)request.results.firstObject;</span><br><span class="line"><span class="keyword">if</span> (mask) &#123;</span><br><span class="line"><span class="built_in">CIImage</span> *ciImage = [<span class="built_in">CIImage</span> imageWithCVPixelBuffer:mask.pixelBuffer];</span><br><span class="line"><span class="built_in">CIContext</span> *context = [<span class="built_in">CIContext</span> context];</span><br><span class="line"><span class="built_in">CGImageRef</span> cgImage = [context createCGImage:ciImage fromRect:ciImage.extent];</span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithCGImage:cgImage];</span><br><span class="line"><span class="built_in">CGImageRelease</span>(cgImage);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">self</span>.getDevicePostion == <span class="built_in">AVCaptureDevicePositionFront</span>) &#123;</span><br><span class="line">image = [<span class="keyword">self</span> flipImageVertically:image];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œæ¸²æŸ“</span></span><br><span class="line">[<span class="keyword">self</span>.filter setBlurBackgroundMaskImage:image];</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;VNGeneratePersonSegmentationRequest is not available on this iOS version.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬é¡¹ç›®æ”¯æŒåˆ°iOS 10.0 æ‰€ä»¥ä½¿ç”¨åŸç”Ÿæ¨¡å‹æ˜¯æœ‰å±€é™æ€§çš„ã€‚</p>
<p>å¦å¤–å¦‚æœä½¿ç”¨é«˜ç²¾åº¦æ¨¡å‹VNGeneratePersonSegmentationRequestQualityLevelAccurateï¼Œå…¶è¿è¡Œé€Ÿåº¦ä¹Ÿæ¯”è¾ƒæ…¢ã€‚</p>
<p>å¦‚æœä½¿ç”¨ç²¾åº¦å’Œé€Ÿåº¦ç›¸å¹³è¡¡çš„æ¨¡å‹åˆ™å…¶è¯†åˆ«æ•ˆæœæœªç»è¿‡äº§å“éªŒè¯æ— æ³•ç¡®å®šæ˜¯å¦è¾¾åˆ°éœ€æ±‚ã€‚</p>
<h2 id="ä¼˜åŒ–æ–¹å‘"><a href="#ä¼˜åŒ–æ–¹å‘" class="headerlink" title="ä¼˜åŒ–æ–¹å‘"></a>ä¼˜åŒ–æ–¹å‘</h2><h3 id="AI"><a href="#AI" class="headerlink" title="AI"></a>AI</h3><p>AIè€ƒè™‘æå‡æ¨¡å‹è¿ç®—æ•ˆç‡å’Œæ¨ç†ç²¾åº¦ï¼Œç”±AIå›¢é˜Ÿè°ƒç ”å’Œç ”å‘ã€‚</p>
<h3 id="APP"><a href="#APP" class="headerlink" title="APP"></a>APP</h3><p>æ ¹æ®æ¨¡å‹æ¨ç†ç²¾åº¦æ¥å†³å®šæ˜¯å¦ç§»é™¤æ‰è…èš€é€»è¾‘ï¼Œä¿è¯äººåƒåŒºåŸŸå®Œæ•´ã€‚</p>
<p>æ£€æµ‹å¤šä¸ªæ»¤é•œé“¾åˆå¹¶æ—¶å€™çš„æ•ˆç‡ï¼Œæ ¹æ®ç»“æœå†³å®šæ˜¯å¦éœ€è¦åˆ†ç¦»ç¾é¢œå’ŒèƒŒæ™¯æ¨¡ç³Šæ»¤é•œã€‚</p>
<p>ä½¿ç”¨å¸§é‡‡æ ·åšmaskåŸºå‡†ï¼Œå°½é‡å‡å°‘æ¨¡å‹æ¨ç†æ¬¡æ•°ã€‚</p>
<p>é‡‡æ ·å¤šä¸ªæ¨¡å‹ï¼Œæ ¹æ®å¸§ç‡åŠ¨æ€é™çº§ã€‚</p>
<h3 id="é‡‡ç”¨iOS-Vision-æ¨ç†æ¡†æ¶-å·¥ç¨‹åŒ–ä¼˜åŒ–"><a href="#é‡‡ç”¨iOS-Vision-æ¨ç†æ¡†æ¶-å·¥ç¨‹åŒ–ä¼˜åŒ–" class="headerlink" title="é‡‡ç”¨iOS Vision æ¨ç†æ¡†æ¶ å·¥ç¨‹åŒ–ä¼˜åŒ–"></a>é‡‡ç”¨iOS Vision æ¨ç†æ¡†æ¶ å·¥ç¨‹åŒ–ä¼˜åŒ–</h3><p>é‡‡ç”¨ VNGeneratePersonSegmentationRequestQualityLevelBalanced æ¡£ä½çš„äººåƒåˆ†å‰²æ¨¡å‹ï¼Œæ•ˆæœå¯ä»¥æ¥å—ã€‚</p>
<p>æµ‹è¯•æœº iOS 15.2 iPhone 11</p>
<p>2024-11-29 15:53:32.273863+0800 [5274:3232793] å¼€å§‹æ¨ç† 1732866812.273805</p>
<p>2024-11-29 15:53:32.300939+0800 [5274:3232793] æ¨ç†å®Œæˆ 1732866812.300908</p>
<p>2024-11-29 15:53:32.309572+0800 [5274:3232793] è½¬å›¾ç‰‡å®Œæˆ 1732866812.309538</p>
<p>äººåƒåˆ†å‰²æ¨ç†ç”¨æ—¶ 27.1 ms  è½¬å›¾ç‰‡ç”¨æ—¶ 8.5 ms</p>
<p>å½“å‰FPS ä¸º 15 æ¯ä¸€å¸§è§†é¢‘ç”¨æ—¶ 66.67ms</p>
<p>äººåƒåˆ†å‰²å¤§æ¦‚éœ€è¦åœ¨åŸå§‹è€—æ—¶çš„åŸºç¡€ä¸Šå¢åŠ 35 ms</p>
<p>ä¸å¼€äººåƒåˆ†å‰²å¯ä»¥è¾¾åˆ°è®¾ç½®çš„æœ€ä½³å¸§ç‡ 30 FPSã€‚</p>
<p>æ’æŸ¥å…¶ä»–ç”¨æ—¶è¯¦æƒ…ï¼š</p>
<p>2024-11-29 16:54:07.306245+0800 [5358:3254717] å¼€å§‹åº”ç”¨æ»¤é•œ 1732870447.306170</p>
<p>2024-11-29 16:54:07.310206+0800 [5358:3254717] åº”ç”¨æ»¤é•œå®Œæˆ 1732870447.310165</p>
<p>åˆæˆå›¾åƒåŠè¾¹ç¼˜ä¼˜åŒ–çš„æ»¤é•œç”¨æ—¶ 4ms ä¼˜åŒ–ç©ºé—´è¾ƒå°</p>
<p>ä¸»è¦ä¼˜åŒ–æ–¹å‘è¿˜æ˜¯åœ¨äººåƒåˆ†å‰²æ¨ç†ä¸Š</p>
<p>é‡‡ç”¨å·®å€¼ä¼˜åŒ–ï¼Œå¸§ç›¸ä¼¼åº¦å°äºæŸä¸ªå€¼æ‰è¿›è¡Œæ£€æµ‹</p>
<p>å·®å€¼è®¡ç®—å¸¦æ¥é¢å¤–çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¦‚æœè®¡ç®—å‡ºæ¥éœ€è¦æ£€æµ‹ï¼Œåˆ™æ£€æµ‹ç”¨æ—¶éœ€è¦è¿½åŠ å·®å€¼è®¡ç®—çš„æ—¶é—´æ¶ˆè€—ï¼Œå¦‚æœè®¡ç®—å‡ºæ¥ä¸éœ€è¦æ£€æµ‹ï¼Œå°±èŠ‚çœäº†ä¸€æ¬¡æ¨ç†æ—¶é—´ã€‚</p>
<p>å¦‚æœå·®å€¼è®¡ç®—æ¶ˆè€—æ•°é‡çº§è¿œè¿œå°äºäººåƒåˆ†å‰²æ¨ç† åˆ™æ•ˆæœæ¯”è¾ƒæ˜æ˜¾ã€‚</p>
<p>2024-11-29 18:01:49.232560+0800 [5457:3292643] å¼€å§‹è®¡ç®—å·®å€¼ 1732874509.232429</p>
<p>2024-11-29 18:01:49.237739+0800 [5457:3292643] å®Œæˆè®¡ç®—å·®å€¼ 1732874509.237706</p>
<p>è®¡ç®—å·®å€¼éœ€è¦ 5ms</p>
<p>åœ¨å·®å€¼2.5%çš„åŸºå‡†ä¸Šï¼Œå¦‚æœäººåƒåŠ¨ä½œå¹…åº¦è¾ƒå°åˆ™å¸§ç‡æå‡åˆ°20-25å·¦å³ã€‚</p>
<p>æ’å€¼åŸºå‡†è¶Šå¤§ï¼Œåˆ™å¸§ç‡æå‡è¶Šæ˜æ˜¾ï¼Œä½†æ˜¯å¯¹äººåƒåˆ†å‰²çš„æ•ˆæœä¼šæœ‰è´Ÿé¢å½±å“ï¼ˆ<strong>æœ‰æ®‹å½±</strong>ï¼‰ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://blog.csdn.net/Jason_Lee155/article/details/121216691">OpenGL ESå‡ ä¸ªæ¦‚å¿µ-é¡¶ç‚¹ç€è‰²å™¨ã€ç‰‡å…ƒç€è‰²å™¨ã€EG</a></p>
<p><a href="https://learnopengl-cn.github.io/">OpenGLå­¦ä¹ æ•™ç¨‹</a></p>
<p><a href="https://www.nxrte.com/jishu/38561.html">äººåƒåˆ†å‰²æŠ€æœ¯æœ‰å“ªäº›ï¼Ÿ</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1077019">Vision å›¾åƒè¯†åˆ«æ¡†æ¶</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯åˆ†äº«</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>å›¾åƒå¤„ç†</tag>
        <tag>AI</tag>
      </tags>
  </entry>
  <entry>
    <title>iOSç¼–è¯‘ä¼˜åŒ–æ–¹æ¡ˆæ¢ç´¢ä¸å®è·µ-ç»„ä»¶ç¯‡</title>
    <url>/2021/09/18/iOS%E7%BC%96%E8%AF%91%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%AE%9E%E8%B7%B5-%E7%BB%84%E4%BB%B6%E7%AF%87/</url>
    <content><![CDATA[<h1 id="iOSç¼–è¯‘ä¼˜åŒ–æ–¹æ¡ˆæ¢ç´¢ä¸å®è·µ-ç»„ä»¶ç¯‡"><a href="#iOSç¼–è¯‘ä¼˜åŒ–æ–¹æ¡ˆæ¢ç´¢ä¸å®è·µ-ç»„ä»¶ç¯‡" class="headerlink" title="iOSç¼–è¯‘ä¼˜åŒ–æ–¹æ¡ˆæ¢ç´¢ä¸å®è·µ-ç»„ä»¶ç¯‡"></a>iOSç¼–è¯‘ä¼˜åŒ–æ–¹æ¡ˆæ¢ç´¢ä¸å®è·µ-ç»„ä»¶ç¯‡</h1><h3 id="åºè¨€"><a href="#åºè¨€" class="headerlink" title="åºè¨€"></a>åºè¨€</h3><p>ç›®å‰ä¸»æµçš„é¡¹ç›®æ„å»ºæ–¹æ¡ˆä¸­å‡ ä¹éƒ½ä½¿ç”¨cocoapodsè¿›è¡Œç»„ä»¶åº“ç®¡ç†ï¼Œä¸è®ºæ˜¯ç¬¬ä¸‰æ–¹å¼€æºåº“è¿˜æ˜¯è‡ªç ”çš„ç§æœ‰åº“ï¼Œéƒ½ä¼šç”Ÿæˆ.podspecæ–‡ä»¶ä½¿ç”¨cocoapodså·¥å…·è¿›è¡Œç»´æŠ¤ã€‚</p>
<p>ä¸ºäº†ä¾¿äºè¿›è¡Œè°ƒè¯•ï¼Œç¬¬ä¸‰æ–¹å¼€æºåº“æˆ–ç§æœ‰ä»£ç åº“ æˆ‘ä»¬éƒ½ä»¥æºç çš„æ–¹å¼è¿›è¡Œå¼•å…¥ã€‚</p>
<p>æ¯æ¬¡åœ¨æœ¬æœºè¿›è¡Œå…¨é‡ç¼–è¯‘æˆ–è€…ciæœºå™¨è¿›è¡Œæ‰“åŒ…çš„æ—¶å€™éƒ½ä¼šå…ˆç¼–è¯‘podä»“åº“ä¸­çš„æºä»£ç ï¼Œç„¶åé“¾æ¥åˆ°ä¸»é¡¹ç›®ä¸­ã€‚</p>
<p>è¿™ä¸ªæµç¨‹æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯éšç€é¡¹ç›®çš„çš„å¤§é‡è¿­ä»£å’Œé•¿æ—¶é—´ç»´æŠ¤ï¼Œå¼•å…¥çš„ä»“åº“ä¼šè¶Šæ¥è¶Šå¤šã€‚ä»¥æˆ‘ä»¬çš„é¡¹ç›®ä¸ºä¾‹ï¼Œé¡¹ç›®è¿­ä»£äº†3å¹´å·¦å³ï¼Œå¼•å…¥çš„ç¬¬ä¸‰æ–¹ä»“åº“è¾¾åˆ°äº†30+ä¸ªã€‚åœ¨æˆ‘çš„macä¸Šè¿›è¡Œä¸€æ¬¡å…¨é‡ç¼–è¯‘æ—¶é—´è¾¾åˆ°äº†500sï¼Œæ€§èƒ½ç¨å·®çš„è®¾å¤‡ç¼–è¯‘æ¶ˆè€—çš„æ—¶é—´æ›´é•¿ã€‚</p>
<p>é’ˆå¯¹ç»„ä»¶åº“çš„ç¼–è¯‘æ—¶é•¿çš„ä¼˜åŒ–æ–¹æ¡ˆå¾ˆç®€å•ï¼ŒæŠŠcocoapodsä»“åº“ä¸­å¼•å…¥çš„éœ€è¦ç¼–è¯‘çš„æºç æ”¹æˆä¸éœ€è¦ç¼–è¯‘çš„äºŒè¿›åˆ¶åº“å³å¯ã€‚</p>
<p>å½“ç„¶ä¸€åˆ€åˆ‡çš„å¼•å…¥æ–¹å¼åˆ‡æ¢æ˜¯ä¸å¯å–çš„ï¼Œæ ¹æ®è‡ªèº«çš„å®é™…æƒ…å†µï¼Œå¯¹ä¸€äº›åŸºæœ¬ä¸ä¼šè¿›å…¥è°ƒè¯•çš„ä»£ç å’Œä¸€äº›ç¨³å®šç‰ˆæœ¬çš„å¸¸ç”¨çš„ä»“åº“è¿›è¡ŒäºŒè¿›åˆ¶åŒ–è¾ƒä¸ºåˆé€‚ã€‚</p>
<p>é’ˆå¯¹ä»¥ä¸Šæƒ³æ³•æœ‰äº†ä¸€äº›cocoapodsæ’ä»¶å¯ä»¥ä½¿ç”¨ã€‚</p>
<h3 id="Cocoapods-Binary"><a href="#Cocoapods-Binary" class="headerlink" title="Cocoapods-Binary"></a>Cocoapods-Binary</h3><p>cocoapods 1.6.xç‰ˆæœ¬çš„æ—¶å€™å¸¸ç”¨çš„ä¸€ä¸ªä»“åº“ï¼Œå¤§å®¶å¯èƒ½éƒ½ç”¨è¿‡ï¼Œå…¶æ€è·¯æ˜¯åœ¨cocoapodsè¿›è¡Œinstallæ“ä½œæ—¶é€šè¿‡å°† dependencies é¢„ç¼–è¯‘æˆ binary åç¼“å­˜è‡³æœ¬åœ°ï¼Œç„¶åå°†åŸæœ‰çš„ Source Code link åˆ° binary ä»¥å‡ ä¹é›¶æˆæœ¬çš„æ–¹å¼å®ç°ç¼–è¯‘æ•ˆç‡çš„æé«˜ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´åœ¨pod installçš„è¿‡ç¨‹ä¸­å…ˆè¿›è¡Œé¢„ç¼–è¯‘ï¼Œé¢„ç¼–è¯‘ä¹‹åæ¯æ¬¡pod installéƒ½å°†ç¼–è¯‘å®Œçš„äºŒè¿›åˆ¶linkåˆ°é¡¹ç›®ï¼Œè¿™æ ·å°±å®Œæˆäº†æºç åˆ°äºŒè¿›åˆ¶çš„è½¬åŒ–ã€‚</p>
<p>è§„æ¨¡è¾ƒå°çš„å›¢é˜Ÿéå¸¸é€‚åˆè¿™ç§æ–¹æ¡ˆï¼Œæ²¡æœ‰ä»€ä¹ˆé¢å¤–çš„æˆæœ¬ï¼Œæˆå‘˜åä½œä¹‹é—´ä¹Ÿä¸ä¼šäº§ç”Ÿå†²çªï¼Œé€šè¿‡ç®€å•çš„ :binary &#x3D;&gt; trueæŒ‡ä»¤å³å¯è®¾ç½®ä»“åº“çš„äºŒè¿›åˆ¶å’Œæºç çš„åˆ‡æ¢ã€‚</p>
<blockquote>
<p>ä½†æ˜¯ç›®å‰è¿™ä¸ªåº“ä¸å†ç»´æŠ¤äº†ï¼ŒåŒæ—¶åœ¨swiftæ–¹é¢ä¹Ÿå­˜åœ¨ç€ä¸€äº›é—®é¢˜<br>ç”±äº CocoaPods åœ¨ 1.7.x ä»¥ä¸Šç‰ˆæœ¬ï¼Œä¿®æ”¹äº† framework ç”Ÿæˆé€»è¾‘ï¼Œä¸ä¼šæŠŠ bundle copy è‡³ frameworkï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°† Pod ç¯å¢ƒå›ºå®šåˆ° 1.6.2<br>pod è¦æ”¯æŒ binaryï¼Œheader ref éœ€è¦å˜æ›´ä¸º #import &lt;&gt;æˆ–è€… @import ä»¥ç¬¦åˆ moduler æ ‡å‡†<br>ç»Ÿä¸€ CI å’Œå¼€å‘çš„ compiler ç¯å¢ƒï¼Œå¦‚æœé¡¹ç›®æ”¯æŒ Swiftï¼Œä¸åŒ compiler ç¼–è¯‘äº§ç‰©æœ‰ Swift ç‰ˆæœ¬å…¼å®¹é—®é¢˜<br>æœ€ç»ˆçš„ binary size ä¼šæ¯”ä½¿ç”¨æºç çš„æ—¶å€™å¤§ä¸€ç‚¹ï¼Œä¸å»ºè®®æœ€ç»ˆä¸Šä¼  Store<br>å»ºè®® Git ignore Pods æ–‡ä»¶å¤¹ï¼Œå¦åˆ™åœ¨ source code ä¸ binary åˆ‡æ¢è¿‡ç¨‹ä¼šæœ‰å¤§é‡çš„ file changeï¼Œå¢åŠ  git è´Ÿæ‹…<br>â€”å¼•ç”¨è‡ª<a href="https://juejin.cn/post/6844904025624674311">æµ…æ Cocoapods-Binary å®ç°</a></p>
</blockquote>
<h3 id="cocoapods-imy-bin"><a href="#cocoapods-imy-bin" class="headerlink" title="cocoapods-imy-bin"></a>cocoapods-imy-bin</h3><p>cocoapods-imy-bin æ’ä»¶æ˜¯ç¾æŸšå›¢é˜Ÿå¼€æºçš„cocoapodsäºŒè¿›åˆ¶ç®¡ç†æ–¹æ¡ˆã€‚</p>
<p>å…¶æ ¸å¿ƒæ€æƒ³æ˜¯å…ˆåˆ¶ä½œäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶åä¸Šä¼ åˆ°æ–‡ä»¶æœåŠ¡å™¨è¿›è¡Œä¿å­˜ï¼Œåœ¨pod install é˜¶æ®µåŠ¨æ€åˆ¤æ–­ä¸‰æ–¹åº“æ˜¯å¦åœ¨æœ¬åœ°ç§æœ‰æºæœ‰äºŒè¿›åˆ¶è®°å½•ï¼Œå¦‚æœæœ‰å°±ä¼šå°†æ­¤åº“çš„æºæ›¿æ¢æˆäºŒè¿›åˆ¶æºç„¶åä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿›è€Œlinkåˆ°é¡¹ç›®ä¸­å®Œæˆæºç å’ŒäºŒè¿›åˆ¶çš„åˆ‡æ¢ã€‚</p>
<p><a href="https://juejin.cn/post/6903407900006449160#heading-3">iOSç¼–è¯‘é€Ÿåº¦å¦‚ä½•ç¨³å®šæé«˜10å€ä»¥ä¸Šä¹‹ä¸€</a></p>
<p><a href="https://juejin.cn/post/6903408514778497031#heading-1">iOSç¼–è¯‘é€Ÿåº¦å¦‚ä½•ç¨³å®šæé«˜10å€ä»¥ä¸Šä¹‹äºŒ</a></p>
<p>æ‰€è°“å®è·µå‡ºçœŸçŸ¥ï¼Œå’±å°±è¯•ä¸€è¯•çœ‹çœ‹æ•ˆæœã€‚</p>
<h3 id="cocoapods-imy-binå®è·µ"><a href="#cocoapods-imy-binå®è·µ" class="headerlink" title="cocoapods-imy-binå®è·µ"></a>cocoapods-imy-binå®è·µ</h3><p><a href="https://github.com/MeetYouDevs/cocoapods-imy-bin/blob/master/%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.md">cocoapods-imy-binä½¿ç”¨æ•™ç¨‹</a></p>
<p><a href="https://github.com/su350380433/cocoapods-imy-bin-demo">cocoapods-imy-bin-demoå·¥ç¨‹</a></p>
<p><a href="https://github.com/su350380433/binary-server">binary-server é™æ€èµ„æºæœåŠ¡å™¨</a></p>
<p>æŒ‰ç…§ä½¿ç”¨æ•™ç¨‹å¼€å§‹æ“ä½œï¼š</p>
<h4 id="1ã€é¦–å…ˆåˆ›å»ºäºŒè¿›åˆ¶ä»“åº“ç§æœ‰æº"><a href="#1ã€é¦–å…ˆåˆ›å»ºäºŒè¿›åˆ¶ä»“åº“ç§æœ‰æº" class="headerlink" title="1ã€é¦–å…ˆåˆ›å»ºäºŒè¿›åˆ¶ä»“åº“ç§æœ‰æº"></a>1ã€é¦–å…ˆåˆ›å»ºäºŒè¿›åˆ¶ä»“åº“ç§æœ‰æº</h4><p>å¯ä»¥é€‰æ‹©ç§æœ‰çš„github&#x2F;gitlabä»“åº“ï¼Œè¿™ä¸ªä»“åº“è´Ÿè´£äºŒè¿›åˆ¶æºcocoapods repoçš„ç»´æŠ¤ã€‚</p>
<p>æ·»åŠ åˆ°æœ¬åœ°repo</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">pod repo add example_spec_bin_dev git<span class="variable">@github</span>.<span class="symbol">com:</span>su350380433/example_spec_bin_dev.git</span><br></pre></td></tr></table></figure>

<p>å‘ç‚¹ï¼šcocoapods-imy-biné…ç½®ç§æœ‰æºæ—¶åªæ”¯æŒsshï¼Œå› æ­¤è¦ä¿®æ”¹ä»¥å‰çš„httpsçš„æºï¼Œå¯¹sshæ“ä½œä¸ç†Ÿç»ƒçš„éœ€è¦googleå‡ºç°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚</p>
<blockquote>
<p><a href="mailto:&#x67;&#x69;&#116;&#64;&#120;&#120;&#120;&#x2e;&#99;&#111;&#x6d;">git@xxx.com</a> sshä¸€ç›´æŠ¥é”™ï¼Œä¹‹å‰çš„å…¬é’¥æœ‰å¯†ç ,é€šè¿‡sshè¿æ¥ç§æœ‰åº“çš„æ—¶å€™ä¸€ç›´æŠ¥é”™è®©è¾“å…¥å¯†ç ï¼Œä½†æ˜¯è¾“å…¥ä¹‹åè¿˜æ˜¯ä¸è¡Œ,æŠ¥é”™æ— æˆæƒ,é‡æ–°ç”Ÿæˆrsaç§˜é’¥å¯¹ä¹‹åå°è¯•è¿˜æ˜¯ä¸è¡Œï¼ŒæŠ¥åŒæ ·çš„é”™è¯¯ã€‚æœ€åå‘ç°æ˜¯gitåœ°å€æ²¡æœ‰ç»™å¯¹ï¼Œä»cocoapods fileä¸­æ‹·è´å‡ºæ¥çš„æ—¶å€™å¸¦äº†ä¸€ä¸ªsourceå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥sshæˆæƒä¸€ç›´å¤±è´¥ï¼ˆåœ°å€éƒ½é”™äº†æˆæƒè‚¯å®šå¤±è´¥å•Šï¼‰</p>
</blockquote>
<p>åˆ›å»ºrepoä¸èƒ½ä»…ä»…æ‹‰ä¸€ä¸ªgitä»“åº“å°±è¡Œäº†ï¼Œè¿˜å¾—æ‰¾ä¸€ä¸ªå·²æœ‰çš„ä»“åº“è¿›è¡Œ.podspecæ–‡ä»¶push ï¼Œå¦åˆ™æ·»åŠ æ­¤æºä¹‹å æ‰§è¡Œpod repo update ä¼šä¸€ç›´å¤±è´¥ã€‚</p>
<blockquote>
<p>æ–°å¢ç©ºçš„pod repo ä¹‹å pod repo update ä¸€ç›´å¤±è´¥,å°è¯•pushä¸€æ¬¡å·²æœ‰çš„.podspecæ–‡ä»¶å†æ›´æ–°repoæ‰æˆåŠŸ</p>
</blockquote>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment"># pod push å‘½ä»¤</span></span><br><span class="line">pod repo push demo_binary_source <span class="title class_">APPLog</span>.podspec --allow-warnings</span><br></pre></td></tr></table></figure>


<h4 id="2ã€æ­å»ºé™æ€èµ„æºæœåŠ¡å™¨"><a href="#2ã€æ­å»ºé™æ€èµ„æºæœåŠ¡å™¨" class="headerlink" title="2ã€æ­å»ºé™æ€èµ„æºæœåŠ¡å™¨"></a>2ã€æ­å»ºé™æ€èµ„æºæœåŠ¡å™¨</h4><p>æœ¬è´¨æ˜¯ä¸€ä¸ªå¯ä»¥æ¥æ”¶å’Œä¸‹è½½æ–‡ä»¶çš„æœåŠ¡å™¨ï¼Œä½¿ç”¨Nodeæ‰¿è½½æœåŠ¡ï¼Œä½¿ç”¨MongoDBå­˜å‚¨æ•°æ®ã€‚ å¯è‡ªè¡Œé€‰æ‹©ECSæˆ–è€…å…¶ä»–æ–‡ä»¶æœåŠ¡å™¨ï¼Œåšæµ‹è¯•çš„è¯å¯ä»¥åœ¨æœ¬åœ°æ­å»ºã€‚</p>
<p>å…ˆæ­å»ºæ•°æ®åº“(Mac)</p>
<p>æ–‡æ¡£ä¸ŠMongoDBæ˜¯åœ¨å®˜ç½‘ä¸‹è½½å®‰è£…çš„ï¼Œä½†æ˜¯å®æµ‹æœ‰å¾ˆå¤šæ–‡ä»¶å¤¹æƒé™é—®é¢˜ï¼Œæ”¹ç”¨homebrewå®‰è£…ã€‚<br>brew install mongodb å‘½ä»¤å¤±æ•ˆï¼Œä¸”å®˜ç½‘ä¸å†å¼€æºï¼Œè¿™é‡Œæ”¹ç”¨homebrewçš„ç¤¾åŒºç‰ˆã€‚</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">brew tap mongodb/brew <span class="comment">#å…ˆæ‰§è¡Œè¿™ä¸ª</span></span><br><span class="line">brew install mongodb-community<span class="variable">@4</span>.<span class="number">2</span> <span class="comment">#ç­‰ä¸€å°ä¼šæ‰§è¡Œè¿™ä¸ª å®‰è£…4.2ç‰ˆæœ¬çš„ </span></span><br></pre></td></tr></table></figure>
<p>å®‰è£…å®Œæ¯•åéœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡æ‰èƒ½ä½¿ç”¨ï¼Œæ ¹æ®ç»ˆç«¯ä½¿ç”¨çš„zshè¿˜æ˜¯bashå„è‡ªåœ¨é…ç½®æ–‡ä»¶è®¾ç½®</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">export <span class="variable constant_">PATH</span>=<span class="variable">$PATH</span><span class="symbol">:/usr/local/Cellar/mongodb-community</span><span class="variable">@4</span>.<span class="number">2</span>/<span class="number">4.2</span>.<span class="number">9</span>/bin</span><br></pre></td></tr></table></figure>
<p>å®‰è£…å®Œæ¯•åæµ‹è¯•ç»“æœï¼Œç„¶åä½¿ç”¨Macç³»ç»ŸæœåŠ¡çš„æ–¹å¼æ‰“å¼€æ•°æ®åº“ï¼Œè¿™æ ·ä¸ç”¨ä¾æ‰˜ç»ˆç«¯çª—å£ï¼Œå³ä½¿ç»ˆç«¯çª—å£å…³é—­äº†æ•°æ®åº“ä¹Ÿä¸ä¼šå…³é—­ã€‚</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">mongod -version <span class="comment">#æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line"><span class="comment">#é™¤äº†å®‰è£…åŒ…æ–‡ä»¶ï¼Œå®‰è£…è¿˜åˆ›å»ºäº†ä»¥ä¸‹æ–‡ä»¶å’Œç›®å½•ï¼š</span></span><br><span class="line"><span class="comment">#é…ç½®æ–‡ä»¶ï¼ˆ/usr/local/etc/mongod.confï¼‰</span></span><br><span class="line"><span class="comment">#æ—¥å¿—ç›®å½•ï¼ˆ/usr/local/var/log/mongodbï¼‰</span></span><br><span class="line"><span class="comment">#æ•°æ®ç›®å½•ï¼ˆ/usr/local/var/mongodbï¼‰</span></span><br><span class="line"><span class="comment">#å°†MongoDBä½œä¸ºç³»ç»ŸæœåŠ¡å¯åŠ¨ ä¸å†ä¾æ‰˜ç»ˆç«¯çª—å£</span></span><br><span class="line">brew services start mongodb-community<span class="variable">@4</span>.<span class="number">2</span> /<span class="regexp">/å¯åŠ¨</span></span><br><span class="line"><span class="regexp">brew services stop mongodb-community@4.2 /</span><span class="regexp">/åœæ­¢</span></span><br><span class="line"><span class="regexp">brew services restart mongodb-community@4.2 /</span><span class="regexp">/é‡å¯</span></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥æ‰§è¡Œmongo shellå‘½ä»¤æŸ¥çœ‹æ•°æ®åº“å¯åŠ¨çŠ¶æ€</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">mongo</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.zcx.info/008i3skNly1gukuhvxnh2j613i0u0gr602.jpg" alt="mongodbå¯åŠ¨shell"></p>
<p>åˆ°è¿™é‡Œ ä½ çš„æ•°æ®åº“å°±æ­å¥½äº†ä¹Ÿå¯åŠ¨èµ·æ¥äº†ã€‚</p>
<p>ç„¶åæ­å»ºé™æ€èµ„æºæœåŠ¡å™¨</p>
<p>å…ˆä¸‹è½½æœåŠ¡æºç ï¼š</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">git clone git<span class="variable">@github</span>.<span class="symbol">com:</span>su350380433/binary-server.git</span><br><span class="line">cd /binary-server <span class="comment">#è¿›å…¥åˆ°ä½ ä¸‹è½½binary-serverçš„æ ¹ç›®å½•å»</span></span><br><span class="line">npm install <span class="comment">#å®‰è£…ä¾èµ–åŒ…</span></span><br><span class="line">npm start <span class="comment"># å¯åŠ¨node</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯æ–‡ä»¶æœåŠ¡å™¨App.jsæºç ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Koa</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">&#x27;./server/routes&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">&#x27;koa-logger&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> koaBody = <span class="built_in">require</span>(<span class="string">&#x27;koa-body&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Koa</span></span><br><span class="line"></span><br><span class="line">mongoose.<span class="title function_">connect</span>(<span class="string">&#x27;mongodb://localhost/binary_database&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">koaBody</span>(&#123; <span class="attr">multipart</span>: <span class="literal">true</span> &#125;))</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">logger</span>())</span><br><span class="line">app.<span class="title function_">use</span>(router.<span class="title function_">routes</span>())</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>

<p>ç”±æ­¤å¯è§ï¼Œæ–‡ä»¶æœåŠ¡å™¨åˆ›å»ºäº†binary_databaseæ•°æ®åº“ï¼Œå¹¶ä¸”å ç”¨äº†8080ç«¯å£ã€‚</p>
<p>æ‰§è¡Œäº†npm startä¹‹åå¯èƒ½ä¼šå‡ºç°ä¸¤ä¸ªé—®é¢˜</p>
<p>8080ç«¯å£å·²ç»è¢«å ç”¨ï¼šå‡ºç°è¿™ä¸ªé—®é¢˜æœ‰å¯èƒ½æ˜¯ä½ ä¹‹å‰å®‰è£…è¿‡å…¶ä»–æœåŠ¡ä¹Ÿå ç”¨è¿™ä¸ªç«¯å£ï¼Œå¯ä»¥åˆ‡æ¢é™æ€èµ„æºæ–‡ä»¶çš„ä½¿ç”¨ç«¯å£ä¿®æ”¹app.listen(8080)å³å¯ï¼Œæˆ–è€…å’Œæˆ‘ä¸€æ ·ç›´æ¥æŠŠä¸ç”¨çš„å…¶ä»–æœåŠ¡å…³æ‰ã€‚</p>
<p>æ•°æ®åº“è¿æ¥å¤±è´¥ï¼šå‡ºç°è¿™ä¸ªé—®é¢˜å¯ä»¥çœ‹ä¸€ä¸‹å…·ä½“çš„æŠ¥é”™å†…å®¹ï¼Œæ ¹æ®ä¸åŒçš„å†…å®¹å¤„ç†ã€‚å¦‚æœå‡ºç°</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">getaddrinfo <span class="variable constant_">ENOTFOUND</span> localhost     at <span class="title class_">GetAddrInfoReqWrap</span>.onlookup</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„æŠ¥é”™çš„è¯å¾ˆå¯èƒ½æ˜¯ä½ çš„è®¾å¤‡æ²¡æœ‰åšlocalhostçš„127.0.0.1çš„æ˜ å°„ã€‚dbä½¿ç”¨çš„é“¾æ¥æ˜¯ipåœ°å€ï¼Œä½†æ˜¯é™æ€èµ„æºæœåŠ¡ä¸­çš„ä»£ç é‡Œè¿æ¥æ•°æ®åº“ä½¿ç”¨çš„æ˜¯localhostï¼Œä¸”ç«¯å£æ˜¯dbçš„é»˜è®¤ç«¯å£ï¼Œå¦‚æœä½ æ•°æ®åº“æ”¹è¿‡ç«¯å£å·ï¼Œé‚£è¿™é‡Œä¸€å®šè¦ä¿®æ”¹æ•°æ®åº“è¿æ¥åœ°å€ã€‚</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&gt; binary-server<span class="variable">@0</span>.<span class="number">1.0</span> start /<span class="title class_">Users</span>/zcx/binary-server</span><br><span class="line">&gt; node app.js</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œè¿™é‡ŒnodeæœåŠ¡å™¨å°±å¯åŠ¨èµ·æ¥äº†ï¼Œç›‘å¬8080(æˆ–ä½ è®¾ç½®çš„)ç«¯å£ï¼Œæä¾›httpæœåŠ¡ã€‚</p>
<h4 id="3-å®‰è£…å’Œåˆå§‹åŒ–cocoapods-imy-binæ’ä»¶"><a href="#3-å®‰è£…å’Œåˆå§‹åŒ–cocoapods-imy-binæ’ä»¶" class="headerlink" title="3 å®‰è£…å’Œåˆå§‹åŒ–cocoapods-imy-binæ’ä»¶"></a>3 å®‰è£…å’Œåˆå§‹åŒ–cocoapods-imy-binæ’ä»¶</h4><p>å®‰è£…è¿™ä¸€æ­¥æ¯”è¾ƒç®€å• ç›´æ¥æ‰§è¡Œgemå‘½ä»¤å®‰è£…æ’ä»¶å³å¯</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">sudo gem install cocoapods-imy-bin</span><br></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–æ’ä»¶é…ç½®ï¼š</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="symbol">xx:</span><span class="title class_">Demo</span> slj<span class="variable">$ </span>pod bin init <span class="comment">#æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ æ ¹æ®æç¤ºä¿¡æ¯è¿›è¡Œä¸‹ä¸€æ­¥çš„æ“ä½œ</span></span><br><span class="line"></span><br><span class="line">======  dev ç¯å¢ƒ ========</span><br><span class="line"></span><br><span class="line">å¼€å§‹è®¾ç½®äºŒè¿›åˆ¶åŒ–åˆå§‹ä¿¡æ¯.</span><br><span class="line">æ‰€æœ‰çš„ä¿¡æ¯éƒ½ä¼šä¿å­˜åœ¨ /<span class="title class_">Users</span>/slj/.cocoapods/bin_dev.yml æ–‡ä»¶ä¸­.</span><br><span class="line"><span class="string">%w[bin_dev.yml bin_debug_iphoneos.yml bin_release_iphoneos.yml]</span> </span><br><span class="line">ä½ å¯ä»¥åœ¨å¯¹åº”ç›®å½•ä¸‹æ‰‹åŠ¨æ·»åŠ ç¼–è¾‘è¯¥æ–‡ä»¶. æ–‡ä»¶åŒ…å«çš„é…ç½®ä¿¡æ¯æ ·å¼å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"><span class="symbol">configuration_env:</span> dev</span><br><span class="line"><span class="comment"># ä¸Šé¢è¿™ä¸ªæ˜¯ç¯å¢ƒåˆ‡æ¢é€‰é¡¹ å…ˆä¸æ”¹ ç›®å‰å…ˆé…ä¸€å¥—ç¯å¢ƒ</span></span><br><span class="line"><span class="symbol">code_repo_url:</span> git<span class="variable">@github</span>.<span class="symbol">com:</span>su350380433/example_spec_source.git</span><br><span class="line"><span class="comment"># ä¸Šé¢è¿™ä¸ªæ˜¯æ­£åœ¨ä½¿ç”¨çš„ç§æœ‰æºåœ°å€</span></span><br><span class="line"><span class="symbol">binary_repo_url:</span> git<span class="variable">@github</span>.<span class="symbol">com:</span>su350380433/example_spec_bin_dev.git</span><br><span class="line"><span class="comment"># ä¸Šé¢è¿™ä¸ªæ˜¯æ–°å¢çš„äºŒè¿›åˆ¶ç§æœ‰æºåœ°å€</span></span><br><span class="line"><span class="symbol">binary_download_url:</span> <span class="symbol">http:</span>/<span class="regexp">/localhost:8080/frameworks</span><span class="regexp">/%s/</span>%s/zip</span><br><span class="line"><span class="comment"># ä¸Šé¢è¿™ä¸ªæ˜¯æ–°åˆ›å»ºçš„æœåŠ¡å™¨åœ°å€ é»˜è®¤ä½¿ç”¨çš„æœ¬åœ° %sæ˜¯åŠ¨æ€æ›¿æ¢ä¸‰æ–¹åº“çš„åç§°çš„ è¿™é‡Œä¸è¦æ”¹</span></span><br><span class="line"><span class="symbol">download_file_type:</span> zip</span><br><span class="line"><span class="comment"># ä¸Šé¢è¿™ä¸ªæ˜¯äºŒè¿›åˆ¶ä¼ è¾“ç”¨çš„å‹ç¼©æ ¼å¼ ä¸€èˆ¬éƒ½zipä¹Ÿä¸ç”¨æ”¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥ä¸Šçš„é…ç½®éƒ½å¯ä»¥åœ¨é…ç½®æ–‡ä»¶é‡Œè¿›è¡Œæ›´æ”¹</span></span><br><span class="line">open /<span class="title class_">Users</span>/zcx/.cocoapods/bin_dev.yml  <span class="comment">#æ–‡ä»¶ä¿å­˜ æ’ä»¶çš„é…ç½®ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>
<p>åˆ°è¿™é‡Œå‡†å¤‡å·¥ä½œå°±ç®—æ˜¯å°±ç»ªäº†ï¼Œå¯ä»¥å¼€å§‹åˆ¶ä½œäºŒè¿›åˆ¶æ–‡ä»¶äº†ã€‚</p>
<h4 id="4-åˆ¶ä½œäºŒè¿›åˆ¶æ–‡ä»¶"><a href="#4-åˆ¶ä½œäºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="4 åˆ¶ä½œäºŒè¿›åˆ¶æ–‡ä»¶"></a>4 åˆ¶ä½œäºŒè¿›åˆ¶æ–‡ä»¶</h4><p>æƒ³è¦åˆ¶ä½œä¸€ç³»åˆ—çš„ä¸‰æ–¹åº“äºŒè¿›åˆ¶ç»„ä»¶ï¼Œå¿…é¡»å¾—æœ‰ä¸ªæ–‡ä»¶å­˜å‚¨ä¸‰æ–¹åº“çš„åˆ—è¡¨å§ï¼Œæ‰€ä»¥è¿™é‡Œè¿˜å¾—å‡†å¤‡ä¸€ä¸ª.podspecæ–‡ä»¶æ¥ç»´æŠ¤ä½ æƒ³è¦åˆ¶ä½œçš„åº“ã€‚</p>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å¢ä¸€ä¸ª<code>demo_binary_source.podspec</code>æ–‡ä»¶,å†…å®¹å¦‚ä¸‹ï¼ˆä¸€ä¸ªåŸºæœ¬çš„ä¾èµ–æ–‡ä»¶ï¼‰</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment"># MARK: converted automatically by spec.py. <span class="doctag">@hgy</span></span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Pod::Spec</span>.new <span class="keyword">do</span> |<span class="params">s</span>|</span><br><span class="line">	s.name = <span class="string">&#x27;demo_binary_source&#x27;</span></span><br><span class="line">	s.version = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">	s.description = <span class="string">&#x27;demo_binary_source&#x27;</span></span><br><span class="line">	s.license = <span class="string">&#x27;MIT&#x27;</span></span><br><span class="line">	s.summary = <span class="string">&#x27;demo_binary_source&#x27;</span></span><br><span class="line">	s.homepage = <span class="string">&#x27;https://gitlab-media.corp.demo.com/iOS/krmedium_binary_source&#x27;</span></span><br><span class="line">	s.authors = &#123; <span class="string">&#x27;zcx&#x27;</span> =&gt; <span class="string">&#x27;zhouchuanxiang@demo.com&#x27;</span> &#125;</span><br><span class="line">	s.source = &#123; <span class="symbol">:git</span> =&gt; <span class="string">&#x27;git@gitlab-media.corp.demo.com:iOS/krmedium_binary_source.git&#x27;</span>, <span class="symbol">:branch</span> =&gt; <span class="string">&#x27;master&#x27;</span> &#125;</span><br><span class="line">        s.requires_arc = <span class="literal">true</span></span><br><span class="line">        s.ios.deployment_target = <span class="string">&#x27;11.0&#x27;</span></span><br><span class="line">        s.source_files = <span class="string">&#x27;Source/**/*.&#123;h,m,c,swift&#125;&#x27;</span></span><br><span class="line">        s.public_header_files = <span class="string">&#x27;Source/**/*.&#123;h,swift&#125;&#x27;</span></span><br><span class="line">        <span class="comment">#objcä¾èµ–</span></span><br><span class="line">        s.dependency <span class="string">&#x27;Masonry&#x27;</span>, <span class="string">&#x27;1.1.0&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;MJRefresh&#x27;</span>, <span class="string">&#x27;3.3.1&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;SDWebImage&#x27;</span>, <span class="string">&#x27;5.3.1&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;YYCategories&#x27;</span>, <span class="string">&#x27;1.0.4&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;MJExtension&#x27;</span>, <span class="string">&#x27;3.2.2&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;MBProgressHUD&#x27;</span>, <span class="string">&#x27;1.1.0&#x27;</span></span><br><span class="line">        <span class="comment">#demoé¡¹ç›®ä¾èµ–</span></span><br><span class="line">        s.dependency <span class="string">&#x27;KeychainAccess&#x27;</span>, <span class="string">&#x27;4.1.0&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;Moya/RxSwift&#x27;</span>, <span class="string">&#x27;13.0.1&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;ObjectMapper&#x27;</span>, <span class="string">&#x27;3.4.2&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;IQKeyboardManagerSwift&#x27;</span>, <span class="string">&#x27;6.5.1&#x27;</span> <span class="comment">#é”®ç›˜ç®¡ç†</span></span><br><span class="line">        s.dependency <span class="string">&#x27;RTRootNavigationController&#x27;</span>, <span class="string">&#x27;0.5.19&#x27;</span> <span class="comment">#UI</span></span><br><span class="line">        s.dependency <span class="string">&#x27;Kingfisher&#x27;</span>, <span class="string">&#x27;5.15.4&#x27;</span> <span class="comment">#å›¾ç‰‡å¤„ç†</span></span><br><span class="line">        s.dependency <span class="string">&#x27;Zip&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;SnapKit&#x27;</span>, <span class="string">&#x27;5.0.1&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;Stencil&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;iCarousel&#x27;</span>, <span class="string">&#x27;1.8.3&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;YYText&#x27;</span>, <span class="string">&#x27;1.0.5&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;lottie-ios&#x27;</span>, <span class="string">&#x27;3.1.9&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;YYCache&#x27;</span>, <span class="string">&#x27;1.0.4&#x27;</span></span><br><span class="line">        <span class="comment">#debugè°ƒè¯•å·¥å…·</span></span><br><span class="line">        s.dependency <span class="string">&#x27;NetSwitch&#x27;</span></span><br><span class="line">        s.dependency <span class="string">&#x27;LookinServer&#x27;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ–‡ä»¶ä¸­æ‰€æœ‰çš„<code>dependency</code>ä¾èµ–éƒ½ä¼šè¢«å°è¯•åˆ¶ä½œäºŒè¿›åˆ¶æ–‡ä»¶ã€‚åˆ¶ä½œäºŒè¿›åˆ¶æ–‡ä»¶ä¹‹å‰éœ€è¦ä¿è¯æ‰€æœ‰çš„<code>repo</code>éƒ½æ˜¯æ­£å¸¸çš„ï¼Œæ¯ä¸ªä¸‰æ–¹åº“çš„æºéƒ½æŒ‡å‘åŸå§‹æºï¼ˆæºä»£ç æºï¼‰ï¼Œæˆ‘ä»¬åˆ¶ä½œçš„æ—¶å€™ä¼šå…ˆè·å–æºç è¿›è¡Œç¼–è¯‘ã€‚<br>æŠŠè¿™ä¸ªæ–‡ä»¶æ”¾åœ¨å’Œ<code>Podfile</code>åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œè¿›å…¥æ­¤ç›®å½•ï¼Œç„¶åæ‰§è¡Œ</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">pod bin auto --all-make <span class="comment"># å¼€å§‹åˆ¶ä½œäºŒè¿›åˆ¶</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šæ ¹æ®ä½ ä¾èµ–çš„åº“æŠ¥å„ç§é”™è¯¯ï¼Œæ¯”å¦‚æˆ‘é‡åˆ°çš„</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Installing</span>...</span><br><span class="line"><span class="title class_">Installing</span> <span class="title class_">Realm</span> (<span class="number">3.19</span>.<span class="number">0</span>)</span><br><span class="line"><span class="title class_">Installing</span> <span class="title class_">RealmSwift</span> (<span class="number">3.19</span>.<span class="number">0</span>)</span><br><span class="line"><span class="title class_">Installing</span> demo_binary_source (<span class="number">1</span>)</span><br><span class="line">[!] /bin/bash -c</span><br><span class="line">set -e</span><br><span class="line">sh build.sh cocoapods-setup</span><br><span class="line"></span><br><span class="line"><span class="symbol">sh:</span> build.<span class="symbol">sh:</span> <span class="title class_">No</span> such file <span class="keyword">or</span> directory</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰§è¡Œpod bin auto --all-make æŠ¥é”™ ä¸çŸ¥é“å•¥åŸå› </span></span><br><span class="line"><span class="comment">#ç»æ’æŸ¥ ä½¿ç”¨æ’ä»¶å swiftRealmåº“é™„å¸¦çš„ä¸‹è½½ä¾èµ–è„šæœ¬æ— æ³•æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Running</span> prepare command</span><br><span class="line"><span class="variable">$ </span>/bin/bash -c  set -e sh build.sh cocoapods-setup</span><br><span class="line"><span class="title class_">Downloading</span> <span class="symbol">dependency:</span> <span class="number">10.3</span>.<span class="number">2</span> from <span class="symbol">https:</span>/<span class="regexp">/static.realm.io/downloads</span><span class="regexp">/core/realm</span>-monorepo-xcframework-v10.<span class="number">3.2</span>.tar.xz</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å†³æ–¹æ¡ˆ</span></span><br><span class="line">å•ç‹¬çš„åº“æ— æ³•å¤„ç†ï¼Œè¿™é‡Œå› ä¸º<span class="string">&#x27;Realm&#x27;</span>ç¼–è¯‘æºç ä¹Ÿå¾ˆæ…¢ï¼Œæ‰€ä»¥æ”¹æˆ<span class="string">&#x27;xcframework&#x27;</span>æ–¹å¼è¿›è¡Œå¼•å…¥äº†ã€‚</span><br><span class="line">è§£å†³é—®é¢˜çš„è¿‡ç¨‹ä¸­å¯èƒ½é‡è§<span class="string">&#x27;pod repo&#x27;</span>æ··ä¹±çš„é—®é¢˜ï¼Œ</span><br><span class="line">ä¹‹å‰å°è¯•çš„ <span class="string">&#x27;--all-make&#x27;</span>å‘½ä»¤ ç”Ÿæˆäº†ä¸€éƒ¨åˆ†äºŒè¿›åˆ¶å’Œ<span class="string">&#x27;repo&#x27;</span>ä¿¡æ¯å¼•èµ·æ··ä¹±</span><br><span class="line">é‚£å°±å…¨éƒ¨åˆ æ‰ï¼Œåˆ æ‰<span class="string">&#x27;repo&#x27;</span>æºï¼Œåˆ æ‰å·²ç»ä¸Šä¼ çš„äºŒè¿›åˆ¶æ–‡ä»¶ä»å¤´å†æ¥ä¸€é </span><br></pre></td></tr></table></figure>
<p>è§£å†³å®Œé—®é¢˜åå†å°è¯•è¿›è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶åˆ¶ä½œã€‚å¦‚æœé¡ºåˆ©çš„è¯ä¼šçœ‹åˆ°åˆ¶ä½œç»“æœã€‚</p>
<p><img src="https://cdn.zcx.info/008i3skNly1gukvojcuwpj60u015rjxk02.jpg"></p>
<p>åŒæ—¶å¯ä»¥æ£€éªŒä¸€ä¸‹æ–°åˆ›å»ºçš„ ç§æœ‰æºä¸­æ˜¯å¦è®°å½•çš„äºŒè¿›åˆ¶æ–‡ä»¶çš„åœ°å€ä¿¡æ¯ã€‚</p>
<p><img src="https://cdn.zcx.info/008i3skNly1gukvrtyptvj61h30u0td202.jpg"></p>
<p>äºŒè¿›åˆ¶æ–‡ä»¶åˆ¶ä½œå¥½äº†ï¼Œå°±å·®linkåˆ°é¡¹ç›®ä¸­äº†ã€‚</p>
<p>æ—¢ç„¶æˆ‘ä»¬æ›´æ–°äº†ç§æœ‰æºï¼Œè¿™é‡Œæœ€å¥½æŠŠ<code>cocoapods repo </code>æ›´æ–°ä¸€ä¸‹å†å®‰è£…ã€‚</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">pod repo update --verbose <span class="comment">#æ›´æ–°æº</span></span><br><span class="line">pod install --verbose <span class="comment">#ä½ æ‡‚å¾—</span></span><br><span class="line"><span class="comment">#ç„¶åä½ ä¼šçœ‹åˆ°æ‰§è¡Œçš„ç»“æœï¼Œéƒ¨åˆ†ä¸‰æ–¹åº“è¢«æ›¿æ¢æˆäº†æ‰“åŒ…å¥½çš„é™æ€åº“</span></span><br><span class="line">======  dev ç¯å¢ƒ ========</span><br><span class="line"><span class="variable constant_">CDN</span>: trunk <span class="title class_">Relative</span> <span class="symbol">path:</span> <span class="title class_">CocoaPods</span>-version.yml exists! <span class="title class_">Returning</span> local because checking is only performed <span class="keyword">in</span> repo update</span><br><span class="line">cocoapods-imy-bin æ’ä»¶</span><br><span class="line">- å¼€å§‹å¤„ç† <span class="title class_">Alamofire</span> <span class="number">4.9</span>.<span class="number">1</span> ç»„ä»¶.</span><br><span class="line">specification =<span class="title class_">Alamofire</span> (<span class="number">4.9</span>.<span class="number">1</span>)</span><br><span class="line">#&lt;Pod::Resolver::ResolverSpecification:0x00007fc8369c9630&gt;</span><br><span class="line">cocoapods-imy-bin æ’ä»¶</span><br><span class="line">- å¼€å§‹å¤„ç† <span class="title class_">AliPlayer</span>SDK_iOS <span class="number">5.4</span>.<span class="number">0</span> ç»„ä»¶.</span><br><span class="line">cocoapods-imy-bin æ’ä»¶</span><br><span class="line">- å¼€å§‹å¤„ç† <span class="title class_">AliPlayer</span>SDK_iOS/<span class="title class_">AliPlayer</span>SDK <span class="number">5.4</span>.<span class="number">0</span> ç»„ä»¶.</span><br><span class="line">cocoapods-imy-bin æ’ä»¶</span><br><span class="line">- å¼€å§‹å¤„ç† <span class="title class_">Alipay</span>SDK-iOS <span class="number">15.7</span>.<span class="number">9</span> ç»„ä»¶.</span><br><span class="line">cocoapods-imy-bin æ’ä»¶</span><br><span class="line">- å¼€å§‹å¤„ç† <span class="title class_">Bugly</span> <span class="number">2.5</span>.<span class="number">90</span> ç»„ä»¶.</span><br><span class="line">........</span><br><span class="line">#&lt;Pod::Resolver::ResolverSpecification:0x00007fc8370b0f48&gt;</span><br><span class="line">ã€<span class="title class_">AliPlayer</span>SDK_iOS |<span class="params"> 5.4.0ã€‘ç»„ä»¶æ— å¯¹åº”äºŒè¿›åˆ¶ç‰ˆæœ¬ , å°†é‡‡ç”¨æºç ä¾èµ–.</span></span><br><span class="line"><span class="params">ã€AliPlayerSDK_iOS/AliPlayerSDK </span>| <span class="number">5.4</span>.<span class="number">0</span>ã€‘ç»„ä»¶æ— å¯¹åº”äºŒè¿›åˆ¶ç‰ˆæœ¬ , å°†é‡‡ç”¨æºç ä¾èµ–.</span><br><span class="line">ã€<span class="title class_">Alipay</span>SDK-iOS |<span class="params"> 15.7.9ã€‘ç»„ä»¶æ— å¯¹åº”äºŒè¿›åˆ¶ç‰ˆæœ¬ , å°†é‡‡ç”¨æºç ä¾èµ–.</span></span><br><span class="line"><span class="params">ã€Bugly </span>| <span class="number">2.5</span>.<span class="number">90</span>ã€‘ç»„ä»¶æ— å¯¹åº”äºŒè¿›åˆ¶ç‰ˆæœ¬ , å°†é‡‡ç”¨æºç ä¾èµ–.</span><br><span class="line">ã€<span class="title class_">CocoaAsyncSocket</span> |<span class="params"> 7.6.5ã€‘ç»„ä»¶æ— å¯¹åº”äºŒè¿›åˆ¶ç‰ˆæœ¬ , å°†é‡‡ç”¨æºç ä¾èµ–.</span></span><br><span class="line"><span class="params">ã€GTSDK </span>| <span class="number">2.5</span>.<span class="number">5.0</span>ã€‘ç»„ä»¶æ— å¯¹åº”äºŒè¿›åˆ¶ç‰ˆæœ¬ , å°†é‡‡ç”¨æºç ä¾èµ–.</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>æœ€åæŸ¥çœ‹<code>xcode</code>ä¸­çš„<code>pod</code>æ–‡ä»¶å¤¹ï¼Œä»æºç åˆ‡æ¢æˆäº†<code>framework</code><br><img src="https://cdn.zcx.info/008i3skNly1gukw1ce7iej60kq0fmq3x02.jpg"><br>å¦‚æœæ²¡æœ‰å‡ºç°<code>framework</code>çš„è¯å¯ä»¥å°è¯•å†æ›´æ–°ä¸€æ¬¡<code>pod repo </code>å’Œ<code>æ‰§è¡Œ pod install</code></p>
<p><code>clean</code> ä¸€ä¸‹è¿›è¡Œå…¨é‡ç¼–è¯‘å¯ä»¥çœ‹åˆ°å˜åŒ–ï¼Œä¼˜åŒ–å‰ç¼–è¯‘éœ€è¦500s</p>
<p><img src="https://cdn.zcx.info/008i3skNly1gukw4a4ri8j61tc0lijvv02.jpg"></p>
<p>ä¼˜åŒ–å<code>tasks</code>å‡å°‘åˆ°2500å·¦å³</p>
<p><img src="https://cdn.zcx.info/008i3skNly1gukw3brvajj60x0038gly02.jpg"></p>
<p>ç¼–è¯‘æ—¶é—´å‡å°‘åˆ°300s</p>
<p><img src="https://cdn.zcx.info/008i3skNly1gukw38z5bdj60nu05eq3w02.jpg"></p>
<h4 id="å¯èƒ½å­˜åœ¨çš„é—®é¢˜"><a href="#å¯èƒ½å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="å¯èƒ½å­˜åœ¨çš„é—®é¢˜"></a>å¯èƒ½å­˜åœ¨çš„é—®é¢˜</h4><p>æš‚æ—¶æ²¡æœ‰æµ‹è¯•ciæ‰“åŒ…æœºä¸Šçš„å‘½ä»¤ä¿®æ”¹å’ŒçœŸæ­£realseå‘åŒ…è¿‡ç¨‹ã€‚å¦‚æœè¦ä¸Šç”Ÿäº§ç¯å¢ƒçš„è¯éœ€è¦è¿›è¡Œå¤§é¢ç§¯çš„è¦†ç›–æµ‹è¯•ã€‚åˆ‡è®°è°¨æ…è¡Œäº‹ã€‚</p>
<h3 id="æ‹“å±•ä¸æ€è€ƒ"><a href="#æ‹“å±•ä¸æ€è€ƒ" class="headerlink" title="æ‹“å±•ä¸æ€è€ƒ"></a>æ‹“å±•ä¸æ€è€ƒ</h3><p>ç»„ä»¶åº“çš„ç¼–è¯‘æ—¶é—´å‡å°‘è¾ƒä¸ºå¯è§‚ï¼Œè¿™ä¹Ÿè®¸æ˜¯å¤§å®¶æ¨è¡Œé¡¹ç›®ç»„ä»¶åŒ–çš„åŸå› ã€‚éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œé¡¹ç›®ä¼šè¶Šæ¥è¶Šå¤§ï¼Œä¸šåŠ¡æ‹“å±•åä¹Ÿå¯èƒ½ä¼šåˆ’åˆ†æ›´å¤šçš„éƒ¨é—¨ã€‚</p>
<p>æ¯ä¸ªéƒ¨é—¨åšè‡ªå·±çš„ä¸šåŠ¡ï¼Œä¸å…³æ³¨å…¶ä»–éƒ¨é—¨çš„ä»£ç ã€‚æ‰€ä»¥å¦‚æœæŒ‡å®šä¸€å®šçš„ä»£ç è§„èŒƒï¼Œåˆ¶ä½œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ç»„ä»¶ã€è·¯ç”±ç»„ä»¶ç­‰å…¬ç”¨ç»„ä»¶çš„åŸºç¡€ä¸Šï¼Œæ¯ä¸ªä¸šåŠ¡éƒ¨é—¨è¾“å‡ºè‡ªèº«çš„ä¸šåŠ¡ç»„ä»¶ï¼Œä½¿ç”¨<code>cocoapods</code>è¿›è¡ŒäºŒè¿›åˆ¶åŒ–ç®¡ç†ã€‚ä»£ç æ•´ä½“çš„ç¼–è¯‘ä¸Šå°±å¯ä»¥èŠ‚çœä¸å°‘æ—¶é—´ï¼Œæå‡ç¼–è¯‘æ•ˆç‡ï¼Œå›¢é˜Ÿé—´åˆä½œä¹Ÿä¼šé™ä½ä¸€äº›æˆæœ¬ã€‚</p>
<p>æœªæ¥æˆ‘ä»¬çš„é¡¹ç›®ä¹Ÿå¯ä»¥è€ƒè™‘åˆ†å‰²å„ä¸ªç»„ä»¶ï¼Œæ€»ä½“åšä¸€ä¸ªå£³å·¥ç¨‹ï¼Œé‡‡ç”¨ç»„ä»¶åŒ–çš„æ–¹æ¡ˆè¿›è¡Œä»£ç ç»´æŠ¤ã€‚ä½†æ˜¯ç»„ä»¶åŒ–ä»»é‡è€Œé“è¿œï¼Œè¿˜å¾—å¾—æ ¹æ®è‡ªèº«çš„å®é™…æƒ…å†µæ¥é€‰æ‹©æŠ€æœ¯æ–¹æ¡ˆã€‚ç»„ä»¶åŒ–å’Œå…¶ä»–è®¾è®¡æ¨¡å¼ä¸€æ ·ï¼Œéƒ½æ˜¯ä¸ºäº†è§£å†³å®é™…é—®é¢˜ï¼Œä¸è¦ä¸ºäº†è®¾è®¡è€Œè®¾è®¡ã€‚</p>
<p>å½“ç„¶ä¸€äº›å‰ç»æ€§çš„æ€è€ƒè¿˜æ˜¯ä¸èƒ½ç¼ºå°‘çš„ï¼Œæœªé›¨ç»¸ç¼ªæ€»å¥½è¿‡äºäº¡ç¾Šè¡¥ç‰¢ï¼</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯è°ƒç ”</tag>
      </tags>
  </entry>
  <entry>
    <title>module importing failed invalid pathname é—®é¢˜è§£å†³</title>
    <url>/2021/09/09/module-importing%20failed-invalid%20pathname/</url>
    <content><![CDATA[<p>æœ€è¿‘Xcodeç¼–è¯‘å®Œæˆååœ¨å‘½ä»¤è¡Œæ¡†é‡Œç¬¬ä¸€è¡Œæ€»ä¼šæŠ¥ä¸€ä¸ªé”™è¯¯ï¼š</p>
<blockquote>
<p>error: module importing failed: invalid pathname</p>
</blockquote>
<p>ä¸è®ºæ˜¯<code>clean</code>è¿˜æ˜¯åˆ é™¤<code>supportæ–‡ä»¶</code>è¿˜æ˜¯<code>é‡å¯Xcode</code>éƒ½æ— æ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>äºæ˜¯å»googleäº†ä¸€ç•ªï¼š</p>
<p><a href="https://stackoverflow.com/questions/59800936/Xcode-11-shows-a-missing-module-error-when-compiling-python-3-8">æŠŠtargetçš„schemeä¸­çš„debug executableçš„é€‰é¡¹å–æ¶ˆæ‰å°±ä¸æŠ¥è¿™ä¸ªé”™äº†</a></p>
<p><img src="https://raw.githubusercontent.com/zcx4u/images/master/Hexo/Xcode/008i3skNly1guaiuljmlhj60qi0gmwfh02.jpg" alt="å…³é—­è°ƒè¯•å™¨"></p>
<p>è¯•äº†ä¸€ä¸‹ï¼Œæœ‰æ•ˆï¼ä½†æ˜¯è¿™ä¸ªé€‰é¡¹ä¸èƒ½å»æ‰å•Šï¼Œå»æ‰äº†è¿™ä¸ªé€‰é¡¹å°±ä¸èƒ½æ‰“æ–­ç‚¹è¿›è¡Œè°ƒè¯•äº†ã€‚ğŸ˜‚</p>
<hr>
<p>Realmåˆ é™¤æ®‹ç•™å¯¼è‡´çš„é—®é¢˜ï¼Ÿ](<a href="https://stackoverflow.com/questions/59090655/removed-realm-but-still-getting-this-error-module-importing-failed-invalid-to/59094519#59094519?newreg=5c6ce4372354468b9449dfc34406e472">https://stackoverflow.com/questions/59090655/removed-realm-but-still-getting-this-error-module-importing-failed-invalid-to/59094519#59094519?newreg=5c6ce4372354468b9449dfc34406e472</a>)</p>
<p>çœ‹åˆ°æœ‹å‹ä»¬åˆ é™¤Realmä¹‹åä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æˆ‘åˆæ²¡æœ‰å®‰è£…è¿‡Realmï¼Œä¸ºä½•ä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜å‘¢ã€‚</p>
<p>å›ç­”ä¸­æåˆ°è§£å†³è¿™ä¸ªé—®é¢˜éœ€è¦å»ç¼–è¾‘<code>~/.lldbinit</code>æ–‡ä»¶ï¼Œçœ‹çš„æˆ‘ä¸€è„¸æ‡µé€¼ï¼Œå¯¹äºè¿™ç§æ²¡è§è¿‡çš„é…ç½®æ–‡ä»¶æˆ‘å¯ä¸æ•¢å»ä¹±åˆ ä¹±æ”¹ã€‚åˆæƒ³èµ·æ¥è¢«é”™æ”¹é…ç½®æ–‡ä»¶æ”¯é…çš„ææƒ§ï¼Œåƒä¸€å ‘é•¿ä¸€æ™ºâ€¦</p>
<p>ä»”ç»†çœ‹<code>lldbinit</code>æ–‡ä»¶å‘½åï¼Œå¥½åƒåœ¨å“ªè§è¿‡ï¼Œæ˜¯LLDBè°ƒè¯•å™¨åˆå§‹åŒ–çš„é…ç½®æ–‡ä»¶ï¼Œäºæ˜¯åœ¨macæ ¹ç›®å½•ä¸‹å»æ‰¾äº†æ‰¾è¿™ä¸ªæ–‡ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¿™ä¸ªæ–‡ä»¶çš„å…¨éƒ¨å†…å®¹</span><br><span class="line">### Reveal LLDB commands support - DO NOT MODIFY</span><br><span class="line">    command script import /Applications/Reveal.app/Contents/SharedSupport/Scripts/RevealServerCommands.py</span><br><span class="line">###</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘çœ‹åˆ°<code>Reveal.app</code>è¿™ä¸ªä¸œè¥¿çš„æ—¶å€™ä¾¿æ˜ç™½æ˜¯ä»€ä¹ˆé—®é¢˜äº†ï¼Œæˆ‘è¿™å°macä¹‹å‰ä¸‹è½½è¿‡ç ´è§£ç‰ˆçš„Revealè½¯ä»¶ç”¨æ¥è°ƒè¯•ç•Œé¢ã€‚</p>
<p><code>Reveal</code>çš„æ’ä»¶éœ€è¦åœ¨LLDBå¯åŠ¨çš„æ—¶å€™åŠ è½½ç”¨æ¥è·å–UIæ ˆä¿¡æ¯ï¼Œåæ¥æ”¹ç”¨äº†<code>Lookin</code>å°±æŠŠ<code>Reveal</code>ç»™å¸è½½äº†ï¼Œä½†æ˜¯<code>.lldbinit</code>ä¸­çš„å‘½ä»¤æ²¡æœ‰æ”¹æ‰ã€‚LLDBå¯åŠ¨çš„æ—¶å€™æ‰¾ä¸åˆ°<code>Revealæ’ä»¶</code>ä¾¿ä¼šæŠ¥<code>module importing failed: invalid pathname</code>é”™è¯¯ã€‚</p>
<p><img src="https://raw.githubusercontent.com/zcx4u/images/master/Hexo/Xcode/008i3skNly1guaium1xjzj60n805q74o02.jpg"></p>
<p>åŒæ—¶è¿™ä¹ŸéªŒè¯äº†ä¸ºä»€ä¹ˆåœ¨Xcodeä¸­å…³é—­è°ƒè¯•å°±ä¸æŠ¥è¿™ä¸ªé”™äº†(é‚£è‚¯å®šæ˜¯Xcodeåœ¨debugæ¨¡å¼ä¸‹è¿è¡Œæ—¶è‡ªåŠ¨å¯åŠ¨äº†å†…ç½®çš„LLDBè°ƒè¯•å™¨å•¦)ã€‚</p>
<p>ä¸ºäº†éªŒè¯æ˜¯LLDBçš„é—®é¢˜æˆ‘æŠŠXcodeå…³é—­ï¼Œæ‰“å¼€äº†ç»ˆç«¯ï¼Œè¾“å…¥LLDBå‘½ä»¤ï¼Œç„¶åç»ˆç«¯ä¸­ä¹ŸæŠ¥å‡ºäº†ç›¸åŒçš„é”™è¯¯æç¤ºã€‚ä¸ºäº†æ›´åŠ ç†è§£è¿™ä¸ªæ–‡ä»¶çš„ä½œç”¨ï¼Œæˆ‘ä¾¿åˆå»æœç´¢äº†ä¸€ç•ª.lldbinitçš„ä½œç”¨ã€‚</p>
<blockquote>
<p>~&#x2F;.lldbinitæ˜¯æ¯æ¬¡LLDBå¯åŠ¨æ—¶ä¼šåŠ è½½çš„æ–‡ä»¶ã€‚æ‰€ä»¥ä¸€äº›åˆå§‹åŒ–çš„äº‹å„¿ï¼Œæˆ‘ä»¬å¯ä»¥å†™å…¥å…¶ä¸­ä¸­ï¼Œæ¯”å¦‚ç»™å‘½ä»¤å®šä¹‰åˆ«åç­‰ã€‚ä½†æ˜¯ç”±äºè¿™æ—¶å€™ç¨‹åºè¿˜æ²¡æœ‰çœŸæ­£è¿è¡Œï¼Œä¹Ÿæœ‰éƒ¨åˆ†æ“ä½œæ— æ³•åœ¨é‡Œé¢ç©ï¼Œæ¯”å¦‚è®¾ç½®æ–­ç‚¹ã€‚</p>
</blockquote>
<p>åˆ°æ­¤æˆ‘è§£å†³äº†Xcodeä¸­æ¯æ¬¡å¯åŠ¨éƒ½æŠ¥é”™çš„é—®é¢˜ï¼Œä¹Ÿæ˜ç™½äº†è¿™ä¸ªé—®é¢˜å‡ºç°çš„åŸå› ï¼ŒåŒæ—¶ä¹Ÿäº†è§£åˆ°äº†LLDBç›¸å…³çš„æ–°çŸ¥è¯†ã€‚æ‰€ä»¥å½“çœ‹åˆ°ä¸€äº›è«åå…¶å¦™çš„æŠ¥é”™çš„æ—¶å€™ä¸è¦ç€æ€¥ä¹Ÿä¸è¦ç„¦è™‘ï¼Œä¸€å®šæ˜¯åœ¨ä½ ä¸ç†Ÿæ‚‰çš„åœ°æ–¹å‡ºç°äº†å¼‚å¸¸ï¼Œå½“ä½ æ…¢æ…¢ç†è§£é‚£äº›å†…å®¹çš„æ—¶å€™ï¼Œè¿™äº›æŠ¥é”™ä¹Ÿè®¸åªæ˜¯ä¸€ä¸ªå¾ˆå°å¾ˆå°çš„é—®é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>Xcode</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€å¸–çœ‹é€iOS14 å°ç»„ä»¶</title>
    <url>/2021/02/23/%E4%B8%80%E5%B8%96%E7%9C%8B%E9%80%8FiOS14%20%E5%B0%8F%E7%BB%84%E4%BB%B6/</url>
    <content><![CDATA[<blockquote>
<p>è‡ªiOS8ä¹‹åï¼Œè‹¹æœæ”¯æŒäº†æ‰©å±•ï¼ˆExtensionï¼‰çš„å¼€å‘ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡ç³»ç»Ÿæä¾›ç»™æˆ‘ä»¬çš„æ‰©å±•æ¥å…¥ç‚¹ (Extension point) æ¥ä¸ºç³»ç»Ÿç‰¹å®šçš„æœåŠ¡æä¾›æŸäº›é™„åŠ çš„åŠŸèƒ½ã€‚<br>ä½†iOS14åï¼Œè‹¹æœæ›´æ–°äº†æ‰©å±•ç»„ä»¶ï¼Œå¼•å…¥äº†æ–°çš„UIç»„ä»¶ï¼š<code>WidgetKit</code> è€Œèˆå¼ƒäº†iOS14ä»¥ä¸‹ç‰ˆæœ¬çš„Today Extensionç»„ä»¶</p>
</blockquote>
<h3 id="Widgetä»‹ç»"><a href="#Widgetä»‹ç»" class="headerlink" title="Widgetä»‹ç»"></a>Widgetä»‹ç»</h3><p><a href="https://support.apple.com/zh-cn/HT207122">è¿™é‡Œæœ‰ä¸€ä»½å®˜æ–¹çš„å°ç»„ä»¶ä½¿ç”¨æŒ‡å—</a></p>
<p>ç®€å•æ¥è¯´ï¼šå°ç»„ä»¶ç›¸å½“äºä¸€ä¸ªåŠ¨æ€ç¨‹åºå…¥å£ï¼Œåœ¨æœ‰é™çš„ç©ºé—´å†…å±•ç¤ºä½ æƒ³çœ‹åˆ°çš„é‡è¦çš„ä¿¡æ¯</p>
<img src="https://cdn.zcx.info/008eGmZEly1gnu0x3a5faj305g05p0tr.jpg" alt="ç”µæ± å°ç»„ä»¶" style="zoom:50%;" />

<p>è‹¹æœè‡ªå¸¦çš„æ—¥å†ä½¿ç”¨èµ·æ¥éå¸¸ä¸é€‚ï¼Œä¸‹è½½ç¬¬ä¸‰æ–¹æ—¥å†åˆä¸æƒ³è¢«æ†ç»‘çš„æ— ç”¨åŠŸèƒ½æ‰“æ‰°ã€‚æœ‰äº†å°ç»„ä»¶ä¹‹åè¿™ä¸ªé—®é¢˜å°±å¾ˆå¥½çš„è§£å†³äº†ï¼Œæ¯”å¦‚ä¸Šé¢çš„æ—¥å†å°ç»„ä»¶ï¼Œæ¸…æ™°çš„å±•ç¤ºäº†ä»Šå¤©çš„æ—¥æœŸå’Œå†œå†ä»¥åŠå‘¨å‡ ï¼Œæ‰“å¼€æ‰‹æœºé”å±å°±èƒ½çœ‹è§ã€‚</p>
<p>æ­¤å¤–ç³»ç»Ÿè‡ªå¸¦çš„ç”µé‡å°ç»„ä»¶ï¼Œæ–¹ä¾¿çš„å±•ç¤ºäº†éœ€è¦ä¸‹æ»‘å»çŠ¶æ€æ æ‰èƒ½çœ‹åˆ°çš„è€³æœºç”µé‡ï¼š</p>
<img src="https://cdn.zcx.info/008eGmZEly1gnu0y70jk5j30ae0bgjuv.jpg" alt="ç”µæ± å°ç»„ä»¶" style="zoom:50%;" />

<p>ä¹‹å‰å‘å¸ƒçš„æ—¶å€™è§‰å¾—è¿™éƒ½æ˜¯å®‰å“ç³»ç»Ÿç©å‰©ä¸‹çš„ä¸œè¥¿ï¼Œæ²¡ä»€ä¹ˆåµç”¨ï¼Œä¸è¿‡ç°åœ¨æ˜¯çœŸé¦™ï¼</p>
<hr>
<h3 id="Widgetè®¾è®¡æŒ‡å—"><a href="#Widgetè®¾è®¡æŒ‡å—" class="headerlink" title="Widgetè®¾è®¡æŒ‡å—"></a>Widgetè®¾è®¡æŒ‡å—</h3><p><a href="https://developer.apple.com/design/human-interface-guidelines/ios/system-capabilities/widgets/">è¿™é‡Œæœ‰ä¸€ä»½å®˜æ–¹çš„è®¾è®¡æŒ‡å—</a></p>
<p>ç®€è€Œè¨€ä¹‹ï¼Œè®¾è®¡ä¸€ä¸ªç®€å•æ¼‚äº®å¸å¼•äººå¹¶ä¸”å¿«é€Ÿæ˜¾ç¤ºå†…å®¹çš„å°ç»„ä»¶ã€‚</p>
<hr>
<h3 id="Widget-HelloWorld"><a href="#Widget-HelloWorld" class="headerlink" title="Widget: HelloWorld"></a>Widget: HelloWorld</h3><p><a href="https://developer.apple.com/documentation/widgetkit/creating-a-widget-extension">è¿™é‡Œæœ‰ä¸€ä»½å®˜æ–¹çš„å¼€å‘æ–‡æ¡£å¯ä»¥å‚è€ƒ</a></p>
<p>ä¸€ä¸ªå°ç»„ä»¶éœ€è¦ç»è¿‡</p>
<p><code>FIle</code> &gt; <code>New</code> &gt;<code>Target</code> &gt;<code>Wiget Extension</code>  æ¥åˆ›å»º</p>
<img src="https://cdn.zcx.info/008eGmZEly1gnu1b833goj30g90gdadn.jpg" style="zoom:100%;" />

<p>æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„ <code>Widget Extension</code></p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnu1b7z83jj30kb0eodh5.jpg"></p>
<p>å‘½åå°ç»„ä»¶</p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnu1b7vu85j30ke0eoq3v.jpg"></p>
<p>å›¾ä¸­åœˆç€çš„é€‰é¡¹æ§åˆ¶äº†æˆ‘ä»¬çš„å°ç»„ä»¶èƒ½å¦é…ç½®å±æ€§ï¼Œä¾‹å¦‚å¤©æ°”ç›¸å…³çš„å°ç»„ä»¶å°±å¯èƒ½éœ€è¦ä½ æ‰‹åŠ¨é…ç½®åœ°å€æ¥è·å–ä½ æƒ³è¦çŸ¥é“çš„åŸå¸‚çš„å¤©æ°”æ•°æ®ã€‚</p>
<p>è¿™æ ·å°±åˆ›å»ºå¥½äº†ä¸€ä¸ªå°ç»„ä»¶ã€‚å°ç»„ä»¶çš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/zcx_bruin/gitee-images/blob/master/Hexo/iOS14Widget/008eGmZEgy1gnu587og7mj30e902s3yi.jpg" alt="ä¸å¸¦é…ç½®é¡¹çš„å°ç»„ä»¶ç»“æ„"></p>
<p>è¿™é‡Œæˆ‘ä»¬é€‰åˆ™äº†ä¸å¸¦é…ç½®é¡¹çš„å°ç»„ä»¶</p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnu1ge3kbuj30eb03hglp.jpg" alt="å¸¦é…ç½®é¡¹çš„ç»“æ„"></p>
<p>å¸¦é…ç½®é¡¹çš„å°ç»„ä»¶çš„ç»“æ„ ä¸»è¦åŒºåˆ«åœ¨äº <code>TestWidget.intentdefinition</code>æ–‡ä»¶ä¸Šï¼Œè¿™ä¸ªæ–‡ä»¶å†…éƒ¨å¯ä»¥æ·»åŠ é…ç½®é€‰é¡¹ã€‚</p>
<p>TestWidgetä»£ç å¦‚ä¸‹</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> WidgetKit</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Provider</span>: <span class="title class_ inherited__">TimelineProvider</span> &#123;</span><br><span class="line">   	<span class="comment">/// é»˜è®¤æ˜¾ç¤ºï¼ˆæ— è‡ªå®šæ•°æ®æƒ…å†µä¸‹æ˜¾ç¤ºï¼‰</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">placeholder</span>(<span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>) -&gt; <span class="type">SimpleEntry</span> &#123;</span><br><span class="line">        <span class="type">SimpleEntry</span>(date: <span class="type">Date</span>())</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">///getSnapshotæ–¹æ³•æ˜¯æä¾›ä¸€ä¸ªé¢„è§ˆæ•°æ®ï¼Œå¯ä»¥è®©ç”¨æˆ·çœ‹åˆ°è¯¥ç»„ä»¶çš„ä¸€ä¸ªå¤§è‡´æƒ…å†µï¼Œæ˜¯é•¿ä»€ä¹ˆæ ·ã€æ˜¾ç¤ºä»€ä¹ˆæ•°æ®çš„ï¼Œå¯ä»¥å†™æˆå›ºå®šæ•°æ®ï¼Œå›½å¤–çš„			æ–‡ç« é‡Œå«å®ƒâ€œfake informationâ€</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">getSnapshot</span>(<span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>, <span class="params">completion</span>: <span class="keyword">@escaping</span> (<span class="type">SimpleEntry</span>) -&gt; ()) &#123;</span><br><span class="line">        <span class="keyword">let</span> entry <span class="operator">=</span> <span class="type">SimpleEntry</span>(date: <span class="type">Date</span>())</span><br><span class="line">        completion(entry)</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">		<span class="comment">///åŒ…å«è¦æ˜¾ç¤ºçš„æ‰€æœ‰æ¡ç›®ï¼šé¢„æœŸæ˜¾ç¤ºçš„æ—¶é—´ï¼ˆæ¡ç›®çš„æ—¥æœŸï¼‰ä»¥åŠæ—¶é—´è½´â€œè¿‡æœŸâ€çš„æ—¶é—´</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">getTimeline</span>(<span class="params">in</span> <span class="params">context</span>: <span class="type">Context</span>, <span class="params">completion</span>: <span class="keyword">@escaping</span> (<span class="type">Timeline</span>&lt;<span class="type">Entry</span>&gt;) -&gt; ()) &#123;</span><br><span class="line">        <span class="keyword">var</span> entries: [<span class="type">SimpleEntry</span>] <span class="operator">=</span> []</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Generate a timeline consisting of five entries an hour apart, starting from the current date.</span></span><br><span class="line">        <span class="keyword">let</span> currentDate <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">        <span class="keyword">for</span> hourOffset <span class="keyword">in</span> <span class="number">0</span> <span class="operator">..&lt;</span> <span class="number">5</span> &#123;</span><br><span class="line">            <span class="comment">//éœ€è¦åœ¨è¿™é‡Œä»ç½‘ç»œåŠ è½½æ•°æ®å›æ¥ åŒæ­¥è¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line">            <span class="keyword">let</span> entryDate <span class="operator">=</span> <span class="type">Calendar</span>.current.date(byAdding: .hour, value: hourOffset, to: currentDate)<span class="operator">!</span></span><br><span class="line">            <span class="keyword">let</span> entry <span class="operator">=</span> <span class="type">SimpleEntry</span>(date: entryDate)</span><br><span class="line">            entries.append(entry)</span><br><span class="line">        &#125;</span><br><span class="line">				<span class="comment">// atEnd æŒ‡åœ¨æœ€åä¸€ä¸ªæ˜¾ç¤ºæ—¶é—´ç‚¹çš„å°ç»„ä»¶å®Œæ¯•åé‡æ–°åˆ·æ–°TimeLine</span></span><br><span class="line">        <span class="keyword">let</span> timeline <span class="operator">=</span> <span class="type">Timeline</span>(entries: entries, policy: .atEnd)</span><br><span class="line">        completion(timeline)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SimpleEntry</span>: <span class="title class_ inherited__">TimelineEntry</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> date: <span class="type">Date</span></span><br><span class="line">  	<span class="comment">// ä¸‹é¢å¯ä»¥è‡ªå·±æ·»åŠ è‡ªå®šä¹‰çš„model</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TestWidgetEntryView</span> : <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> entry: <span class="type">Provider</span>.<span class="type">Entry</span></span><br><span class="line">		<span class="comment">// swiftUIçš„View å¯ä»¥è¿”å›ä¸€ç³»åˆ—View å…·ä½“è¯·å‚çœ‹SwiftUIæ–‡æ¡£</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(entry.date, style: .time)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å°ç»„ä»¶ä¸»å…¥å£</span></span><br><span class="line"><span class="keyword">@main</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TestWidget</span>: <span class="title class_ inherited__">Widget</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> kind: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;TestWidget&quot;</span></span><br><span class="line">		<span class="comment">// StaticConfiguration ä¸å¸¦é…ç½®é¡¹çš„å°ç»„ä»¶åˆå§‹åŒ–æ–¹å¼</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">WidgetConfiguration</span> &#123;</span><br><span class="line">        <span class="type">StaticConfiguration</span>(kind: kind, provider: <span class="type">Provider</span>()) &#123; entry <span class="keyword">in</span></span><br><span class="line">            <span class="type">TestWidgetEntryView</span>(entry: entry)</span><br><span class="line">        &#125;</span><br><span class="line">        .configurationDisplayName(<span class="string">&quot;My Widget&quot;</span>)</span><br><span class="line">        .description(<span class="string">&quot;This is an example widget.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å®æ—¶é¢„è§ˆview</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TestWidget_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">TestWidgetEntryView</span>(entry: <span class="type">SimpleEntry</span>(date: <span class="type">Date</span>()))</span><br><span class="line">            .previewContext(<span class="type">WidgetPreviewContext</span>(family: .systemSmall))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>äºæ˜¯æˆ‘ä»¬è·å¾—äº†ç¬¬ä¸€ä¸ªå°ç»„ä»¶ï¼š</p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnu2oixw72j304o051mx9.jpg"></p>
<p>çœ‹èµ·æ¥å¾ˆç®€å•å§ï¼</p>
<hr>
<h3 id="Widgetç»“æ„è§£æ"><a href="#Widgetç»“æ„è§£æ" class="headerlink" title="Widgetç»“æ„è§£æ"></a>Widgetç»“æ„è§£æ</h3><h4 id="è‡³å…³é‡è¦-TimeLine"><a href="#è‡³å…³é‡è¦-TimeLine" class="headerlink" title="è‡³å…³é‡è¦ TimeLine"></a>è‡³å…³é‡è¦ TimeLine</h4><p><code>getTimeLine</code> æ–¹æ³•è·å–å°ç»„ä»¶æ•´ä¸ªæ˜¾ç¤ºå‘¨æœŸã€‚</p>
<p>ä¸ºäº†ç®¡ç†ç³»ç»Ÿè´Ÿè½½ï¼Œ<code>WidgetKit</code>ä½¿ç”¨é¢„ç®—æ¥åˆ†é…ä¸€å¤©ä¸­çš„çª—å£å°éƒ¨ä»¶é‡æ–°è´Ÿè½½ã€‚</p>
<blockquote>
<p>Widgets use SwiftUI views to display their content. WidgetKit renders the views on your behalf in a separate process. As a result, your widget extension is not continually active, even if the widget is onscreen. Despite your widget not always being active, there are several ways you can keep its content up to date.</p>
</blockquote>
<p>æŠ›å¼€ <code>SwiftUI</code>ä¸è°ˆï¼Œå•è¯´ <code>your widget extension is not continually active</code> ï¼Œè¿™æ®µæ–‡å­—æ¸…æ™°çš„è¯´æ˜äº†å°ç»„ä»¶æ‰€é¢ä¸´çš„é—®é¢˜ï¼šä¸èƒ½å®æ—¶åˆ·æ–°ã€‚å³ä½¿ä½ çš„å°ç»„ä»¶åœ¨ä½ ç›®å…‰æ³¨è§†ä¸­ï¼Œå°ç»„ä»¶ä¹Ÿä¸èƒ½ä¿æŒæœ€æ–°çŠ¶æ€ã€‚</p>
<p>é‡æ–°åŠ è½½çª—å£å°éƒ¨ä»¶ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œå¹¶ä¼šç”±äºé¢å¤–çš„è”ç½‘å’Œå¤„ç†è€Œå¯¼è‡´ç”µæ± æ¶ˆè€—ã€‚ä¸ºäº†å‡å°‘å¯¹æ€§èƒ½çš„å½±å“å¹¶ä¿æŒå…¨å¤©çš„ç”µæ± å¯¿å‘½ï¼Œè¯·æ±‚çš„æ›´æ–°é¢‘ç‡å’Œæ›´æ–°æ¬¡æ•°å°†ä¼šé™åˆ¶ä¸ºå¿…è¦ã€‚</p>
<p>é‚£ä¹ˆå°ç»„ä»¶å¦‚ä½•åˆ·æ–°ï¼Ÿ</p>
<blockquote>
<p>Many widgets have predictable points in time where it makes sense to update their content. For example, a widget that displays weather information might update the temperature hourly throughout the day. A stock market widget could update its content frequently during open market hours, but not at all over the weekend. By planning these times in advance, WidgetKit automatically refreshes your widget when the appropriate time arrives.</p>
</blockquote>
<p>è®¸å¤šAPPéœ€è¦å®šæ—¶åˆ·æ–°æ•°æ®ï¼Œè¿™äº›åˆ·æ–°æ—¶é—´æ˜¯å¯é¢„æµ‹çš„ï¼Œæ¯”å¦‚æ—¥å†APPæ¯å¤©åˆ·æ–°å½“æ—¥çš„æ—¥æœŸä¿¡æ¯ï¼Œè‚¡å¸‚APPåˆ™ä¼šåœ¨å·¥ä½œæ—¥é¢‘ç¹åˆ·æ–°äº¤æ˜“ä¿¡æ¯ï¼Œä½†æ˜¯åœ¨ä¼‘æ¯æ—¥ä¸é¢‘ç¹åˆ·æ–°ã€‚</p>
<p>å½“æˆ‘ä»¬èƒ½å¤Ÿä¸ºå°ç»„ä»¶æä¾›ä¸€ä¸ªå¯é¢„æµ‹çš„æ—¶é—´ç‚¹å’Œåˆ·æ–°ç­–ç•¥ï¼Œç³»ç»Ÿä¾¿ä¼šæŒ‰ç…§æ—¢å®šçš„é¡ºåºåˆ·æ–°ã€‚</p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnwiq5qmqfj30n80rugn1.jpg"></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬åœ¨ <code>.Now</code>å’Œæ¯éš”1å°æ—¶å…±ä¸‰å°æ—¶è®¾ç½®å››ä¸ªæ˜¾ç¤ºæ—¶é—´ç‚¹ï¼Œç³»ç»Ÿåœ¨getåˆ°æˆ‘ä»¬ç»™å®šçš„ <code>TimeLine</code>ä¹‹åä¼šåœ¨å½“å‰ã€ä¸€å°æ—¶åã€ä¸¤å°æ—¶åã€ä¸‰å°æ—¶åæ€»è®¡å››ä¸ªæ—¶é—´ç‚¹è¿›è¡Œå°ç»„ä»¶UIæ¸²æŸ“,ç”±äºæˆ‘ä»¬ç¬¬ä¸€æ¬¡ç»™å®šçš„é‡æ–°åˆ·æ–°ç­–ç•¥ä¸º <code>.atEnd</code>æ‰€ä»¥ä¼šåœ¨ä¸‰ä¸ªå°æ—¶æ—¶é—´ç‚¹æ¸²æŸ“å®Œæ¯•ä¹‹åé‡æ–°è·å– <code>TimeLine</code>ã€‚</p>
<p>ç¬¬äºŒä¸ª <code>TimeLine(Provide timeline)</code>ä¸­è®¾ç½®çš„é‡æ–°åˆ·æ–°ç­–ç•¥ä¸º <code>.never</code>æ‰€ä»¥åœ¨è¿™ä¸ªæ—¶é—´ç‚¹çš„å°ç»„ä»¶æ¸²æŸ“å®Œæ¯•ä¹‹åå°±ä¸å†åˆ·æ–°äº†ã€‚</p>
<h4 id="æ·»åŠ é¢„è§ˆ-Snapshot"><a href="#æ·»åŠ é¢„è§ˆ-Snapshot" class="headerlink" title="æ·»åŠ é¢„è§ˆ Snapshot"></a>æ·»åŠ é¢„è§ˆ Snapshot</h4><p><code>getSnapshot</code>æ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œè¿™ä¸ªæ–¹æ³•è·å–æˆ‘ä»¬åœ¨æ‰“å¼€å°ç»„ä»¶é¢„è§ˆç•Œé¢æ—¶æ‰€çœ‹åˆ°çš„ä¸‰ä¸ªå°ç»„ä»¶çš„ <code>Entry</code>ã€‚</p>
<p>è¿™é‡Œå¦‚æœä¸éœ€è¦å±•ç¤ºå®æ—¶æ•°æ®çš„æ—¶å€™å¯ä»¥æ”¾å…¥å›ºå®šçš„é¢„è§ˆæ•°æ®ä»¥è·å¾—æœ€å¥½çš„ä½“éªŒ(ä¸éœ€è¦è¯·æ±‚ç½‘ç»œç›´æ¥æ¸²æŸ“æ•°æ®)ã€‚</p>
<h4 id="ç•Œé¢ç¾åŒ–-Placeholder"><a href="#ç•Œé¢ç¾åŒ–-Placeholder" class="headerlink" title="ç•Œé¢ç¾åŒ– Placeholder"></a>ç•Œé¢ç¾åŒ– Placeholder</h4><p><code>placeholder</code>æ–¹æ³•ç›®çš„åœ¨äºè·å–ä¸€ä¸ªæ²¡æœ‰æ•°æ®æˆ–è€…æ²¡æœ‰ç½‘ç»œæƒ…å†µä¸‹çš„é»˜è®¤View,ä¸€èˆ¬æ˜¯è¿›è¡Œç¾åŒ–å°ç»„ä»¶çš„æ—¶å€™åœ¨è¿™ä¸ªviewä¸Šåšæ–‡ç« ï¼Œ</p>
<h4 id="æ•°æ®æ”¯æ’‘-TimelineEntry"><a href="#æ•°æ®æ”¯æ’‘-TimelineEntry" class="headerlink" title="æ•°æ®æ”¯æ’‘ TimelineEntry"></a>æ•°æ®æ”¯æ’‘ TimelineEntry</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SimpleEntry</span>: <span class="title class_ inherited__">TimelineEntry</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> date: <span class="type">Date</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>TimelineEntry</code>åè®®å¿…é¡»åŒ…å«ä¸€ä¸ª <code>date</code>å±æ€§ï¼Œç”¨äºè®¡ç®—éœ€è¦æ¸²æŸ“é¡µé¢çš„æ—¶é—´ç‚¹</p>
<p>è‡ªå®šä¹‰çš„æ¨¡å‹å¯ä»¥å®ç°è¿™ä¸ªåè®®ç”¨äºæ‰¿è½½å†…å®¹æ•°æ®ã€‚</p>
<h4 id="å†…å®¹åŸºçŸ³-WidgetEntryView"><a href="#å†…å®¹åŸºçŸ³-WidgetEntryView" class="headerlink" title="å†…å®¹åŸºçŸ³ WidgetEntryView"></a>å†…å®¹åŸºçŸ³ WidgetEntryView</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">TestWidgetEntryView</span> : <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> entry: <span class="type">Provider</span>.<span class="type">Entry</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(entry.date, style: .time)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°ç»„ä»¶çš„ <code>View</code>å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„åŒ…å« <code>Provider.Entry</code>çš„ <code>View(swiftUI)</code>ï¼Œä¸€èˆ¬åˆ›å»ºtimelineçš„æ—¶å€™ä¼šæä¾› <code>Provider.Entry</code>ç»™ <code>View</code>è¿›è¡Œæ¸²æŸ“ã€‚</p>
<p><code>body</code>å±æ€§ä¸‹åŒ…å«ä¸€ç³»åˆ— <code>VIew</code>æ§ä»¶ç”¨äºæ¸²æŸ“é¡µé¢ï¼Œæ›´å¤š <code>SwiftUI</code>ç›¸å…³çš„çŸ¥è¯†çœ‹<a href="https://developer.apple.com/tutorials/swiftui/creating-and-combining-views">SwiftUIæ–‡æ¡£</a>ã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯å°ç»„ä»¶çš„ç»“æ„æ‹†åˆ†å’Œè§£æï¼Œåªè¦æ˜ç™½ç»„æˆç»“æ„å’Œè¿è¡Œæœºåˆ¶å°±èƒ½æ ¹æ®è‡ªå·±çš„éœ€æ±‚å»å®šåˆ¶å¼€å‘äº†ã€‚</p>
<hr>
<h3 id="Widgetè¿›é˜¶"><a href="#Widgetè¿›é˜¶" class="headerlink" title="Widgetè¿›é˜¶"></a>Widgetè¿›é˜¶</h3><h4 id="åŠŸèƒ½å’Œé™åˆ¶"><a href="#åŠŸèƒ½å’Œé™åˆ¶" class="headerlink" title="åŠŸèƒ½å’Œé™åˆ¶"></a>åŠŸèƒ½å’Œé™åˆ¶</h4><p><code>iOS14 Widget</code>çš„åŠŸèƒ½å¯¹æ¯”ç€ä»¥å‰çš„ <code>TodayExtension</code>è¦å°‘äº†å¾ˆå¤šï¼Œå®˜æ–¹å¯¹å°ç»„ä»¶æ·»åŠ äº†å¾ˆå¤šé™åˆ¶ã€‚</p>
<ul>
<li>å°ç»„ä»¶æ‰©å±•æ•´ä½“éœ€è¦ä½¿ç”¨ <code>SwiftUI</code>ç»“æ„ï¼Œ<code>WidgetEntryView</code>éœ€è¦æä¾› <code>SwiftUIView</code>ã€‚</li>
<li>é¡µé¢æ»šåŠ¨ã€åŠ¨ç”»å’Œè§†é¢‘æ˜¯è¢«ç¦æ­¢çš„ï¼Œ<code>SwiftUI</code> ä¸­ <code> List</code> æ§ä»¶æ˜¯æ— æ³•ä½¿ç”¨çš„ï¼Œæ‰©å±•çš„ <code>UIKit</code>ä¸­ <code>UIVisualEffectView</code>æ˜¯è¢«ç¦ç”¨çš„(æ¯›ç»ç’ƒæ•ˆæœ)ï¼Œæ›´å¤šè¢«ç¦ç”¨çš„ <code>View</code>è¿˜éœ€è¦åœ¨å¼€å‘ä¸­å‘ç°ã€‚</li>
<li>åªæ”¯æŒç‚¹å‡»äº‹ä»¶äº¤äº’ã€‚</li>
<li>æ— æ³•ä¸»åŠ¨æ›´æ–°æ•°æ® åˆ·æ–°æ•°æ®ä½¿ç”¨ <code>Timeline</code>æ–¹å¼æ‰‹åŠ¨è®¾ç½®ã€‚</li>
<li>æ¯æ¬¡é‡ç½®åˆ·æ–°è½®æ¬¡çš„é—´éš”ä¸èƒ½ä½äº5åˆ†é’Ÿï¼Œä½äº5åˆ†é’Ÿæ— æ•ˆ ï¼Œæˆ‘ä»¬åœ¨å¡«å…… <code>entries</code>æ—¶åº”è¯¥ä¸ºå…¶å¡«å……5åˆ†é’Ÿå†…éœ€è¦æ˜¾ç¤ºçš„æ•°æ®ã€‚ä¸å»ºè®®æ˜¾ç¤ºå®æ—¶æ—¶é—´ï¼Œå’Œæ‰‹æœºç³»ç»Ÿæ˜¾ç¤ºçš„æ—¶é—´å¯èƒ½ä¼šå‡ºç°åå·®ã€‚</li>
</ul>
<h4 id="å°ç»„ä»¶æ ·å¼åŒºåˆ†-supportedFamilies"><a href="#å°ç»„ä»¶æ ·å¼åŒºåˆ†-supportedFamilies" class="headerlink" title="å°ç»„ä»¶æ ·å¼åŒºåˆ†  supportedFamilies"></a>å°ç»„ä»¶æ ·å¼åŒºåˆ†  supportedFamilies</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@main</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TestWidget</span>: <span class="title class_ inherited__">Widget</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> kind: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;TestWidget&quot;</span></span><br><span class="line">		<span class="comment">// StaticConfiguration ä¸å¸¦é…ç½®é¡¹çš„å°ç»„ä»¶åˆå§‹åŒ–æ–¹å¼</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">WidgetConfiguration</span> &#123;</span><br><span class="line">        <span class="type">StaticConfiguration</span>(kind: kind, provider: <span class="type">Provider</span>()) &#123; entry <span class="keyword">in</span></span><br><span class="line">            <span class="type">TestWidgetEntryView</span>(entry: entry)</span><br><span class="line">        &#125;</span><br><span class="line">        .configurationDisplayName(<span class="string">&quot;My Widget&quot;</span>)</span><br><span class="line">        .description(<span class="string">&quot;This is an example widget.&quot;</span>)</span><br><span class="line">        .supportedFamilies([.systemSmall])<span class="comment">// æ³¨æ„è¿™é‡Œå¢åŠ äº†ä¸€ä¸ªæ–¹æ³•æ¥é™åˆ¶å°ç»„ä»¶æ”¯æŒçš„ç±»å‹ è¿™é‡Œåªæ”¯æŒ2x2å°æ–¹å—</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä¸»å…¥å£å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>TestWidgetçš„</code>å°ç»„ä»¶ï¼Œè¿™ä¸ªå°ç»„ä»¶é»˜è®¤æ”¯æŒä¸‰ç§æ ·å¼ã€‚</p>
<p>æˆ‘ä»¬å¸¸å¸¸åªéœ€è¦æŸä¸€ä¸ªå°ç»„ä»¶åªæ”¯æŒä¸€ç§æ ·å¼ï¼Œæ¯”å¦‚æœ€å°çš„æ–¹å—å½¢çŠ¶çš„ç»„ä»¶è®¾è®¡çš„æ—¶å€™ç”±äºå°ºå¯¸åŠå½¢çŠ¶å¾€å¾€ä¸è€ƒè™‘å…¶ä»–æ˜¾ç¤ºæ ¼å¼ã€‚</p>
<p>è¿™æ—¶æˆ‘ä»¬å¯ä»¥åœ¨ <code>StaticConfiguration</code>åè·Ÿä¸Šé…ç½®æ”¯æŒçš„æ ·å¼æ–¹æ³• <code>supportedFamilies()</code>ï¼Œå°ç»„ä»¶æŒ‰ç…§ä½“ç§¯å¤§å°åˆ†ä¸º   <code>systemSmall</code>, <code> systemMedium</code>ï¼Œ<code>systemLarge</code>ä¸‰ç§ã€‚</p>
<h4 id="å¤šå°ç»„ä»¶å®¹å™¨-WidgetBundle"><a href="#å¤šå°ç»„ä»¶å®¹å™¨-WidgetBundle" class="headerlink" title="å¤šå°ç»„ä»¶å®¹å™¨  WidgetBundle"></a>å¤šå°ç»„ä»¶å®¹å™¨  WidgetBundle</h4><p>åœ¨è®¾è®¡å®Œæˆå¹¶ç¡®å®šè¦å±•ç¤ºçš„å°ç»„ä»¶ä¹‹åï¼Œæˆ‘ä»¬ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•åœ¨å…¥å£æ–¹æ³•å¤„å±•ç¤ºå¤šä¸ªä¸åŒç±»å‹çš„å°ç»„ä»¶ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬ç¡®å®šäº†ä¸‰ä¸ªå°ç»„ä»¶ï¼Œ<code>2x2</code>ã€<code>2x4</code>ã€<code>4x4</code>ä¸‰ç§å°ºå¯¸å„ä¸€ä¸ªï¼Œå±•ç¤ºçš„å†…å®¹ä¹Ÿä¸ç›¸åŒã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@main</span> <span class="comment">// ç§»é™¤åŸæ¥çš„æ ‡è®° æ”¾åœ¨è¿™é‡Œ mainåªèƒ½å­˜åœ¨ä¸€ä¸ª</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">KrWidget</span>: <span class="title class_ inherited__">WidgetBundle</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">Widget</span> &#123;</span><br><span class="line">        <span class="type">KrSmallWidget</span>()</span><br><span class="line">        <span class="type">KrMediumWidget</span>()</span><br><span class="line">        <span class="type">KrLargeWidget</span>()</span><br><span class="line">      	<span class="type">TestWidget</span>()<span class="comment">// å£°æ˜å¥½çš„å°ç»„ä»¶å¯ä»¥åœ¨WidgetBundleä¸‹ç›´æ¥åˆå§‹åŒ–</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶æˆ‘ä»¬å¯ä»¥å°†å…¥å£æ–¹æ³•æ ‡è®°æ”¹æˆ <code>WidgetBundle</code>æ¥é€‚åº”å¤šä¸ªå°ç»„ä»¶ï¼Œ<code>KrSmallWidget</code>ã€<code>KrMediumWidget</code>ã€<code>KrLargeWidget</code>ä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„å°ç»„ä»¶ï¼Œå…¶ç»“æ„å’Œ <code>TestWidget</code>ä¸€è‡´ã€‚</p>
<h4 id="æ‰€è§å³æ‰€å¾—-PreviewProvider"><a href="#æ‰€è§å³æ‰€å¾—-PreviewProvider" class="headerlink" title="æ‰€è§å³æ‰€å¾—   PreviewProvider"></a>æ‰€è§å³æ‰€å¾—   PreviewProvider</h4><p>å¦‚æœå¯¹ <code>swiftUI</code>æ¯”è¾ƒç†Ÿæ‚‰çš„èƒ–å‹å¯¹è¿™ä¸ªä¼šæ¯”è¾ƒç†Ÿæ‚‰ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">TestWidget_Previews</span>: <span class="title class_ inherited__">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">TestWidgetEntryView</span>(entry: <span class="type">SimpleEntry</span>(date: <span class="type">Date</span>()))</span><br><span class="line">            .previewContext(<span class="type">WidgetPreviewContext</span>(family: .systemSmall))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª <code>PreviewProvider</code>å¯ä»¥å‘¼å‡ºå®æ—¶é¢„è§ˆçš„é¡µé¢ï¼Œæ–¹ä¾¿æˆ‘ä»¬ç UIã€‚</p>
<p>å¯ä»¥ç‚¹ç¼–è¾‘å™¨å³è¾¹çš„resumeæŒ‰é’®è¿›è¡Œé¢„è§ˆ</p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnwfwkcrujj30il04f3yq.jpg"></p>
<p>ç»è¿‡buildå¯ä»¥çœ‹åˆ°é¢„è§ˆçš„ç»“æœï¼Œåœ¨ä½ ä»£ç æ”¹åŠ¨çš„æ—¶å€™ä¼šå®æ—¶å˜åŒ–ï¼Œååˆ†æ–¹ä¾¿ã€‚</p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnwfux3fiej31310ibn10.jpg"></p>
<p>ä¸å°å¿ƒæŠŠé¡µé¢å…³æ‰çš„è¯å¯ä»¥åœ¨å³ä¸Šè§’äº”æ¡æ¨ªçº¿æŒ‰é’®ä¸­æ‰¾åˆ° <code>Canvas</code>é€‰é¡¹å‹¾é€‰å³å¯ <code>(Xcode12)</code></p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnwfqmmkj4j305r06waag.jpg"></p>
<h4 id="APPå†…åˆ·æ–°å°ç»„ä»¶-WidgetCenter"><a href="#APPå†…åˆ·æ–°å°ç»„ä»¶-WidgetCenter" class="headerlink" title="APPå†…åˆ·æ–°å°ç»„ä»¶   WidgetCenter"></a>APPå†…åˆ·æ–°å°ç»„ä»¶   WidgetCenter</h4><p>å¦‚æœä½ éœ€è¦åœ¨ä¸»å·¥ç¨‹é‡Œå¹²é¢„å°ç»„ä»¶çš„åˆ·æ–°ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>WidgetCenterï¼ˆå•ä¾‹ï¼‰</code>ç±»æ¥è¿›è¡Œæ“ä½œã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// Reloads the timelines for all widgets of a particular kind.</span></span><br><span class="line"> <span class="comment">/// - Parameter kind: A string that identifies the widget and matches the</span></span><br><span class="line"> <span class="comment">///   value you used when you created the widget&#x27;s configuration.</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">reloadTimelines</span>(<span class="params">ofKind</span> <span class="params">kind</span>: <span class="type">String</span>)</span><br><span class="line"></span><br><span class="line"> <span class="comment">/// Reloads the timelines for all configured widgets belonging to the</span></span><br><span class="line"> <span class="comment">/// containing app.</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">func</span> <span class="title function_">reloadAllTimelines</span>()</span><br></pre></td></tr></table></figure>

<p>ä¸€èˆ¬ä½¿ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œæ¥å®ç°ä¸»APPå†…åˆ·æ–°å°ç»„ä»¶ã€‚</p>
<h4 id="ä¸ºå°ç»„ä»¶å¯ç”¨å®šä½"><a href="#ä¸ºå°ç»„ä»¶å¯ç”¨å®šä½" class="headerlink" title="ä¸ºå°ç»„ä»¶å¯ç”¨å®šä½"></a>ä¸ºå°ç»„ä»¶å¯ç”¨å®šä½</h4><p>ä¸€äº›å¤©æ°”ç±»å‹çš„å°ç»„ä»¶ç»å¸¸ä¼šè·å–å½“å‰çš„å®šä½ï¼Œå°ç»„ä»¶ä¸­å¦‚æœè¦è¯·æ±‚å®šä½ä¿¡æ¯ï¼Œéœ€è¦åœ¨å°ç»„ä»¶ç›®å½•ä¸‹çš„ <code>info.plist</code>æ–‡ä»¶ä¸­æ·»åŠ  <code>NSWidgetWantsLocation</code>å­—æ®µæ¥è¯·æ±‚æƒé™</p>
<p>æ›´å¤šå®šä½æƒé™ç›¸å…³çš„ä¿¡æ¯è¯·å‚è€ƒ<a href="https://developer.apple.com/documentation/widgetkit/accessing-location-information-in-widgets">ç»™ä½ çš„å°ç»„ä»¶æ·»åŠ å®šä½ä¿¡æ¯</a></p>
<h4 id="å’Œä¸»APPæ•°æ®å…±äº«"><a href="#å’Œä¸»APPæ•°æ®å…±äº«" class="headerlink" title="å’Œä¸»APPæ•°æ®å…±äº«"></a>å’Œä¸»APPæ•°æ®å…±äº«</h4><p>ç”±äºwidgetè·ŸAPPé—´ç›¸äº’ç‹¬ç«‹ï¼Œå¦‚æœæƒ³ç”¨ç›¸åŒçš„æ•°æ®åˆ™éœ€è¦ä¸¤è€…é—´æ•°æ®å…±äº«ï¼Œåˆ›å»º**<code>App Group</code>**<br>ä¸»APPä¸­  <code>Target</code> -&gt; <code>Signing &amp; Capability</code> -&gt; <code>+Capability</code> -&gt; <code>æ·»åŠ  App Group</code></p>
<p>ä¸è¿‡å¦‚æœå¼€å‘è€…è´¦å·å¼€å¯ <code>Automatically manage signing</code>çš„è¯è‹¹æœä¼šè‡ªåŠ¨ç»™ä½ åˆ›å»ºç›¸å…³è”çš„APPIDã€‚</p>
<p>ä¸¤è€…é—´çš„æ•°æ®å…±äº«ä¸»è¦é€šè¿‡**<code>UserDefaults</code><strong>å’Œ</strong> <code>FileManager</code>**ä¸¤ç§å½¢å¼ã€‚</p>
<h4 id="ç‚¹å‡»äº¤äº’å’Œè·³è½¬æ–¹å¼"><a href="#ç‚¹å‡»äº¤äº’å’Œè·³è½¬æ–¹å¼" class="headerlink" title="ç‚¹å‡»äº¤äº’å’Œè·³è½¬æ–¹å¼"></a>ç‚¹å‡»äº¤äº’å’Œè·³è½¬æ–¹å¼</h4><p>ç‚¹å‡»Widgetçª—å£å”¤èµ·APPè¿›è¡Œäº¤äº’æŒ‡å®šè·³è½¬æ”¯æŒä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li><code>.widgetURL</code>ï¼šç‚¹å‡»åŒºåŸŸæ˜¯Widgetçš„æ‰€æœ‰åŒºåŸŸï¼Œé€‚åˆå…ƒç´ ã€é€»è¾‘ç®€å•çš„å°éƒ¨ä»¶ï¼Œä¸€ä¸ªå°ç»„ä»¶åªèƒ½å“åº”ä¸€ä¸ª <code>widgetURL</code>ï¼Œå…¶ä¸­**<code>systemSmall</code>**ç±»å‹çš„å°ç»„ä»¶åªèƒ½ä½¿ç”¨æ­¤æ–¹å¼è¿›è¡Œè·³è½¬</li>
<li><code>Link</code>ï¼šé€šè¿‡Linkä¿®é¥°ï¼Œå…è®¸è®©ç•Œé¢ä¸Šä¸åŒå…ƒç´ äº§ç”Ÿç‚¹å‡»å“åº”ï¼Œä¸€ä¸ªå°ç»„ä»¶å¯ä»¥åŒ…å«å¤šä¸ª <code>Link</code></li>
</ul>
<p>ä»¥ä¸Šä¸¤ç§å°ç»„ä»¶é“¾æ¥ç‚¹å‡»åï¼Œå¯ä»¥åœ¨ä¸» <code>APP</code>ä¸­çš„ <code>APPDelegate</code>ç±»ä¸­è¿›è¡Œå“åº”</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">application</span>(<span class="keyword">_</span> <span class="params">app</span>: <span class="type">UIApplication</span>, <span class="params">open</span> <span class="params">url</span>: <span class="type">URL</span>, <span class="params">options</span>: [<span class="type">UIApplication</span>.<span class="params">OpenURLOptionsKey</span> : <span class="keyword">Any</span>] <span class="operator">=</span> [:]) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">  		 <span class="comment">// ä¸€èˆ¬ä¸ºå°ç»„ä»¶é“¾æ¥å®šä¹‰ç‰¹æ®Šçš„hostè¿›è¡ŒåŒºåˆ†</span></span><br><span class="line">       <span class="keyword">if</span> url.host <span class="operator">==</span> <span class="type">WidgetExtensionHost</span> &#123;</span><br><span class="line">         <span class="comment">//å¤„ç†å°ç»„ä»¶ç‚¹å‡»äº‹ä»¶æº</span></span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ <code>APP</code>å†…åšäº†åˆ‡å±é€‚é…ï¼Œå®ç°äº† <code>SceneDelegate</code>åˆ™éœ€è¦åœ¨ <code>SceneDelegate</code>é‡Œé¢å®ç°è·³è½¬å¤„ç†</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">scene</span>(<span class="keyword">_</span> <span class="params">scene</span>: <span class="type">UIScene</span>, <span class="params">openURLContexts</span> <span class="params">URLContexts</span>: <span class="type">Set</span>&lt;<span class="type">UIOpenURLContext</span>&gt;) &#123;</span><br><span class="line">    <span class="keyword">for</span> context <span class="keyword">in</span> <span class="type">URLContexts</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(context.url)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è°ƒè¯•å°ç»„ä»¶"><a href="#è°ƒè¯•å°ç»„ä»¶" class="headerlink" title="è°ƒè¯•å°ç»„ä»¶"></a>è°ƒè¯•å°ç»„ä»¶</h4><p>å¼€å‘çš„è¿‡ç¨‹ä¸­æ€»æ˜¯å……æ»¡äº†ä¸ç¡®å®šæ€§ï¼Œä¸€äº›ä¸œè¥¿éœ€è¦æ–­ç‚¹è¿›è¡Œè°ƒè¯•ã€‚é‚£ä¹ˆé’ˆå¯¹å°ç»„ä»¶å¦‚ä½•è°ƒè¯•ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œå®‰è£…APPä¹‹åæŠŠ <code>Scheme</code>ä¿®æ”¹ä¸ºæˆ‘ä»¬çš„ <code>WidgetExtension</code>ï¼Œé€‰æ‹©æµ‹è¯•æœºï¼Œç„¶åè¿è¡Œï¼Œåœ¨æ‰‹æœºä¸Šæ·»åŠ å°ç»„ä»¶åå³å¯çœ‹åˆ°ä»£ç è¿›å…¥æ–­ç‚¹ã€‚</p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnwg0oh85cj30iw06ljsr.jpg"></p>
<h4 id="æœºå‹é€‚é…"><a href="#æœºå‹é€‚é…" class="headerlink" title="æœºå‹é€‚é…"></a>æœºå‹é€‚é…</h4><p><img src="https://cdn.zcx.info/008eGmZEly1gnwgzuiadlj30rh09g751.jpg"></p>
<p>ä¸åŒçš„è®¾å¤‡å°ºå¯¸æ‰€æ‹¥æœ‰çš„å°ç»„ä»¶çš„å°ºå¯¸ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œç›®å‰ï¼ˆiPhone12æ—¶ä»£ï¼‰å°ç»„ä»¶æœ‰ä»¥ä¸Šå‡ ç§å°ºå¯¸ã€‚</p>
<p>åœ¨è®¾è®¡ç•Œé¢çš„æ—¶å€™å’Œå¸ƒå±€æ—¶éœ€è¦è€ƒè™‘ä¸åŒå¤§å°çš„åŒºåŸŸçš„å¸ƒå±€åŒºåˆ«ã€‚</p>
<p>å®˜æ–¹å»ºè®®ä¿è¯å¤§çš„ç»„ä»¶çœ‹èµ·æ¥æ¯”è¾ƒå¥½ï¼Œå…¶ä»–å°ºå¯¸çš„å°ç»„ä»¶æ ¹æ®å¤§å°ºå¯¸çš„è¿›è¡Œå¾®è°ƒã€‚ï¼ˆæ¯•ç«Ÿå±å¹•ä¸€å¤©æ¯”ä¸€å¤©å¤§ï¼‰</p>
<h4 id="æš—é»‘æ¨¡å¼"><a href="#æš—é»‘æ¨¡å¼" class="headerlink" title="æš—é»‘æ¨¡å¼"></a>æš—é»‘æ¨¡å¼</h4><p>å¼€å‘è¿‡ç¨‹ä¸­æœ‰é‡åˆ°ä½¿ç”¨åŒæ¨¡å¼çš„å›¾ç‰‡ç´ ææ—¶ï¼Œæ‰‹æœºåˆ‡æ¢æš—é»‘æ¨¡å¼åé¡µé¢çš„å›¾æ ‡é…å›¾æ²¡æœ‰åŠæ—¶æ›´æ–°ã€‚æ€»è§‰çš„ç›®å‰å°ç»„ä»¶è¿˜æœ‰è®¸å¤šé—®é¢˜ï¼Œä¸æ˜¯å¾ˆå®Œå–„ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆä¸ºä½¿ç”¨å•æ¨¡å¼çš„å›¾ï¼Œä½¿ç”¨ä¸¤å¥—å›¾è¿›è¡Œæ ¹æ®ç¯å¢ƒåˆ‡æ¢ã€‚</p>
<p>swiftUIä¸­ä½¿ç”¨ColorSchemeåˆ¤æ–­æš—é»‘æ¨¡å¼</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Environment</span>(\.colorScheme) <span class="keyword">var</span> colorScheme: <span class="type">ColorScheme</span></span><br><span class="line"><span class="comment">//æ ¹æ®ä¸åŒæ¨¡å¼å¡«å……ä¸åŒé¢œè‰²</span></span><br><span class="line"><span class="type">Rectangle</span>().fill(<span class="type">Color</span>(colorScheme <span class="operator">==</span> .dark <span class="operator">?</span> <span class="type">UIColor</span>(hex: <span class="number">0x262626</span>) <span class="operator">??</span> <span class="type">UIColor</span>.black : .white))</span><br></pre></td></tr></table></figure>

<h4 id="ç½‘ç»œè¯·æ±‚"><a href="#ç½‘ç»œè¯·æ±‚" class="headerlink" title="ç½‘ç»œè¯·æ±‚"></a>ç½‘ç»œè¯·æ±‚</h4><p>å¦‚æœä¸»é¡¹ç›®æ˜¯ä½¿ç”¨swiftè¿›è¡Œå¼€å‘çš„ï¼Œå¯ä»¥å°†å¯¹åº”çš„ç½‘ç»œè¯·æ±‚åº“åˆ†äº«åˆ°å°ç»„ä»¶çš„targetè¿›è¡Œä½¿ç”¨ã€‚åœ¨å¯¹åº”çš„ç±»æ–‡ä»¶çš„Target Membershipé€‰é¡¹å‹¾é€‰å°ç»„ä»¶targetå³å¯ã€‚</p>
<p><img src="https://cdn.zcx.info/008eGmZEly1gnwha6k9wsj30970g3dgy.jpg"></p>
<p>ä½†æ˜¯ä¸€èˆ¬ä¸»é¡¹ç›®ä¸­çš„ç½‘ç»œæ¡†æ¶å¾€å¾€ä¼šå¤¹æ‚å¾ˆå¤šå®šåˆ¶åŒ–çš„æ’ä»¶æˆ–å…¶ä»–éœ€æ±‚ï¼Œè¿™ä¹ˆåˆ†äº«ä¼šä½¿é¡¹ç›®å·¥ç¨‹ä»£ç ä¾èµ–ååˆ†æ··ä¹±ã€‚</p>
<p>å°ç»„ä»¶ä¸­è¦ä½¿ç”¨çš„æ¥å£æœåŠ¡ä¸ä¼šå¾ˆå¤šï¼Œæ‰€ä»¥æˆ‘å»ºè®®è¿™é‡Œä½¿ç”¨ç®€å•çš„ç½‘ç»œè¯·æ±‚å³å¯ã€‚</p>
<p>å½“ç„¶ç”±äºwidgetç±»ä¼¼äºtodayExtensionï¼Œè¿™é‡Œå¯ä»¥å’ŒtodayExtensionçš„ç½‘ç»œè¯·æ±‚ç­–ç•¥ä¿æŒä¸€è‡´ã€‚</p>
<h4 id="ç½‘ç»œå›¾ç‰‡"><a href="#ç½‘ç»œå›¾ç‰‡" class="headerlink" title="ç½‘ç»œå›¾ç‰‡"></a>ç½‘ç»œå›¾ç‰‡</h4><p>SwiftUIä¸­çš„Imageæ²¡æœ‰æä¾›ç›´æ¥åŠ è½½URLæ–¹å¼çš„å›¾ç‰‡æ˜¾ç¤ºã€‚åœ¨ <code>getTimeline</code>ä¸­è¿›è¡Œæ•°æ®è¯·æ±‚ä¸­ <code>completion(timeline)</code>æ‰§è¡Œå®Œä¹‹åï¼Œä¸å†æ”¯æŒå›¾ç‰‡çš„å¼‚æ­¥å›è°ƒï¼Œç”¨å¼‚æ­¥åŠ è½½çš„æ–¹å¼å°±æ— æ³•åŠ è½½ç½‘ç»œå›¾ç‰‡ï¼Œæ‰€ä»¥å¿…é¡»åœ¨æ•°æ®è¯·æ±‚å›æ¥çš„å¤„ç†ä¸­é‡‡ç”¨<strong>åŒæ­¥æ–¹å¼</strong>ï¼Œå°†å›¾ç‰‡çš„dataè·å–ï¼Œè½¬æ¢æˆUIImageï¼Œå†èµ‹å€¼ç»™Imageå±•ç¤º</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">KrBaseWidgetEntity</span>: <span class="title class_ inherited__">Mappable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> itemId: <span class="type">Int</span>?</span><br><span class="line">    <span class="keyword">var</span> itemType: <span class="type">Int</span>?</span><br><span class="line">    <span class="keyword">var</span> widgetTitle: <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">var</span> widgetImageURL: <span class="type">URL</span>?</span><br><span class="line">    <span class="keyword">var</span> widgetImage: <span class="type">UIImage</span>?</span><br><span class="line">    <span class="keyword">var</span> route: <span class="type">String</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init?</span>(<span class="params">map</span>: <span class="type">Map</span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">mutating</span> <span class="keyword">func</span> <span class="title function_">mapping</span>(<span class="params">map</span>: <span class="type">Map</span>) &#123;</span><br><span class="line">        itemId <span class="operator">&lt;-</span> map[<span class="string">&quot;itemId&quot;</span>]</span><br><span class="line">        itemType <span class="operator">&lt;-</span> map[<span class="string">&quot;itemType&quot;</span>]</span><br><span class="line">        widgetTitle <span class="operator">&lt;-</span> map[<span class="string">&quot;widgetTitle&quot;</span>]</span><br><span class="line">        widgetImageURL <span class="operator">&lt;-</span> (map[<span class="string">&quot;widgetImage&quot;</span>], <span class="type">CustomURLTransform</span>())</span><br><span class="line">        route <span class="operator">&lt;-</span> map[<span class="string">&quot;route&quot;</span>]</span><br><span class="line">      	<span class="comment">//è·å–åˆ°å›¾ç‰‡åœ°å€åç›´æ¥åŒæ­¥è·å–å›¾ç‰‡æ•°æ®è½¬æ¢ä¸ºUIImageç„¶ååœ¨Viewé‡Œé¢è½¬æ¢ä¸ºImageæ˜¾ç¤º</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> url <span class="operator">=</span>  widgetImageURL,<span class="keyword">let</span> img <span class="operator">=</span> <span class="keyword">try?</span> <span class="type">Data</span>(contentsOf: url) &#123;</span><br><span class="line">            widgetImage <span class="operator">=</span> <span class="type">UIImage</span>(data: img)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">id</span>: <span class="type">Int</span>, <span class="params">img</span>: <span class="type">UIImage</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.itemId <span class="operator">=</span> id</span><br><span class="line">        <span class="keyword">self</span>.itemType <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">self</span>.widgetTitle <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">self</span>.widgetImage <span class="operator">=</span> img</span><br><span class="line">        <span class="keyword">self</span>.route <span class="operator">=</span> defultRoute</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="åŸ‹ç‚¹ä¼ å€¼"><a href="#åŸ‹ç‚¹ä¼ å€¼" class="headerlink" title="åŸ‹ç‚¹ä¼ å€¼"></a>åŸ‹ç‚¹ä¼ å€¼</h4><p>å°ç»„ä»¶ä¸­åŸ‹ç‚¹ä¸å®œè®¾è®¡è¿‡äºå¤æ‚ï¼Œå› ä¸ºå°ç»„ä»¶èƒ½å¤Ÿä¸€ç›´åœ¨æ“ä½œç³»ç»Ÿç•Œé¢ä¸Šç•™å­˜ï¼Œä½†æ˜¯ä¸»APPå´ä¸ä¸€å®šï¼Œéœ€è¦ä¼ é€’åŸ‹ç‚¹çš„æ—¶å€™åªèƒ½åœ¨ç‚¹å‡»äº‹ä»¶ä¼ é€’çš„URLä¸­é™„å¸¦åŸ‹ç‚¹å€¼ç„¶ååœ¨APPå†…æ¥æ”¶å’Œå¤„ç†çš„æ—¶å€™å†æå–å›ºå®šçš„åŸ‹ç‚¹å­—æ®µã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç›®å‰æœ‰ä¸€ä¸ªè‡ªå®šä¹‰çš„åŸ‹ç‚¹ä¼ å€¼ ç±»ä¼¼&quot;media_event_value=click_mor_and_eve_widget&quot;</span></span><br><span class="line"><span class="keyword">let</span> routeStr <span class="operator">=</span> route <span class="operator">??</span> defultRoute</span><br><span class="line">  <span class="keyword">var</span> pathURL <span class="operator">=</span>  <span class="type">URL</span>(string: <span class="string">&quot;TestWidget://<span class="subst">\(widgetHost)</span>?<span class="subst">\(routeStr)</span>&quot;</span>)<span class="operator">!</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">let</span> trackStr <span class="operator">=</span> track &#123;</span><br><span class="line">      pathURL <span class="operator">=</span>  <span class="type">URL</span>(string: <span class="string">&quot;TestWidget://<span class="subst">\(widgetHost)</span>?<span class="subst">\(routeStr)</span>&amp;<span class="subst">\(trackStr)</span>&quot;</span>)<span class="operator">!</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Widgetè¸©å‘"><a href="#Widgetè¸©å‘" class="headerlink" title="Widgetè¸©å‘"></a>Widgetè¸©å‘</h3><h4 id="å¼ºåˆ¶ä½¿ç”¨SwiftUI"><a href="#å¼ºåˆ¶ä½¿ç”¨SwiftUI" class="headerlink" title="å¼ºåˆ¶ä½¿ç”¨SwiftUI"></a>å¼ºåˆ¶ä½¿ç”¨SwiftUI</h4><p>è¿™æ¬¡çš„å°ç»„ä»¶æ›´æ–°å¼ºåˆ¶ä½¿ç”¨SwiftUIå¯ä»¥çœ‹åˆ°è‹¹æœçš„ç›®æ ‡å’Œæ€åº¦ã€‚å¯¹è¿™ä¸ªUIåº“ä¸ç†Ÿçš„è¯å¼€å‘èµ·æ¥è¿˜æ˜¯æœ‰ç‚¹å›°éš¾ï¼Œä¸è¿‡æ­£å¥½ä¹Ÿå¯ä»¥é€šè¿‡Widgetå¯¹swiftUIè¿›è¡Œä¸€æ¬¡å®æˆ˜è®­ç»ƒã€‚</p>
<h4 id="å¶ç°ç¬¬ä¸€æ¬¡æ·»åŠ å°ç»„ä»¶åˆ°æ¡Œé¢UIæ¸²æŸ“å¤±è´¥-ç³»ç»Ÿä¸è°ƒç”¨getTimeLine"><a href="#å¶ç°ç¬¬ä¸€æ¬¡æ·»åŠ å°ç»„ä»¶åˆ°æ¡Œé¢UIæ¸²æŸ“å¤±è´¥-ç³»ç»Ÿä¸è°ƒç”¨getTimeLine" class="headerlink" title="å¶ç°ç¬¬ä¸€æ¬¡æ·»åŠ å°ç»„ä»¶åˆ°æ¡Œé¢UIæ¸²æŸ“å¤±è´¥(ç³»ç»Ÿä¸è°ƒç”¨getTimeLine)"></a>å¶ç°ç¬¬ä¸€æ¬¡æ·»åŠ å°ç»„ä»¶åˆ°æ¡Œé¢UIæ¸²æŸ“å¤±è´¥(ç³»ç»Ÿä¸è°ƒç”¨getTimeLine)</h4><p>æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°çš„ä¸€ä¸ªé—®é¢˜</p>
<p>APPç¬¬ä¸€æ¬¡å®‰è£…ï¼Œç¬¬ä¸€æ¬¡æ·»åŠ å°ç»„ä»¶çš„çš„æ—¶å€™ï¼Œå¦‚æœä¸ç­‰å¾…å°ç»„ä»¶é¢„è§ˆæ¸²æŸ“å®Œæˆå°±ç›´æ¥ç‚¹ <code>æ·»åŠ åˆ°æ¡Œé¢</code>ä¼šè§¦å‘åˆå§‹åŒ–å¤±è´¥é—®é¢˜</p>
<p>æ–­ç‚¹è°ƒè¯•å‘ç°è¿™ä¸ªæ—¶å€™æ“ä½œç³»ç»Ÿä¸è°ƒç”¨ï¼ˆæœ‰æ—¶å€™ä¼šç­‰å¾ˆä¹…æ‰è°ƒè²Œä¼¼æ˜¯çº¿ç¨‹è¢«é˜»å¡äº†ï¼‰<code>getTimeLine</code>æ–¹æ³•ï¼Œå¯¼è‡´é¡µé¢åŠ è½½ä¸æˆåŠŸï¼Œç”±äºtimelineè·å–å¤±è´¥ï¼Œå…¶åç»­çš„åˆ·æ–°æ—¶é—´ç‚¹ä¹Ÿæ²¡æ³•ç¡®å®šï¼Œåˆ™æœ€åå…¨éƒ¨éƒ½ä¸èƒ½åˆ·æ–°ã€‚</p>
<h4 id="åˆ·æ–°ä¸åŠæ—¶"><a href="#åˆ·æ–°ä¸åŠæ—¶" class="headerlink" title="åˆ·æ–°ä¸åŠæ—¶"></a>åˆ·æ–°ä¸åŠæ—¶</h4><p>è‡ªå·±ä½¿ç”¨çš„ä¸€äº›å…¶ä»–å®¶çš„å°ç»„ä»¶ï¼Œä¾‹å¦‚ä¸Šæ–‡æåˆ°çš„æ—¥å†ï¼Œå¶å°”èƒ½çœ‹åˆ°å°ç»„ä»¶ä¸Šè¿˜ä¿æŒç€æ˜¨å¤©çš„æ—¥æœŸï¼Œè¿™è®©æˆ‘æ„Ÿè§‰ä½“éªŒå¾ˆå·®ã€‚</p>
<p>è¿™ä¸ªæ–°å…´äº‹ç‰©è¿˜æœ‰å¾…ä¼˜åŒ–å‘€ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>å°ç»„ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title>runloop å­¦ä¹ ç¬”è®°</title>
    <url>/2020/09/25/runloop/</url>
    <content><![CDATA[<h3 id="ä»ä¸€ä¸ªé—®é¢˜å¼€å§‹"><a href="#ä»ä¸€ä¸ªé—®é¢˜å¼€å§‹" class="headerlink" title="ä»ä¸€ä¸ªé—®é¢˜å¼€å§‹"></a>ä»ä¸€ä¸ªé—®é¢˜å¼€å§‹</h3><p>Runloop å’Œçº¿ç¨‹æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</p>
<p><code>Runloop</code> å’Œ <code>çº¿ç¨‹</code>æ˜¯å¯†ä¸å¯åˆ†çš„ï¼Œå¯ä»¥è¯´Runloopæ˜¯ä¸ºçº¿ç¨‹è€Œç”Ÿçš„ã€‚çº¿ç¨‹å’Œrunloopæ˜¯<code>ä¸€ä¸€å¯¹åº”çš„</code>ï¼Œæˆ‘ä»¬åªå¯ä»¥åœ¨å½“å‰çº¿ç¨‹å†…æ“æ§å½“å‰çº¿ç¨‹å¯¹åº”çš„Runloopã€‚</p>
<p>Runloopæ˜¯æ‡’åŠ è½½çš„åœ¨çº¿ç¨‹<code>ç¬¬ä¸€æ¬¡</code>è·å–ä»–çš„æ—¶å€™åˆ›å»ºï¼Œåœ¨çº¿ç¨‹<code>ç»“æŸ</code>çš„æ—¶å€™é”€æ¯ã€‚</p>
<p>ä¸»çº¿ç¨‹çš„runloopæ˜¯é»˜è®¤å¯åŠ¨çš„ï¼Œå› ä¸ºä¸»çº¿ç¨‹éœ€è¦ä¸€ç›´ç›‘å¬äº‹ä»¶ã€‚å­çº¿ç¨‹çš„Runloopé»˜è®¤æ˜¯ä¸å¯åŠ¨çš„ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯å¾ªç¯ã€‚</p>
<h3 id="Runloop-çš„ä½œç”¨ï¼Ÿ"><a href="#Runloop-çš„ä½œç”¨ï¼Ÿ" class="headerlink" title="Runloop çš„ä½œç”¨ï¼Ÿ"></a>Runloop çš„ä½œç”¨ï¼Ÿ</h3><p>ä¿æŒç¨‹åºçš„è¿è¡Œï¼Œä¸»çº¿ç¨‹çš„runloopä½¿å¾—APPä¸ä¼šé€€å‡º</p>
<p>å“åº”å¹¶å¤„ç†APPä¸­çš„äº‹ä»¶ï¼Œç”¨æˆ·äº¤äº’ã€å®šæ—¶ä»»åŠ¡ç­‰</p>
<p>èŠ‚çœcpuèµ„æºï¼ŒæŒ‰éœ€è¿è¡Œï¼Œæå‡ç¨‹åºæ€§èƒ½</p>
<h3 id="Runloopçš„è¿è¡Œè¿‡ç¨‹"><a href="#Runloopçš„è¿è¡Œè¿‡ç¨‹" class="headerlink" title="Runloopçš„è¿è¡Œè¿‡ç¨‹"></a>Runloopçš„è¿è¡Œè¿‡ç¨‹</h3><p>Run Loopæœ¬è´¨æ˜¯ä¸€ä¸ªå¤„ç†äº‹ä»¶æºçš„å¾ªç¯ã€‚æˆ‘ä»¬å¯¹Run Loopçš„è¿è¡Œæ—¶å…·æœ‰æ§åˆ¶æƒï¼Œå¦‚æœå½“å‰æ²¡æœ‰æ—¶é—´å‘ç”Ÿï¼ŒRun Loopä¼šè®©å½“å‰çº¿ç¨‹è¿›å…¥ç¡çœ æ¨¡å¼ï¼Œæ¥å‡è½»CPUå‹åŠ›ã€‚å¦‚æœæœ‰äº‹ä»¶å‘ç”Ÿï¼ŒRun Loopå°±å¤„ç†äº‹ä»¶å¹¶é€šçŸ¥ç›¸å…³çš„Observerã€‚å…·ä½“çš„é¡ºåºå¦‚ä¸‹:</p>
<ol>
<li><p>Run Loopè¿›å…¥çš„æ—¶å€™ï¼Œä¼šé€šçŸ¥Observer</p>
</li>
<li><p>Timerå³å°†è¢«è§¦å‘æ—¶ï¼Œä¼šé€šçŸ¥Observer</p>
</li>
<li><p>æœ‰å…¶å®ƒéPort-Based Input Sourceå³å°†è¢«è§¦å‘æ—¶ï¼Œä¼šé€šçŸ¥Observer</p>
</li>
<li><p>å¯åŠ¨éPort-Based Input Sourceçš„äº‹ä»¶æº</p>
</li>
<li><p>å¦‚æœåŸºäºPortçš„Input Sourceäº‹ä»¶æºå³å°†è§¦å‘æ—¶ï¼Œç«‹å³å¤„ç†è¯¥äº‹ä»¶ï¼Œå¹¶è·³è½¬åˆ°9</p>
</li>
<li><p>é€šçŸ¥Observerå½“å‰çº¿ç¨‹è¿›å…¥ç¡çœ çŠ¶æ€</p>
</li>
<li><p>å°†çº¿ç¨‹ç½®å…¥ç¡çœ çŠ¶æ€ç›´åˆ°æœ‰ä»¥ä¸‹äº‹ä»¶å‘ç”Ÿï¼š1. Port-Based Input Sourceè¢«è§¦å‘ã€‚2.Timerè¢«è§¦å‘ã€‚ 3.Run Loopè®¾ç½®çš„æ—¶é—´å·²ç»è¶…æ—¶ã€‚ 4.Run Loopè¢«æ˜¾å¼å”¤é†’ã€‚</p>
</li>
<li><p>é€šçŸ¥Observerçº¿ç¨‹å°†è¦è¢«å”¤é†’</p>
</li>
<li><p>å¤„ç†è¢«è§¦å‘çš„äº‹ä»¶ï¼š1. å¦‚æœæ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„Timerï¼Œå¤„ç†Timeräº‹ä»¶åé‡å¯Run Loopå¹¶ç›´æ¥è¿›å…¥æ­¥éª¤2ã€‚ 2.å¦‚æœçº¿ç¨‹è¢«æ˜¾ç¤ºå”¤é†’åˆæ²¡æœ‰è¶…æ—¶ï¼Œé‚£ä¹ˆè¿›å…¥æ­¥éª¤2ã€‚ 3.å¦‚æœæ˜¯å…¶ä»–Input Sourceäº‹ä»¶æºæœ‰äº‹ä»¶å‘ç”Ÿï¼Œç›´æ¥ä¼ é€’è¿™ä¸ªæ¶ˆæ¯ã€‚</p>
</li>
<li><p>é€šçŸ¥Observer Run Loopç»“æŸï¼ŒRun Loopé€€å‡ºã€‚</p>
</li>
</ol>
<h3 id="Runloopçš„mode"><a href="#Runloopçš„mode" class="headerlink" title="Runloopçš„mode"></a>Runloopçš„mode</h3><p>runloopæœ‰ä¸‹å¯ä»¥æœ‰å¤šä¸ªæ¨¡å¼ï¼Œä½†æ˜¯åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªæ¨¡å¼åœ¨è¿è¡Œï¼›</p>
<p>å¸¸ç”¨çš„æ¨¡å¼æœ‰ä»¥ä¸‹3ç§:</p>
<ol>
<li><p>NSDefaultRunLoopMode: å¤§å¤šæ•°å·¥ä½œä¸­é»˜è®¤çš„è¿è¡Œæ–¹å¼ã€‚</p>
</li>
<li><p>UITrackingRunLoopMode: ä½¿ç”¨è¿™ä¸ªModeå»è·Ÿè¸ªæ¥è‡ªç”¨æˆ·äº¤äº’çš„äº‹ä»¶ï¼ˆæ¯”å¦‚UITableViewä¸Šä¸‹æ»‘åŠ¨ï¼‰ã€‚</p>
</li>
<li><p>NSRunLoopCommonModes: è¿™æ˜¯ä¸€ä¸ªä¼ªæ¨¡å¼ï¼Œå…¶ä¸ºä¸€ç»„run loop modeçš„é›†åˆã€‚å¦‚æœå°†Input sourceåŠ å…¥æ­¤æ¨¡å¼ï¼Œæ„å‘³ç€å…³è”Input sourceåˆ°Common Modesä¸­åŒ…å«çš„æ‰€æœ‰æ¨¡å¼ä¸‹ã€‚åœ¨iOSç³»ç»Ÿä¸­NSRunLoopCommonModeåŒ…å«NSDefaultRunLoopModeã€UITrackingRunLoopMode.</p>
</li>
</ol>
<p>runloopè¿è¡Œåœ¨æŸä¸€æŒ‡å®šæ¨¡å¼ä¸‹ï¼Œå°±æ„å‘³ç€inputæºæˆ–è€…timeæºåªèƒ½åœ¨è¯¥æ¨¡å¼ä¸‹è¿è¡Œ</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>iOS å¦‚ä½•åšä¸€ä¸ªä¹å®«æ ¼GIFæ’­æ”¾å™¨</title>
    <url>/2021/12/06/%E4%BF%A1%E6%81%AF%E6%B5%81GIF%E8%BD%AE%E6%92%AD%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[<h1 id="å¦‚ä½•åšä¸€ä¸ªä¹å®«æ ¼GIFæ’­æ”¾å™¨"><a href="#å¦‚ä½•åšä¸€ä¸ªä¹å®«æ ¼GIFæ’­æ”¾å™¨" class="headerlink" title="å¦‚ä½•åšä¸€ä¸ªä¹å®«æ ¼GIFæ’­æ”¾å™¨"></a>å¦‚ä½•åšä¸€ä¸ªä¹å®«æ ¼GIFæ’­æ”¾å™¨</h1><h2 id="éœ€æ±‚èƒŒæ™¯"><a href="#éœ€æ±‚èƒŒæ™¯" class="headerlink" title="éœ€æ±‚èƒŒæ™¯"></a>éœ€æ±‚èƒŒæ™¯</h2><p>APP V9.4.0ç‰ˆæœ¬ä¸Šçº¿äº†ç±»ä¼¼æœ‹å‹åœˆçš„åŠ¨æ€ï¼ŒåŒ…å«æ–‡å­—åŠæœ€å¤š9å¼ å›¾ç‰‡ã€‚</p>
<p>åŠ¨æ€2æœŸå†…å®¹ä¸­ä¹å®«æ ¼å›¾ç‰‡å†…è¿½åŠ äº†GIFæ ¼å¼çš„å›¾ç‰‡ï¼Œå¹¶è¦æ±‚å¤šå¼ GIFå›¾ç‰‡åœ¨ä¹å®«æ ¼å†…å¾ªç¯æ’­æ”¾ï¼Œä¸”ä¼˜å…ˆæ’­æ”¾ä¿¡æ¯æµå†…ç¬¬ä¸€ä¸ªåŠ¨æ€ä¸­åŒ…å«çš„GIFå›¾ç‰‡ã€‚å¯å‚è€ƒå¾®åšä¿¡æ¯æµå†…GIFç»„çš„æ’­æ”¾è¡¨ç°ã€‚</p>
<h2 id="æŠ€æœ¯å®ç°"><a href="#æŠ€æœ¯å®ç°" class="headerlink" title="æŠ€æœ¯å®ç°"></a>æŠ€æœ¯å®ç°</h2><h3 id="GIFæ’­æ”¾"><a href="#GIFæ’­æ”¾" class="headerlink" title="GIFæ’­æ”¾"></a>GIFæ’­æ”¾</h3><p>GIFå›¾æ˜¯åŒ…å«è‹¥å¹²å¸§å›¾ç‰‡çš„å›¾ç‰‡ç»„ï¼Œç”±äºé˜¿é‡Œäº‘å­˜å‚¨æˆ–è€…å…¶ä»–å­˜å‚¨å®¹å™¨ä¸­çš„æ–‡ä»¶ç‰¹å¾ï¼Œè®¸å¤šå›¾ç‰‡è·¯å¾„å¹¶ä¸å¸¦.gifæˆ–.GIFçš„åç¼€ï¼Œæ‰€ä»¥ä¸èƒ½ä»…é€šè¿‡æ¯”å¯¹æ–‡ä»¶åæ¥è¯†åˆ«GIFå›¾ã€‚è€Œé€šè¿‡<strong>äºŒè¿›åˆ¶æ•°æ®</strong>ä¸­æ¥æ ‡è®°å…¶æ–‡ä»¶ç±»å‹çš„å›ºå®šçš„<strong>ä½ç‰¹å¾</strong>æ¥åŒºåˆ†è¾ƒä¸ºå‡†ç¡®ã€‚</p>
<p>ç›®å‰æˆ‘ä»¬é¡¹ç›®ä¸­é›†æˆäº†ä¼˜ç§€çš„å¼€æºç½‘ç»œå›¾ç‰‡æ¡†æ¶ <code>&#39;Kingfisher&#39;</code>ï¼Œå…¶ä¸­åŒ…å«çš„ <code>AnimatedImageView</code>ç±»èƒ½æœ‰æ•ˆè¯†åˆ«GIFæ–‡ä»¶ç±»å‹å’Œå®ç°ç²¾ç»†çš„æ’­æ”¾æ§åˆ¶ï¼Œä¸”ä½¿ç”¨æ–¹ä¾¿ï¼Œä»…éœ€è¦ç»™å›¾ç‰‡viewè®¾ç½®ç½‘ç»œå›¾ç‰‡çš„URLã€‚</p>
<h3 id="å›¾ç‰‡å¯¹é½æ–¹å¼"><a href="#å›¾ç‰‡å¯¹é½æ–¹å¼" class="headerlink" title="å›¾ç‰‡å¯¹é½æ–¹å¼"></a>å›¾ç‰‡å¯¹é½æ–¹å¼</h3><p>éœ€æ±‚ä¸­åŒæ—¶éœ€è¦æ”¯æŒå›¾ç‰‡è®¾ç½®é¡¶éƒ¨å¯¹é½è£å‰ªå’Œå·¦éƒ¨å¯¹é½è£å‰ªï¼Œ1æœŸé¡¹ç›®ä¸­ <code>KrShortContentImageView</code>ç±»å·²ä½¿ç”¨ <code>UIImageViewAlignmentMask</code>æ¥å®ç°æ­¤éœ€æ±‚ã€‚</p>
<p><code>UIImageViewAlignmentMask</code>çš„å®ç°åŸç†ä¸ºè¦æ˜¾ç¤ºçš„å›¾ç‰‡Viewçš„å¤–å±‚åµŒå¥—ä¸€ä¸ªâ€ç›¸æ¡†â€å®¹å™¨Viewï¼Œå›¾ç‰‡Viewæ ¹æ®åŸå›¾çš„æ¯”ä¾‹æ¥è¿›è¡Œç­‰æ¯”ä¾‹ç¼©æ”¾ï¼Œå†æ ¹æ®å¯¹é½æ–¹å¼ä½¿ç”¨â€œç›¸æ¡†â€æ¥è£å‰ªï¼Œä»è€Œåšåˆ°é¡¶éƒ¨å¯¹é½æˆ–è€…å·¦éƒ¨å¯¹é½çš„è§†è§‰æ•ˆæœã€‚</p>
<p>GIFå›¾ç‰‡åŒæ—¶æ»¡è¶³æ­¤å¯¹é½æ–¹å¼çš„éœ€æ±‚ï¼Œæ‰€ä»¥åªè¦æŠŠå†…éƒ¨çš„å›¾ç‰‡Viewæ›¿æ¢ä¸ºæ”¯æŒGIFæ’­æ”¾çš„ <code>AnimatedImageView</code>å³å¯ã€‚</p>
<h3 id="æ’­æ”¾æ§åˆ¶"><a href="#æ’­æ”¾æ§åˆ¶" class="headerlink" title="æ’­æ”¾æ§åˆ¶"></a>æ’­æ”¾æ§åˆ¶</h3><h4 id="é¡ºåºæ’­æ”¾ä¸å¾ªç¯æ’­æ”¾"><a href="#é¡ºåºæ’­æ”¾ä¸å¾ªç¯æ’­æ”¾" class="headerlink" title="é¡ºåºæ’­æ”¾ä¸å¾ªç¯æ’­æ”¾"></a>é¡ºåºæ’­æ”¾ä¸å¾ªç¯æ’­æ”¾</h4><p><code>AnimatedImageView</code>é»˜è®¤è‡ªåŠ¨æ’­æ”¾GIFï¼Œä¸æˆ‘ä»¬çš„éœ€æ±‚ä¸ç¬¦åˆï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å…³é—­å…¶è‡ªåŠ¨æ’­æ”¾åŠŸèƒ½æ”¹ä¸ºæ‰‹åŠ¨æ§åˆ¶æ’­æ”¾åˆ—è¡¨çš„é¡ºåºæ’­æ”¾å’Œæ•´ä½“å¾ªç¯æ’­æ”¾ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">var</span> realImageView <span class="operator">=</span> <span class="type">AnimatedImageView</span>().then &#123; img <span class="keyword">in</span></span><br><span class="line">    img.autoPlayAnimatedImage <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    img.contentMode <span class="operator">=</span> .scaleAspectFill</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¡ºå…¶è‡ªç„¶çš„æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>KrShortContentImageView</code>æ•°ç»„ä½œä¸ºæ’­æ”¾åˆ—è¡¨ï¼Œæ•°ç»„ä¸­ä¿å­˜çš„æ¯ä¸€ä¸ªviewéƒ½å¯ä»¥è§†ä¸ºä¸€ä¸ªæ’­æ”¾å™¨æ¥ä½¿ç”¨ã€‚</p>
<p>æ¯æ¬¡è·å–å¯ä»¥æ’­æ”¾çš„viewæ•°ç»„åæˆ‘ä»¬ä»ç¬¬ä¸€ä¸ªviewå¼€å§‹æ’­æ”¾ï¼Œåœ¨ç¬¬ä¸€ä¸ªviewçš„GIFæ’­æ”¾å®Œæ¯•åé€šè¿‡ä»£ç†å›åˆ°åˆ—è¡¨ä¸­è°ƒç”¨ä¸‹ä¸€ä¸ªviewçš„æ’­æ”¾ï¼Œä¸”å½“æ’­æ”¾çš„æ˜¯æœ€åä¸€ä¸ªviewçš„æ—¶å€™å›åˆ°æ•°ç»„å¤´è¿›è¡Œå¾ªç¯å³å¯ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬å®ç° <code>AnimatedImageView</code>çš„ä»£ç† <code>AnimatedImageViewDelegate</code>æ–¹æ³•æ¥ç›‘æ§æ¯ä¸€ä¸ªGIFçš„æ’­æ”¾ç»“æŸã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">animatedImageView</span>(<span class="keyword">_</span> <span class="params">imageView</span>: <span class="type">AnimatedImageView</span>, <span class="params">didPlayAnimationLoops</span> <span class="params">count</span>: <span class="type">UInt</span>) &#123;</span><br><span class="line">  <span class="comment">///æ¯ä¸€ä¸ªAnimatedImageViewæ’­æ”¾å®Œæ¯•åä¼šè°ƒç”¨è¿™é‡Œçš„ä»£ç†æ–¹æ³•æ¥æ’­æ”¾ä¸‹ä¸€ä¸ª</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·é¡ºå…¶è‡ªç„¶çš„æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ¥é›†ä¸­å¤„ç†æ’­æ”¾é€»è¾‘å’Œå‘å¤–æä¾›æœåŠ¡æ–¹æ³•çš„å•ä¾‹ç±»å’Œä¼ é€’GIFæ’­æ”¾å’ŒåŠ è½½äº‹ä»¶çš„ä»£ç†åè®®ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// ä¸‰ä¸ªæ–¹æ³•åˆ†åˆ«å¤„ç†å›¾ç‰‡åŠ è½½æˆåŠŸã€å›¾ç‰‡åŠ è½½å¤±è´¥ã€GIFæ’­æ”¾å®Œæ¯•</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">KrShortContentImageViewDelegate</span>: <span class="title class_ inherited__">AnyObject</span> &#123;</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">krShortContentImageViewLoadImageDidSuccess</span>(<span class="params">imageView</span>: <span class="type">KrShortContentImageView</span>)</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">krShortContentImageViewLoadImageFailure</span>(<span class="params">imageView</span>: <span class="type">KrShortContentImageView</span>)</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">krShortContentImageViewDidFinishAnimation</span>(<span class="params">imageView</span>: <span class="type">KrShortContentImageView</span>, <span class="params">gifView</span>: <span class="type">AnimatedImageView</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// åŠ¨æ€åˆ—è¡¨æ’­æ”¾å™¨ç®¡ç†ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShortContentGifListPlayer</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> `default` <span class="operator">=</span> <span class="type">ShortContentGifListPlayer</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç½‘ç»œåŠ è½½æ•°æ®æ§åˆ¶"><a href="#ç½‘ç»œåŠ è½½æ•°æ®æ§åˆ¶" class="headerlink" title="ç½‘ç»œåŠ è½½æ•°æ®æ§åˆ¶"></a>ç½‘ç»œåŠ è½½æ•°æ®æ§åˆ¶</h4><p>é‰´äºç½‘ç»œçŠ¶æ€çš„æ³¢åŠ¨ï¼Œä¸èƒ½ä¿è¯æ¯ä¸€ä¸ªGIFçš„åŠ è½½éƒ½èƒ½å¾ˆå¿«å®Œæˆï¼Œæˆ‘ä»¬åœ¨ <code>KrShortContentImageView</code>ç±»ä¸­å¢åŠ äº† <code>UIActivityIndicatorView</code>è½¬åŠ¨å°èŠèŠ±æ¥è¡¨ç¤ºæ­¤GIFå›¾ç‰‡æ­£åœ¨åŠ è½½ä¸­ã€‚</p>
<p>åŒæ—¶æˆ‘ä»¬éœ€è¦ä¸€ä¸ªçŠ¶æ€å˜é‡æ ‡è¯†GIFèµ„æºçš„åŠ è½½çŠ¶æ€ï¼Œä»¥åŠç®€å•çš„å˜åŒ–é€»è¾‘ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// å›¾ç‰‡åŠ è½½çŠ¶æ€æœº</span></span><br><span class="line"><span class="keyword">var</span> imageLoadState: <span class="type">LoadingState</span> <span class="operator">=</span> .initial </span><br><span class="line"></span><br><span class="line"><span class="comment">/// å›¾ç‰‡åŠ è½½è¿‡ç¨‹</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">setRealImage</span>(<span class="params">withUrl</span> <span class="params">url</span>: <span class="type">URL</span>?) &#123;</span><br><span class="line">  <span class="keyword">self</span>.imageLoadState <span class="operator">=</span> .loading</span><br><span class="line">  realImageView.kf.setImage(with: url, placeholder: <span class="type">UIImage</span>(color: <span class="type">KrColor</span>.<span class="type">Fill</span>.placeHolder), options: [], progressBlock: <span class="literal">nil</span>) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] (result) <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> `self` <span class="operator">=</span> <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">      <span class="keyword">switch</span> result &#123;</span><br><span class="line">      <span class="keyword">case</span> .success(<span class="keyword">_</span>):</span><br><span class="line">          <span class="keyword">self</span>.imageLoadState <span class="operator">=</span> .success</span><br><span class="line">          <span class="comment">// é€šçŸ¥ä»£ç†GIFåŠ è½½æˆåŠŸå¯ä»¥æ’­æ”¾GIF</span></span><br><span class="line">          <span class="keyword">self</span>.loadingImageDelegate<span class="operator">?</span>.krShortContentImageViewLoadImageDidSuccess(imageView: <span class="keyword">self</span>)</span><br><span class="line">          <span class="keyword">self</span>.updateRealImageLayout()</span><br><span class="line">      <span class="keyword">case</span> .failure(<span class="keyword">_</span>):</span><br><span class="line">          <span class="keyword">self</span>.imageLoadState <span class="operator">=</span> .fail(msg: <span class="string">&quot;å›¾ç‰‡åŠ è½½å¤±è´¥&quot;</span>, image: <span class="string">&quot;&quot;</span>)</span><br><span class="line">          <span class="comment">// é€šçŸ¥ä»£ç†GIFåŠ è½½å¤±è´¥å¯ä»¥æ’­æ”¾ä¸‹ä¸€ä¸ªGIF</span></span><br><span class="line">          <span class="keyword">self</span>.loadingImageDelegate<span class="operator">?</span>.krShortContentImageViewLoadImageFailure(imageView: <span class="keyword">self</span>)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å¼±ç½‘æˆ–è€…è¶…æ—¶å¤„ç†"><a href="#å¼±ç½‘æˆ–è€…è¶…æ—¶å¤„ç†" class="headerlink" title="å¼±ç½‘æˆ–è€…è¶…æ—¶å¤„ç†"></a>å¼±ç½‘æˆ–è€…è¶…æ—¶å¤„ç†</h4><p>å¼±ç½‘å’Œè¶…æ—¶æš‚æ—¶æ²¡æœ‰åšè‡ªå®šä¹‰çš„è¶…æ—¶æ—¶é—´ï¼Œä½¿ç”¨äº†kfæ¡†æ¶å†…éƒ¨çš„è¶…æ—¶æ—¶é—´ã€‚åœ¨æ’­æ”¾GIFæ—¶å¦‚æœå‘ç°å½“å‰çš„å›¾ç‰‡æ­£åœ¨åŠ è½½ä¸­å°±æŠŠloadingViewå±•ç¤ºå‡ºæ¥ç­‰å¾…å…¶åŠ è½½ï¼Œå½“kf.setImageæ–¹æ³•å›è°ƒå¤±è´¥æ—¶é€šè¿‡ä»£ç†å‘Šè¯‰ç®¡ç†å™¨å»æ’­æ”¾ä¸‹ä¸€ä¸ªã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span> gifContent.imageLoadState &#123;</span><br><span class="line">  <span class="keyword">case</span> .success:</span><br><span class="line">      gifContent.hideLoading()<span class="comment">// æ”¶èµ·loadingå±‚</span></span><br><span class="line">      gifContent.startAnimating()<span class="comment">// å¼€å§‹æ’­æ”¾GIF</span></span><br><span class="line">  <span class="keyword">case</span> .loading:</span><br><span class="line">      gifContent.showLoading()<span class="comment">// å±•ç¤ºloadingå±‚</span></span><br><span class="line">  <span class="keyword">case</span> .fail(<span class="keyword">let</span> err, <span class="keyword">_</span>):</span><br><span class="line">      playNextGif()<span class="comment">// æ’­æ”¾ä¸‹ä¸€ä¸ª</span></span><br><span class="line">      <span class="type">SwiftyBeaver</span>.error(<span class="string">&quot;æ’­æ”¾GIFå‡ºé”™,<span class="subst">\(err)</span>&quot;</span>, context: <span class="literal">nil</span>)</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">      playNextGif()</span><br><span class="line">      <span class="type">SwiftyBeaver</span>.error(<span class="string">&quot;æ’­æ”¾GIFå‡ºé”™,GIFæœªåˆå§‹åŒ–æˆåŠŸ&quot;</span>, context: <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ»šåŠ¨ç»“æŸåè·å–æ’­æ”¾åˆ—è¡¨"><a href="#æ»šåŠ¨ç»“æŸåè·å–æ’­æ”¾åˆ—è¡¨" class="headerlink" title="æ»šåŠ¨ç»“æŸåè·å–æ’­æ”¾åˆ—è¡¨"></a>æ»šåŠ¨ç»“æŸåè·å–æ’­æ”¾åˆ—è¡¨</h3><p>æ¨èä¿¡æ¯æµã€å…³æ³¨ä¿¡æ¯æµã€åŠ¨æ€æµä¸­å‡åŒ…å«åŠ¨æ€å›¾ç‰‡ä¹å®«æ ¼ã€‚æ»šåŠ¨åœæ­¢åå¦‚ä½•å–å‡ºå¯ä»¥æ’­æ”¾çš„ <code>KrShortContentImageView</code>åˆ—è¡¨æˆä¸ºäº†å…³é”®é—®é¢˜ã€‚</p>
<p>ä¸ºäº†è¾¾åˆ°è¾ƒå¥½çš„æ’­æ”¾æ•ˆæœè¿™é‡Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ¦‚å¿µï¼š</p>
<blockquote>
<p>å¦‚æœGIFå›¾åœ¨å±å¹•ä¸Šæ¸²æŸ“å‡ºå¹¶æ˜¾ç¤ºäº†è¶…å‡ºä¸€åŠçš„èŒƒå›´ï¼Œåˆ™è§†ä¸ºæ­¤å›¾æ˜¯å¯ä»¥æ’­æ”¾çš„ã€‚</p>
</blockquote>
<p>ä»‹äºæ¯ä¸ªGIFå›¾æ‹¥æœ‰è‡ªèº«çš„æ˜¾ç¤ºæ ‡å‡†ï¼ˆå®½é«˜ï¼‰ï¼Œè¿™é‡Œéœ€è¦è®¡ç®—è‡ªèº«é«˜åº¦çš„50%æ¥å’Œä¿¡æ¯æµæ˜¾ç¤ºåŒºåŸŸè¿›è¡Œå¯¹æ¯”ã€‚éœ€è¦æˆ‘ä»¬æŠŠæ¯ä¸ªGIFå›¾çš„ <code>Frame</code>è®¡ç®—å‡ºæ¥ï¼Œç„¶åé€å±‚è½¬æ¢åæ ‡ç³»åˆ°ä¿¡æ¯æµçš„ä¸»æ˜¾ç¤ºå±‚è¿›è¡Œå¯å±•ç¤ºåŒºåŸŸçš„<strong>äº¤é›†è®¡ç®—</strong>ï¼Œå¦‚æœå’Œå¯å±•ç¤ºåŒºåŸŸç›¸äº¤åˆ™åˆ¤æ–­æ­¤GIFå›¾æ˜¯å¯ä»¥æ’­æ”¾çš„ã€‚</p>
<p>ä»¥æ¨èä¿¡æ¯æµä¸ºä¾‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// æ’­æ”¾Gifåˆ—è¡¨</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">playShortContentGifList</span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> indexPaths: [<span class="type">IndexPath</span>] <span class="operator">=</span> []</span><br><span class="line">    <span class="keyword">let</span> cells <span class="operator">=</span> tableView.visibleCells</span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> <span class="number">0</span> <span class="operator">..&lt;</span> cells.count &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> indexPath <span class="operator">=</span> tableView.indexPath(for: cells[index]) &#123;</span><br><span class="line">            indexPaths.append(indexPath)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> needsPlayGifList: [<span class="type">KrShortContentImageView</span>] <span class="operator">=</span> []</span><br><span class="line">    <span class="comment">/// è¿™é‡Œé€»è¾‘æ˜¯å¯ä¼˜åŒ–çš„ ä¹‹æ‰€ä»¥å…ˆéå†cellå–indexPathæ˜¯ä¸ºäº†ä¿è¯indexPathæ˜¯ä»å°åˆ°å¤§æ’åˆ—çš„ï¼Œæœ¬æ¥è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªindexPathæ•°ç»„çš„æ’åº</span></span><br><span class="line">    <span class="comment">/// é‡æ„è¿‡ç¨‹ä¸­è®¤è¯†åˆ°visibleCellså–å‡ºæ—¶å°±æ˜¯æœ‰åºçš„ï¼Œåªæ˜¯æŠŠæ’åºæ–¹æ³•åˆ æ‰äº†ï¼Œå½“æ—¶æ²¡æœ‰æ”¹canDisplayGifViewsçš„å‚æ•°ï¼Œåæ¥å¿˜è®°äº†...</span></span><br><span class="line">    <span class="comment">/// éå†ç¬¬ä¸€ä¸ªåŒ…å«å¯æ’­æ”¾çš„GIFåˆ—è¡¨çš„Cellè¿›è¡Œæ’­æ”¾</span></span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> <span class="number">0</span> <span class="operator">..&lt;</span> indexPaths.count  &#123;</span><br><span class="line">        <span class="keyword">let</span> imageList <span class="operator">=</span> canDisplayGifViews(indexPath: indexPaths[index])</span><br><span class="line">        <span class="keyword">if</span> <span class="operator">!</span>imageList.isEmpty &#123;</span><br><span class="line">            needsPlayGifList.append(contentsOf: imageList)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ShortContentGifListPlayer</span>.default.setNeedsPlayGifList(gifList: needsPlayGifList)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å›¾ç‰‡åŠ¨æ€å†…éƒ¨æ»¡è¶³å¯æ’­çš„gifåˆ—è¡¨</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">canDisplayGifViews</span>(<span class="params">indexPath</span>: <span class="type">IndexPath</span>) -&gt; [<span class="type">KrShortContentImageView</span>] &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> cell <span class="operator">=</span> <span class="keyword">self</span>.tableView.cellForRow(at: indexPath), <span class="keyword">let</span> provider <span class="operator">=</span> cell <span class="keyword">as?</span> <span class="type">ShortContentGifListProvider</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> [] &#125;</span><br><span class="line">    <span class="comment">/// è·å–GIFåˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">let</span> list <span class="operator">=</span> provider.provideGifViewList()</span><br><span class="line">    <span class="keyword">let</span> rectInTableView <span class="operator">=</span> tableView.rectForRow(at: indexPath)</span><br><span class="line">    <span class="keyword">var</span> showList: [<span class="type">KrShortContentImageView</span>] <span class="operator">=</span> []</span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> <span class="number">0</span> <span class="operator">..&lt;</span> list.count &#123;</span><br><span class="line">        <span class="keyword">let</span> imageFrame <span class="operator">=</span> list[index].frame</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> superView <span class="operator">=</span> list[index].superview <span class="keyword">else</span> &#123; <span class="keyword">continue</span> &#125;<span class="comment">//æ³¨æ„cellå†…å±‚ç»“æ„</span></span><br><span class="line">        <span class="comment">/// åæ ‡ç³»è½¬æ¢</span></span><br><span class="line">        <span class="keyword">let</span> imageFrameInCell <span class="operator">=</span> superView.convert(imageFrame, to: cell)</span><br><span class="line">        <span class="keyword">let</span> imageFrameInTable <span class="operator">=</span> <span class="type">CGRect</span>(x: rectInTableView.origin.x <span class="operator">+</span> imageFrameInCell.origin.x,</span><br><span class="line">                                       y: rectInTableView.origin.y <span class="operator">+</span> imageFrameInCell.origin.y,</span><br><span class="line">                                       width: imageFrame.size.width, height: imageFrame.size.height)</span><br><span class="line">        <span class="keyword">let</span> reactInMainView <span class="operator">=</span> tableView.convert(imageFrameInTable, to: <span class="keyword">self</span>.view)</span><br><span class="line">        <span class="comment">/// è®¡ç®—å¯æ’­åŒºåŸŸ</span></span><br><span class="line">        <span class="keyword">let</span> safeShownGifArea <span class="operator">=</span> <span class="type">CGRect</span>(x: <span class="number">0</span>, y: ceil(imageFrame.size.height <span class="operator">/</span> <span class="number">2</span>), </span><br><span class="line">                                      width: view.bounds.size.width, </span><br><span class="line">                                      height: view.bounds.height <span class="operator">-</span> imageFrame.size.height))</span><br><span class="line">        <span class="comment">/// äº¤é›†è®¡ç®—</span></span><br><span class="line">        <span class="keyword">if</span> safeShownGifArea.intersects(reactInMainView) &#123;</span><br><span class="line">            showList.append(list[index])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> showList</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¿¡æ¯æµåˆ·æ–°å¤„ç†"><a href="#ä¿¡æ¯æµåˆ·æ–°å¤„ç†" class="headerlink" title="ä¿¡æ¯æµåˆ·æ–°å¤„ç†"></a>ä¿¡æ¯æµåˆ·æ–°å¤„ç†</h3><p>å¼€å‘è¿‡ç¨‹ä¸­å‘ç°ä¿¡æ¯æµç»å¸¸ä¼šæœ‰reloadçš„æ“ä½œï¼Œå¯¼è‡´åŠ¨æ€ä¹å®«æ ¼åˆ·æ–°æ•°æ®ï¼ŒåŒæ—¶åˆ·æ–°äº†GIFçš„Viewï¼Œæ­¤æ—¶TableViewä¼šä»å¤ç”¨æ± ä¸­è·å–ä¸€ä¸ªæ–°çš„åŠ¨æ€æ¨¡æ¿ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶æ˜¾ç¤ºçš„GIFè™½ç„¶å›¾ç‰‡å†…å®¹å’Œåˆ·æ–°ä¹‹å‰ä¸€æ ·ä½†æ˜¯å…¶å®è´¨å·²ç»æ˜¯ä¸€ä¸ªæ–°çš„GIFäº†ï¼ˆæŒ‡é’ˆå€¼å·²ç»å˜åŒ–ï¼‰ã€‚æ­¤æ—¶æ­£åœ¨æ’­æ”¾GIFçš„Viewä»ä¹å®«æ ¼ä¸Šç§»é™¤ï¼ŒGIFçš„æ’­æ”¾è¢«ä¸­æ–­ã€‚</p>
<p>å¦‚æœåˆ·æ–°åå†æ‰‹åŠ¨è°ƒä¸€æ¬¡æ’­æ”¾æ–¹æ³•ï¼Œè®¡ç®—é€»è¾‘ä¼šé‡æ–°è®¡ç®—éœ€è¦æ’­æ”¾çš„GIFï¼Œå¦‚æœæ»šåŠ¨ä½ç½®æ²¡æœ‰å˜åŒ–ä¼šè®¡ç®—å‡ºå’Œåˆ·æ–°ä¹‹å‰ç›¸åŒçš„GIFå›¾æ’­æ”¾åˆ—è¡¨ï¼ˆGIFæ–‡ä»¶URLç›¸åŒï¼‰ï¼Œç„¶åä»ç¬¬ä¸€ä¸ªå¼€å§‹æ’­æ”¾ã€‚</p>
<p>è¿™æ ·çš„è¯å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<p>1ï¼šGIFåˆ—è¡¨æ’­æ”¾è¿›åº¦è¢«é‡ç½®ã€‚å½“å‰æ­£åœ¨æ’­æ”¾ç¬¬ä¸‰ä¸ªGIF&gt;è§¦å‘åˆ·æ–°&gt;é‡æ–°è®¡ç®—&gt;ä»å¤´å¼€å§‹æ’­æ”¾ã€‚</p>
<p>2ï¼šGIFæ’­æ”¾å¸§è¿›åº¦è¢«é‡ç½®ã€‚å½“å‰æ­£åœ¨æ’­æ”¾ç¬¬ä¸€ä¸ªGIFï¼ˆå…±60å¸§ï¼‰ä¸”æ’­æ”¾åˆ°ç¬¬30å¸§å›¾ç‰‡&gt;è§¦å‘åˆ·æ–°&gt;é‡æ–°è®¡ç®—&gt;ä»å¤´å¼€å§‹æ’­æ”¾&gt;å¼€å§‹æ’­æ”¾ç¬¬ä¸€ä¸ªGIFçš„ç¬¬ä¸€å¸§ã€‚</p>
<p>å½“ç„¶ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜æˆ‘ä»¬å°è¯•é€šè¿‡è®°å½•å½“å‰æ­£åœ¨æ’­æ”¾çš„GIFçš„URLæ¥åˆ¤æ–­æ’­æ”¾çš„ä½ç½®çš„æ–¹æ³•æ¥è§£å†³ï¼Œä½†æ˜¯ç”±äºæ›¿æ¢äº†æ‰¿è½½GIFçš„Viewï¼Œæ’­æ”¾å¸§è¢«é‡ç½®çš„é—®é¢˜æ˜¯æ— æ³•è§£å†³çš„ã€‚è¿™æ ·å½“å¼¹èµ·è¾“å…¥æ¡†ã€ç‚¹èµç­‰æ“ä½œåˆ·æ–°åŠ¨æ€Cellæ—¶æ— æ³•åšåˆ°æ— ç—•åˆ·æ–°ï¼Œç”¨æˆ·æ­£åœ¨è§‚çœ‹çš„GIFè¢«ä¸­æ–­ï¼Œä½“éªŒè¾ƒå·®ã€‚</p>
<p>æ‰€ä»¥å¦‚æœæƒ³è§£å†³é—®é¢˜2åº”<strong>é¿å…è®©GIFç›´æ¥åœ¨ä¿¡æ¯æµä¸­æ’­æ”¾</strong>ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬åœ¨ <code>ShortContentGifListPlayer</code>æ’­æ”¾ç®¡ç†å™¨ä¸­æŒæœ‰ä¸€ä¸ªä¸“é—¨ç”¨æ¥æ’­æ”¾GIFçš„å›¾ç‰‡ç±» <code>gifContent</code>ã€‚ç„¶åå°†å˜åŒ–è¾ƒå¤§ä¸”è¾ƒéš¾æ§åˆ¶çš„åŠ¨æ€ä¹å®«æ ¼ä¸­çš„å›¾ç‰‡åˆ—è¡¨ä½œä¸ºå±•ç¤ºçœŸæ­£æ’­æ”¾GIFçš„å®¹å™¨ <code>containerList</code>æ¥ç®¡ç†ï¼Œåœ¨ä¿¡æ¯æµåˆ·æ–°æ—¶ä»…ä»…æ›¿æ¢GIFå®¹å™¨ï¼Œè€Œä¸å½±å“æ­£åœ¨æ’­æ”¾çš„GIFå›¾ç‰‡ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// çœŸæ­£æ’­æ”¾çš„gif</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> gifContent <span class="operator">=</span> <span class="type">KrShortContentImageView</span>()</span><br><span class="line"><span class="comment">/// å½“å‰çš„gifè½½ä½“superview</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> currentContainer: <span class="type">KrShortContentImageView</span>?</span><br><span class="line"><span class="comment">/// è½½ä½“åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> containerList: [<span class="type">KrShortContentImageView</span>] <span class="operator">=</span> []</span><br></pre></td></tr></table></figure>

<p>æ¯æ¬¡è§¦å‘ä¿¡æ¯æµåˆ·æ–°æ—¶å‡é‡æ–°è®¡ç®—GIFæ’­æ”¾å®¹å™¨åˆ—è¡¨ï¼Œå¯¹æ¯”æ­£åœ¨æ’­æ”¾çš„GIFçš„URLå’Œå®¹å™¨çš„URLï¼ŒæŠŠæ­£åœ¨æ’­æ”¾çš„GIFæ”¾åˆ°å¯¹åº”çš„å®¹å™¨ä¸­ï¼Œåšåˆ°è§†è§‰å†…æ— ç—•æ›¿æ¢ã€‚</p>
<p>æ¯æ¬¡GIFæ’­æ”¾å®Œæ¯•ä¹‹åå¯»æ‰¾ä¸‹ä¸€ä¸ªå®¹å™¨ï¼Œä»å®¹å™¨ä¸­è·å–GIFçš„å›¾ç‰‡URLè¿›è¡ŒåŠ è½½ã€‚</p>
<p>å¦‚æœæ’­æ”¾å®Œæ¯•åæ‰¾ä¸åˆ°æ–°çš„å®¹å™¨åˆ™ç•Œå®šä¸ºæ’­æ”¾é€»è¾‘åœæ­¢ï¼Œæ•´ä¸ªæ’­æ”¾å™¨å˜ä¸ºéæ´»è·ƒçŠ¶æ€ã€‚</p>
<p><img src="https://cdn.zcx.info/202302221018159.jpg" alt="ç¤ºæ„å›¾"></p>
<hr>
<p>è§£å†³ä¸Šè¿°é—®é¢˜2åï¼Œé—®é¢˜1çš„è§£å†³æ–¹æ¡ˆä¹Ÿè·å¾—äº†ä¼˜åŒ–ã€‚</p>
<p>é‰´äºæˆ‘ä»¬åŠ¨æ€æµä¹å®«æ ¼å›¾ç‰‡ç»„ç»å¸¸ä¼šä»æ¨èé¢‘é“è¿›å…¥åŠ¨æ€æµç„¶åä»åŠ¨æ€æµå†è¿›å…¥åŠ¨æ€è¯¦æƒ…é¡µï¼Œè¿™ä¸‰å¤„ä½ç½®çš„GIFéƒ½éœ€è¦æ’­æ”¾ï¼Œæ¯æ¬¡è¿›å…¥åæ–°é¡µé¢éƒ½éœ€è¦é‡æ–°è®¡ç®—æ’­æ”¾åˆ—è¡¨ï¼Œè€Œè¿™ç§ç¿»é¡µçš„æ“ä½œåˆæºå¸¦ç›¸åŒï¼ˆæŒ‰ç…§å›¾ç‰‡URLè®¡ç®—ï¼‰çš„GIFç»„ã€‚</p>
<p>è¿™æ ·çš„åœºæ™¯å°±éœ€è¦æˆ‘ä»¬æŠŠä¸åŒä½ç½®çš„ç›¸åŒGIFåˆ—è¡¨è®°å¿†æ’­æ”¾è¿›åº¦ï¼Œå³æ¥åŠ›æ’­æ”¾ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ¥åŠ›æ’­æ”¾çš„è§„åˆ™ï¼š</p>
<blockquote>
<p>æ–°GIFåˆ—è¡¨åŒ…å«æ­£åœ¨æ’­æ”¾çš„GIFä¸”æ–°åˆ—è¡¨æ˜¯å½“å‰æ’­æ”¾çš„GIFåˆ—è¡¨çš„å­é›†è§†ä¸ºå¯ä»¥æ¥åŠ›æ’­æ”¾</p>
</blockquote>
<p>ä¾‹å¦‚å½“å‰æ­£åœ¨æ’­æ”¾ <code>[A,B,C,D,E,F,G]</code>åˆ—è¡¨ä¸”æ­£åœ¨æ’­æ”¾ <code>GIF_C</code>ï¼Œè¿™ä¸ªæ—¶å€™æŸä¸ªæ“ä½œè®¡ç®—å‡ºäº†æ–°çš„æ’­æ”¾åˆ—è¡¨ <code>[A,B,C,D,E]</code>ã€‚æˆ‘ä»¬å‘ç°æ–°çš„æ’­æ”¾åˆ—è¡¨æ˜¯æ—§çš„æ’­æ”¾åˆ—è¡¨çš„<strong>å­é›†</strong>ï¼Œä¸”æ–°åˆ—è¡¨<strong>åŒ…å«</strong>äº†æ­£åœ¨æ’­æ”¾çš„ <code>GIF_C</code>ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦æŠŠæ­£åœ¨æ’­æ”¾çš„ <code>GIF_C</code>ç§»åŠ¨åˆ°æ–°åˆ—è¡¨çš„ <code>å®¹å™¨C</code>ä¸Šä¸”è®¾ç½®æ’­æ”¾è¿›åº¦ä¸ºCï¼Œè€Œä¸æ˜¯é‡æ–°åŠ è½½Açš„URLè¿›è¡ŒGIFæ’­æ”¾ã€‚</p>
<p>è¿™æ ·æ“ä½œå‡å°‘äº†GIFå›¾é‡æ–°æ’­æ”¾çš„æ¬¡æ•°ï¼Œé™ä½äº†å›¾ç‰‡æ•°æ®IOæ¬¡æ•°å’ŒGPUé‡æ–°æ¸²æŸ“çš„æ¬¡æ•°ï¼Œå°†ç¿»é¡µçš„GIFå›¾å¹³æ»‘è¿‡æ¸¡åˆ°æ–°çš„æ’­æ”¾åˆ—è¡¨ã€‚</p>
<h2 id="åŠŸèƒ½æ‹“å±•"><a href="#åŠŸèƒ½æ‹“å±•" class="headerlink" title="åŠŸèƒ½æ‹“å±•"></a>åŠŸèƒ½æ‹“å±•</h2><p>ç»¼ä¸Šæ‰€è¿°ï¼Œå¦‚æœå°†GIFå˜ä¸ºè§†é¢‘æˆ–è€…å®å†µç…§ç‰‡æˆ–è€…å…¶ä»–ä»»ä½•å¯ä»¥æ§åˆ¶å¼€å§‹å’Œç»“æŸçš„åŠŸèƒ½æ¨¡å—ï¼Œå‡å¯å¥—ç”¨æ­¤é€»è¾‘è¿›è¡Œäº¤äº’ã€‚</p>
<h2 id="æ€»ç»“ä¸ä¼˜åŒ–"><a href="#æ€»ç»“ä¸ä¼˜åŒ–" class="headerlink" title="æ€»ç»“ä¸ä¼˜åŒ–"></a>æ€»ç»“ä¸ä¼˜åŒ–</h2><h3 id="ä¿¡æ¯æµå›¾ç‰‡ç¼©ç•¥"><a href="#ä¿¡æ¯æµå›¾ç‰‡ç¼©ç•¥" class="headerlink" title="ä¿¡æ¯æµå›¾ç‰‡ç¼©ç•¥"></a>ä¿¡æ¯æµå›¾ç‰‡ç¼©ç•¥</h3><p>ç”±äºGIFåˆ—è¡¨ä½¿ç”¨äº†å›ºå®šçš„ä¸“é—¨ç”¨æ¥æ’­æ”¾çš„æ‰¿è½½å™¨ <code>gifContent</code>,ä¿¡æ¯æµä¸­ä¸å†æ‰¿æ‹…æ’­æ”¾GIFå›¾çš„è´£ä»»ï¼Œæ‰€ä»¥ä¿¡æ¯æµä¸­å¯ä»¥å®Œå…¨èˆå¼ƒåŠ è½½GIFï¼Œè€Œæ”¹ç”¨åŠ è½½GIFå›¾çš„ç¼©ç•¥å›¾ã€‚ç¼©ç•¥å›¾çš„å†…å­˜å ç”¨æ›´å°ï¼ŒåŠ è½½é€Ÿåº¦æ›´å¿«ï¼Œæ›´åŠ é€‚åˆå¤šå›¾ç‰‡ä¿¡æ¯æµçš„å±•ç¤ºã€‚</p>
<p>å½“ç‚¹å‡»å›¾ç‰‡éœ€è¦åŠ è½½å¤§å›¾æˆ–è€…æ»šåŠ¨åœæ­¢éœ€è¦æ’­æ”¾GIFçš„æ—¶å€™å†å»åŠ è½½çœŸæ­£çš„åŸå›¾ä»¥è·å¾—è¾ƒå¥½çš„æ˜¾ç¤ºæ•ˆæœã€‚è¿™æ ·å›¾ç‰‡åŸå›¾ä»¥æ‡’åŠ è½½ï¼ˆç”¨æ—¶åŠ è½½ï¼‰çš„æ–¹å¼æ¥æ¸²æŸ“èƒ½å¤Ÿæå‡ä¿¡æ¯æµä¸­å¤§é‡å›¾ç‰‡çš„åŠ è½½é€Ÿåº¦ï¼Œé™ä½å†…å­˜æ¶ˆè€—ã€‚</p>
<p>ç§»åŠ¨è®¾å¤‡å¯è§†åŒºåŸŸæ¯”è¾ƒå°ï¼Œä¹å®«æ ¼ä¸­æ˜¾ç¤ºçš„å›¾ç‰‡å°ºå¯¸æ›´å°ï¼Œæ‰€ä»¥ä½¿ç”¨ç¼©ç•¥å›¾ï¼ˆåˆé€‚çš„å‹ç¼©ç‡ï¼‰ä»£æ›¿åŸå›¾åœ¨è§†è§‰æ•ˆæœä¸Šä¸ä¼šäº§ç”Ÿç‰¹åˆ«å¤§çš„æŸå¤±ã€‚</p>
<h3 id="ä»£ç é€»è¾‘æ”¶æ•›"><a href="#ä»£ç é€»è¾‘æ”¶æ•›" class="headerlink" title="ä»£ç é€»è¾‘æ”¶æ•›"></a>ä»£ç é€»è¾‘æ”¶æ•›</h3><p>å½“å‰çš„ä»£ç å®ç°æ¯”è¾ƒæ•£ä¹±ï¼Œç‰¹åˆ«æ˜¯æ¯ä¸ªGIFè½¬æ¢åæ ‡ç³»æ—¶çš„è®¡ç®—ä»¥åŠå’Œä¿¡æ¯æµå¯æ’­åŒºåŸŸè¿›è¡Œçš„äº¤é›†è®¡ç®—ã€‚åæ ‡ç³»è½¬æ¢é€»è¾‘çš„å¤æ‚åº¦éšç€GIFViewçš„å±‚çº§å¤æ‚åº¦çš„æç¤ºè€Œæ˜¾è‘—æå‡ã€‚æ¢ç´¢æ˜¯å¦å­˜åœ¨ä¸€ç§æ–¹æ³•åˆ¤æ–­ä»»æ„ä¸¤ä¸ªVIewæ˜¯å¦å­˜åœ¨äº¤é›†ï¼ˆæ”¯æŒè®¾ç½®å¿½ç•¥EdgeInsetï¼‰ï¼Œä»¥é€šç”¨çš„è®¡ç®—æ–¹æ³•æ¥ä»£æ›¿åŒ…å«ä¸šåŠ¡Viewçš„è®¡ç®—ï¼Œä»è€Œå¤§é‡é™ä½è€¦åˆåº¦ï¼ŒåŒæ—¶å‡å°‘äº†å¤æ‚åº¦ã€‚</p>
<p>å°†å¿…è¦çš„é€»è¾‘æŠ½è±¡ä¸ºåè®®ï¼Œä»¥æ–¹ä¾¿æ­¤åŠŸèƒ½ç§»æ¤åˆ°å…¶ä»–é¢‘é“æˆ–è€…åˆ—è¡¨ã€‚</p>
<p>éšç€è¿­ä»£å¢åŠ åŠŸèƒ½ï¼Œä¿¡æ¯æµControllerä¸­çš„äº‹ä»¶è¶Šæ¥è¶Šå¤šï¼Œæä¾›å†…å®¹ï¼ˆæ¯”å¦‚è¿™æ¬¡çš„GIFï¼‰çš„Cellå¯ä»¥è€ƒè™‘è‡ªèº«æ¥è®¡ç®—å¯æ‰§è¡Œæ¡ä»¶ï¼Œå®ç°æˆ–è€…è°ƒç”¨åŠŸèƒ½ï¼Œæˆ–è€…ä½¿ç”¨VMæ¥é™ä½Controllerçš„è‡ƒè‚¿ã€‚Controllerä¸­ä»…æ§åˆ¶Tableviewçš„ä»£ç†äº‹ä»¶ç›‘å¬ç„¶åè°ƒç”¨ç¬¦åˆæ¡ä»¶çš„Cellå†…éƒ¨çš„åŠŸèƒ½å®ç°ã€‚è¿™æ ·æ¯æ¬¡æœ‰æ–°çš„åŠŸèƒ½æ—¶ä»…ä»…å¢åŠ æ–°çš„Cellæ³¨å†Œå’Œæ–°åè®®çš„è°ƒç”¨ï¼Œé¿å¼€å¤§é‡ä¿®æ”¹è‡ƒè‚¿çš„Controllerä»£ç ä»¥é™ä½å‡ºé”™çš„æ¦‚ç‡ã€‚</p>
<h2 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h2><h3 id="åæ ‡ç³»è½¬æ¢ç®€åŒ–"><a href="#åæ ‡ç³»è½¬æ¢ç®€åŒ–" class="headerlink" title="åæ ‡ç³»è½¬æ¢ç®€åŒ–"></a>åæ ‡ç³»è½¬æ¢ç®€åŒ–</h3><p>å¸¦ç€ç–‘é—®ç ”ç©¶äº†ä¸€ä¸‹åæ ‡ç³»è½¬æ¢çš„æ–¹æ³•ï¼Œå‘ç°ä»–æ˜¯ <code>UICoordinateSpace</code>åè®®ï¼ŒåªåŒ…å«å‡ ä¸ªå’Œåæ ‡è½¬æ¢ç›¸å…³çš„æ–¹æ³•ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">protocol</span> <span class="title class_">UICoordinateSpace</span> : <span class="title class_ inherited__">NSObjectProtocol</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">8.0</span>, <span class="operator">*</span>)</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">convert</span>(<span class="keyword">_</span> <span class="params">point</span>: <span class="type">CGPoint</span>, <span class="params">to</span> <span class="params">coordinateSpace</span>: <span class="type">UICoordinateSpace</span>) -&gt; <span class="type">CGPoint</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">8.0</span>, <span class="operator">*</span>)</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">convert</span>(<span class="keyword">_</span> <span class="params">point</span>: <span class="type">CGPoint</span>, <span class="params">from</span> <span class="params">coordinateSpace</span>: <span class="type">UICoordinateSpace</span>) -&gt; <span class="type">CGPoint</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">8.0</span>, <span class="operator">*</span>)</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">convert</span>(<span class="keyword">_</span> <span class="params">rect</span>: <span class="type">CGRect</span>, <span class="params">to</span> <span class="params">coordinateSpace</span>: <span class="type">UICoordinateSpace</span>) -&gt; <span class="type">CGRect</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">8.0</span>, <span class="operator">*</span>)</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">convert</span>(<span class="keyword">_</span> <span class="params">rect</span>: <span class="type">CGRect</span>, <span class="params">from</span> <span class="params">coordinateSpace</span>: <span class="type">UICoordinateSpace</span>) -&gt; <span class="type">CGRect</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">8.0</span>, <span class="operator">*</span>)</span><br><span class="line">    <span class="keyword">var</span> bounds: <span class="type">CGRect</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œ <code>UIView</code>æ˜¯å®ç°è¿™ä¸ªåè®®çš„ï¼Œæ‰€ä»¥ï¼Œåœ¨çˆ¶viewçš„å±‚çº§å†…è‚¯å®šæ˜¯å¯ä»¥å°†æ·±å±‚åµŒå¥—çš„å­viewè½¬æ¢åˆ°è‡ªèº«åæ ‡ç³»ä¸‹çš„ã€‚è¿™æ ·ä¸€æ¥æˆ‘ä»¬å°±ä¸å¿…å…³å¿ƒviewåˆ°åº•æ˜¯ä»€ä¹ˆï¼Œæ— è®ºæ˜¯tableViewè¿˜æ˜¯collectionViewï¼Œå¯ä»¥è·¨å±‚çº§å°†cellä¸ŠåŠ è½½çš„å›¾ç‰‡çš„frameè®¡ç®—åˆ°ä¸Šå±‚çš„ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªæ–¹æ¡ˆåˆå¹¶ä¸ºä¸€ä¸ªé€šç”¨çš„æ‰©å±•ï¼Œç”¨ä¸€ä¸ªæ–¹æ³•å°±å¯ä»¥æŠŠGIFä½ç½®æ˜¯å¦æ»¡è¶³æ’­æ”¾æ¡ä»¶ç»™è®¡ç®—å‡ºæ¥ã€‚</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">UIView</span> &#123;</span><br><span class="line">    <span class="comment">/// é€’å½’æŸ¥è¯¢æ˜¯å¦æ˜¯è‡ªå·±çš„subview/å¤šçº§subview</span></span><br><span class="line">    <span class="comment">/// - Parameter subview: å­viewæˆ–è€…æ·±å±‚å­view</span></span><br><span class="line">    <span class="comment">/// - Returns: Bool</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">isMySubview</span>(<span class="params">subview</span>: <span class="type">UIView</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> subview <span class="operator">!=</span> <span class="keyword">self</span>, <span class="keyword">let</span> subviewSuper <span class="operator">=</span> subview.superview <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125;</span><br><span class="line">        <span class="keyword">if</span> subviewSuper <span class="operator">==</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> isMySubview(subview: subviewSuper)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// åˆ¤æ–­ä»»æ„ä¸€å­viewæˆ–è€…åµŒå¥—æ·±å±‚å­viewæ˜¯å¦æ˜¾ç¤ºåœ¨äº†çˆ¶è§†å›¾ç‰¹å®šçš„å¯è§åŒºåŸŸå†…</span></span><br><span class="line">    <span class="comment">/// - Parameter subview: å­viewæˆ–è€…æ·±å±‚å­view</span></span><br><span class="line">    <span class="comment">/// - Returns: Bool</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">isSubviewIntersectInAimRect</span>(<span class="params">subview</span>: <span class="type">UIView</span>, <span class="params">inset</span>: <span class="type">UIEdgeInsets</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> subviewSuper <span class="operator">=</span> subview.superview, isMySubview(subview: subview) <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125;</span><br><span class="line">        <span class="keyword">let</span> subviewFrameInSuper <span class="operator">=</span> convert(subview.frame, from: subviewSuper)</span><br><span class="line">        <span class="keyword">if</span> subviewFrameInSuper <span class="operator">==</span> .zero <span class="operator">||</span> subviewFrameInSuper.isNull &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125;</span><br><span class="line">        <span class="keyword">let</span> safeShownArea <span class="operator">=</span> bounds.in<span class="keyword">set</span>(by: inset)</span><br><span class="line">        <span class="keyword">return</span> safeShownArea.intersects(subviewFrameInSuper)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨äº†è¿™ä¸ªæ–¹æ³•åï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¯”ä¸€ä¸‹</p>
<p>æ—§è®¡ç®—è¿‡ç¨‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å›¾ç‰‡åŠ¨æ€å†…éƒ¨æ»¡è¶³å¯æ’­çš„gifåˆ—è¡¨</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">canDisplayGifViews</span>(<span class="params">indexPath</span>: <span class="type">IndexPath</span>) -&gt; [<span class="type">KrShortContentImageView</span>] &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> cell <span class="operator">=</span> <span class="keyword">self</span>.tableView.cellForRow(at: indexPath), <span class="keyword">let</span> provider <span class="operator">=</span> cell <span class="keyword">as?</span> <span class="type">ShortContentGifListProvider</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> [] &#125;</span><br><span class="line">    <span class="comment">/// è·å–GIFåˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">let</span> list <span class="operator">=</span> provider.provideGifViewList()</span><br><span class="line">    <span class="keyword">let</span> rectInTableView <span class="operator">=</span> tableView.rectForRow(at: indexPath)</span><br><span class="line">    <span class="keyword">var</span> showList: [<span class="type">KrShortContentImageView</span>] <span class="operator">=</span> []</span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> <span class="number">0</span> <span class="operator">..&lt;</span> list.count &#123;</span><br><span class="line">        <span class="keyword">let</span> imageFrame <span class="operator">=</span> list[index].frame</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> superView <span class="operator">=</span> list[index].superview <span class="keyword">else</span> &#123; <span class="keyword">continue</span> &#125;<span class="comment">//æ³¨æ„cellå†…å±‚ç»“æ„</span></span><br><span class="line">        <span class="comment">/// åæ ‡ç³»è½¬æ¢</span></span><br><span class="line">        <span class="keyword">let</span> imageFrameInCell <span class="operator">=</span> superView.convert(imageFrame, to: cell)</span><br><span class="line">        <span class="keyword">let</span> imageFrameInTable <span class="operator">=</span> <span class="type">CGRect</span>(x: rectInTableView.origin.x <span class="operator">+</span> imageFrameInCell.origin.x, y: rectInTableView.origin.y <span class="operator">+</span> imageFrameInCell.origin.y,  width: imageFrame.size.width, height: imageFrame.size.height)</span><br><span class="line">        <span class="keyword">let</span> reactInMainView <span class="operator">=</span> tableView.convert(imageFrameInTable, to: <span class="keyword">self</span>.view)</span><br><span class="line">        <span class="comment">/// è®¡ç®—å¯æ’­åŒºåŸŸ</span></span><br><span class="line">        <span class="keyword">let</span> safeShownGifArea <span class="operator">=</span> <span class="type">CGRect</span>(x: <span class="number">0</span>, y: ceil(imageFrame.size.height <span class="operator">/</span> <span class="number">2</span>), width: view.bounds.size.width, height: view.bounds.height <span class="operator">-</span> imageFrame.size.height)</span><br><span class="line">        <span class="comment">/// äº¤é›†è®¡ç®—</span></span><br><span class="line">        <span class="keyword">if</span> safeShownGifArea.intersects(reactInMainView) &#123;</span><br><span class="line">            showList.append(list[index])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> showList</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–°è®¡ç®—è¿‡ç¨‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¯ä¸€ä¸ªå›¾ç‰‡åŠ¨æ€å†…éƒ¨æ»¡è¶³å¯æ’­çš„gifåˆ—è¡¨</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">canDisplayGifViews</span>(<span class="params">indexPath</span>: <span class="type">IndexPath</span>) -&gt; [<span class="type">KrShortContentImageView</span>] &#123;</span><br><span class="line">  <span class="keyword">guard</span> <span class="keyword">let</span> cell <span class="operator">=</span> <span class="keyword">self</span>.tableView.cellForRow(at: indexPath),</span><br><span class="line">  <span class="keyword">let</span> provider <span class="operator">=</span> cell <span class="keyword">as?</span> <span class="type">ShortContentGifListProvider</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> [] &#125;</span><br><span class="line">  <span class="keyword">let</span> showList: [<span class="type">KrShortContentImageView</span>] <span class="operator">=</span> provider.provideGifViewList().filter &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> `self` <span class="operator">=</span> <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125;</span><br><span class="line">      <span class="comment">// tabbaræ˜¯è¦†ç›–åœ¨æµä¸Šæ–¹çš„ï¼Œæ‰€ä»¥å¯æ’­åŒºåŸŸé™åˆ¶å¢åŠ tabbarçš„é«˜åº¦</span></span><br><span class="line">      <span class="keyword">let</span> shownInset <span class="operator">=</span> <span class="type">UIEdgeInsets</span>(top: <span class="variable">$0</span>.frame.height <span class="operator">/</span> <span class="number">2</span>, left: <span class="number">0</span>, bottom: <span class="variable">$0</span>.frame.height <span class="operator">/</span> <span class="number">2</span> <span class="operator">+</span> <span class="type">BasicConst</span>.<span class="type">Layout</span>.tabBarHeight, right: <span class="number">0</span>)</span><br><span class="line">      <span class="comment">// äº¤é›†è®¡ç®—</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">self</span>.tableView.isSubviewIntersectInAimRect(subview: <span class="variable">$0</span>, inset: shownInset)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> showList</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸå°†å¤æ‚çš„é€å±‚è½¬æ¢å¸ƒå±€å˜æˆäº†ä¸€ä¸ªæ–¹æ³•å®ç°ï¼Œä»£ç å˜å¾—ååˆ†ç®€æ´ï¼Œçœ‹èµ·æ¥å¾ˆçˆ½ã€‚</p>
]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>ç»éªŒè®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title>å®¢æˆ·ç«¯æ—¥å¿—è§„èŒƒæŒ‡å—</title>
    <url>/2025/03/14/%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%97%A5%E5%BF%97%E8%A7%84%E8%8C%83%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h2 id="ä¸€ã€æ—¥å¿—åˆ†ç±»ä½“ç³»"><a href="#ä¸€ã€æ—¥å¿—åˆ†ç±»ä½“ç³»" class="headerlink" title="ä¸€ã€æ—¥å¿—åˆ†ç±»ä½“ç³»"></a>ä¸€ã€æ—¥å¿—åˆ†ç±»ä½“ç³»</h2><h3 id="1-1-æ ¸å¿ƒåˆ†ç±»çŸ©é˜µ"><a href="#1-1-æ ¸å¿ƒåˆ†ç±»çŸ©é˜µ" class="headerlink" title="1.1 æ ¸å¿ƒåˆ†ç±»çŸ©é˜µ"></a>1.1 æ ¸å¿ƒåˆ†ç±»çŸ©é˜µ</h3><h3 id="1-2-åˆ†ç±»å®šä¹‰"><a href="#1-2-åˆ†ç±»å®šä¹‰" class="headerlink" title="1.2 åˆ†ç±»å®šä¹‰"></a>1.2 åˆ†ç±»å®šä¹‰</h3><table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>è®°å½•å†…å®¹</th>
<th>å­˜å‚¨å‘¨æœŸ</th>
</tr>
</thead>
<tbody><tr>
<td>è¯Šæ–­æ—¥å¿—</td>
<td>ç¨‹åºè¿è¡ŒçŠ¶æ€ã€å¼‚å¸¸å †æ ˆ</td>
<td>90å¤©</td>
</tr>
<tr>
<td>ç»Ÿè®¡æ—¥å¿—</td>
<td>ç”¨æˆ·è¡Œä¸ºåŸ‹ç‚¹ã€ä¸šåŠ¡è½¬åŒ–ç‡</td>
<td>365å¤©</td>
</tr>
<tr>
<td>å®¡è®¡æ—¥å¿—</td>
<td>æ•æ„Ÿæ“ä½œè®°å½•ã€æƒé™å˜æ›´</td>
<td>æ°¸ä¹…</td>
</tr>
</tbody></table>
<h2 id="äºŒã€æ—¥å¿—çº§åˆ«æ ‡å‡†"><a href="#äºŒã€æ—¥å¿—çº§åˆ«æ ‡å‡†" class="headerlink" title="äºŒã€æ—¥å¿—çº§åˆ«æ ‡å‡†"></a>äºŒã€æ—¥å¿—çº§åˆ«æ ‡å‡†</h2><h3 id="2-1-äº”çº§æ—¥å¿—å¯¹ç…§è¡¨"><a href="#2-1-äº”çº§æ—¥å¿—å¯¹ç…§è¡¨" class="headerlink" title="2.1 äº”çº§æ—¥å¿—å¯¹ç…§è¡¨"></a>2.1 äº”çº§æ—¥å¿—å¯¹ç…§è¡¨</h3><table>
<thead>
<tr>
<th>çº§åˆ«</th>
<th>è§¦å‘åœºæ™¯</th>
<th>é‡‡æ ·ç‡</th>
</tr>
</thead>
<tbody><tr>
<td>DEBUG</td>
<td>å¼€å‘ç¯å¢ƒè°ƒè¯•æ—¥å¿—</td>
<td>100%</td>
</tr>
<tr>
<td>INFO</td>
<td>å¸¸è§„æµç¨‹èŠ‚ç‚¹è®°å½•</td>
<td>30%</td>
</tr>
<tr>
<td>WARNING</td>
<td>å¯æ¢å¤çš„å¼‚å¸¸çŠ¶æ€</td>
<td>100%</td>
</tr>
<tr>
<td>ERROR</td>
<td>å½±å“ä¸»æµç¨‹çš„å¼‚å¸¸</td>
<td>100%</td>
</tr>
<tr>
<td>FATAL</td>
<td>å¯¼è‡´åº”ç”¨å´©æºƒçš„è‡´å‘½é”™è¯¯</td>
<td>100%</td>
</tr>
</tbody></table>
<h3 id="2-2-çº§åˆ«ä½¿ç”¨ç¤ºä¾‹"><a href="#2-2-çº§åˆ«ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="2.2 çº§åˆ«ä½¿ç”¨ç¤ºä¾‹"></a>2.2 çº§åˆ«ä½¿ç”¨ç¤ºä¾‹</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å…³é”®å‡½æ•°è°ƒç”¨è®°å½•</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">didSelectItem</span>(<span class="params">at</span> <span class="params">index</span>: <span class="type">IndexPath</span>) &#123;</span><br><span class="line">    <span class="type">Logger</span>.info(<span class="string">&quot;ç”¨æˆ·ç‚¹å‡»å•å…ƒæ ¼&quot;</span>, metadata: [<span class="string">&quot;section&quot;</span>: <span class="string">&quot;2&quot;</span>, <span class="string">&quot;row&quot;</span>: <span class="string">&quot;5&quot;</span>])</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">guard</span> isValidIndex(index) <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">Logger</span>.error(<span class="string">&quot;éæ³•ç´¢å¼•è·¯å¾„&quot;</span>, metadata: index.debugDescription)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€å…³é”®åœºæ™¯æ—¥å¿—è§„èŒƒ"><a href="#ä¸‰ã€å…³é”®åœºæ™¯æ—¥å¿—è§„èŒƒ" class="headerlink" title="ä¸‰ã€å…³é”®åœºæ™¯æ—¥å¿—è§„èŒƒ"></a>ä¸‰ã€å…³é”®åœºæ™¯æ—¥å¿—è§„èŒƒ</h2><h3 id="3-1-ä¸šåŠ¡æµç¨‹ç›‘æ§"><a href="#3-1-ä¸šåŠ¡æµç¨‹ç›‘æ§" class="headerlink" title="3.1 ä¸šåŠ¡æµç¨‹ç›‘æ§"></a>3.1 ä¸šåŠ¡æµç¨‹ç›‘æ§</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@startuml</span><br><span class="line">start</span><br><span class="line">:æµç¨‹å¼€å§‹;</span><br><span class="line">:è®°å½•STARTæ—¥å¿—;</span><br><span class="line">if (å…³é”®æ“ä½œ) then (æˆåŠŸ)</span><br><span class="line">  :è®°å½•SUCCESSæ—¥å¿—;</span><br><span class="line">else (å¤±è´¥)</span><br><span class="line">  :è®°å½•FAILUREæ—¥å¿—;</span><br><span class="line">endif</span><br><span class="line">:æµç¨‹ç»“æŸ;</span><br><span class="line">:è®°å½•ENDæ—¥å¿—;</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure>

<h3 id="3-2-å¼‚å¸¸å¤„ç†è§„èŒƒ"><a href="#3-2-å¼‚å¸¸å¤„ç†è§„èŒƒ" class="headerlink" title="3.2 å¼‚å¸¸å¤„ç†è§„èŒƒ"></a>3.2 å¼‚å¸¸å¤„ç†è§„èŒƒ</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;error_code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;E1003&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;error_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;BUSINESS&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;expected&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;stack_trace&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;device_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;os_version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;iOS 16.4.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;network&quot;</span><span class="punctuation">:</span> <span class="string">&quot;WiFi&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="å››ã€é«˜çº§è®°å½•è§„èŒƒ"><a href="#å››ã€é«˜çº§è®°å½•è§„èŒƒ" class="headerlink" title="å››ã€é«˜çº§è®°å½•è§„èŒƒ"></a>å››ã€é«˜çº§è®°å½•è§„èŒƒ</h2><h3 id="4-1-è€—æ—¶æ“ä½œç›‘æ§"><a href="#4-1-è€—æ—¶æ“ä½œç›‘æ§" class="headerlink" title="4.1 è€—æ—¶æ“ä½œç›‘æ§"></a>4.1 è€—æ—¶æ“ä½œç›‘æ§</h3><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">handleLargeFile</span><span class="params">(file: <span class="type">File</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> traceId = Logger.beginTrace(<span class="string">&quot;FILE_PROCESSING&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Logger.debug(<span class="string">&quot;å¼€å§‹å¤„ç†æ–‡ä»¶&quot;</span>, metadata: file.metadata)</span><br><span class="line">        <span class="comment">// å®é™…å¤„ç†é€»è¾‘</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        Logger.endTrace(traceId)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-ç¯å¢ƒä¿¡æ¯è®°å½•"><a href="#4-2-ç¯å¢ƒä¿¡æ¯è®°å½•" class="headerlink" title="4.2 ç¯å¢ƒä¿¡æ¯è®°å½•"></a>4.2 ç¯å¢ƒä¿¡æ¯è®°å½•</h3><table>
<thead>
<tr>
<th>ä¿¡æ¯ç»´åº¦</th>
<th>é‡‡é›†å­—æ®µ</th>
<th>éšç§å¤„ç†</th>
</tr>
</thead>
<tbody><tr>
<td>è®¾å¤‡ä¿¡æ¯</td>
<td>å‹å·ã€OSç‰ˆæœ¬ã€åˆ†è¾¨ç‡</td>
<td>MD5å“ˆå¸Œå¤„ç†</td>
</tr>
<tr>
<td>ç½‘ç»œç¯å¢ƒ</td>
<td>è¿æ¥ç±»å‹ã€ä¿¡å·å¼ºåº¦ã€IPåœ°å€</td>
<td>è„±æ•å¤„ç†</td>
</tr>
<tr>
<td>ç”¨æˆ·ä¸Šä¸‹æ–‡</td>
<td>å½“å‰é¡µé¢ã€ç™»å½•çŠ¶æ€ã€æ—¶åŒº</td>
<td>åŠ å¯†å­˜å‚¨</td>
</tr>
</tbody></table>
<hr>
<p><strong>æœ€ä½³å®è·µæ¨è</strong>ï¼š</p>
<ol>
<li>ä½¿ç”¨<a href="https://opentelemetry.io/">OpenTelemetry</a>å®ç°æ ‡å‡†åŒ–æ—¥å¿—é‡‡é›†</li>
<li>é€šè¿‡<a href="https://grafana.com/oss/loki/">Grafana Loki</a>æ„å»ºæ—¥å¿—ç›‘æ§ä½“ç³»</li>
<li>é‡‡ç”¨<a href="https://www.splunk.com/">Splunk</a>è¿›è¡Œæ—¥å¿—åˆ†æä¸å‘Šè­¦</li>
</ol>
<blockquote>
<p>æ–‡æ¡£ç‰ˆæœ¬ï¼šv2.3.1<br>æ›´æ–°æ—¥æœŸï¼š2025-03-14</p>
</blockquote>
]]></content>
      <categories>
        <category>å·¥ç¨‹å®è·µ</category>
      </categories>
      <tags>
        <tag>ç§»åŠ¨å¼€å‘</tag>
        <tag>æ—¥å¿—ç³»ç»Ÿ</tag>
        <tag>å¯è§‚æµ‹æ€§</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸è§ç®—æ³•è€ƒé¢˜åˆ—è¡¨ï¼ˆ2025 å¹´æ•´ç†ï¼‰</title>
    <url>/2024/01/01/%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<hr>
<p>æœ¬æ–‡æ•´ç†äº†å¸¸è§çš„ç®—æ³•é¢è¯•é¢˜ç›®ï¼ŒåŒ…æ‹¬æ•°æ®ç»“æ„ã€åŸºç¡€ç®—æ³•å’Œé«˜çº§ç®—æ³•ç­‰å¤šä¸ªæ–¹é¢çš„å…¸å‹é¢˜ç›®ã€‚</p>
<hr>
<h2 id="ğŸ“š-æ•°æ®ç»“æ„ä¸åŸºç¡€ç®—æ³•"><a href="#ğŸ“š-æ•°æ®ç»“æ„ä¸åŸºç¡€ç®—æ³•" class="headerlink" title="ğŸ“š æ•°æ®ç»“æ„ä¸åŸºç¡€ç®—æ³•"></a>ğŸ“š <strong>æ•°æ®ç»“æ„ä¸åŸºç¡€ç®—æ³•</strong></h2><h3 id="1-æ•°ç»„ä¸é“¾è¡¨"><a href="#1-æ•°ç»„ä¸é“¾è¡¨" class="headerlink" title="1. æ•°ç»„ä¸é“¾è¡¨"></a>1. <strong>æ•°ç»„ä¸é“¾è¡¨</strong></h3><ul>
<li><strong>ä¸¤æ•°ä¹‹å’Œ</strong>é¢˜ç›®ï¼šåœ¨æ•°ç»„ä¸­æ‰¾å‡ºå’Œä¸º <code>target</code> çš„ä¸¤ä¸ªå…ƒç´ çš„ä¸‹æ ‡ã€‚è€ƒå¯Ÿç‚¹ï¼šå“ˆå¸Œè¡¨ã€ç©ºé—´æ¢æ—¶é—´ä¼˜åŒ–:cite[3]:cite[7]</li>
<li><strong>åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</strong>é¢˜ç›®ï¼šå°†ä¸¤ä¸ªå‡åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°é“¾è¡¨ã€‚è€ƒå¯Ÿç‚¹ï¼šæŒ‡é’ˆæ“ä½œã€é€’å½’&#x2F;è¿­ä»£å®ç°:cite[3]:cite[7]</li>
<li><strong>åè½¬é“¾è¡¨</strong><br>é¢˜ç›®ï¼šå°†å•é“¾è¡¨åè½¬ï¼ˆè¿­ä»£æˆ–é€’å½’å®ç°ï¼‰ã€‚<br>è€ƒå¯Ÿç‚¹ï¼šæŒ‡é’ˆæ“ä½œã€é€’å½’æ€ç»´:cite[2]:cite[7]</li>
</ul>
<h3 id="2-å­—ç¬¦ä¸²"><a href="#2-å­—ç¬¦ä¸²" class="headerlink" title="2. å­—ç¬¦ä¸²"></a>2. <strong>å­—ç¬¦ä¸²</strong></h3><ul>
<li><strong>æœ€é•¿å›æ–‡å­ä¸²</strong>é¢˜ç›®ï¼šæ‰¾åˆ°å­—ç¬¦ä¸²ä¸­çš„æœ€é•¿å›æ–‡å­ä¸²ã€‚è€ƒå¯Ÿç‚¹ï¼šä¸­å¿ƒæ‰©æ•£æ³•ã€åŠ¨æ€è§„åˆ’:cite[2]:cite[7]</li>
<li><strong>ç¬¬ä¸€ä¸ªä¸é‡å¤çš„å­—ç¬¦</strong>é¢˜ç›®ï¼šæ‰¾åˆ°å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦çš„ä¸‹æ ‡ã€‚è€ƒå¯Ÿç‚¹ï¼šå“ˆå¸Œè¡¨ç»Ÿè®¡é¢‘ç‡:cite[7]</li>
<li><strong>ç‰ˆæœ¬å·æ’åº</strong><br>é¢˜ç›®ï¼šå°†ç‰ˆæœ¬å·æ•°ç»„æŒ‰ä»å¤§åˆ°å°æ’åºï¼ˆå¦‚ <code>[&#39;10.2.1&#39;, &#39;0.402.1&#39;]</code>ï¼‰ã€‚<br>è€ƒå¯Ÿç‚¹ï¼šå­—ç¬¦ä¸²åˆ†å‰²ã€å¤šçº§æ¯”è¾ƒ:cite[7]</li>
</ul>
<h3 id="3-æ ‘ä¸å›¾"><a href="#3-æ ‘ä¸å›¾" class="headerlink" title="3. æ ‘ä¸å›¾"></a>3. <strong>æ ‘ä¸å›¾</strong></h3><ul>
<li><strong>å¯¹ç§°äºŒå‰æ ‘</strong>é¢˜ç›®ï¼šåˆ¤æ–­äºŒå‰æ ‘æ˜¯å¦é•œåƒå¯¹ç§°ã€‚è€ƒå¯Ÿç‚¹ï¼šé€’å½’éå†ã€å±‚åºéå†:cite[3]:cite[7]</li>
<li><strong>äºŒå‰æ ‘çš„ä¸­åºéå†</strong>é¢˜ç›®ï¼šå®ç°éé€’å½’ä¸­åºéå†ã€‚è€ƒå¯Ÿç‚¹ï¼šæ ˆçš„åº”ç”¨ã€Morris éå†:cite[2]:cite[7]</li>
<li><strong>å…‹éš†å›¾</strong><br>é¢˜ç›®ï¼šæ·±åº¦æ‹·è´æ— å‘è¿é€šå›¾ã€‚<br>è€ƒå¯Ÿç‚¹ï¼šDFS&#x2F;BFSã€å“ˆå¸Œè¡¨è®°å½•å·²è®¿é—®èŠ‚ç‚¹:cite[3]</li>
</ul>
<hr>
<h2 id="âš™ï¸-é«˜çº§ç®—æ³•ä¸ä¼˜åŒ–"><a href="#âš™ï¸-é«˜çº§ç®—æ³•ä¸ä¼˜åŒ–" class="headerlink" title="âš™ï¸ é«˜çº§ç®—æ³•ä¸ä¼˜åŒ–"></a>âš™ï¸ <strong>é«˜çº§ç®—æ³•ä¸ä¼˜åŒ–</strong></h2><h3 id="1-æ’åºä¸æœç´¢"><a href="#1-æ’åºä¸æœç´¢" class="headerlink" title="1. æ’åºä¸æœç´¢"></a>1. <strong>æ’åºä¸æœç´¢</strong></h3><ul>
<li><strong>å¿«é€Ÿæ’åº</strong>é¢˜ç›®ï¼šå®ç°å¿«é€Ÿæ’åºå¹¶åˆ†ææ—¶é—´å¤æ‚åº¦ã€‚è€ƒå¯Ÿç‚¹ï¼šåˆ†æ²»æ€æƒ³ã€åŸºå‡†é€‰æ‹©ä¼˜åŒ–:cite[1]:cite[7]</li>
<li><strong>äºŒåˆ†æŸ¥æ‰¾</strong>é¢˜ç›®ï¼šåœ¨æœ‰åºæ•°ç»„ä¸­æŸ¥æ‰¾ç›®æ ‡å€¼çš„ä½ç½®ã€‚è€ƒå¯Ÿç‚¹ï¼šè¾¹ç•Œæ¡ä»¶å¤„ç†ã€å¾ªç¯ä¸å˜é‡:cite[1]:cite[7]</li>
<li><strong>ç¬¬ K ä¸ªæœ€å¤§å…ƒç´ </strong><br>é¢˜ç›®ï¼šåœ¨æœªæ’åºæ•°ç»„ä¸­æ‰¾åˆ°ç¬¬ K å¤§çš„å…ƒç´ ã€‚<br>è€ƒå¯Ÿç‚¹ï¼šå¿«é€Ÿé€‰æ‹©ç®—æ³•ã€å †æ’åº:cite[3]</li>
</ul>
<h3 id="2-åŠ¨æ€è§„åˆ’"><a href="#2-åŠ¨æ€è§„åˆ’" class="headerlink" title="2. åŠ¨æ€è§„åˆ’"></a>2. <strong>åŠ¨æ€è§„åˆ’</strong></h3><ul>
<li><strong>æœ€é•¿é€’å¢å­åºåˆ—</strong>é¢˜ç›®ï¼šæ±‚æ•°ç»„ä¸­æœ€é•¿ä¸¥æ ¼é€’å¢å­åºåˆ—çš„é•¿åº¦ã€‚è€ƒå¯Ÿç‚¹ï¼šçŠ¶æ€è½¬ç§»æ–¹ç¨‹ã€äºŒåˆ†ä¼˜åŒ–:cite[3]:cite[7]</li>
<li><strong>èƒŒåŒ…é—®é¢˜</strong>é¢˜ç›®ï¼š0-1 èƒŒåŒ…é—®é¢˜çš„åŠ¨æ€è§„åˆ’è§£æ³•ã€‚è€ƒå¯Ÿç‚¹ï¼šäºŒç»´ DP è¡¨ã€ç©ºé—´å‹ç¼©:cite[4]:cite[8]</li>
<li><strong>ç¼–è¾‘è·ç¦»</strong><br>é¢˜ç›®ï¼šè®¡ç®—å°†å­—ç¬¦ä¸² A è½¬æ¢ä¸º B çš„æœ€å°æ“ä½œæ¬¡æ•°ï¼ˆå¢&#x2F;åˆ &#x2F;æ”¹ï¼‰ã€‚<br>è€ƒå¯Ÿç‚¹ï¼šäºŒç»´ DPã€çŠ¶æ€è½¬ç§»æ–¹ç¨‹:cite[7]</li>
</ul>
<h3 id="3-è´ªå¿ƒä¸å›æº¯"><a href="#3-è´ªå¿ƒä¸å›æº¯" class="headerlink" title="3. è´ªå¿ƒä¸å›æº¯"></a>3. <strong>è´ªå¿ƒä¸å›æº¯</strong></h3><ul>
<li><strong>è·³è·ƒæ¸¸æˆ</strong>é¢˜ç›®ï¼šåˆ¤æ–­èƒ½å¦ä»æ•°ç»„èµ·ç‚¹è·³åˆ°ç»ˆç‚¹ï¼ˆæ¯æ­¥æœ€å¤§è·³è·ƒé•¿åº¦ä¸º <code>nums[i]</code>ï¼‰ã€‚è€ƒå¯Ÿç‚¹ï¼šè´ªå¿ƒç­–ç•¥ã€æœ€å¤§è¦†ç›–èŒƒå›´:cite[7]</li>
<li><strong>å…¨æ’åˆ—</strong>é¢˜ç›®ï¼šç”Ÿæˆæ•°ç»„çš„æ‰€æœ‰æ’åˆ—ç»„åˆã€‚è€ƒå¯Ÿç‚¹ï¼šå›æº¯ç®—æ³•ã€å‰ªæä¼˜åŒ–:cite[7]</li>
<li><strong>ç»„åˆæ€»å’Œ</strong><br>é¢˜ç›®ï¼šæ‰¾å‡ºæ•°ç»„ä¸­æ‰€æœ‰å’Œä¸º <code>target</code> çš„ç»„åˆï¼ˆå…ƒç´ å¯é‡å¤ä½¿ç”¨ï¼‰ã€‚<br>è€ƒå¯Ÿç‚¹ï¼šå›æº¯ã€å»é‡æŠ€å·§:cite[7]</li>
</ul>
<hr>
<h2 id="ğŸ§©-ç³»ç»Ÿè®¾è®¡ä¸åœºæ™¯é¢˜"><a href="#ğŸ§©-ç³»ç»Ÿè®¾è®¡ä¸åœºæ™¯é¢˜" class="headerlink" title="ğŸ§© ç³»ç»Ÿè®¾è®¡ä¸åœºæ™¯é¢˜"></a>ğŸ§© <strong>ç³»ç»Ÿè®¾è®¡ä¸åœºæ™¯é¢˜</strong></h2><h3 id="1-æ•°æ®ç»“æ„è®¾è®¡"><a href="#1-æ•°æ®ç»“æ„è®¾è®¡" class="headerlink" title="1. æ•°æ®ç»“æ„è®¾è®¡"></a>1. <strong>æ•°æ®ç»“æ„è®¾è®¡</strong></h3><ul>
<li><strong>LRU ç¼“å­˜</strong>é¢˜ç›®ï¼šè®¾è®¡åŸºäº LRU ç­–ç•¥çš„ç¼“å­˜ï¼Œæ”¯æŒ <code>get</code> å’Œ <code>put</code> æ“ä½œã€‚è€ƒå¯Ÿç‚¹ï¼šå“ˆå¸Œè¡¨ + åŒå‘é“¾è¡¨:cite[2]:cite[7]</li>
<li><strong>æœ€å°æ ˆ</strong><br>é¢˜ç›®ï¼šå®ç°ä¸€ä¸ªæ”¯æŒ <code>push</code>ã€<code>pop</code>ã€<code>top</code> åŠ <code>getMin</code> çš„æ ˆã€‚<br>è€ƒå¯Ÿç‚¹ï¼šè¾…åŠ©æ ˆæˆ–å·®å€¼å­˜å‚¨:cite[3]</li>
</ul>
<h3 id="2-åœºæ™¯é—®é¢˜"><a href="#2-åœºæ™¯é—®é¢˜" class="headerlink" title="2. åœºæ™¯é—®é¢˜"></a>2. <strong>åœºæ™¯é—®é¢˜</strong></h3><ul>
<li><strong>ä¼šè®®å®¤å®‰æ’</strong>é¢˜ç›®ï¼šç»™å®šå¤šä¸ªä¼šè®®æ—¶é—´åŒºé—´ï¼Œåˆ¤æ–­èƒ½å¦å…¨éƒ¨å®‰æ’ã€‚è€ƒå¯Ÿç‚¹ï¼šåŒºé—´æ’åºã€é‡å æ£€æµ‹:cite[7]</li>
<li><strong>æ¥é›¨æ°´</strong><br>é¢˜ç›®ï¼šè®¡ç®—æŸ±å­é«˜åº¦æ•°ç»„èƒ½æ¥å¤šå°‘é›¨æ°´ã€‚<br>è€ƒå¯Ÿç‚¹ï¼šåŒæŒ‡é’ˆã€åŠ¨æ€è§„åˆ’æˆ–å•è°ƒæ ˆ:cite[7]</li>
</ul>
<hr>
<h2 id="ğŸ“ˆ-å¤æ‚åº¦ä¸ä¼˜åŒ–"><a href="#ğŸ“ˆ-å¤æ‚åº¦ä¸ä¼˜åŒ–" class="headerlink" title="ğŸ“ˆ å¤æ‚åº¦ä¸ä¼˜åŒ–"></a>ğŸ“ˆ <strong>å¤æ‚åº¦ä¸ä¼˜åŒ–</strong></h2><ul>
<li><strong>æ—¶é—´å¤æ‚åº¦åˆ†æ</strong>å¸¸è§é˜¶ï¼šO(1)ã€O(n)ã€O(nÂ²)ã€O(nlogn) ç­‰ï¼Œéœ€ç»“åˆä»£ç è§£é‡Š:cite[4]:cite[8]</li>
<li><strong>ç©ºé—´å¤æ‚åº¦ä¼˜åŒ–</strong><br>ä¾‹å¦‚ï¼šåŸåœ°æ’åºã€æ»šåŠ¨æ•°ç»„ã€ä½è¿ç®—å‹ç¼©çŠ¶æ€:cite[4]:cite[7]</li>
</ul>
<hr>
<blockquote>
<p><strong>æç¤º</strong>ï¼šä»¥ä¸Šé¢˜ç›®è¦†ç›–äº†ç®—æ³•é¢è¯• 80% çš„é«˜é¢‘è€ƒç‚¹ï¼Œå»ºè®®ç»“åˆ LeetCode æˆ–ã€Šå‰‘æŒ‡ Offerã€‹è¿›è¡Œé’ˆå¯¹æ€§ç»ƒä¹ ã€‚<br><strong>å®Œæ•´é¢˜ç›®ä¸ä»£ç å®ç°</strong>å¯å‚è€ƒï¼š<a href="https://blog.csdn.net/Ed7zgeE9X/article/details/132288312">CSDN ç®—æ³•é¢˜æ•´ç†</a>:cite[7] | <a href="https://leetcode.com/">åŠ›æ‰£é¢˜åº“</a></p>
</blockquote>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>é¢è¯•</tag>
        <tag>æ•°æ®ç»“æ„</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºäºAIåŠ©æ‰‹çš„å¤šè¯­è¨€ç¿»è¯‘ç³»ç»Ÿå¼€å‘å®è·µ</title>
    <url>/2025/03/19/%E5%9F%BA%E4%BA%8EAI%E5%8A%A9%E6%89%8B%E7%9A%84%E5%A4%9A%E8%AF%AD%E8%A8%80%E7%BF%BB%E8%AF%91%E7%B3%BB%E7%BB%9F%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5/</url>
    <content><![CDATA[<h1 id="åŸºäºAIåŠ©æ‰‹çš„å¤šè¯­è¨€ç¿»è¯‘ç³»ç»Ÿå¼€å‘å®è·µ"><a href="#åŸºäºAIåŠ©æ‰‹çš„å¤šè¯­è¨€ç¿»è¯‘ç³»ç»Ÿå¼€å‘å®è·µ" class="headerlink" title="åŸºäºAIåŠ©æ‰‹çš„å¤šè¯­è¨€ç¿»è¯‘ç³»ç»Ÿå¼€å‘å®è·µ"></a>åŸºäºAIåŠ©æ‰‹çš„å¤šè¯­è¨€ç¿»è¯‘ç³»ç»Ÿå¼€å‘å®è·µ</h1><h2 id="ä¸€ã€é¡¹ç›®èƒŒæ™¯"><a href="#ä¸€ã€é¡¹ç›®èƒŒæ™¯" class="headerlink" title="ä¸€ã€é¡¹ç›®èƒŒæ™¯"></a>ä¸€ã€é¡¹ç›®èƒŒæ™¯</h2><p>åœ¨å…¨çƒåŒ–äº§å“å¼€å‘èƒŒæ™¯ä¸‹ï¼Œæˆ‘ä»¬åŸºäºPythonæ„å»ºæ”¯æŒGoogleç¿»è¯‘ä¸LLMå¤§æ¨¡å‹çš„åŒå¼•æ“ç¿»è¯‘ç³»ç»Ÿã€‚æ ¸å¿ƒæ¨¡å—é€šè¿‡ <code>translate_api.py</code>å®ç°ï¼Œæ—¥å‡å¤„ç†iOS&#x2F;Android&#x2F;Webå¤šç«¯50+è¯­è¨€çš„ç™¾ä¸‡çº§å­—ç¬¦ç¿»è¯‘éœ€æ±‚ã€‚</p>
<p>åœ¨å…¨çƒåŒ–äº§å“å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æ„å»ºäº†åŸºäºPythonçš„å¤šè¯­è¨€ç¿»è¯‘ç³»ç»Ÿï¼Œæ”¯æŒGoogleç¿»è¯‘å’Œå¤§æ¨¡å‹ç¿»è¯‘åŒå¼•æ“ï¼Œé€šè¿‡ <code>translate_api.py</code>å®ç°æ ¸å¿ƒç¿»è¯‘é€»è¾‘ã€‚ç³»ç»Ÿéœ€è¦å¤„ç†iOS&#x2F;Android&#x2F;Webå¤šç«¯è¶…è¿‡50ç§è¯­è¨€çš„å®æ—¶ç¿»è¯‘éœ€æ±‚ï¼Œæ—¥å‡å¤„ç†é‡è¾¾ç™¾ä¸‡çº§å­—ç¬¦ã€‚</p>
<h2 id="äºŒã€æ¶æ„è®¾è®¡äº®ç‚¹"><a href="#äºŒã€æ¶æ„è®¾è®¡äº®ç‚¹" class="headerlink" title="äºŒã€æ¶æ„è®¾è®¡äº®ç‚¹"></a>äºŒã€æ¶æ„è®¾è®¡äº®ç‚¹</h2><h3 id="1-åŒå¼•æ“å®¹é”™æœºåˆ¶"><a href="#1-åŒå¼•æ“å®¹é”™æœºåˆ¶" class="headerlink" title="1. åŒå¼•æ“å®¹é”™æœºåˆ¶"></a>1. åŒå¼•æ“å®¹é”™æœºåˆ¶</h3><p>é€šè¿‡ <code>TranslatorFactory</code> class in <code>translate_api.py</code>å®ç°ç¿»è¯‘å¼•æ“çš„åŠ¨æ€åˆ‡æ¢ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TranslatorType</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    LLM = <span class="string">&quot;LLM&quot;</span></span><br><span class="line">    GOOGLE = <span class="string">&quot;GOOGLE&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TranslatorFactory</span>:</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_translator</span>(<span class="params">translator_type: TranslatorType</span>) -&gt; BaseTranslator:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        ç¿»è¯‘å™¨å·¥å‚æ–¹æ³•</span></span><br><span class="line"><span class="string">        :param translator_type: ç¿»è¯‘å™¨ç±»å‹æšä¸¾</span></span><br><span class="line"><span class="string">        :return: å¯¹åº”ç±»å‹çš„ç¿»è¯‘å™¨å®ä¾‹</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> translator_type == TranslatorType.LLM:</span><br><span class="line">            <span class="keyword">return</span> LLMTranslate()</span><br><span class="line">        <span class="keyword">elif</span> translator_type == TranslatorType.GOOGLE:</span><br><span class="line">            <span class="keyword">return</span> GoogleTranslate()</span><br></pre></td></tr></table></figure>

<h3 id="2-å¼‚æ­¥å¹¶å‘æ¨¡å‹"><a href="#2-å¼‚æ­¥å¹¶å‘æ¨¡å‹" class="headerlink" title="2. å¼‚æ­¥å¹¶å‘æ¨¡å‹"></a>2. å¼‚æ­¥å¹¶å‘æ¨¡å‹</h3><p>åœ¨ <code>LLMTranslate.translate_all_async</code> functionä¸­å®ç°é«˜æ•ˆå¹¶å‘ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">translate_all_async</span>(<span class="params">self, zh_cn_json: <span class="type">Dict</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">    tasks = [<span class="variable language_">self</span>.translate_batch_async(...) <span class="keyword">for</span> lan <span class="keyword">in</span> lang_tasks]</span><br><span class="line">    results = <span class="keyword">await</span> asyncio.gather(*tasks)</span><br><span class="line">    <span class="comment"># ç»“æœåˆå¹¶é€»è¾‘...</span></span><br></pre></td></tr></table></figure>

<h3 id="3-æ™ºèƒ½é‡è¯•æœºåˆ¶"><a href="#3-æ™ºèƒ½é‡è¯•æœºåˆ¶" class="headerlink" title="3. æ™ºèƒ½é‡è¯•æœºåˆ¶"></a>3. æ™ºèƒ½é‡è¯•æœºåˆ¶</h3><p>Googleç¿»è¯‘æ¨¡å—å®ç°ä¸‰çº§é‡è¯•ç­–ç•¥ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">_google_translate</span>(<span class="params">self, input_dict, from_lang, to_lang, retry_count=<span class="number">3</span></span>):</span><br><span class="line">    <span class="keyword">if</span> retry_count &lt;= <span class="number">0</span>:</span><br><span class="line">        <span class="variable language_">self</span>.logger.error(<span class="string">&quot;è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    <span class="comment"># åˆ†å—å¤„ç†ä¸å¼‚å¸¸é‡è¯•é€»è¾‘...</span></span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€AIåŠ©æ‰‹ç¼–ç¨‹å®è·µå¿ƒå¾—"><a href="#ä¸‰ã€AIåŠ©æ‰‹ç¼–ç¨‹å®è·µå¿ƒå¾—" class="headerlink" title="ä¸‰ã€AIåŠ©æ‰‹ç¼–ç¨‹å®è·µå¿ƒå¾—"></a>ä¸‰ã€AIåŠ©æ‰‹ç¼–ç¨‹å®è·µå¿ƒå¾—</h2><h3 id="1-ä»£ç ç”Ÿæˆæ•ˆç‡æå‡"><a href="#1-ä»£ç ç”Ÿæˆæ•ˆç‡æå‡" class="headerlink" title="1. ä»£ç ç”Ÿæˆæ•ˆç‡æå‡"></a>1. ä»£ç ç”Ÿæˆæ•ˆç‡æå‡</h3><p>åœ¨å®ç°å¼‚æ­¥ç¿»è¯‘æ—¶ï¼ŒAIåŠ©æ‰‹å¿«é€Ÿç”Ÿæˆæ­£ç¡®çš„äº‹ä»¶å¾ªç¯ç»“æ„ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">translate_all</span>(<span class="params">self, zh_cn_json: <span class="type">Dict</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">    <span class="keyword">return</span> asyncio.run(<span class="variable language_">self</span>.translate_all_async(zh_cn_json))</span><br></pre></td></tr></table></figure>

<h3 id="2-è®¾è®¡æ¨¡å¼åº”ç”¨æŒ‡å¯¼"><a href="#2-è®¾è®¡æ¨¡å¼åº”ç”¨æŒ‡å¯¼" class="headerlink" title="2. è®¾è®¡æ¨¡å¼åº”ç”¨æŒ‡å¯¼"></a>2. è®¾è®¡æ¨¡å¼åº”ç”¨æŒ‡å¯¼</h3><p>å½“éœ€è¦æ‰©å±•ç¿»è¯‘å¼•æ“æ—¶ï¼ŒAIåŠ©æ‰‹å»ºè®®é‡‡ç”¨å·¥å‚æ¨¡å¼ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TranslatorType</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    LLM = <span class="string">&quot;LLM&quot;</span></span><br><span class="line">    GOOGLE = <span class="string">&quot;GOOGLE&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TranslatorFactory</span>:</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_translator</span>(<span class="params">translator_type: TranslatorType</span>) -&gt; BaseTranslator:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        ç¿»è¯‘å™¨å·¥å‚æ–¹æ³•</span></span><br><span class="line"><span class="string">        :param translator_type: ç¿»è¯‘å™¨ç±»å‹æšä¸¾</span></span><br><span class="line"><span class="string">        :return: å¯¹åº”ç±»å‹çš„ç¿»è¯‘å™¨å®ä¾‹</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-æ€§èƒ½ä¼˜åŒ–å»ºè®®"><a href="#3-æ€§èƒ½ä¼˜åŒ–å»ºè®®" class="headerlink" title="3. æ€§èƒ½ä¼˜åŒ–å»ºè®®"></a>3. æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3><p>AIåŠ©æ‰‹å¸®åŠ©è¯†åˆ«åŒæ­¥é˜»å¡ç‚¹ï¼Œå°† <code>GoogleTranslate.translate_all</code> functionæ”¹é€ ä¸ºå¼‚æ­¥ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">translate_all_async</span>(<span class="params">self, zh_cn_json: <span class="type">Dict</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">    <span class="comment"># ä¸¤é˜¶æ®µå¹¶å‘ç¿»è¯‘æµç¨‹...</span></span><br></pre></td></tr></table></figure>

<h3 id="4-å¼‚å¸¸å¤„ç†å¢å¼º"><a href="#4-å¼‚å¸¸å¤„ç†å¢å¼º" class="headerlink" title="4. å¼‚å¸¸å¤„ç†å¢å¼º"></a>4. å¼‚å¸¸å¤„ç†å¢å¼º</h3><p>åœ¨ <code>translate_and_check</code> functionä¸­å®ç°æ™ºèƒ½é™çº§ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">translate_and_check</span>(<span class="params">zh_cn_json: <span class="type">Dict</span>, max_retries=<span class="number">3</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">    <span class="keyword">for</span> engine <span class="keyword">in</span> [TranslatorType.LLM, TranslatorType.GOOGLE]:</span><br><span class="line">        <span class="keyword">while</span> retries &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># å°è¯•ç¿»è¯‘...</span></span><br></pre></td></tr></table></figure>

<h3 id="5-è‡ªåŠ¨ç”Ÿæˆè„šæ‰‹æ¶åŠç›¸å…³é…ç½®"><a href="#5-è‡ªåŠ¨ç”Ÿæˆè„šæ‰‹æ¶åŠç›¸å…³é…ç½®" class="headerlink" title="5.è‡ªåŠ¨ç”Ÿæˆè„šæ‰‹æ¶åŠç›¸å…³é…ç½®"></a>5.è‡ªåŠ¨ç”Ÿæˆè„šæ‰‹æ¶åŠç›¸å…³é…ç½®</h3><p>è‡ªåŠ¨ç”Ÿæˆsetup.pyå¡«å†™ä¾èµ–åŒ…ã€‚</p>
<p>è‡ªåŠ¨ç”ŸæˆREADME.mdæ€»ç»“é¡¹ç›®å†…å®¹ï¼Œç”Ÿæˆåˆå§‹åŒ–æ–¹æ³•ã€‚</p>
<h2 id="å››ã€å¼€å‘å·¥å…·é“¾"><a href="#å››ã€å¼€å‘å·¥å…·é“¾" class="headerlink" title="å››ã€å¼€å‘å·¥å…·é“¾"></a>å››ã€å¼€å‘å·¥å…·é“¾</h2><h3 id="å¼€å‘å·¥å…·"><a href="#å¼€å‘å·¥å…·" class="headerlink" title="å¼€å‘å·¥å…·"></a>å¼€å‘å·¥å…·</h3><ol>
<li><strong>Traeä»£ç ç¼–è¾‘å™¨</strong>ï¼šé€šè¿‡é™æ€åˆ†æå®æ—¶æ£€æµ‹ <code>await</code>å…³é”®å­—ç¼ºå¤±é—®é¢˜</li>
<li><strong>AIè¾…åŠ©è°ƒè¯•</strong>ï¼šé€šè¿‡å¼‚å¸¸å †æ ˆåˆ†æç²¾å‡†å®šä½ç½‘ç»œè¶…æ—¶é—®é¢˜</li>
<li><strong>æ€§èƒ½æµ‹è¯•å·¥å…·</strong>ï¼šä½¿ç”¨pytest-asyncioè¿›è¡Œå¹¶å‘å‹åŠ›æµ‹è¯•</li>
</ol>
<h2 id="äº”ã€å®è·µå»ºè®®"><a href="#äº”ã€å®è·µå»ºè®®" class="headerlink" title="äº”ã€å®è·µå»ºè®®"></a>äº”ã€å®è·µå»ºè®®</h2><ol>
<li>ä½¿ç”¨ç±»å‹æ³¨è§£æå‡ä»£ç å¯è¯»æ€§ï¼š</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">translate_batch_async</span>(<span class="params">self, data: TranslationRequest</span>) -&gt; <span class="type">Dict</span>:</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å»ºç«‹å®Œå–„çš„ç›‘æ§æŒ‡æ ‡ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç›‘æ§å¹³å‡ç¿»è¯‘è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰</span></span><br><span class="line">grep <span class="string">&#x27;ç¿»è¯‘ä»»åŠ¡å®Œæˆ&#x27;</span> application.log \</span><br><span class="line">  | awk -F<span class="string">&#x27;=&#x27;</span> <span class="string">&#x27;&#123;sum+=$NF; count++&#125; END &#123;print &quot;å¹³å‡è€—æ—¶:&quot;, sum/count, &quot;ms&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>é…ç½®ç®¡ç†è§„èŒƒåŒ–ï¼š</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> TRANSLATE_BY_EN, TRANSLATE_BY_ZH</span><br></pre></td></tr></table></figure>

<h2 id="å…­ã€æ€»ç»“ä¸å±•æœ›"><a href="#å…­ã€æ€»ç»“ä¸å±•æœ›" class="headerlink" title="å…­ã€æ€»ç»“ä¸å±•æœ›"></a>å…­ã€æ€»ç»“ä¸å±•æœ›</h2><h3 id="6-1-é¡¹ç›®æˆæœ"><a href="#6-1-é¡¹ç›®æˆæœ" class="headerlink" title="6.1 é¡¹ç›®æˆæœ"></a>6.1 é¡¹ç›®æˆæœ</h3><p>é€šè¿‡AIåŠ©æ‰‹ä¸Traeç¼–è¾‘å™¨çš„é…åˆï¼Œæˆ‘ä»¬å®ç°äº†ï¼šå¼€å‘æ•ˆç‡æå‡40%ï¼Œç¿»è¯‘æ€§èƒ½ä»å•æ¬¡è¯·æ±‚2sä¼˜åŒ–åˆ°200msã€‚</p>
<p>å…³é”®æ”¶è·ï¼š</p>
<ol>
<li>AIåŠ©æ‰‹èƒ½å¿«é€Ÿå®ç°æŠ€æœ¯æ–¹æ¡ˆéªŒè¯ï¼Œä½†éœ€è¦å¼€å‘è€…æŠŠæ§æ¶æ„åˆç†æ€§</li>
<li>è‰¯å¥½çš„ä»£ç æŠ½è±¡æ˜¯AIç”Ÿæˆæœ‰æ•ˆä»£ç çš„å‰æ</li>
<li>æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰æ¨¡å¼ä¸AIç”Ÿæˆä»£ç å…·æœ‰è‰¯å¥½ååŒæ•ˆåº”</li>
</ol>
<p>æœªæ¥è®¡åˆ’å°†AIåŠ©æ‰‹åº”ç”¨äºï¼š</p>
<ol>
<li>è‡ªåŠ¨ç”Ÿæˆå•å…ƒæµ‹è¯•ç”¨ä¾‹</li>
<li>æ™ºèƒ½è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ</li>
<li>å¤šè¯­è¨€ç¿»è¯‘è´¨é‡è‡ªåŠ¨æ ¡éªŒ</li>
</ol>
<p>AIç¼–ç¨‹åŠ©æ‰‹æ­£åœ¨æˆä¸ºç°ä»£è½¯ä»¶å¼€å‘çš„æ–°ç”Ÿäº§åŠ›å·¥å…·ï¼Œä½†å¦‚ä½•ä¸å¼€å‘è€…å½¢æˆã€ŒäººæœºååŒã€çš„æœ€ä½³å®è·µï¼Œä»æ˜¯æˆ‘ä»¬éœ€è¦æŒç»­æ¢ç´¢çš„æ–¹å‘ã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>AIGC</tag>
        <tag>i18n</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>iOS é¢è¯•é«˜é¢‘é—®é¢˜æ€»ç»“ï¼ˆ2025 æœ€æ–°ç‰ˆï¼‰</title>
    <url>/2024/01/01/%E9%AB%98%E9%A2%91%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<hr>
<p>æœ¬æ–‡æ€»ç»“äº†iOSå¼€å‘é¢è¯•ä¸­çš„é«˜é¢‘é—®é¢˜ï¼Œæ¶µç›–è¯­è¨€åŸºç¡€ã€æ¡†æ¶åº”ç”¨ã€æ€§èƒ½ä¼˜åŒ–ç­‰å¤šä¸ªæ–¹é¢ã€‚</p>
<hr>
<h2 id="ğŸ¯-è¯­è¨€åŸºç¡€ï¼ˆSwiftï¼‰"><a href="#ğŸ¯-è¯­è¨€åŸºç¡€ï¼ˆSwiftï¼‰" class="headerlink" title="ğŸ¯ è¯­è¨€åŸºç¡€ï¼ˆSwiftï¼‰"></a>ğŸ¯ è¯­è¨€åŸºç¡€ï¼ˆSwiftï¼‰</h2><ol>
<li><p><strong>å€¼ç±»å‹ vs å¼•ç”¨ç±»å‹</strong></p>
<ul>
<li>ç»“æ„ä½“&#x2F;æšä¸¾ä¸ç±»çš„æœ¬è´¨åŒºåˆ«ï¼Ÿ</li>
<li>å¦‚ä½•é€‰æ‹© <code>struct</code> å’Œ <code>class</code> çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ</li>
</ul>
</li>
<li><p><strong>åè®®ä¸æ³›å‹</strong></p>
<ul>
<li><code>associatedtype</code> çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>å¦‚ä½•å®ç°ç±»å‹æ“¦é™¤ï¼ˆType Erasureï¼‰ï¼Ÿ</li>
</ul>
</li>
<li><p><strong>å†…å­˜ç®¡ç†</strong></p>
<ul>
<li>è§£é‡Š <code>weak</code>ã€<code>unowned</code>ã€<code>strong</code> çš„åŒºåˆ«</li>
<li>å¦‚ä½•æ£€æµ‹å’Œè§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Ÿ</li>
</ul>
</li>
<li><p><strong>Swift Concurrency</strong></p>
<ul>
<li><code>async/await</code> ä¸ Combine æ¡†æ¶çš„é€‚ç”¨åœºæ™¯å¯¹æ¯”</li>
<li><code>Sendable</code> åè®®çš„ä½œç”¨ä¸å®ç°è¦æ±‚</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ğŸ–¥ï¸-iOS-æ¡†æ¶"><a href="#ğŸ–¥ï¸-iOS-æ¡†æ¶" class="headerlink" title="ğŸ–¥ï¸ iOS æ¡†æ¶"></a>ğŸ–¥ï¸ iOS æ¡†æ¶</h2><h3 id="UIKit"><a href="#UIKit" class="headerlink" title="UIKit"></a>UIKit</h3><ol>
<li><p><strong>ç”Ÿå‘½å‘¨æœŸ</strong></p>
<ul>
<li><code>viewDidLoad</code> å’Œ <code>viewWillAppear</code> çš„åŒºåˆ«</li>
<li>å¦‚ä½•æ­£ç¡®ç®¡ç†è§†å›¾æ§åˆ¶å™¨çš„å†…å­˜ï¼Ÿ</li>
</ul>
</li>
<li><p><strong>å¸ƒå±€ä¸æ¸²æŸ“</strong></p>
<ul>
<li>Auto Layout æ€§èƒ½ä¼˜åŒ–æŠ€å·§</li>
<li>è§£é‡Š <code>drawRect</code> ä¸ <code>layoutSubviews</code> çš„è°ƒç”¨æ—¶æœº</li>
</ul>
</li>
<li><p><strong>å“åº”é“¾ä¸æ‰‹åŠ¿</strong></p>
<ul>
<li>æè¿° iOS äº‹ä»¶ä¼ é€’æœºåˆ¶ï¼ˆHit-Testingï¼‰</li>
<li>å¦‚ä½•å®ç°è‡ªå®šä¹‰æ‰‹åŠ¿è¯†åˆ«å™¨ï¼Ÿ</li>
</ul>
</li>
</ol>
<h3 id="SwiftUI"><a href="#SwiftUI" class="headerlink" title="SwiftUI"></a>SwiftUI</h3><ol>
<li><p><strong>çŠ¶æ€ç®¡ç†</strong></p>
<ul>
<li><code>@State</code>ã€<code>@Binding</code>ã€<code>@ObservedObject</code> çš„åŒºåˆ«</li>
<li>å¦‚ä½•å®ç°è·¨è§†å›¾çŠ¶æ€å…±äº«ï¼Ÿ</li>
</ul>
</li>
<li><p><strong>æ€§èƒ½ä¼˜åŒ–</strong></p>
<ul>
<li><code>LazyVStack</code> ä¸ <code>VStack</code> çš„æ€§èƒ½å·®å¼‚</li>
<li>å¦‚ä½•é¿å… SwiftUI è§†å›¾çš„æ— æ•ˆé‡ç»˜ï¼Ÿ</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ğŸ’¡-è®¾è®¡æ¨¡å¼ä¸æ¶æ„"><a href="#ğŸ’¡-è®¾è®¡æ¨¡å¼ä¸æ¶æ„" class="headerlink" title="ğŸ’¡ è®¾è®¡æ¨¡å¼ä¸æ¶æ„"></a>ğŸ’¡ è®¾è®¡æ¨¡å¼ä¸æ¶æ„</h2><ol>
<li><p><strong>MVVM å®ç°</strong></p>
<ul>
<li>å¦‚ä½•è®¾è®¡åŒå‘æ•°æ®ç»‘å®šï¼ˆç»“åˆ Combine&#x2F;Swift Concurrencyï¼‰ï¼Ÿ</li>
<li>ViewModel ä¸ Service å±‚çš„èŒè´£åˆ’åˆ†</li>
</ul>
</li>
<li><p><strong>ä¾èµ–æ³¨å…¥</strong></p>
<ul>
<li>æ‰‹åŠ¨ä¾èµ–æ³¨å…¥ vs æ¡†æ¶ï¼ˆå¦‚ Swinjectï¼‰çš„ä¼˜åŠ£</li>
<li>å¦‚ä½•åœ¨å•å…ƒæµ‹è¯•ä¸­åº”ç”¨ DIï¼Ÿ</li>
</ul>
</li>
<li><p><strong>æ¨¡å—åŒ–è®¾è®¡</strong></p>
<ul>
<li>å¦‚ä½•è§£è€¦å·¨å‹å•ä½“å·¥ç¨‹ï¼Ÿ</li>
<li>åŠ¨æ€åŒ–æ–¹æ¡ˆï¼ˆäºŒè¿›åˆ¶åŒ–&#x2F;æ’ä»¶åŒ–ï¼‰çš„å®ç°æ€è·¯</li>
</ul>
</li>
</ol>
<hr>
<h2 id="âš™ï¸-æ€§èƒ½ä¼˜åŒ–"><a href="#âš™ï¸-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="âš™ï¸ æ€§èƒ½ä¼˜åŒ–"></a>âš™ï¸ æ€§èƒ½ä¼˜åŒ–</h2><ol>
<li><p><strong>å¯åŠ¨ä¼˜åŒ–</strong></p>
<ul>
<li>å†·å¯åŠ¨é˜¶æ®µå„è¿›ç¨‹çš„åŠ è½½é¡ºåº</li>
<li>å¦‚ä½•å‡å°‘åŠ¨æ€åº“åŠ è½½æ—¶é—´ï¼Ÿ</li>
</ul>
</li>
<li><p><strong>å†…å­˜ä¼˜åŒ–</strong></p>
<ul>
<li>ä½¿ç”¨ Instruments å®šä½å†…å­˜æ³„æ¼çš„æ­¥éª¤</li>
<li><code>NSCache</code> ä¸ <code>URLCache</code> çš„æœ€ä½³å®è·µ</li>
</ul>
</li>
<li><p><strong>æ¸²æŸ“æ€§èƒ½</strong></p>
<ul>
<li>å¦‚ä½•æ£€æµ‹å’Œè§£å†³æ‰å¸§é—®é¢˜ï¼Ÿ</li>
<li>ç¦»å±æ¸²æŸ“çš„å¸¸è§åœºæ™¯ä¸ä¼˜åŒ–æ–¹æ¡ˆ</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ğŸŒ-ç½‘ç»œä¸å­˜å‚¨"><a href="#ğŸŒ-ç½‘ç»œä¸å­˜å‚¨" class="headerlink" title="ğŸŒ ç½‘ç»œä¸å­˜å‚¨"></a>ğŸŒ ç½‘ç»œä¸å­˜å‚¨</h2><ol>
<li><p><strong>HTTP&#x2F;2 ä¸ QUIC</strong></p>
<ul>
<li>å¯¹æ¯” HTTP&#x2F;1.1 çš„æ ¸å¿ƒæ”¹è¿›ç‚¹</li>
<li>iOS å¦‚ä½•æ”¯æŒ QUIC åè®®ï¼Ÿ</li>
</ul>
</li>
<li><p><strong>æ•°æ®æŒä¹…åŒ–</strong></p>
<ul>
<li>Core Data ä¸ SwiftData çš„æ¶æ„å·®å¼‚</li>
<li>å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ Realm çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹</li>
</ul>
</li>
<li><p><strong>å®‰å…¨æœºåˆ¶</strong></p>
<ul>
<li>å¦‚ä½•é˜²æ­¢ä¸­é—´äººæ”»å‡»ï¼ˆMITMï¼‰ï¼Ÿ</li>
<li>Keychain æ•°æ®å­˜å‚¨çš„åŠ å¯†åŸç†</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ğŸ”„-å¤šçº¿ç¨‹ä¸å¹¶å‘"><a href="#ğŸ”„-å¤šçº¿ç¨‹ä¸å¹¶å‘" class="headerlink" title="ğŸ”„ å¤šçº¿ç¨‹ä¸å¹¶å‘"></a>ğŸ”„ å¤šçº¿ç¨‹ä¸å¹¶å‘</h2><ol>
<li><p><strong>GCD é«˜çº§ç”¨æ³•</strong></p>
<ul>
<li><code>dispatch_barrier_async</code> çš„åº”ç”¨åœºæ™¯</li>
<li>å¦‚ä½•åˆ›å»ºå¯å–æ¶ˆçš„ DispatchWorkItemï¼Ÿ</li>
</ul>
</li>
<li><p><strong>OperationQueue</strong></p>
<ul>
<li>å¦‚ä½•å®ç°ä»»åŠ¡ä¾èµ–ä¸ä¼˜å…ˆçº§æ§åˆ¶ï¼Ÿ</li>
<li>å¯¹æ¯” GCD çš„ä¼˜åŠ£</li>
</ul>
</li>
<li><p><strong>Actor æ¨¡å‹</strong></p>
<ul>
<li>Swift Actor å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</li>
<li><code>nonisolated</code> å…³é”®å­—çš„ç”¨é€”</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ğŸ§ª-æµ‹è¯•ä¸è°ƒè¯•"><a href="#ğŸ§ª-æµ‹è¯•ä¸è°ƒè¯•" class="headerlink" title="ğŸ§ª æµ‹è¯•ä¸è°ƒè¯•"></a>ğŸ§ª æµ‹è¯•ä¸è°ƒè¯•</h2><ol>
<li><p><strong>å•å…ƒæµ‹è¯•</strong></p>
<ul>
<li>å¦‚ä½•å¯¹å¼‚æ­¥ä»£ç è¿›è¡Œæµ‹è¯•ï¼Ÿ</li>
<li>ä¾èµ–æ³¨å…¥åœ¨æµ‹è¯•ä¸­çš„åº”ç”¨</li>
</ul>
</li>
<li><p><strong>UI è‡ªåŠ¨åŒ–</strong></p>
<ul>
<li>XCUITest çš„æ ¸å¿ƒç»„ä»¶ä¸ä½¿ç”¨é™åˆ¶</li>
<li>å¦‚ä½•å®ç°è·¨è¯­è¨€è‡ªåŠ¨åŒ–æµ‹è¯•ï¼ˆAppiumï¼‰</li>
</ul>
</li>
<li><p><strong>Crash åˆ†æ</strong></p>
<ul>
<li>ç¬¦å·åŒ–å´©æºƒæ—¥å¿—çš„å®Œæ•´æµç¨‹</li>
<li>å¦‚ä½•æ•è·å¹¶ä¸ŠæŠ¥é‡æŒ‡é’ˆå¼‚å¸¸ï¼Ÿ</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ğŸ§ -ç³»ç»Ÿè®¾è®¡é¢˜"><a href="#ğŸ§ -ç³»ç»Ÿè®¾è®¡é¢˜" class="headerlink" title="ğŸ§  ç³»ç»Ÿè®¾è®¡é¢˜"></a>ğŸ§  ç³»ç»Ÿè®¾è®¡é¢˜</h2><ol>
<li><p><strong>æ¶æ„è®¾è®¡</strong></p>
<ul>
<li>è®¾è®¡ä¸€ä¸ªæ”¯æŒ LRU ç¼“å­˜çš„å›¾ç‰‡åŠ è½½åº“</li>
<li>å®ç°ä¸€ä¸ªæ”¯æŒæ–­ç‚¹ç»­ä¼ çš„ä¸‹è½½ç®¡ç†å™¨</li>
</ul>
</li>
<li><p><strong>åœºæ™¯æ–¹æ¡ˆ</strong></p>
<ul>
<li>å¦‚ä½•ä¿è¯å¼±ç½‘ç¯å¢ƒä¸‹æ¶ˆæ¯çš„å¯é ä¼ è¾“ï¼Ÿ</li>
<li>è®¾è®¡ä¸€ä¸ªå³æ—¶é€šè®¯åº”ç”¨çš„æ¶ˆæ¯åŒæ­¥æœºåˆ¶</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ğŸ’»-ç®—æ³•ä¸æ•°æ®ç»“æ„"><a href="#ğŸ’»-ç®—æ³•ä¸æ•°æ®ç»“æ„" class="headerlink" title="ğŸ’» ç®—æ³•ä¸æ•°æ®ç»“æ„"></a>ğŸ’» ç®—æ³•ä¸æ•°æ®ç»“æ„</h2><ol>
<li><p><strong>é«˜é¢‘ç®—æ³•</strong></p>
<ul>
<li>é“¾è¡¨åè½¬ï¼ˆè¿­ä»£&#x2F;é€’å½’ï¼‰</li>
<li>äºŒå‰æ ‘å±‚åºéå†</li>
<li>æœ€é•¿æ— é‡å¤å­ä¸²</li>
</ul>
</li>
<li><p><strong>ä¼˜åŒ–æ€ç»´</strong></p>
<ul>
<li>ä¸¤æ•°ä¹‹å’Œçš„å¤šç§è§£æ³•å¯¹æ¯”ï¼ˆå“ˆå¸Œè¡¨&#x2F;åŒæŒ‡é’ˆï¼‰</li>
<li>åŠ¨æ€è§„åˆ’è§£å†³èƒŒåŒ…é—®é¢˜</li>
</ul>
</li>
</ol>
<hr>
<blockquote>
<p><strong>æç¤º</strong>ï¼šæ¯ä¸ªé—®é¢˜å»ºè®®å»¶ä¼¸æ€è€ƒï¼š</p>
<ul>
<li>è¯¥æŠ€æœ¯ç‚¹çš„åº•å±‚åŸç†ï¼ˆå¦‚ Runtime æœºåˆ¶ï¼‰</li>
<li>å®é™…é¡¹ç›®ä¸­çš„å®è·µæ¡ˆä¾‹</li>
<li>ä¸åŒæ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹å¯¹æ¯”</li>
</ul>
</blockquote>
<p><strong>æ³¨</strong>ï¼šç»“åˆæœ€æ–° iOS 19 ç‰¹æ€§ï¼ˆå¦‚ Vision Pro å¼€å‘ï¼‰å‡†å¤‡å·®å¼‚åŒ–ç­”æ¡ˆ ğŸš€</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>çŸ¥è¯†ç‚¹</tag>
        <tag>é¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>iOS å¼€å‘è€…æŠ€æœ¯è·¯çº¿å›¾ï¼ˆ2025 å¹´ï¼‰</title>
    <url>/2024/01/01/%E6%8A%80%E6%9C%AF%E8%B7%AF%E7%BA%BF%E5%9B%BE/</url>
    <content><![CDATA[<p>æœ¬æ–‡æ•´ç†äº†iOSå¼€å‘è€…æ‰€éœ€æŒæ¡çš„æ ¸å¿ƒæŠ€èƒ½å’Œå­¦ä¹ è·¯å¾„ï¼Œå¸®åŠ©å¼€å‘è€…è§„åˆ’èŒä¸šå‘å±•ã€‚</p>
<hr>
<h2 id="ğŸŒŸ-åŸºç¡€èƒ½åŠ›"><a href="#ğŸŒŸ-åŸºç¡€èƒ½åŠ›" class="headerlink" title="ğŸŒŸ åŸºç¡€èƒ½åŠ›"></a>ğŸŒŸ åŸºç¡€èƒ½åŠ›</h2><h3 id="1-ç¼–ç¨‹è¯­è¨€"><a href="#1-ç¼–ç¨‹è¯­è¨€" class="headerlink" title="1. ç¼–ç¨‹è¯­è¨€"></a>1. ç¼–ç¨‹è¯­è¨€</h3><ul>
<li><strong>Swift</strong><ul>
<li>æŒæ¡è¯­æ³•åŸºç¡€ï¼ˆå˜é‡ã€æ§åˆ¶æµã€å‡½æ•°ã€é—­åŒ…ï¼‰</li>
<li>æ·±å…¥ç†è§£ <code>Optional</code>ã€æ³›å‹ã€åè®®ã€<code>async/await</code></li>
<li>å­¦ä¹  Swift Concurrencyï¼ˆ<code>Task</code>ã€<code>Actor</code>ã€<code>Sendable</code>ï¼‰</li>
</ul>
</li>
<li><strong>Objective-Cï¼ˆå¯é€‰ï¼‰</strong><ul>
<li>ç†è§£ä¸ Swift çš„æ··ç¼–æœºåˆ¶</li>
<li>é˜…è¯»é—ç•™ä»£ç åº“çš„å…¼å®¹æ€§</li>
</ul>
</li>
</ul>
<h3 id="2-å¼€å‘å·¥å…·"><a href="#2-å¼€å‘å·¥å…·" class="headerlink" title="2. å¼€å‘å·¥å…·"></a>2. å¼€å‘å·¥å…·</h3><ul>
<li><strong>Xcode</strong><ul>
<li>ç†Ÿç»ƒä½¿ç”¨ Interface Builderã€Storyboard&#x2F;XIB</li>
<li>æŒæ¡ LLDB è°ƒè¯•ã€Instruments æ€§èƒ½åˆ†æ</li>
<li>ç†Ÿæ‚‰ Swift Package Managerï¼ˆSPMï¼‰ä¾èµ–ç®¡ç†</li>
</ul>
</li>
<li><strong>ç»ˆç«¯å·¥å…·</strong><ul>
<li>åŸºç¡€ Shell å‘½ä»¤ï¼ˆ<code>xcodebuild</code>ã€<code>xcrun</code>ï¼‰</li>
<li>Fastlane è‡ªåŠ¨åŒ–ï¼ˆæ„å»ºã€æµ‹è¯•ã€å‘å¸ƒï¼‰</li>
</ul>
</li>
</ul>
<hr>
<h2 id="ğŸ¨-UI-UX-å¼€å‘"><a href="#ğŸ¨-UI-UX-å¼€å‘" class="headerlink" title="ğŸ¨ UI&#x2F;UX å¼€å‘"></a>ğŸ¨ UI&#x2F;UX å¼€å‘</h2><h3 id="1-åŸç”Ÿæ¡†æ¶"><a href="#1-åŸç”Ÿæ¡†æ¶" class="headerlink" title="1. åŸç”Ÿæ¡†æ¶"></a>1. åŸç”Ÿæ¡†æ¶</h3><ul>
<li><strong>UIKit</strong><ul>
<li>Auto Layout ä¸è‡ªé€‚åº”å¸ƒå±€</li>
<li>æ ¸å¿ƒç»„ä»¶ï¼ˆ<code>UITableView</code>ã€<code>UICollectionView</code>ï¼‰</li>
<li>è‡ªå®šä¹‰è§†å›¾ä¸åŠ¨ç”»ï¼ˆ<code>CALayer</code>ã€<code>UIViewPropertyAnimator</code>ï¼‰</li>
</ul>
</li>
<li><strong>SwiftUI</strong><ul>
<li>å£°æ˜å¼è¯­æ³•ä¸æ•°æ®ç»‘å®šï¼ˆ<code>@State</code>ã€<code>@Binding</code>ï¼‰</li>
<li>å¤æ‚å¸ƒå±€ï¼ˆ<code>Grid</code>ã€<code>LazyVStack</code>ï¼‰</li>
<li>è·¨å¹³å°é€‚é…ï¼ˆiOS&#x2F;macOS&#x2F;watchOSï¼‰</li>
</ul>
</li>
</ul>
<h3 id="2-è®¾è®¡è§„èŒƒ"><a href="#2-è®¾è®¡è§„èŒƒ" class="headerlink" title="2. è®¾è®¡è§„èŒƒ"></a>2. è®¾è®¡è§„èŒƒ</h3><ul>
<li><strong>Human Interface Guidelines</strong><ul>
<li>éµå¾ª Apple è®¾è®¡åŸåˆ™ï¼ˆäº¤äº’ã€å›¾æ ‡ã€åŠ¨æ•ˆï¼‰</li>
<li>é€‚é…ä¸åŒè®¾å¤‡å°ºå¯¸ï¼ˆiPhone&#x2F;iPad&#x2F;æŠ˜å å±ï¼‰</li>
<li>æ— éšœç¢æ”¯æŒï¼ˆVoiceOverã€åŠ¨æ€å­—ä½“ï¼‰</li>
</ul>
</li>
</ul>
<hr>
<h2 id="ğŸ”—-ç½‘ç»œä¸æ•°æ®"><a href="#ğŸ”—-ç½‘ç»œä¸æ•°æ®" class="headerlink" title="ğŸ”— ç½‘ç»œä¸æ•°æ®"></a>ğŸ”— ç½‘ç»œä¸æ•°æ®</h2><h3 id="1-ç½‘ç»œè¯·æ±‚"><a href="#1-ç½‘ç»œè¯·æ±‚" class="headerlink" title="1. ç½‘ç»œè¯·æ±‚"></a>1. ç½‘ç»œè¯·æ±‚</h3><ul>
<li><strong>URLSession</strong><ul>
<li>å®ç° RESTful API è°ƒç”¨ï¼ˆGET&#x2F;POST&#x2F;DELETEï¼‰</li>
<li>å¤„ç†åå°ä¸‹è½½&#x2F;ä¸Šä¼ ä»»åŠ¡</li>
<li>ä¼˜åŒ–ç¼“å­˜ç­–ç•¥ï¼ˆ<code>URLCache</code>ã€<code>NSURLCache</code>ï¼‰</li>
</ul>
</li>
<li><strong>Alamofireï¼ˆç¬¬ä¸‰æ–¹åº“ï¼‰</strong><ul>
<li>å°è£…ç½‘ç»œå±‚ï¼ˆæ‹¦æˆªå™¨ã€è¯·æ±‚é‡è¯•ï¼‰</li>
<li>ç»“åˆ Combine&#x2F;Swift Concurrency</li>
</ul>
</li>
</ul>
<h3 id="2-æ•°æ®å­˜å‚¨"><a href="#2-æ•°æ®å­˜å‚¨" class="headerlink" title="2. æ•°æ®å­˜å‚¨"></a>2. æ•°æ®å­˜å‚¨</h3><ul>
<li><strong>Core Data</strong><ul>
<li>æ•°æ®æ¨¡å‹è®¾è®¡ä¸ç‰ˆæœ¬è¿ç§»</li>
<li>æ€§èƒ½ä¼˜åŒ–ï¼ˆæ‰¹é‡æ“ä½œã€é¢„å–ï¼‰</li>
</ul>
</li>
<li><strong>SwiftDataï¼ˆæ¨èï¼‰</strong><ul>
<li>å£°æ˜å¼æ•°æ®ç®¡ç†ï¼ˆ<code>@Model</code> å®ï¼‰</li>
<li>ä¸ SwiftUI æ·±åº¦é›†æˆ</li>
</ul>
</li>
<li><strong>Realm&#x2F;GRDBï¼ˆå¯é€‰ï¼‰</strong><ul>
<li>æ›¿ä»£æ•°æ®åº“æ–¹æ¡ˆå¯¹æ¯”</li>
</ul>
</li>
</ul>
<hr>
<h2 id="âš¡-æ€§èƒ½ä¼˜åŒ–"><a href="#âš¡-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="âš¡ æ€§èƒ½ä¼˜åŒ–"></a>âš¡ æ€§èƒ½ä¼˜åŒ–</h2><h3 id="1-å…³é”®æŒ‡æ ‡"><a href="#1-å…³é”®æŒ‡æ ‡" class="headerlink" title="1. å…³é”®æŒ‡æ ‡"></a>1. å…³é”®æŒ‡æ ‡</h3><ul>
<li><strong>å¯åŠ¨æ—¶é—´ä¼˜åŒ–</strong><ul>
<li>å†·å¯åŠ¨&#x2F;çƒ­å¯åŠ¨åˆ†æ</li>
<li>å‡å°‘åŠ¨æ€åº“åŠ è½½ï¼ˆ<code>dyld</code> ä¼˜åŒ–ï¼‰</li>
</ul>
</li>
<li><strong>å†…å­˜ç®¡ç†</strong><ul>
<li>æ£€æµ‹å¾ªç¯å¼•ç”¨ï¼ˆ<code>weak</code>ã€<code>unowned</code>ï¼‰</li>
<li>ä½¿ç”¨ Memory Graph Debugger</li>
</ul>
</li>
<li><strong>æ¸²æŸ“æ€§èƒ½</strong><ul>
<li>è§£å†³æ‰å¸§é—®é¢˜ï¼ˆ<code>CADisplayLink</code> ç›‘æµ‹ï¼‰</li>
<li>ç¦»å±æ¸²æŸ“ä¼˜åŒ–ï¼ˆ<code>cornerRadius</code> æ›¿ä»£æ–¹æ¡ˆï¼‰</li>
</ul>
</li>
</ul>
<h3 id="2-å·¥å…·é“¾"><a href="#2-å·¥å…·é“¾" class="headerlink" title="2. å·¥å…·é“¾"></a>2. å·¥å…·é“¾</h3><ul>
<li><strong>Instruments</strong><ul>
<li>Time Profiler å®šä½ CPU ç“¶é¢ˆ</li>
<li>Allocations åˆ†æå†…å­˜æ³„æ¼</li>
</ul>
</li>
<li><strong>Xcode Metrics</strong><ul>
<li>ç›‘æ§çº¿ä¸Šç”¨æˆ·æ€§èƒ½æ•°æ®ï¼ˆç”µæ± ã€å¡é¡¿ç‡ï¼‰</li>
</ul>
</li>
</ul>
<hr>
<h2 id="ğŸ§ª-æµ‹è¯•ä¸è°ƒè¯•"><a href="#ğŸ§ª-æµ‹è¯•ä¸è°ƒè¯•" class="headerlink" title="ğŸ§ª æµ‹è¯•ä¸è°ƒè¯•"></a>ğŸ§ª æµ‹è¯•ä¸è°ƒè¯•</h2><h3 id="1-å•å…ƒæµ‹è¯•"><a href="#1-å•å…ƒæµ‹è¯•" class="headerlink" title="1. å•å…ƒæµ‹è¯•"></a>1. å•å…ƒæµ‹è¯•</h3><ul>
<li><strong>XCTest æ¡†æ¶</strong><ul>
<li>ç¼–å†™å¯ç»´æŠ¤çš„æµ‹è¯•ç”¨ä¾‹</li>
<li>è¦†ç›–ç‡åˆ†æï¼ˆXcode Coverageï¼‰</li>
</ul>
</li>
<li><strong>Snapshot Testingï¼ˆç¬¬ä¸‰æ–¹ï¼‰</strong><ul>
<li>éªŒè¯ UI ä¸€è‡´æ€§ï¼ˆiOSSnapshotTestCaseï¼‰</li>
</ul>
</li>
</ul>
<h3 id="2-è°ƒè¯•æŠ€å·§"><a href="#2-è°ƒè¯•æŠ€å·§" class="headerlink" title="2. è°ƒè¯•æŠ€å·§"></a>2. è°ƒè¯•æŠ€å·§</h3><ul>
<li><strong>æ–­ç‚¹é«˜çº§ç”¨æ³•</strong><ul>
<li>æ¡ä»¶æ–­ç‚¹ã€ç¬¦å·æ–­ç‚¹</li>
<li>LLDB å‘½ä»¤ï¼ˆ<code>po</code>ã€<code>expression</code>ï¼‰</li>
</ul>
</li>
<li><strong>Proxyman&#x2F;Charles</strong><ul>
<li>æŠ“åŒ…åˆ†æä¸ Mock æ•°æ®</li>
</ul>
</li>
</ul>
<hr>
<h2 id="ğŸ—ï¸-æ¶æ„è®¾è®¡"><a href="#ğŸ—ï¸-æ¶æ„è®¾è®¡" class="headerlink" title="ğŸ—ï¸ æ¶æ„è®¾è®¡"></a>ğŸ—ï¸ æ¶æ„è®¾è®¡</h2><h3 id="1-ä¸»æµæ¨¡å¼"><a href="#1-ä¸»æµæ¨¡å¼" class="headerlink" title="1. ä¸»æµæ¨¡å¼"></a>1. ä¸»æµæ¨¡å¼</h3><ul>
<li><strong>MVVM</strong><ul>
<li>ç»“åˆ Combine&#x2F;Swift Concurrency</li>
<li>åŒå‘æ•°æ®ç»‘å®šï¼ˆ<code>@Published</code>ï¼‰</li>
</ul>
</li>
<li><strong>VIPERï¼ˆå¤æ‚åœºæ™¯ï¼‰</strong><ul>
<li>æ¨¡å—åŒ–æ‹†åˆ†ï¼ˆRouter&#x2F;Interactorï¼‰</li>
</ul>
</li>
<li><strong>TCAï¼ˆThe Composable Architectureï¼‰</strong><ul>
<li>çŠ¶æ€ç®¡ç†ï¼ˆ<code>Reducer</code>ã€<code>Store</code>ï¼‰</li>
</ul>
</li>
</ul>
<h3 id="2-è®¾è®¡åŸåˆ™"><a href="#2-è®¾è®¡åŸåˆ™" class="headerlink" title="2. è®¾è®¡åŸåˆ™"></a>2. è®¾è®¡åŸåˆ™</h3><ul>
<li><strong>SOLID åŸåˆ™</strong><ul>
<li>å•ä¸€èŒè´£ã€ä¾èµ–å€’ç½®</li>
</ul>
</li>
<li><strong>DIï¼ˆä¾èµ–æ³¨å…¥ï¼‰</strong><ul>
<li>ä½¿ç”¨ Swinject&#x2F;Factory æ¡†æ¶</li>
</ul>
</li>
</ul>
<hr>
<h2 id="ğŸŒ-è·¨å¹³å°æŠ€æœ¯"><a href="#ğŸŒ-è·¨å¹³å°æŠ€æœ¯" class="headerlink" title="ğŸŒ è·¨å¹³å°æŠ€æœ¯"></a>ğŸŒ è·¨å¹³å°æŠ€æœ¯</h2><h3 id="1-æ··åˆå¼€å‘"><a href="#1-æ··åˆå¼€å‘" class="headerlink" title="1. æ··åˆå¼€å‘"></a>1. æ··åˆå¼€å‘</h3><ul>
<li><strong>Flutterï¼ˆæ¨èï¼‰</strong><ul>
<li>ä½¿ç”¨ Dart æ„å»ºè·¨ç«¯ UI</li>
<li>ä¸åŸç”Ÿæ¨¡å—é€šä¿¡ï¼ˆPlatform Channelï¼‰</li>
</ul>
</li>
<li><strong>React Nativeï¼ˆå¯é€‰ï¼‰</strong><ul>
<li>JavaScript æ¡¥æ¥åŸç”Ÿèƒ½åŠ›</li>
</ul>
</li>
</ul>
<h3 id="2-è‹¹æœç”Ÿæ€æ‰©å±•"><a href="#2-è‹¹æœç”Ÿæ€æ‰©å±•" class="headerlink" title="2. è‹¹æœç”Ÿæ€æ‰©å±•"></a>2. è‹¹æœç”Ÿæ€æ‰©å±•</h3><ul>
<li><strong>watchOS&#x2F;tvOS</strong><ul>
<li>å¼€å‘é…å¥—åº”ç”¨ï¼ˆHealthKit&#x2F;HomeKitï¼‰</li>
</ul>
</li>
<li><strong>CarPlay</strong><ul>
<li>è½¦è½½ç³»ç»Ÿé€‚é…æŒ‡å—</li>
</ul>
</li>
</ul>
<hr>
<h2 id="ğŸš€-è¿›é˜¶é¢†åŸŸ"><a href="#ğŸš€-è¿›é˜¶é¢†åŸŸ" class="headerlink" title="ğŸš€ è¿›é˜¶é¢†åŸŸ"></a>ğŸš€ è¿›é˜¶é¢†åŸŸ</h2><h3 id="1-æ–°æŠ€æœ¯"><a href="#1-æ–°æŠ€æœ¯" class="headerlink" title="1. æ–°æŠ€æœ¯"></a>1. æ–°æŠ€æœ¯</h3><ul>
<li><strong>AR&#x2F;VR</strong><ul>
<li>ä½¿ç”¨ ARKit å¼€å‘æ²‰æµ¸å¼ä½“éªŒ</li>
</ul>
</li>
<li><strong>æœºå™¨å­¦ä¹ </strong><ul>
<li>Core ML æ¨¡å‹é›†æˆï¼ˆå›¾åƒåˆ†ç±»ã€NLPï¼‰</li>
</ul>
</li>
<li><strong>Swift ç¼–è¯‘å™¨æ’ä»¶</strong><ul>
<li>è‡ªå®šä¹‰å®ï¼ˆ<code>@freestanding</code>ã€<code>@attached</code>ï¼‰</li>
</ul>
</li>
</ul>
<h3 id="2-å·¥ç¨‹åŒ–"><a href="#2-å·¥ç¨‹åŒ–" class="headerlink" title="2. å·¥ç¨‹åŒ–"></a>2. å·¥ç¨‹åŒ–</h3><ul>
<li><strong>CI&#x2F;CD</strong><ul>
<li>GitHub Actions&#x2F;Bitrise æµæ°´çº¿æ­å»º</li>
<li>TestFlight åˆ†å‘ä¸ç®¡ç†</li>
</ul>
</li>
<li><strong>App Store ä¸Šæ¶</strong><ul>
<li>å®¡æ ¸é¿å‘æŒ‡å—ï¼ˆéšç§æ”¿ç­–ã€å…ƒæ•°æ®ï¼‰</li>
</ul>
</li>
</ul>
<hr>
<h2 id="ğŸ“š-æŒç»­å­¦ä¹ "><a href="#ğŸ“š-æŒç»­å­¦ä¹ " class="headerlink" title="ğŸ“š æŒç»­å­¦ä¹ "></a>ğŸ“š æŒç»­å­¦ä¹ </h2><h3 id="1-èµ„æºæ¨è"><a href="#1-èµ„æºæ¨è" class="headerlink" title="1. èµ„æºæ¨è"></a>1. èµ„æºæ¨è</h3><ul>
<li><strong>å®˜æ–¹æ–‡æ¡£</strong><ul>
<li><a href="https://developer.apple.com/">Apple Developer</a></li>
<li>WWDC è§†é¢‘ï¼ˆå¹´åº¦æ–°æŠ€æœ¯è§£æï¼‰</li>
</ul>
</li>
<li><strong>ä¹¦ç±</strong><ul>
<li>ã€ŠSwift è¿›é˜¶ã€‹</li>
<li>ã€ŠCombine å¼‚æ­¥ç¼–ç¨‹ã€‹</li>
</ul>
</li>
<li><strong>ç¤¾åŒº</strong><ul>
<li>Swift è®ºå›ã€iOS Dev Weekly</li>
</ul>
</li>
</ul>
<h3 id="2-å®è·µå»ºè®®"><a href="#2-å®è·µå»ºè®®" class="headerlink" title="2. å®è·µå»ºè®®"></a>2. å®è·µå»ºè®®</h3><ul>
<li><strong>å¼€æºè´¡çŒ®</strong><ul>
<li>Alamofire&#x2F;SwiftUI æºç é˜…è¯»</li>
</ul>
</li>
<li><strong>ä¸ªäººé¡¹ç›®</strong><ul>
<li>å¼€å‘å®Œæ•´ä¸Šæ¶åº”ç”¨ï¼ˆä» 0 åˆ° 1 é—­ç¯ï¼‰</li>
</ul>
</li>
</ul>
<hr>
<blockquote>
<p><strong>æç¤º</strong>ï¼šæŠ€æœ¯è·¯çº¿éœ€æ ¹æ®ä¸ªäººç›®æ ‡åŠ¨æ€è°ƒæ•´ï¼Œå»ºè®®æ¯åŠå¹´å¤ç›˜ä¸€æ¬¡æŠ€èƒ½æ ‘ ğŸ¯</p>
</blockquote>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>èŒä¸šå‘å±•</tag>
        <tag>å­¦ä¹ è·¯å¾„</tag>
      </tags>
  </entry>
</search>
